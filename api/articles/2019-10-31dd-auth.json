{"title":"é’‰é’‰æˆæƒ-å•tokenåˆ·æ–°","uid":"8fa718ac5651ee524192868a31e6e820","slug":"2019-10-31dd-auth","date":"2019-10-31T12:49:53.000Z","updated":"2022-09-16T13:54:56.088Z","comments":true,"path":"api/articles/2019-10-31dd-auth.json","keywords":null,"cover":null,"content":"<h2 id=\"é’‰é’‰æˆæƒ\"><a href=\"#é’‰é’‰æˆæƒ\" class=\"headerlink\" title=\"é’‰é’‰æˆæƒ\"></a>é’‰é’‰æˆæƒ</h2><p> é’‰é’‰å°ç¨‹åºï¼Œå•tokené˜²æ­¢è¿›è¡Œtokenåˆ·æ–°</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; åˆ·æ–°token\nfunction refreshToken(corpId, cb) &#123;\n  dd.getAuthCode(&#123;\n    success: async (res) &#x3D;&gt; &#123;\n      const params &#x3D; &#123;\n        authCode: res.authCode,\n        corpId,\n      &#125;;\n      dd.stopPullDownRefresh();\n      const resAuth &#x3D; await authDing(params);\n      &#x2F;&#x2F; åªæœ‰æˆæƒæˆåŠŸæƒ…å†µä¸‹æ‰å¯ä»¥\n      if (resAuth.code &#x3D;&#x3D;&#x3D; &quot;000000&quot;) &#123;\n        saveToken(resAuth.data.token);\n        setLastTokenTime(new Date().getTime().toString());\n        if (cb) &#123;\n          cb();\n        &#125;\n      &#125; else &#123;\n        showToastFail(JSON.stringify(resAuth));\n      &#125;\n    &#125;,\n    fail: (err) &#x3D;&gt; &#123;\n      showToastFail(JSON.stringify(err));\n    &#125;,\n  &#125;);\n&#125;\n&#x2F;**\n * é’‰é’‰æˆæƒ\n * corpId ä¼ä¸šé’‰é’‰ç»„ç»‡id\n * callBack æˆæƒæˆåŠŸåçš„å›è°ƒ\n * *&#x2F;\nexport function ddAuth(corpId, callBack) &#123;\n  const currentTime &#x3D; new Date().getTime();\n  const lastTokenTime &#x3D; getLastTokenTime() || 0;\n  &#x2F;&#x2F; å‘å¸ƒ\n  if (config.release) &#123;\n    try &#123;\n      &#x2F;&#x2F; å¤§äº23å°æ—¶ï¼Œé‡æ–°æˆæƒ\n      if (currentTime - +lastTokenTime &gt; 23 * 60 * 60 * 1000) &#123;\n        refreshToken(corpId, callBack);\n        console.log(&quot;é‡æ–°æˆæƒ&quot;);\n      &#125; else &#123;\n        &#x2F;&#x2F; å°äº23å°æ—¶ï¼Œå¤§äº6å°æ—¶ï¼Œåˆ·æ–°\n        callBack();\n        &#x2F;&#x2F; åˆ·æ–°token\n        if (currentTime - +lastTokenTime &gt; 6 * 60 * 60 * 1000) &#123;\n          refreshToken(corpId);\n        &#125;\n      &#125;\n    &#125; catch (error) &#123;\n      showToastFail(error);\n    &#125;\n    &#x2F;&#x2F; å¼€å‘è°ƒè¯•\n  &#125; else &#123;\n    callBack();\n    &#x2F;&#x2F; showToastFail(&quot;å¼€å‘ç™»å½•è¶…æ—¶ï¼Œé‡æ–°ç™»å½•&quot;)\n  &#125;\n&#125;</code></pre>\n","text":"é’‰é’‰æˆæƒ é’‰é’‰å°ç¨‹åºï¼Œå•tokené˜²æ­¢è¿›è¡Œtokenåˆ·æ–° &#x2F;&#x2F; åˆ·æ–°token function refreshToken(corpId, cb) &#123; dd.getAuthCode(&#123; success: async (res) &#x3D;...","link":"","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[{"name":"é’‰é’‰å°ç¨‹åº","slug":"é’‰é’‰å°ç¨‹åº","count":1,"path":"api/categories/é’‰é’‰å°ç¨‹åº.json"}],"tags":[{"name":"é’‰é’‰å°ç¨‹åº","slug":"é’‰é’‰å°ç¨‹åº","count":1,"path":"api/tags/é’‰é’‰å°ç¨‹åº.json"},{"name":"token","slug":"token","count":1,"path":"api/tags/token.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%92%89%E9%92%89%E6%8E%88%E6%9D%83\"><span class=\"toc-text\">é’‰é’‰æˆæƒ</span></a></li></ol>","author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"npm åŒ…å‘å¸ƒç›¸å…³","uid":"33a4c09d5b272c8b61a9dda679d7a5e9","slug":"2022-04-28npm","date":"2020-04-28T01:20:00.000Z","updated":"2022-09-16T13:54:56.096Z","comments":true,"path":"api/articles/2022-04-28npm.json","keywords":null,"cover":"http://t-blog-images.aijs.top/img/20220519182933.webp","text":"npm åŒ…å‘å¸ƒnpm notice &#x3D;&#x3D;&#x3D; Tarball Details &#x3D;&#x3D;&#x3D; npm notice name: @tutu-fe&#x2F;wiki-ui npm notice version: 0.1.1-bet...","link":"","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"npm","slug":"npm","count":4,"path":"api/categories/npm.json"}],"tags":[{"name":"npm","slug":"npm","count":5,"path":"api/tags/npm.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"Git public key","uid":"e8f86794a8b73abb4c26e162bb1c7550","slug":"2016-06-20git","date":"2019-10-30T13:30:47.000Z","updated":"2022-09-16T13:54:56.086Z","comments":true,"path":"api/articles/2016-06-20git.json","keywords":null,"cover":[],"text":"[root@izbp1hun1qsl59e2nzqyvcz ~]# git config --global user.name &quot;hailong.chen&quot; [root@izbp1hun1qsl59e2nzqyvcz ~]# git config --glob...","link":"","photos":[],"count_time":{"symbolsCount":"5.5k","symbolsTime":"5 mins."},"categories":[{"name":"git","slug":"git","count":1,"path":"api/categories/git.json"}],"tags":[{"name":"git","slug":"git","count":1,"path":"api/tags/git.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}