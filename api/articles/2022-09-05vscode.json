{"title":"vscode react-javascript-snippets源码","uid":"1ad99506e723aeb106287f0014b15cda","slug":"2022-09-05vscode","date":"2022-09-05T02:35:51.000Z","updated":"2022-09-16T13:54:56.317Z","comments":true,"path":"api/articles/2022-09-05vscode.json","keywords":null,"cover":[],"content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>要分享自己开发的代码片段工具 <a href=\"http://v.aijs.top/post/2022-05-11vscode\" target=\"_blank\" ><code>vs-snippets</code></a>，正所谓：<code>没有对比，就没有伤害</code>,了解下别人是如何开发代码片段插件的思路，做个对比</p>\n<p>不得不说，<code>react-javascript-snippets</code> 无论从源代码组织还是支持的代码片段来讲都非常优秀，对于大众化来讲非常 nice。 然而项目开发总有那么多定制化，作为一款代码片段插件来讲，私有定制化却并不是那么灵活</p>\n<h2 id=\"package-json\"><a href=\"#package-json\" class=\"headerlink\" title=\"package.json\"></a>package.json</h2><p>.json 文件不能增加注释</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;name&quot;: &quot;es7-react-js-snippets&quot;,\n  &quot;displayName&quot;: &quot;ES7+ React&#x2F;Redux&#x2F;React-Native snippets&quot;,\n  &quot;description&quot;: &quot;Extensions for React, React-Native and Redux in JS&#x2F;TS with ES7+ syntax. Customizable. Built-in integration with prettier.&quot;,\n  &quot;version&quot;: &quot;4.4.3&quot;,\n  &quot;publisher&quot;: &quot;dsznajder&quot;,\n  &quot;icon&quot;: &quot;images&#x2F;logo.png&quot;,\n  &quot;browser&quot;: &quot;.&#x2F;lib&#x2F;index.js&quot;,\n  &quot;main&quot;: &quot;.&#x2F;lib&#x2F;index.js&quot;,\n  &quot;keywords&quot;: [\n    &quot;snippets&quot;,\n    &quot;react&quot;,\n    &quot;redux&quot;,\n    &quot;react-native&quot;,\n    &quot;customizable&quot;,\n    &quot;javascript&quot;,\n    &quot;typescript&quot;,\n    &quot;prettier&quot;\n  ],\n  &quot;license&quot;: &quot;MIT&quot;,\n  &quot;repository&quot;: &#123;\n    &quot;type&quot;: &quot;git&quot;,\n    &quot;url&quot;: &quot;https:&#x2F;&#x2F;github.com&#x2F;dsznajder&#x2F;vscode-es7-javascript-react-snippets&quot;\n  &#125;,\n  &quot;engines&quot;: &#123;\n    &quot;vscode&quot;: &quot;^1.60.0&quot;\n  &#125;,\n  &#x2F;&#x2F; https:&#x2F;&#x2F;code.visualstudio.com&#x2F;api&#x2F;references&#x2F;extension-manifest#combining-extension-contributions\n  &quot;categories&quot;: [&quot;Snippets&quot;],\n  &quot;extensionKind&quot;: [&quot;ui&quot;, &quot;workspace&quot;],\n  &quot;capabilities&quot;: &#123;\n    &quot;virtualWorkspaces&quot;: true,\n    &quot;untrustedWorkspaces&quot;: &#123;\n      &quot;supported&quot;: true\n    &#125;\n  &#125;,\n  &#x2F;&#x2F; https:&#x2F;&#x2F;code.visualstudio.com&#x2F;api&#x2F;references&#x2F;extension-manifest\n  &quot;activationEvents&quot;: [\n    &quot;onLanguage:typescript&quot;,\n    &quot;onLanguage:typescriptReact&quot;,\n    &quot;onLanguage:javascript&quot;,\n    &quot;onLanguage:javascriptReact&quot;,\n    &quot;onCommand:reactSnippets.search&quot;,\n    &quot;onStartupFinished&quot;\n  ],\n  &quot;contributes&quot;: &#123;\n    &#x2F;&#x2F; 查询命令\n    &quot;commands&quot;: [\n      &#123;\n        &quot;command&quot;: &quot;reactSnippets.search&quot;,\n        &quot;title&quot;: &quot;Snippet search&quot;\n      &#125;\n    ],\n    &#x2F;&#x2F; 绑定快捷键\n    &quot;keybindings&quot;: [\n      &#123;\n        &quot;command&quot;: &quot;reactSnippets.search&quot;,\n        &quot;key&quot;: &quot;ctrl+alt+r&quot;,\n        &quot;mac&quot;: &quot;shift+cmd+r&quot;,\n        &quot;when&quot;: &quot;editorTextFocus&quot;\n      &#125;\n    ],\n    &#x2F;&#x2F; 配置信息\n    &quot;configuration&quot;: &#123;\n      &quot;title&quot;: &quot;ES React&#x2F;React-Native&#x2F;Redux snippets&quot;,\n      &quot;properties&quot;: &#123;\n        &#x2F;&#x2F; 是否启用prettier格式代码\n        &quot;reactSnippets.settings.prettierEnabled&quot;: &#123;\n          &quot;type&quot;: &quot;boolean&quot;,\n          &quot;markdownDescription&quot;: &quot;[EXPERIMENTAL: MIGHT NOT WORK]: Integrate prettier settings with code generated from snippets.&quot;,\n          &quot;default&quot;: false\n        &#125;,\n        &#x2F;&#x2F; 是否在顶部引入 react importReactOnTop\n        &quot;reactSnippets.settings.importReactOnTop&quot;: &#123;\n          &quot;type&quot;: &quot;boolean&quot;,\n          &quot;markdownDescription&quot;: &quot;Controls if snippets should add &#96;import React from &#39;react&#39;;&#96; at the top of components.\\nUse if you have React +17 and use jsx transform.&quot;,\n          &quot;default&quot;: true\n        &#125;,\n        &#x2F;&#x2F; 是否使用typescript\n        &quot;reactSnippets.settings.typescript&quot;: &#123;\n          &quot;type&quot;: &quot;boolean&quot;,\n          &quot;markdownDescription&quot;: &quot;Controls if React components have typescript Props typing.&quot;,\n          &quot;default&quot;: true\n        &#125;,\n        &#x2F;&#x2F; 语言范围\n        &quot;reactSnippets.settings.languageScopes&quot;: &#123;\n          &quot;type&quot;: &quot;string&quot;,\n          &quot;markdownDescription&quot;: &quot;defines the language scopes for which the snippets will be available.\\nUse comma separated values.\\nFor example: &#96;typescript,typescriptreact,javascript,javascriptreact&#96;&quot;,\n          &quot;default&quot;: &quot;typescript,typescriptreact,javascript,javascriptreact&quot;\n        &#125;,\n        &#x2F;&#x2F; props&#x2F;state. 使用type还是interface\n        &quot;reactSnippets.settings.typescriptPropsStatePrefix&quot;: &#123;\n          &quot;type&quot;: &quot;string&quot;,\n          &quot;markdownDescription&quot;: &quot;Controls which prefix for typescript snippets should use for props&#x2F;state.&quot;,\n          &quot;default&quot;: &quot;type&quot;,\n          &quot;enum&quot;: [&quot;type&quot;, &quot;interface&quot;]\n        &#125;\n      &#125;\n    &#125;,\n    &quot;snippets&quot;: [\n      &#x2F;&#x2F; js语言\n      &#123;\n        &quot;language&quot;: &quot;javascript&quot;,\n        &quot;path&quot;: &quot;.&#x2F;lib&#x2F;snippets&#x2F;generated.json&quot;\n      &#125;,\n      &#x2F;&#x2F; jsx语言\n      &#123;\n        &quot;language&quot;: &quot;javascriptreact&quot;,\n        &quot;path&quot;: &quot;.&#x2F;lib&#x2F;snippets&#x2F;generated.json&quot;\n      &#125;,\n      &#x2F;&#x2F; ts语言\n      &#123;\n        &quot;language&quot;: &quot;typescript&quot;,\n        &quot;path&quot;: &quot;.&#x2F;lib&#x2F;snippets&#x2F;generated.json&quot;\n      &#125;,\n      &#x2F;&#x2F; tsx语言\n      &#123;\n        &quot;language&quot;: &quot;typescriptreact&quot;,\n        &quot;path&quot;: &quot;.&#x2F;lib&#x2F;snippets&#x2F;generated.json&quot;\n      &#125;\n    ]\n  &#125;,\n  &quot;scripts&quot;: &#123;\n    &quot;vscode:prepublish&quot;: &quot;yarn compile&quot;,\n    &quot;compile&quot;: &quot;rm -rf lib; tsc -p .&#x2F; --noEmit false --module commonjs --outDir lib&quot;,\n    &quot;compile:dev&quot;: &quot;rm -rf lib; tsc -p .&#x2F; --noEmit false --module commonjs --outDir lib&quot;,\n    &quot;lint&quot;: &quot;eslint --ext .js,.ts,.tsx .&#x2F;src&#x2F;&quot;,\n    &quot;watch&quot;: &quot;tsc -watch -p .&#x2F;&quot;,\n    &quot;typescript&quot;: &quot;tsc --noEmit&quot;\n  &#125;,\n  &quot;dependencies&quot;: &#123;\n    &quot;prettier&quot;: &quot;2.5.1&quot;\n  &#125;,\n  &quot;peerDependencies&quot;: &#123;\n    &quot;prettier&quot;: &quot;^2&quot;\n  &#125;,\n  &quot;devDependencies&quot;: &#123;\n    &quot;prettier&quot;: &quot;2.5.1&quot;,\n    &quot;typescript&quot;: &quot;4.5.5&quot;\n  &#125;,\n  &#x2F;&#x2F; prettier  配置\n  &quot;prettier&quot;: &#123;\n    &quot;bracketSameLine&quot;: false,\n    &quot;bracketSpacing&quot;: true,\n    &quot;printWidth&quot;: 80,\n    &quot;semi&quot;: true,\n    &quot;singleQuote&quot;: true,\n    &quot;tabWidth&quot;: 2,\n    &quot;trailingComma&quot;: &quot;all&quot;,\n    &quot;useTabs&quot;: false,\n    &quot;endOfLine&quot;: &quot;auto&quot;\n  &#125;\n&#125;</code></pre>\n\n<h2 id=\"tsrcredux-命令举例\"><a href=\"#tsrcredux-命令举例\" class=\"headerlink\" title=\"tsrcredux 命令举例\"></a>tsrcredux 命令举例</h2><pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\">import &#123;\n  exportDefault,\n  innerComponent,\n  innerComponentReturn,\n  propsStateInterface,\n  propsTypeInterface,\n  react,\n  reactComponent,\n  reactPureComponent,\n  reduxComponentExport,\n&#125; from &quot;.&#x2F;sharedSnippets&quot;;\n\n&#x2F;&#x2F; src&#x2F;sourceSnippets&#x2F;typescript.ts\n&#x2F;&#x2F; 源码链接：https:&#x2F;&#x2F;github.com&#x2F;841660202&#x2F;vscode-react-javascript-snippets&#x2F;blob&#x2F;185bb91a0b692c54136663464e8225872c434637&#x2F;src&#x2F;sourceSnippets&#x2F;typescript.ts#L175\nconst typescriptReactClassComponentRedux: TypescriptSnippet &#x3D; &#123;\n  key: &quot;typescriptReactClassComponentRedux&quot;,\n  prefix: &quot;tsrcredux&quot;,\n  body: [\n    &quot;import &#123; connect &#125; from &#39;react-redux&#39;&quot;,\n    ...reactComponent, &#x2F;&#x2F; 源码 https:&#x2F;&#x2F;github.com&#x2F;841660202&#x2F;vscode-react-javascript-snippets&#x2F;blob&#x2F;185bb91a0b692c54136663464e8225872c434637&#x2F;src&#x2F;sourceSnippets&#x2F;sharedSnippets.ts#L18 &#x2F;&#x2F; 复用 import React, &#123; Component &#125; from &#39;react&#39;\n    &quot;&quot;,\n    ...propsStateInterface, &#x2F;&#x2F; 源码 https:&#x2F;&#x2F;github.com&#x2F;841660202&#x2F;vscode-react-javascript-snippets&#x2F;blob&#x2F;185bb91a0b692c54136663464e8225872c434637&#x2F;src&#x2F;sourceSnippets&#x2F;sharedSnippets.ts#L52 type Props &#x3D; &#123;&#125; type State &#x3D; &#123;&#125;\n    &#96;export class $&#123;Placeholders.FileName&#125; extends Component&lt;Props, State&gt; &#123;&#96;,\n    &quot;  state &#x3D; &#123;&#125;&quot;,\n    &quot;&quot;,\n    ...innerComponentReturn, &#x2F;&#x2F; 源码 https:&#x2F;&#x2F;github.com&#x2F;841660202&#x2F;vscode-react-javascript-snippets&#x2F;blob&#x2F;185bb91a0b692c54136663464e8225872c434637&#x2F;src&#x2F;sourceSnippets&#x2F;sharedSnippets.ts#L40\n    &quot;&#125;&quot;,\n    ...reduxComponentExport, &#x2F;&#x2F; 源码 https:&#x2F;&#x2F;github.com&#x2F;841660202&#x2F;vscode-react-javascript-snippets&#x2F;blob&#x2F;185bb91a0b692c54136663464e8225872c434637&#x2F;src&#x2F;sourceSnippets&#x2F;sharedSnippets.ts#L25\n  ],\n  description:\n    &quot;Creates a React component class with connected redux and ES7 module system and TypeScript interfaces&quot;,\n&#125;;</code></pre>\n\n<p>测试结果</p>\n<pre class=\"line-numbers language-tsx\" data-language=\"tsx\"><code class=\"language-tsx\">import &#123; connect &#125; from &quot;react-redux&quot;;\nimport React, &#123; Component &#125; from &quot;react&quot;;\n\ntype Props &#x3D; &#123;&#125;;\n\ntype State &#x3D; &#123;&#125;;\n\nexport class tsrcredux&#x2F;**文件名 *&#x2F; extends Component&lt;Props, State&gt; &#123;\n  state &#x3D; &#123;&#125;;\n\n  render() &#123;\n    return &lt;div&gt;tsrcreduxx&lt;!--文件名 --&gt;&lt;&#x2F;div&gt;;\n  &#125;\n&#125;\n\nconst mapStateToProps &#x3D; (state) &#x3D;&gt; (&#123;&#125;);\n\nconst mapDispatchToProps &#x3D; &#123;&#125;;\n\nexport default connect(mapStateToProps, mapDispatchToProps)(tsrcreduxx&#x2F;**文件名 *&#x2F;);</code></pre>\n\n<img src=\"http://t-blog-images.aijs.top/img/202209051036707.webp\" />\n\n<h2 id=\"源码解读\"><a href=\"#源码解读\" class=\"headerlink\" title=\"源码解读\"></a>源码解读</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">👑 ~&#x2F;haotian&#x2F;github&#x2F;vscode-plugins&#x2F;vscode-react-javascript-snippets&#x2F;src git:(master) $ tree -l\n.\n├── helpers &#x2F;&#x2F; 工具\n│   ├── extensionConfig.ts &#x2F;&#x2F; 获取工作空间的配置信息\n│   ├── formatters.ts &#x2F;&#x2F; 从配置工作空间中拿到配置信息对代码片段进行格式化，对代码片段进行解析，转化成vscode支持的语法\n│   ├── generateSnippets.ts &#x2F;&#x2F; 获取sourceSnippets 目录下的代码片段，进行格式化输出到 __dirname + &#39;&#x2F;..&#x2F;snippets&#x2F;generated.json&#39;\n│   ├── getPrettierConfig.ts &#x2F;&#x2F;  获取prettier的配置信息\n│   ├── parseSnippetToBody.ts &#x2F;&#x2F; 将代码片段放到body中，中间过程处理了是否需要引入react\n│   ├── replaceOrRemoveReactImport.ts &#x2F;&#x2F; 有引入react得前缀枚举, 对于不需要引入react得行进行替换除去\n│   ├── snippetPlaceholders.ts &#x2F;&#x2F; 1.Mappings 键转化成值， 2.Mappings 值转化成键\n│   └── snippetSearch.ts &#x2F;&#x2F;获取代码片段，格式化成 vscode showQuickPick 可以使用的数据\n├── index.ts &#x2F;&#x2F; 插件入口， 插件激活时候，1.工作空间配置更改监听， window.showWarningMessage提示是否需要重启插件；2.命令注册\n├── snippets\n│   └── generated.json &#x2F;&#x2F; generateSnippets 生成目录，以及package.json snippets字段 用于语言域配置\n├── sourceSnippets &#x2F;&#x2F; 源代码片段目录\n│   ├── components.ts &#x2F;&#x2F; react组件相关\n│   ├── console.ts &#x2F;&#x2F; 日志相关\n│   ├── hooks.ts &#x2F;&#x2F; react hooks相关\n│   ├── imports.ts &#x2F;&#x2F; 提供了不同的引入方式\n│   ├── others.ts &#x2F;&#x2F; 其他乱七八糟的归为一类 js 函数、数组、结构、class、声明周期、react createRef 叭啦叭啦一堆\n│   ├── propTypes.ts &#x2F;&#x2F; 属性相关的\n│   ├── reactNative.ts &#x2F;&#x2F; rn 相关的\n│   ├── redux.ts &#x2F;&#x2F; redux相关的\n│   ├── sharedSnippets.ts &#x2F;&#x2F; 被其他代码片段共享复用的部分\n│   ├── tests.ts &#x2F;&#x2F; 测试代码片段，非测试文件\n│   └── typescript.ts &#x2F;&#x2F; ts语法的的代码片段\n└── types.ts &#x2F;&#x2F; 与vsocde可识别语法的 映射关系\n\n3 directories, 22 files</code></pre>\n\n<h2 id=\"详细源码注释\"><a href=\"#详细源码注释\" class=\"headerlink\" title=\"详细源码注释\"></a>详细源码注释</h2><p><a href=\"https://github.com/841660202/vscode-react-javascript-snippets/blob/master/src/index.ts\" target=\"_blank\" >github fork</a></p>\n<h2 id=\"片段语法\"><a href=\"#片段语法\" class=\"headerlink\" title=\"片段语法\"></a>片段语法</h2><p><a href=\"https://code.visualstudio.com/docs/editor/userdefinedsnippets#_snippet-syntax\" target=\"_blank\" >见 visualstudio</a><br><a href=\"https://blog.csdn.net/maokelong95/article/details/54379046\" target=\"_blank\" >见 博客</a><br><a href=\"https://code.visualstudio.com/api/references/extension-manifest#combining-extension-contributions\" target=\"_blank\" >extension-manifest categories</a><br><a href=\"https://code.visualstudio.com/api/references/extension-manifest\" target=\"_blank\" >activationEvents</a></p>\n","text":"背景要分享自己开发的代码片段工具 vs-snippets，正所谓：没有对比，就没有伤害,了解下别人是如何开发代码片段插件的思路，做个对比 不得不说，react-javascript-snippets 无论从源代码组织还是支持的代码片段来讲都非常优秀，对于大众化来讲非常 nice。...","link":"","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"11 mins."},"categories":[{"name":"vscode","slug":"vscode","count":2,"path":"api/categories/vscode.json"}],"tags":[{"name":"vscode","slug":"vscode","count":6,"path":"api/tags/vscode.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">背景</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#package-json\"><span class=\"toc-text\">package.json</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#tsrcredux-%E5%91%BD%E4%BB%A4%E4%B8%BE%E4%BE%8B\"><span class=\"toc-text\">tsrcredux 命令举例</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB\"><span class=\"toc-text\">源码解读</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AF%A6%E7%BB%86%E6%BA%90%E7%A0%81%E6%B3%A8%E9%87%8A\"><span class=\"toc-text\">详细源码注释</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%89%87%E6%AE%B5%E8%AF%AD%E6%B3%95\"><span class=\"toc-text\">片段语法</span></a></li></ol>","author":{"name":"陈海龙","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"需要就学呗，多大点事😂","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"React useImperativeHandle","uid":"89201434f3db3df07b7bcb0835c2df9a","slug":"2022-09-06useImperativeHandle","date":"2022-09-06T03:21:11.000Z","updated":"2022-09-16T15:03:47.426Z","comments":true,"path":"api/articles/2022-09-06useImperativeHandle.json","keywords":null,"cover":[],"text":"小插曲vscode 把 js 代码做做了 ts 校验 问题处理 useImperativeHandleuse Imperative Handle 使用命令句柄 useImperativeHandle(ref, createHandle, [deps]) useImperative...","link":"","photos":[],"count_time":{"symbolsCount":833,"symbolsTime":"1 mins."},"categories":[{"name":"React","slug":"React","count":18,"path":"api/categories/React.json"}],"tags":[{"name":"React","slug":"React","count":12,"path":"api/tags/React.json"}],"author":{"name":"陈海龙","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"需要就学呗，多大点事😂","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"企业微信 下载/导出","uid":"624f5234ec8cf95d8c13811af9eb0639","slug":"2022-09-02wx-download","date":"2022-09-02T08:59:24.000Z","updated":"2022-09-16T13:54:56.316Z","comments":true,"path":"api/articles/2022-09-02wx-download.json","keywords":null,"cover":[],"text":"浏览器环境a 标签方式一般情况 &#x2F;** * @param &#123; String &#125; target 下载对象 * @param &#123; String &#125; type 类型 url &#x2F; blob *&#x2F; export cons...","link":"","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"企业微信","slug":"企业微信","count":5,"path":"api/categories/企业微信.json"}],"tags":[{"name":"企业微信","slug":"企业微信","count":5,"path":"api/tags/企业微信.json"}],"author":{"name":"陈海龙","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"需要就学呗，多大点事😂","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}