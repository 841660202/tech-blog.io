{"title":"react-redux  æºç 2","uid":"d512c56f4cbf1792b4d8bab0668985ad","slug":"2022-05-24react-redux2","date":"2022-05-24T13:15:31.000Z","updated":"2022-06-25T09:34:46.424Z","comments":true,"path":"api/articles/2022-05-24react-redux2.json","keywords":null,"cover":[],"content":"<p>æºç ç‰ˆæœ¬<code>&quot;version&quot;: &quot;8.0.2&quot;,</code></p>\n<h2 id=\"Provider\"><a href=\"#Provider\" class=\"headerlink\" title=\"Provider\"></a>Provider</h2><ul>\n<li>ä¸»è¦ä½œç”¨é€šè¿‡subscriptionè°ƒç”¨reduxä¸­storeçš„subscriptionäº§ç”Ÿè®¢é˜…ï¼Œè®¢é˜…å†…å®¹æ˜¯onStateChangeçš„å›è°ƒ</li>\n<li>é€šè¿‡reactçš„ProvideråŠŸèƒ½ï¼Œæä¾›ä¼ é€’ç»™æ ¹çš„storeå’Œæ ¹çš„subscriptionç»™åç»­ä½¿ç”¨äº†connectçš„ç»„ä»¶</li>\n</ul>\n<pre class=\"line-numbers language-tsx\" data-language=\"tsx\"><code class=\"language-tsx\">&#x2F;* provider ç»„ä»¶ä»£ç  *&#x2F;\nfunction Provider(&#123; store, context, children &#125;) &#123;\n   &#x2F;* åˆ©ç”¨useMemoï¼Œè·Ÿæ®storeå˜åŒ–åˆ›å»ºå‡ºä¸€ä¸ªcontextValue åŒ…å«ä¸€ä¸ªæ ¹å…ƒç´ è®¢é˜…å™¨å’Œå½“å‰store  *&#x2F; \n  const contextValue &#x3D; useMemo(() &#x3D;&gt; &#123;\n      &#x2F;* åˆ›å»ºäº†ä¸€ä¸ªæ ¹ Subscription è®¢é˜…å™¨ *&#x2F;\n    const subscription &#x3D; new Subscription(store)\n    &#x2F;* subscription çš„ notifyNestedSubs æ–¹æ³• ï¼Œèµ‹å€¼ç»™  onStateChangeæ–¹æ³• *&#x2F;\n    &#x2F;&#x2F;onStateChangeå°±æ˜¯ä¹‹åè§¦å‘çš„listenr\n    subscription.onStateChange &#x3D; subscription.notifyNestedSubs  \n    return &#123;\n      store,\n      subscription\n    &#125; &#x2F;*  store æ”¹å˜åˆ›å»ºæ–°çš„contextValue *&#x2F;\n  &#125;, [store])\n  &#x2F;*  è·å–æ›´æ–°ä¹‹å‰çš„stateå€¼ ï¼Œå‡½æ•°ç»„ä»¶é‡Œé¢çš„ä¸Šä¸‹æ–‡è¦ä¼˜å…ˆäºç»„ä»¶æ›´æ–°æ¸²æŸ“  *&#x2F;\n  const previousState &#x3D; useMemo(() &#x3D;&gt; store.getState(), [store])\n\n  useEffect(() &#x3D;&gt; &#123;\n    const &#123; subscription &#125; &#x3D; contextValue\n    &#x2F;* è§¦å‘trySubscribeæ–¹æ³•æ‰§è¡Œï¼Œåˆ›å»ºlistens *&#x2F;\n    subscription.trySubscribe() &#x2F;&#x2F; å‘èµ·è®¢é˜…\n    if (previousState !&#x3D;&#x3D; store.getState()) &#123;\n        &#x2F;* ç»„ä»¶æ›´æ–°æ¸²æŸ“ä¹‹åï¼Œå¦‚æœæ­¤æ—¶stateå‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆç«‹å³è§¦å‘ subscription.notifyNestedSubs æ–¹æ³•  *&#x2F;\n        &#x2F;&#x2F;è§¦å‘æ‰€æœ‰çš„listener\n      subscription.notifyNestedSubs() \n    &#125;\n    &#x2F;*   *&#x2F;\n    return () &#x3D;&gt; &#123;\n      subscription.tryUnsubscribe()  &#x2F;&#x2F; å¸è½½è®¢é˜…\n      subscription.onStateChange &#x3D; null\n    &#125;\n    &#x2F;*  contextValue state æ”¹å˜å‡ºå‘æ–°çš„ effect *&#x2F;\n  &#125;, [contextValue, previousState])\n\n  &#x2F;&#x2F;è‹¥Provideræ²¡æœ‰æ˜¾ç¤ºä¼ å…¥contextï¼Œåˆ™ä¸ºä½¿ç”¨React.createContextåˆ›å»ºçš„ä¸Šä¸‹æ–‡\n  const Context &#x3D; context || ReactReduxContext\n\n  return &lt;Context.Provider value&#x3D;&#123;contextValue&#125;&gt;&#123;children&#125;&lt;&#x2F;Context.Provider&gt;\n&#125;\n</code></pre>\n<h2 id=\"Subscription\"><a href=\"#Subscription\" class=\"headerlink\" title=\"Subscription\"></a>Subscription</h2><ul>\n<li>è®¢é˜…æ¶ˆæ¯ã€å‘èµ·æ›´æ–°</li>\n<li>åœ¨æ ¹çš„Providerçš„ä½œç”¨æ˜¯è°ƒç”¨reduxä¸­storeçš„è®¢é˜…æ–¹æ³•ï¼Œå°†æ ¹çš„onStateChangeè¿›è¡Œè®¢é˜…</li>\n<li>åœ¨å­ä»£ä¸­æ˜¯æ”¶é›†æ‰€æœ‰è¢« connect åŒ…è£¹çš„ç»„ä»¶ä¸­çš„Subscriptionçš„æ›´æ–°å‡½æ•° onstatechangeï¼Œç„¶åå½¢æˆä¸€ä¸ª callback é“¾è¡¨ï¼Œå†ç”±çˆ¶çº§ Subscription ç»Ÿä¸€æ´¾å‘æ‰§è¡Œæ›´æ–°ï¼Œåªä¼šå¾€ä¸Šä¼ é€’ä¸€å±‚ï¼Œä¸ä¼šä¸€ç›´ä¼ é€’ä½¿å¾—æ¯ä¸€ä¸ªä¸Šçº§éƒ½æœ‰è‡ªèº«çš„æ›´æ–°å‡½æ•°</li>\n</ul>\n<pre class=\"line-numbers language-ts\" data-language=\"ts\"><code class=\"language-ts\">&#x2F;* å‘å¸ƒè®¢é˜…è€…æ¨¡å¼ *&#x2F;\nexport default class Subscription &#123;\n  constructor(store, parentSub) &#123;\n    this.store &#x3D; store\n    this.parentSub &#x3D; parentSub\n    this.unsubscribe &#x3D; null\n    this.listeners &#x3D; nullListeners\n\n    this.handleChangeWrapper &#x3D; this.handleChangeWrapper.bind(this)\n  &#125;\n  &#x2F;* è´Ÿè´£æ£€æµ‹æ˜¯å¦è¯¥ç»„ä»¶è®¢é˜…ï¼Œç„¶åæ·»åŠ è®¢é˜…è€…ä¹Ÿå°±æ˜¯listener *&#x2F;  \n  &#x2F;&#x2F;å½“çˆ¶ä»£è°ƒç”¨è¿‡trySubscribeåï¼Œå­ä»£å†è°ƒç”¨ï¼Œå› ä¸ºthis.unsubscribeæœ‰å€¼ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šå®é™…æ‰§è¡Œçˆ¶ä»£çš„trySubscribeï¼Œè€Œåªæ˜¯å°†listeneræ”¾è¿›çˆ¶ä»£ä¸­ç®¡ç†\n  addNestedSub(listener) &#123;\n    this.trySubscribe()\n    return this.listeners.subscribe(listener)\n  &#125;\n  &#x2F;* å‘listenerså‘å¸ƒé€šçŸ¥ *&#x2F;\n  notifyNestedSubs() &#123;\n    this.listeners.notify()\n  &#125;\n  &#x2F;* å¯¹äº Provide onStateChange å°±æ˜¯ notifyNestedSubs æ–¹æ³•ï¼Œ\n  å¯¹äº connect åŒ…è£¹æ¥å—æ›´æ–°çš„ç»„ä»¶ ï¼ŒonStateChange å°±æ˜¯ è´Ÿè´£æ›´æ–°ç»„ä»¶çš„å‡½æ•° ã€‚   *&#x2F;\n  handleChangeWrapper() &#123;\n    if (this.onStateChange) &#123;\n      this.onStateChange()\n    &#125;\n  &#125;\n   &#x2F;* åˆ¤æ–­æœ‰æ²¡æœ‰å¼€å¯è®¢é˜… *&#x2F;\n  isSubscribed() &#123;\n    return Boolean(this.unsubscribe)\n  &#125;\n  &#x2F;* å¼€å¯è®¢é˜…æ¨¡å¼ é¦–å…ˆåˆ¤æ–­å½“å‰è®¢é˜…å™¨æœ‰æ²¡æœ‰çˆ¶çº§è®¢é˜…å™¨ ï¼Œ å¦‚æœæœ‰çˆ¶çº§è®¢é˜…å™¨(å°±æ˜¯çˆ¶çº§Subscription)ï¼ŒæŠŠè‡ªå·±çš„handleChangeWrapperæ”¾å…¥åˆ°ç›‘å¬è€…é“¾è¡¨ä¸­ *&#x2F;\n  trySubscribe() &#123;\n    &#x2F;*\n    \tparentSubå³æ˜¯provide value é‡Œé¢çš„ Subscription è¿™é‡Œå¯ä»¥ç†è§£ä¸º çˆ¶çº§å…ƒç´ çš„ Subscription\n    *&#x2F;\n    &#x2F;&#x2F;å½“Subscriptionæ‰§è¡Œè¿‡ä¸€æ¬¡æ”¹æ–¹æ³•åï¼Œå†è°ƒç”¨å› ä¸ºthis.unsubscribeæœ‰å€¼\n    &#x2F;&#x2F;æ‰€ä»¥è¯¥æ–¹æ³•è°ƒç”¨ä¸€æ¬¡åå°±ä¸ä¼šå†è¢«è°ƒç”¨äº†\n    &#x2F;&#x2F;æ„å‘³ç€addNestedSubä¸­åªä¼šæ·»åŠ listenerï¼Œè€Œä¸ä¼šå†è°ƒç”¨trySubscribeï¼Œä½¿å¾—listenerä¸ä¼šå¾€ä¸Šä¼ é€’\n    if (!this.unsubscribe) &#123;\n      this.unsubscribe &#x3D; this.parentSub\n        ? this.parentSub.addNestedSub(this.handleChangeWrapper)\n        &#x2F;* providerçš„Subscriptionæ˜¯ä¸å­˜åœ¨parentSubï¼Œæ‰€ä»¥æ­¤æ—¶trySubscribe å°±ä¼šè°ƒç”¨ store.subscribe   *&#x2F;\n        : this.store.subscribe(this.handleChangeWrapper)\n      this.listeners &#x3D; createListenerCollection()\n    &#125;\n  &#125;\n  &#x2F;* å–æ¶ˆè®¢é˜… *&#x2F;\n  tryUnsubscribe() &#123;\n    if (this.unsubscribe) &#123;\n      this.unsubscribe()\n      this.unsubscribe &#x3D; null\n      this.listeners.clear()\n\n      this.listeners &#x3D; nullListeners\n    &#125;\n  &#125;\n&#125;\n</code></pre>\n\n<ul>\n<li>é¦–å…ˆProvideråˆ›å»º Subscription æ—¶å€™æ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œå°±è¯´æ˜provider ä¸­çš„Subscription ä¸å­˜åœ¨ parentSub ã€‚</li>\n<li>é‚£ä¹ˆå†è°ƒç”¨Providerç»„ä»¶ä¸­useEffecté’©å­ä¸­trySubscribeçš„æ—¶å€™,ä¼šè§¦å‘this.store.subscribe , subscribe å°±æ˜¯ redux çš„ subscribe ,æ­¤æ—¶çœŸæ­£å‘èµ·äº†è®¢é˜…</li>\n<li>è®¢é˜…çš„å†…å®¹æ˜¯notifyNestedSubsï¼Œå³é€šçŸ¥æ ¹ç®¡ç†çš„listenersè§¦å‘<pre class=\"line-numbers language-tsx\" data-language=\"tsx\"><code class=\"language-tsx\">subscription.onStateChange &#x3D; subscription.notifyNestedSubs \n\n&#x2F;* å‘listenerså‘å¸ƒé€šçŸ¥ *&#x2F;\nnotifyNestedSubs() &#123;\n  this.listeners.notify()\n&#125;\n</code></pre>\n<h2 id=\"createListenerCollection\"><a href=\"#createListenerCollection\" class=\"headerlink\" title=\"createListenerCollection\"></a>createListenerCollection</h2>é€šè¿‡åŒå‘é“¾è¡¨çš„ç»“æ„ç®¡ç†æ¯ä¸€ä¸ªlistener<br>ä»¥é“¾è¡¨çš„å½¢å¼æ”¶é›†å¯¹åº”çš„ listeners (æ¯ä¸€ä¸ªSubscription) çš„handleChangeWrapperå‡½æ•°å³onStateChangeã€‚<br>é€šè¿‡ batch æ–¹æ³•( react-dom ä¸­çš„ unstable_batchedUpdates ) æ¥è¿›è¡Œæ‰¹é‡æ›´æ–°ï¼Œè®¸å°†ä¸€æ¬¡äº‹ä»¶å¾ªç¯ä¸­çš„æ‰€æœ‰ React æ›´æ–°éƒ½ä¸€èµ·æ‰¹é‡å¤„ç†åˆ°ä¸€ä¸ªæ¸²æŸ“è¿‡ç¨‹ä¸­ã€‚<pre class=\"line-numbers language-tsx\" data-language=\"tsx\"><code class=\"language-tsx\">import &#123; unstable_batchedUpdates as batch &#125; from &#39;.&#x2F;utils&#x2F;reactBatchedUpdates&#39;\nsetBatch(batch)\n\n\nfunction createListenerCollection() &#123;\n   &#x2F;* batch ç”±getBatchå¾—åˆ°çš„ unstable_batchedUpdates æ–¹æ³• *&#x2F;\n  const batch &#x3D; getBatch()\n  let first &#x3D; null\n  let last &#x3D; null\n\n  return &#123;\n    &#x2F;* æ¸…é™¤å½“å‰listenersçš„æ‰€æœ‰listener *&#x2F;\n    clear() &#123;\n      first &#x3D; null\n      last &#x3D; null\n    &#125;,\n    &#x2F;* æ´¾å‘æ›´æ–° *&#x2F;\n    notify() &#123;\n      batch(() &#x3D;&gt; &#123;\n        let listener &#x3D; first\n        while (listener) &#123;\n          listener.callback()\n          listener &#x3D; listener.next\n        &#125;\n      &#125;)\n    &#125;,\n    &#x2F;* è·å–listenersçš„æ‰€æœ‰listener *&#x2F;\n    get() &#123;\n      let listeners &#x3D; []\n      let listener &#x3D; first\n      while (listener) &#123;\n        listeners.push(listener)\n        listener &#x3D; listener.next\n      &#125;\n      return listeners\n    &#125;,\n     &#x2F;* æ¥æ”¶è®¢é˜…ï¼Œå°†å½“å‰çš„callbackï¼ˆhandleChangeWrapperï¼‰å­˜åˆ°å½“å‰çš„é“¾è¡¨ä¸­  *&#x2F;\n    subscribe(callback) &#123;\n      let isSubscribed &#x3D; true\n\n      let listener &#x3D; (last &#x3D; &#123;\n        callback,\n        next: null,\n        prev: last &#x2F;&#x2F;é¦–æ¬¡lastä¸ºç©º\n      &#125;)\n\t   \t\n      if (listener.prev) &#123;\n        listener.prev.next &#x3D; listener\n      &#125; else &#123;\n        first &#x3D; listener\n      &#125;\n      &#x2F;* å–æ¶ˆå½“å‰ handleChangeWrapper çš„è®¢é˜…*&#x2F;\n      return function unsubscribe() &#123;\n        if (!isSubscribed || first &#x3D;&#x3D;&#x3D; null) return\n        isSubscribed &#x3D; false\n\t\t\n\t\t&#x2F;&#x2F;åŒå‘é“¾è¡¨åˆ é™¤èŠ‚ç‚¹çš„æ“ä½œ\n        if (listener.next) &#123;\n          listener.next.prev &#x3D; listener.prev\n        &#125; else &#123;\n          last &#x3D; listener.prev\n        &#125;\n        if (listener.prev) &#123;\n          listener.prev.next &#x3D; listener.next\n        &#125; else &#123;\n          first &#x3D; listener.next\n        &#125;\n      &#125;\n    &#125;\n  &#125;\n&#125;\n</code></pre>\n<h2 id=\"connect\"><a href=\"#connect\" class=\"headerlink\" title=\"connect\"></a>connect</h2>åŸºæœ¬ä½¿ç”¨<pre class=\"line-numbers language-tsx\" data-language=\"tsx\"><code class=\"language-tsx\">function connect(mapStateToProps?, mapDispatchToProps?, mergeProps?, options?)\n\nconst mapStateToProps &#x3D; state &#x3D;&gt; (&#123; todos: state.todos &#125;)\nconst mapDispatchToProps &#x3D; dispatch &#x3D;&gt; &#123;\n  return &#123;\n    increment: () &#x3D;&gt; dispatch(&#123; type: &#39;INCREMENT&#39; &#125;),\n    decrement: () &#x3D;&gt; dispatch(&#123; type: &#39;DECREMENT&#39; &#125;),\n    reset: () &#x3D;&gt; dispatch(&#123; type: &#39;RESET&#39; &#125;)\n  &#125;\n&#125;\n&#x2F;*\n* stateProps , state æ˜ å°„åˆ° props ä¸­çš„å†…å®¹\n* dispatchPropsï¼Œ dispatch æ˜ å°„åˆ° props ä¸­çš„å†…å®¹ã€‚\n* ownProps ç»„ä»¶æœ¬èº«çš„ props\nå½“æœªä¼ é€’æ—¶ï¼Œé»˜è®¤çš„åˆå¹¶è§„åˆ™ä¸º\n&#123; ...ownProps, ...stateProps, ...dispatchProps &#125;\n\n*&#x2F;\nmergeProps&#x3D;(stateProps, dispatchProps, ownProps) &#x3D;&gt; Object\n\noptions&#x3D;&#123;\n  context?: Object,   &#x2F;&#x2F; è‡ªå®šä¹‰ä¸Šä¸‹æ–‡\n  pure?: boolean, &#x2F;&#x2F; é»˜è®¤ä¸º true , å½“ä¸º true çš„æ—¶å€™ ï¼Œé™¤äº† mapStateToProps å’Œ props ,å…¶ä»–è¾“å…¥æˆ–è€…state æ”¹å˜ï¼Œå‡ä¸ä¼šæ›´æ–°ç»„ä»¶ã€‚\n  areStatesEqual?: Function, &#x2F;&#x2F; å½“pure true , æ¯”è¾ƒå¼•è¿›store ä¸­stateå€¼ æ˜¯å¦å’Œä¹‹å‰ç›¸ç­‰ã€‚ (next: Object, prev: Object) &#x3D;&gt; boolean\n  areOwnPropsEqual?: Function, &#x2F;&#x2F; å½“pure true , æ¯”è¾ƒ props å€¼, æ˜¯å¦å’Œä¹‹å‰ç›¸ç­‰ã€‚ (next: Object, prev: Object) &#x3D;&gt; boolean\n  areStatePropsEqual?: Function, &#x2F;&#x2F; å½“pure true , æ¯”è¾ƒ mapStateToProps åçš„å€¼ æ˜¯å¦å’Œä¹‹å‰ç›¸ç­‰ã€‚  (next: Object, prev: Object) &#x3D;&gt; boolean\n  areMergedPropsEqual?: Function, &#x2F;&#x2F; å½“ pure ä¸º true æ—¶ï¼Œ æ¯”è¾ƒ ç»è¿‡ mergeProps åˆå¹¶åçš„å€¼ ï¼Œ æ˜¯å¦ä¸ä¹‹å‰ç­‰  (next: Object, prev: Object) &#x3D;&gt; boolean\n  forwardRef?: boolean, &#x2F;&#x2F;å½“ä¸ºtrue æ—¶å€™,å¯ä»¥é€šè¿‡ref è·å–è¢«connectåŒ…è£¹çš„ç»„ä»¶å®ä¾‹ã€‚\n&#125;\n</code></pre>\n<img src=\"http://t-blog-images.aijs.top/img/20220525105732.webp\"></li>\n</ul>\n<pre class=\"line-numbers language-tsx\" data-language=\"tsx\"><code class=\"language-tsx\">&#x2F;**\n * Connects a React component to a Redux store.\n *\n * - Without arguments, just wraps the component, without changing the behavior &#x2F; props\n *\n * - If 2 params are passed (3rd param, mergeProps, is skipped), default behavior\n * is to override ownProps (as stated in the docs), so what remains is everything that&#39;s\n * not a state or dispatch prop\n *\n * - When 3rd param is passed, we don&#39;t know if ownProps propagate and whether they\n * should be valid component props, because it depends on mergeProps implementation.\n * As such, it is the user&#39;s responsibility to extend ownProps interface from state or\n * dispatch props or both when applicable\n *\n * @param mapStateToProps A function that extracts values from state\n * @param mapDispatchToProps Setup for dispatching actions\n * @param mergeProps Optional callback to merge state and dispatch props together\n * @param options Options for configuring the connection\n *\n *&#x2F;\nfunction connect&lt;\n  TStateProps &#x3D; &#123;&#125;,\n  TDispatchProps &#x3D; &#123;&#125;,\n  TOwnProps &#x3D; &#123;&#125;,\n  TMergedProps &#x3D; &#123;&#125;,\n  State &#x3D; unknown\n&gt;(\n  mapStateToProps?: MapStateToPropsParam&lt;TStateProps, TOwnProps, State&gt;,\n  mapDispatchToProps?: MapDispatchToPropsParam&lt;TDispatchProps, TOwnProps&gt;,\n  mergeProps?: MergeProps&lt;TStateProps, TDispatchProps, TOwnProps, TMergedProps&gt;,\n  &#123;\n    &#x2F;&#x2F; The &#96;pure&#96; option has been removed, so TS doesn&#39;t like us destructuring this to check its existence.\n    &#x2F;&#x2F; @ts-ignore\n    pure,\n    areStatesEqual &#x3D; strictEqual,\n    areOwnPropsEqual &#x3D; shallowEqual,\n    areStatePropsEqual &#x3D; shallowEqual,\n    areMergedPropsEqual &#x3D; shallowEqual,\n\n    &#x2F;&#x2F; use React&#39;s forwardRef to expose a ref of the wrapped component\n    forwardRef &#x3D; false,\n\n    &#x2F;&#x2F; the context consumer to use\n    context &#x3D; ReactReduxContext,\n  &#125;: ConnectOptions&lt;unknown, unknown, unknown, unknown&gt; &#x3D; &#123;&#125;\n): unknown &#123;\n  \n\n  const Context &#x3D; context\n\n  &#x2F;*\n  * stateProps , state æ˜ å°„åˆ° props ä¸­çš„å†…å®¹\n  * dispatchPropsï¼Œ dispatch æ˜ å°„åˆ° props ä¸­çš„å†…å®¹ã€‚\n  * ownProps ç»„ä»¶æœ¬èº«çš„ props\n  å½“æœªä¼ é€’æ—¶ï¼Œé»˜è®¤çš„åˆå¹¶è§„åˆ™ä¸º\n  &#123; ...ownProps, ...stateProps, ...dispatchProps &#125;\n\n  *&#x2F;\n &#x2F;* ç»è¿‡ä»£ç†åŒ…è£…åçš„ mapStateToProps,å®Œæˆä¼ å…¥storeç­‰æ“ä½œ*&#x2F;\n  const initMapStateToProps &#x3D; mapStateToPropsFactory(mapStateToProps)\n  &#x2F;* ç»è¿‡ä»£ç†åŒ…è£…åçš„ mapDispatchToPropsï¼Œå®Œæˆä¼ å…¥store.dispatchç­‰æ“ä½œ*&#x2F;\n  const initMapDispatchToProps &#x3D; mapDispatchToPropsFactory(mapDispatchToProps)\n  &#x2F;* ç»è¿‡ä»£ç†åŒ…è£…åçš„ mergePropsï¼Œç”¨äºå½¢æˆçœŸæ­£çš„ mergePropså‡½æ•°ï¼Œåˆå¹¶ä¸šåŠ¡ç»„ä»¶çš„ props , state æ˜ å°„çš„ props , dispatch æ˜ å°„çš„ props *&#x2F;\n  const initMergeProps &#x3D; mergePropsFactory(mergeProps)\n\n  const shouldHandleStateChanges &#x3D; Boolean(mapStateToProps)\n\n  &#x2F;&#x2F;é»˜è®¤çš„é«˜é˜¶ç»„ä»¶connectAdvancedï¼Œå®é™…æ¸²æŸ“çš„ç»„ä»¶æ˜¯å…¶ä¸­è¿”å›çš„ä¸€ä¸ªConnectFunction\n\t&#x2F;&#x2F;selectorFactoryä¸ºæ•´åˆconnectæ›´æ–°è¿‡ç¨‹ä¸­çš„å½¢æˆæ–°propsçš„ä¸»è¦å‡½æ•°\n\t&#x2F;&#x2F;selectorFactoryä¸ºåé¢çš„finalPropsSelectorFactory\n  const wrapWithConnect: AdvancedComponentDecorator&lt;\n    TOwnProps,\n    WrappedComponentProps\n  &gt; &#x3D; (WrappedComponent) &#x3D;&gt; &#123;\n    ...\n  &#125;\n&#125;\n</code></pre>\n<ul>\n<li>å½“æˆ‘ä»¬ä¸å‘connectä¼ é€’ç¬¬ä¸‰ä¸ªå‚æ•°mergeProps çš„æ—¶å€™ï¼Œé»˜è®¤çš„defaultMergePropså¦‚ä¸‹ï¼Œä½œä¸ºæ–°çš„ props ä¼ é€’ç»™äº†ä¸šåŠ¡ç»„ä»¶</li>\n</ul>\n<pre class=\"line-numbers language-ts\" data-language=\"ts\"><code class=\"language-ts\">export function defaultMergeProps(stateProps, dispatchProps, ownProps) &#123;\n  return &#123; ...ownProps, ...stateProps, ...dispatchProps &#125;\n&#125;</code></pre>\n\n\n\n<h2 id=\"selectorFactory\"><a href=\"#selectorFactory\" class=\"headerlink\" title=\"selectorFactory\"></a>selectorFactory</h2><p><img src=\"http://t-blog-images.aijs.top/img/20220525101153.webp\"></p>\n<ul>\n<li>é¦–å…ˆå¾—åˆ°çœŸæ­£connect ç»è¿‡ä¸€å±‚ä»£ç†å‡½æ•° mapStateToProps ,mapDispatchToProps ,mergeProps</li>\n<li>ç„¶åè°ƒç”¨selectorFactory (åœ¨pureæ¨¡å¼ä¸‹ï¼ŒselectorFactory å°±æ˜¯ pureFinalPropsSelectorFactory )<pre class=\"line-numbers language-ts\" data-language=\"ts\"><code class=\"language-ts\">export default function finalPropsSelectorFactory(\n  dispatch,\n  &#123; initMapStateToProps, initMapDispatchToProps, initMergeProps, ...options &#125;\n) &#123;\n  &#x2F;&#x2F; mapStateToProps mapDispatchToProps mergeProps ä¸ºçœŸæ­£connect ç»è¿‡ä¸€å±‚ä»£ç†çš„ proxy å‡½æ•°\n  const mapStateToProps &#x3D; initMapStateToProps(dispatch, options)\n  const mapDispatchToProps &#x3D; initMapDispatchToProps(dispatch, options)\n  const mergeProps &#x3D; initMergeProps(dispatch, options)\n\n  &#x2F;&#x2F;é»˜è®¤pureä¸ºtrueï¼ŒselectorFactoryé»˜è®¤ä¸ºpureFinalPropsSelectorFactory\n  const selectorFactory &#x3D; options.pure ? pureFinalPropsSelectorFactory : impureFinalPropsSelectorFactory\n   &#x2F;&#x2F; è¿”å›ä¸€ä¸ª å‡½æ•°ç”¨äºç”Ÿæˆæ–°çš„ props \n  return selectorFactory(\n    mapStateToProps,\n    mapDispatchToProps,\n    mergeProps,\n    dispatch,\n    options\n  )\n&#125;\n</code></pre></li>\n</ul>\n<h2 id=\"pureFinalPropsSelectorFactory\"><a href=\"#pureFinalPropsSelectorFactory\" class=\"headerlink\" title=\"pureFinalPropsSelectorFactory\"></a>pureFinalPropsSelectorFactory</h2><p><img src=\"http://t-blog-images.aijs.top/img/20220525100640.webp\"></p>\n<ul>\n<li>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ï¼Œé‚£ä¹ˆç›´æ¥è°ƒç”¨mergePropsåˆå¹¶ownProps,stateProps,dispatchProps å½¢æˆæœ€ç»ˆçš„propsã€‚</li>\n<li>å¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡ï¼Œé‚£ä¹ˆåˆ¤æ–­åˆ°åº•æ˜¯propsè¿˜æ˜¯ store.state å‘ç”Ÿæ”¹å˜ï¼Œç„¶åé’ˆå¯¹é‚£é‡Œå˜åŒ–ï¼Œé‡æ–°ç”Ÿæˆå¯¹åº”çš„propsï¼Œæœ€ç»ˆåˆå¹¶åˆ°çœŸæ­£çš„props</li>\n<li>æ•´ä¸ª selectorFactory é€»è¾‘å°±æ˜¯å½¢æˆæ–°çš„propsä¼ é€’ç»™æˆ‘ä»¬çš„ä¸šåŠ¡ç»„ä»¶ã€‚</li>\n</ul>\n<pre class=\"line-numbers language-ts\" data-language=\"ts\"><code class=\"language-ts\">&#x2F;** pureç»„ä»¶å¤„ç† ï¼Œ å¯¹æ¯” props æ˜¯å¦å‘ç”Ÿå˜åŒ– ç„¶å åˆå¹¶props *&#x2F;\nexport function pureFinalPropsSelectorFactory(\n  mapStateToProps,\n  mapDispatchToProps,\n  mergeProps,\n  dispatch,\n  &#123; areStatesEqual, areOwnPropsEqual, areStatePropsEqual &#125; &#x2F;&#x2F;åˆ¤æ–­ state prop æ˜¯å¦ç›¸ç­‰\n) &#123;\n  let hasRunAtLeastOnce &#x3D; false\n  let state\n  let ownProps\n  let stateProps\n  let dispatchProps\n  let mergedProps\n \n  &#x2F;* ç¬¬ä¸€æ¬¡ ç›´æ¥å½¢æˆ ownProps  stateProps  dispatchProps åˆå¹¶  å½¢æˆæ–°çš„ props *&#x2F;\n  function handleFirstCall(firstState, firstOwnProps) &#123;\n    state &#x3D; firstState\n    ownProps &#x3D; firstOwnProps\n    &#x2F;&#x2F;è·å–ä¸šåŠ¡ç»„ä»¶ä¸­mapStateToPropså‡½æ•°çš„è¿”å›å€¼\n    stateProps &#x3D; mapStateToProps(state, ownProps)\n    &#x2F;&#x2F;è·å–ä¸šåŠ¡ç»„ä»¶ä¸­mapDispatchToPropså‡½æ•°çš„è¿”å›å€¼\n    dispatchProps &#x3D; mapDispatchToProps(dispatch, ownProps)\n    &#x2F;&#x2F;åˆå¹¶stateã€dispatchã€ç»„ä»¶è‡ªèº«çš„propsï¼Œå½¢æˆæœ€ç»ˆä¼ é€’ç»™ç»„ä»¶çš„props\n    mergedProps &#x3D; mergeProps(stateProps, dispatchProps, ownProps)\n    hasRunAtLeastOnce &#x3D; true\n    return mergedProps\n  &#125;\n  \n  function handleNewPropsAndNewState() &#123;\n    &#x2F;&#x2F;  props å’Œ state éƒ½æ”¹å˜  mergeProps \n  &#125;\n\n  function handleNewProps() &#123;\n    &#x2F;&#x2F; props æ”¹å˜  mergeProps\n  &#125;\n\n  function handleNewState() &#123;\n     &#x2F;&#x2F; state æ”¹å˜ mergeProps\n  &#125;\n\n  &#x2F;*  ä¸æ˜¯ç¬¬ä¸€æ¬¡çš„æƒ…å†µ props æˆ–è€… store.state å‘ç”Ÿæ”¹å˜çš„æƒ…å†µã€‚ *&#x2F;\n  function handleSubsequentCalls(nextState, nextOwnProps) &#123;\n      &#x2F;* åˆ¤æ–­ä¸¤æ¬¡ props æ˜¯å¦ç›¸ç­‰ *&#x2F;\n    const propsChanged &#x3D; !areOwnPropsEqual(nextOwnProps, ownProps) \n      &#x2F;* åˆ¤æ–­ä¸¤æ¬¡ store.state æ˜¯å¦ç›¸ç­‰ *&#x2F;\n    const stateChanged &#x3D; !areStatesEqual(nextState, state)\n    state &#x3D; nextState\n    ownProps &#x3D; nextOwnProps\n    \n    &#x2F;&#x2F;æ ¹æ®æ”¹å˜çš„ç±»å‹ä¸åŒï¼Œè¿”å›å¯¹åº”åˆå¹¶ç­–ç•¥ä¸‹çš„props\n    if (propsChanged &amp;&amp; stateChanged) return handleNewPropsAndNewState()\n    if (propsChanged) return handleNewProps()\n    if (stateChanged) return handleNewState()\n    return mergedProps\n  &#125;\n  \n  &#x2F;&#x2F;æ ¹æ®æ˜¯å¦ç¬¬ä¸€æ¬¡å½¢æˆpropsï¼Œæ‰§è¡Œå¯¹åº”æ–¹æ³•\n  return function pureFinalPropsSelector(nextState, nextOwnProps) &#123;\n    return hasRunAtLeastOnce\n      ? handleSubsequentCalls(nextState, nextOwnProps)\n      : handleFirstCall(nextState, nextOwnProps)\n  &#125;\n&#125;\n</code></pre>\n<h2 id=\"connectHOC\"><a href=\"#connectHOC\" class=\"headerlink\" title=\"connectHOC\"></a>connectHOC</h2><pre class=\"line-numbers language-tsx\" data-language=\"tsx\"><code class=\"language-tsx\">const mapStateToProp &#x3D; (store) &#x3D;&gt; (&#123; userInfo: store.root.userInfo &#125;)\n\nfunction Index()&#123;\n    &#x2F;* ..... *&#x2F;\n    return &lt;div&gt; &#123; &#x2F;* .... *&#x2F; &#125; &lt;&#x2F;div&gt;\n&#125;\nexport default connect(mapStateToProp)(Index)\n\n</code></pre>\n<ul>\n<li>connect(mapStateToProp)&#x3D;&#x3D;&#x3D;connectAdvanced()</li>\n</ul>\n<details class=\"custom-details\">\n<summary>ç‚¹å‡»æŸ¥çœ‹æ›´å¤š</summary>\n<p><ul>\n<li>è¿™éƒ¨åˆ†ä»£ç ï¼Œåœ¨8.x.xç‰ˆæœ¬åœ¨conncetä¸­ç›´æ¥å¤„ç†ï¼Œå¹¶æ²¡æœ‰æ‹†åˆ†ä¸ºå•ç‹¬å‡½æ•°</li>\n</ul>\n<pre class=\"line-numbers language-ts\" data-language=\"ts\"><code class=\"language-ts\">export default function connectAdvanced(\n  selectorFactory, &#x2F;&#x2F; æ¯æ¬¡ props,stateæ”¹å˜æ‰§è¡Œ ï¼Œç”¨äºç”Ÿæˆæ–°çš„ propsã€‚\n  &#123;\n    getDisplayName &#x3D; name &#x3D;&gt; &#96;ConnectAdvanced($&#123;name&#125;)&#96;,\n    &#x2F;&#x2F;å¯èƒ½è¢«åŒ…è£…å‡½æ•°ï¼ˆå¦‚connectï¼ˆï¼‰ï¼‰é‡å†™\n    methodName &#x3D; &#39;connectAdvanced&#39;,\n    &#x2F;&#x2F;å¦‚æœå®šä¹‰äº†ï¼Œåˆ™ä¼ é€’ç»™åŒ…è£…å…ƒç´ çš„å±æ€§çš„åç§°ï¼ŒæŒ‡ç¤ºè¦å‘ˆç°çš„è°ƒç”¨ã€‚ç”¨äºç›‘è§†react devtoolsä¸­ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚\n    renderCountProp &#x3D; undefined,\n    shouldHandleStateChanges &#x3D; true,  &#x2F;&#x2F;ç¡®å®šæ­¤HOCæ˜¯å¦è®¢é˜…å­˜å‚¨æ›´æ”¹\n    storeKey &#x3D; &#39;store&#39;,\n    withRef &#x3D; false,\n    forwardRef &#x3D; false, &#x2F;&#x2F; æ˜¯å¦ ç”¨ forwarRef æ¨¡å¼\n    context &#x3D; ReactReduxContext,&#x2F;&#x2F; Provider ä¿å­˜çš„ä¸Šä¸‹æ–‡\n    ...connectOptions\n  &#125; &#x3D; &#123;&#125;\n) &#123;\n  &#x2F;* ReactReduxContext å°±æ˜¯storeå­˜åœ¨çš„context *&#x2F;\n  const Context &#x3D; context\n   &#x2F;* WrappedComponent ä¸ºconnect åŒ…è£¹çš„ç»„ä»¶æœ¬èº«  *&#x2F;   \n  return  function wrapWithConnect(WrappedComponent)&#123;\n      &#x2F;&#x2F; WrappedComponent è¢« connect çš„ä¸šåŠ¡ç»„ä»¶æœ¬èº«\n  &#125;\n&#125;</code></pre>\n<ul>\n<li>æ‹¿åˆ°Provideræä¾›çš„contextä¸Šä¸‹æ–‡</li>\n</ul>\n</p>\n</details>\n<h2 id=\"wrapWithConnect\"><a href=\"#wrapWithConnect\" class=\"headerlink\" title=\"wrapWithConnect\"></a>wrapWithConnect</h2><p>wrapWithConnectä½œä¸ºé«˜é˜¶ç»„ä»¶ï¼Œä¼šè¿”å›ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä¼šå¯¹åŸæœ‰çš„ä¸šåŠ¡ç»„ä»¶ï¼Œè¿›è¡Œä¸€ç³»åˆ—å¢å¼ºç­‰å·¥ä½œ<br>åˆ¤æ–­æ˜¯å¦æ˜¯ pure çº¯ç»„ä»¶æ¨¡å¼ï¼Œå¦‚æœæ˜¯ç”¨react.memoåŒ…è£¹,è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¼šå‘ pureComponent ä¸€æ ·å¯¹ props è¿›è¡Œæµ…æ¯”è¾ƒ<br>å¦‚æœ connect æœ‰forwardRefé…ç½®é¡¹ï¼Œç”¨React.forwardRefå¤„ç†</p>\n<pre class=\"line-numbers language-tsx\" data-language=\"tsx\"><code class=\"language-tsx\">function wrapWithConnect(WrappedComponent) &#123;\n\t&#x2F;&#x2F;WrappedComponentä¸ºå®é™…ä¼ é€’çš„ä¸šåŠ¡ç»„ä»¶\n    const wrappedComponentName &#x3D;\n      WrappedComponent.displayName || WrappedComponent.name || &#39;Component&#39;\n  \n    const displayName &#x3D; getDisplayName(wrappedComponentName)\n    \n    &#x2F;&#x2F;è¦åˆå¹¶éƒ½å†…å®¹ï¼ŒconnectOptionsä¸ºä¸Šä¸€æ­¥é—­åŒ…æ‹¿åˆ°çš„å†…å®¹\n    const selectorFactoryOptions &#x3D; &#123;\n      ...connectOptions,\n      getDisplayName,\n      methodName,\n      renderCountProp,\n      shouldHandleStateChanges,\n      storeKey,\n      displayName,\n      wrappedComponentName,\n      WrappedComponent\n    &#125;\n    const &#123; pure &#125; &#x3D; connectOptions\n    \n    &#x2F;&#x2F;selectorFactoryä¸ºfinalPropsSelectorFactory\n    function createChildSelector(store) &#123;\n      &#x2F;&#x2F; åˆå¹¶å‡½æ•° mergeprops å¾—åˆ°æœ€æ–°çš„props\n      &#x2F;&#x2F; åŠé»˜è®¤è¿”å›pureFinalPropsSelectorFactoryï¼Œä¼šæ ¹æ®æ˜¯å¦ç¬¬ä¸€æ¬¡åˆå¹¶ã€ä¿®æ”¹ç±»å‹ç­‰è¿›è¡Œä¸åŒç­–ç•¥ç­‰åˆå¹¶ä»¥åŠè¿”å›æœ€ç»ˆéƒ½props\n      return selectorFactory(store.dispatch, selectorFactoryOptions)\n    &#125;\n    &#x2F;&#x2F;åˆ¤æ–­æ˜¯å¦æ˜¯pureçº¯ç»„ä»¶æ¨¡å¼ å¦‚æœæ˜¯å°†ç”¨ useMemo ç¼“å­˜ç»„ä»¶æå‡æ€§èƒ½\n    const usePureOnlyMemo &#x3D; pure ? useMemo : callback &#x3D;&gt; callback()\n    &#x2F;&#x2F; è´Ÿè´£æ›´æ–°çš„å®¹å™¨å­ç»„ä»¶ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å®é™…æ¸²æŸ“çš„ç±»ç»„ä»¶\n    function ConnectFunction (props)&#123;\n        &#x2F;&#x2F; props ä¸º ä¸šåŠ¡ç»„ä»¶ çœŸæ­£çš„ props \n    &#125;\n    &#x2F;&#x2F;å¦‚æœ\n    const Connect &#x3D; pure ? React.memo(ConnectFunction) : ConnectFunction\n  \n    Connect.WrappedComponent &#x3D; WrappedComponent\n    Connect.displayName &#x3D; displayName\n    &#x2F;* forwardRef *&#x2F;\n    if (forwardRef) &#123;\n      const forwarded &#x3D; React.forwardRef(function forwardConnectRef(\n        props,\n        ref\n      ) &#123;\n      \t&#x2F;&#x2F;connectä¸­æ˜¯å¦ä¼ é€’äº†forwardRefé€‰é¡¹\n        return &lt;Connect &#123;...props&#125; reactReduxForwardedRef&#x3D;&#123;ref&#125; &#x2F;&gt;\n      &#125;)\n  \n      forwarded.displayName &#x3D; displayName\n      forwarded.WrappedComponent &#x3D; WrappedComponent\n      &#x2F;&#x2F;hoistStaticsä¸ºä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œè´Ÿè´£æŠŠä¸€ä¸ªç±»ä¸­çš„é™æ€å±æ€§æ‹·è´åˆ°å¦ä¸€ä¸ªç±»ä¸­\n      return hoistStatics(forwarded, WrappedComponent)\n    &#125;\n  \n    return hoistStatics(Connect, WrappedComponent)\n  &#125;\n&#125;</code></pre>\n\n<h2 id=\"ä¸ºä½•è¦ä¼ é€’forwardRefï¼Ÿ\"><a href=\"#ä¸ºä½•è¦ä¼ é€’forwardRefï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä½•è¦ä¼ é€’forwardRefï¼Ÿ\"></a>ä¸ºä½•è¦ä¼ é€’forwardRefï¼Ÿ</h2><pre class=\"line-numbers language-tsx\" data-language=\"tsx\"><code class=\"language-tsx\">connect(mapStateToProp,mapDispatchToProps,mergeProps,&#123; forwardRef:true  &#125;)(Child)</code></pre>\n\n<p>å¦‚æœä¸ä¼ é€’ï¼Œè€Œæ˜¯åœ¨å…¶ä»–ç»„ä»¶ä¸­ç›´æ¥æ”¾refåˆ°ä½¿ç”¨äº†connectçš„ç»„ä»¶ï¼Œåˆ™refå®é™…åº”ç”¨åˆ°çš„æ˜¯ConncectFunctionç»„ä»¶ï¼Œè€ŒéçœŸæ­£çš„WrappedComponentç»„ä»¶<br>æ‰€ä»¥react-reduxæä¾›forwardRefé€‰é¡¹ï¼Œä½¿ç”¨React.forwardRefï¼Œå°†refå®é™…æ”¾åˆ°çœŸæ­£çš„WrappedComponentä¸Š</p>\n<h2 id=\"ConnectFunction\"><a href=\"#ConnectFunction\" class=\"headerlink\" title=\"ConnectFunction\"></a>ConnectFunction</h2><ul>\n<li><p>å®é™…æ¸²æŸ“çš„ç»„ä»¶</p>\n<pre class=\"line-numbers language-tsx\" data-language=\"tsx\"><code class=\"language-tsx\">function ConnectFunction(props) &#123;\n    &#x2F;* TODO:  ç¬¬ä¸€æ­¥ æŠŠ context ForwardedRef props å–å‡ºæ¥ *&#x2F;\n    &#x2F;&#x2F;å–å‡ºforwardRefå’Œä¼ é€’ç»™ConnectFunctionçš„æ‰€æœ‰é™¤forwardRefçš„props\n    &#x2F;&#x2F;é™¤äº†forwardRefä»¥å¤–çš„propsä¹Ÿå°±æ˜¯å®é™…ä¸šåŠ¡ä»£ç ä¸­ä¼ é€’ç»™conncecåŒ…è£¹ç»„ä»¶éƒ½props\n    const [\n      reactReduxForwardedRef,\n      wrapperProps &#x2F;&#x2F; props ä¼ é€’çš„props\n    ] &#x3D; useMemo(() &#x3D;&gt; &#123;\n      const &#123; reactReduxForwardedRef, ...wrapperProps &#125; &#x3D; props\n      return [reactReduxForwardedRef, wrapperProps]\n    &#125;, [props])\n \n\t  &#x2F;&#x2F; è·å–ä¸Šå±‚Provideræä¾›çš„contextï¼Œå¤šä¸ªProvideråªä¼šå–æœ€è¿‘çš„Provider\n    &#x2F;&#x2F; è·å– contextå†…å®¹ é‡Œé¢å«æœ‰  redux ä¸­store å’Œ subscription\n    const contextValue &#x3D; useContext(Context)\n\n    &#x2F;&#x2F;TODO: åˆ¤æ–­ store æ˜¯å¦æ¥è‡ªprops  didStoreComeFromProps ,æ­£å¸¸æƒ…å†µä¸‹ ï¼Œprop ä¸­æ˜¯ä¸å­˜åœ¨ store æ‰€ä»¥  didStoreComeFromProps &#x3D; false\n    const didStoreComeFromProps &#x3D;\n      Boolean(props.store) &amp;&amp;\n      Boolean(props.store.getState) &amp;&amp;\n      Boolean(props.store.dispatch)\n    &#x2F;&#x2F;storeæ˜¯å¦æ¥è‡ªProvideræä¾›çš„ä¸Šä¸‹æ–‡\n    const didStoreComeFromContext &#x3D;\n      Boolean(contextValue) &amp;&amp; Boolean(contextValue.store)\n\n    &#x2F;&#x2F;æ ¹æ®ä¸¤ç§æƒ…å†µè·å–store\n    const store &#x3D; didStoreComeFromProps ? props.store : contextValue.store\n     \n     &#x2F;&#x2F;è¿”å›mergeå‡½æ•° ç”¨äºç”ŸæˆçœŸæ­£ä¼ ç»™å­ç»„ä»¶ props\n    const childPropsSelector &#x3D; useMemo(() &#x3D;&gt; &#123;\n    \t&#x2F;&#x2F;é»˜è®¤æƒ…å†µä¸‹pureä¸ºtrueï¼Œè¿”å›çš„æ˜¯pureFinalPropsSelectorFactory\n      return createChildSelector(store)\n    &#125;, [store])\n\n\n    &#x2F;&#x2F; TODO:  ç¬¬äºŒæ­¥  åˆ›å»ºconnectç»„ä»¶è‡ªèº«çš„subscription ç›‘å¬è€…å®ä¾‹  \n    const [subscription, notifyNestedSubs] &#x3D; useMemo(() &#x3D;&gt; &#123;\n        &#x2F;&#x2F; å¦‚æœæ²¡æœ‰è®¢é˜…æ›´æ–°ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ï¼Œé»˜è®¤æƒ…å†µä¸‹å¼€å¯äº†è®¢é˜…\n      if (!shouldHandleStateChanges) return NO_SUBSCRIPTION_ARRAY\n\t\t&#x2F;&#x2F;ä¸ºæ¯ä¸€ä¸ªconncetçš„ç»„ä»¶åˆ›å»ºè®¢é˜…å™¨ï¼Œè·å–ä¸Šå±‚Provideræä¾›çš„contextValue.subscription\n\t\t&#x2F;&#x2F;connctçš„ç»„ä»¶è·å–çš„æ˜¯ä¸Šå±‚çš„Provderæä¾›çš„subscriptionï¼Œæœ‰å¤šä¸ªProviderï¼Œåªä¼šå–å±‚çº§æœ€è¿‘çš„ä¸€ä¸ª\n\t\t&#x2F;&#x2F;æ‰€ä»¥connectä¸­çš„connectç»„ä»¶ï¼Œè·å–åˆ°çš„æ˜¯ç¦»å®ƒæœ€è¿‘çš„Providerä¸­çš„è®¢é˜…å™¨ï¼Œé€šè¿‡å®ƒæ¥ç®¡ç†è‡ªèº«çš„listeneræ›´æ–°å‡½æ•°\n      const subscription &#x3D; new Subscription(\n        store,\n        didStoreComeFromProps ? null : contextValue.subscription &#x2F;&#x2F; å’Œ ä¸Šçº§ &#96;subscription&#96; å»ºç«‹èµ·å…³ç³»ã€‚ this.parentSub &#x3D; contextValue.subscription\n      )\n      &#x2F;&#x2F; notifyNestedSubs è§¦å‘ noticy æ‰€æœ‰å­ä»£ listener ç›‘å¬è€… -&gt; è§¦å‘batchæ–¹æ³•,è§¦å‘ batchupdateæ–¹æ³• ,æ‰¹é‡æ›´æ–°\n      &#x2F;&#x2F;å¹¶æ›´æ–°ä¸€ä¸‹thisæŒ‡å‘\n      const notifyNestedSubs &#x3D; subscription.notifyNestedSubs.bind(\n        subscription\n      )\n\n      return [subscription, notifyNestedSubs]\n    &#125;, [store, didStoreComeFromProps, contextValue])\n\n    &#x2F;*  åˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„contextValue ,æŠŠçˆ¶çº§çš„ subscription æ¢æˆè‡ªå·±çš„ subscription   *&#x2F;\n    const overriddenContextValue &#x3D; useMemo(() &#x3D;&gt; &#123;   \n      if (didStoreComeFromProps) &#123; \n        return contextValue\n      &#125;\n      &#x2F;&#x2F;é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿”å›è‡ªèº«çš„è®¢é˜…å™¨ä»¥åŠreduxä¸­çš„storeç»™è‡ªèº«çš„å­ä»£connectä¸­è·å–\n      return &#123;\n        ...contextValue,\n        subscription\n      &#125;\n    &#125;, [didStoreComeFromProps, contextValue, subscription])\n    \n    &#x2F;&#x2F;å®šä¹‰äº†ä¸€ä¸ªuseReducerï¼Œå½“actualChildPropså˜åŒ–æ—¶ï¼Œè°ƒç”¨dispatchæ–¹æ³•forceComponentUpdateDispatchè¿›è¡Œç»„ä»¶æ›´æ–°\n    const [\n      [previousStateUpdateResult], &#x2F;&#x2F;è°ƒç”¨dispatchæ›´æ–°åçš„å†…å®¹\n      forceComponentUpdateDispatch  &#x2F;*  *&#x2F;\n    ] &#x3D; useReducer(storeStateUpdatesReducer, EMPTY_ARRAY, initStateUpdates)\n\n\n    &#x2F;&#x2F; TODO: ç¬¬ä¸‰æ­¥ç¼“å­˜ç»„ä»¶æœ¬æ¬¡çš„propsç­‰å†…å®¹ï¼Œåœ¨ä¸‹ä¸€æ¬¡ç»„ä»¶æ›´æ–°æ—¶åšæ¯”è¾ƒ\n    const lastChildProps &#x3D; useRef() &#x2F;&#x2F;ä¿å­˜ä¸Šä¸€æ¬¡ åˆå¹¶è¿‡çš„ propsä¿¡æ¯ï¼ˆç»è¿‡ ownprops ,stateProps , dispatchProps åˆå¹¶è¿‡çš„ ï¼‰\n    const lastWrapperProps &#x3D; useRef(wrapperProps) &#x2F;&#x2F;ä¿å­˜æœ¬æ¬¡ä¸šåŠ¡ç»„ä»¶çš„ props \n    const childPropsFromStoreUpdate &#x3D; useRef() &#x2F;&#x2F;ç”¨æ¥ä¿å­˜æ›´æ–°åçš„æœ€æ–°çš„props\n    const renderIsScheduled &#x3D; useRef(false) &#x2F;&#x2F; å½“å‰ç»„ä»¶æ˜¯å¦å¤„äºæ¸²æŸ“é˜¶æ®µ\n    \n    &#x2F;&#x2F; actualChildProps ä¸ºå½“å‰çœŸæ­£å¤„ç†è¿‡åï¼Œç»è¿‡åˆå¹¶çš„ props\n    const actualChildProps &#x3D; usePureOnlyMemo(() &#x3D;&gt; &#123;\n        &#x2F;&#x2F; è°ƒç”¨ mergeProps è¿›è¡Œåˆå¹¶ï¼Œè¿”å›åˆå¹¶åçš„æœ€æ–° porps\n        &#x2F;&#x2F;åŠè°ƒç”¨pureFinalPropsSelectorFactoryåçš„åˆå¹¶ç»“æœ\n      return childPropsSelector(store.getState(), wrapperProps)\n    \n    \t &#x2F;&#x2F;ä¼šåœ¨storeã€è°ƒç”¨äº†checkForUpdatesã€ä¼ é€’ç»™ç»„å»ºçš„propså‘ç”Ÿå˜åŒ–åï¼Œé‡æ–°è®¡ç®—è·å–åˆå¹¶åçš„props \n    &#125;, [store, previousStateUpdateResult, wrapperProps])\n\n   &#x2F;* è´Ÿè´£æ›´æ–°ç¼“å­˜å˜é‡ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ¬¡æ›´æ–°çš„æ—¶å€™æ¯”è¾ƒ *&#x2F;\n    useEffect(()&#x3D;&gt;&#123;\n      captureWrapperProps(...[\n          lastWrapperProps,\n          lastChildProps,\n          renderIsScheduled,\n          wrapperProps,\n          actualChildProps,\n          childPropsFromStoreUpdate,\n          notifyNestedSubs\n       ])\n    &#125;)\n    \n    &#x2F;&#x2F;å®é™…è®¢é˜…æ›´æ–°ç»„ä»¶çš„åœ°æ–¹\n    useEffect(()&#x3D;&gt;&#123;\n        subscribeUpdates(...[\n        shouldHandleStateChanges,\n        store,\n        subscription,\n        childPropsSelector,\n        lastWrapperProps,\n        lastChildProps,\n        renderIsScheduled,\n        childPropsFromStoreUpdate,\n        notifyNestedSubs,\n        forceComponentUpdateDispatch\n       ])\n    &#125;,[store, subscription, childPropsSelector])\n\n\n\n    &#x2F;&#x2F; TODO: ç¬¬å››æ­¥ï¼šæ¸²æŸ“å®é™…æŒ‚è½½çš„ç»„ä»¶ï¼Œé€šè¿‡useMemoè¿›è¡Œç»„ä»¶çš„ç¼“å­˜\n    const renderedWrappedComponent &#x3D; useMemo(\n      () &#x3D;&gt; (\n        &lt;WrappedComponent\n          &#123;...actualChildProps&#125;\n          ref&#x3D;&#123;reactReduxForwardedRef&#125;\n        &#x2F;&gt;\n      ),\n      &#x2F;&#x2F;å½“actualChildPropså‘ç”Ÿå˜åŒ–çš„æ—¶å€™é‡æ–°æ¸²æŸ“ç»„ä»¶\n      &#x2F;&#x2F;è¿™é‡Œå°±æ˜¯ç»„ä»¶é‡æ–°æ¸²æŸ“çš„åŸå› ï¼šä¸»è¦é€šè¿‡ç›‘å¬actualChildPropsçš„å˜åŒ–\n      [reactReduxForwardedRef, WrappedComponent, actualChildProps]\n    )\n    &#x2F;&#x2F; å°†ä¸Šä¸€æ­¥çš„renderedWrappedComponentåŒ…è£¹ä¸€å±‚Provider\n    &#x2F;&#x2F; æä¾›è¯¥connectç»„ä»¶è‡ªèº«çš„è®¢é˜…å™¨ã€storeç»™å­ä»£ä¸­çš„connectç»„ä»¶è·å–\n    const renderedChild &#x3D; useMemo(() &#x3D;&gt; &#123;\n      &#x2F;&#x2F;shouldHandleStateChanges æ¥æº connectæ˜¯å¦æœ‰ç¬¬ä¸€ä¸ªå‚æ•°\n      if (shouldHandleStateChanges) &#123;\n        return (\n          &#x2F;&#x2F; ContextToUse ä¼ é€’ context \n          &lt;ContextToUse.Provider value&#x3D;&#123;overriddenContextValue&#125;&gt;\n            &#123;renderedWrappedComponent&#125;\n          &lt;&#x2F;ContextToUse.Provider&gt;\n        )\n      &#125;\n\n      return renderedWrappedComponent\n    &#125;, [ContextToUse, renderedWrappedComponent, overriddenContextValue])\n\n    return renderedChild\n  &#125;\n\n</code></pre>\n</li>\n<li><p>åˆ›å»ºè¯¥connectç»„ä»¶è‡ªèº«çš„subscription, å¹¶ä½¿ç”¨ProvideråŒ…è£¹ï¼Œå±‚å±‚ä¼ é€’æ–°çš„context(å¾ˆé‡è¦)</p>\n</li>\n<li><p>æ‰€ä»¥connectç»„ä»¶çš„å­ä»£connectç»„ä»¶ï¼Œè·å–åˆ°çš„éƒ½æ˜¯å…¶ä¸Šå±‚æœ€è¿‘çš„connectæä¾›çš„Providerä¸­çš„è®¢é˜…å™¨ï¼Œç„¶åå°†æ›´æ–°å‡½æ•°checkForUpdatesæ”¾è¿›å…¶ä¸­ç®¡ç†</p>\n</li>\n<li><p>ç„¶åé€šè¿‡ useMemo åˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„ contextValue ,æŠŠçˆ¶çº§çš„ subscription æ¢æˆè‡ªå·±çš„ subscriptionã€‚ç”¨äºé€šè¿‡ Provider ä¼ é€’æ–°çš„ context</p>\n</li>\n<li><p>æ¥ä¸‹æ¥é€šè¿‡useReduceråˆ¶é€ å‡ºçœŸæ­£è§¦å‘æ›´æ–°çš„forceComponentUpdateDispatch è¿™ä¸ªdispatchå‡½æ•°ã€‚ä¹Ÿå°±æ˜¯æ•´ä¸ª state æˆ–è€…æ˜¯ propsæ”¹å˜ï¼Œè§¦å‘ç»„ä»¶æ›´æ–°çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ”¾è¿›checkForUpdatesä¸­æ‰§è¡Œ</p>\n</li>\n</ul>\n<h2 id=\"captureWrapperProps\"><a href=\"#captureWrapperProps\" class=\"headerlink\" title=\"captureWrapperProps\"></a>captureWrapperProps</h2><ul>\n<li>è¿›è¡Œå†…å®¹ç¼“å­˜ï¼Œä¸ºäº†ä¸‹æ¬¡ç»„ä»¶æ›´æ–°è¿›è¡Œæ¯”è¾ƒ<pre class=\"line-numbers language-ts\" data-language=\"ts\"><code class=\"language-ts\">&#x2F;&#x2F;è·å–åŒ…è£…çš„props \nfunction captureWrapperProps(\n  lastWrapperProps,\n  lastChildProps,\n  renderIsScheduled,\n  wrapperProps,\n  actualChildProps,\n  childPropsFromStoreUpdate,\n  notifyNestedSubs\n) &#123;\n  lastWrapperProps.current &#x3D; wrapperProps  &#x2F;&#x2F;å­props \n  lastChildProps.current &#x3D; actualChildProps &#x2F;&#x2F;ç»è¿‡ megeprops ä¹‹åå½¢æˆçš„æ–°prop\n  renderIsScheduled.current &#x3D; false  &#x2F;&#x2F; å½“å‰ç»„ä»¶æ¸²æŸ“å®Œæˆ\n&#125;\n</code></pre></li>\n</ul>\n<h2 id=\"subscribeUpdates\"><a href=\"#subscribeUpdates\" class=\"headerlink\" title=\"subscribeUpdates\"></a>subscribeUpdates</h2><ul>\n<li><p>å®é™…æ·»åŠ æ›´æ–°å›è°ƒçš„åœ°æ–¹</p>\n<pre class=\"line-numbers language-ts\" data-language=\"ts\"><code class=\"language-ts\">function subscribeUpdates(\n  shouldHandleStateChanges,\n  store,\n  subscription,\n  childPropsSelector,\n  lastWrapperProps,  &#x2F;&#x2F;å­props \n  lastChildProps, &#x2F;&#x2F;ç»è¿‡ megeprops ä¹‹åå½¢æˆçš„ prop\n  renderIsScheduled,\n  childPropsFromStoreUpdate,\n  notifyNestedSubs,\n  forceComponentUpdateDispatch\n) &#123;\n  if (!shouldHandleStateChanges) return\n\n   &#x2F;&#x2F; æ•è·å€¼ä»¥æ£€æŸ¥æ­¤ç»„ä»¶æ˜¯å¦å¸è½½ä»¥åŠä½•æ—¶å¸è½½\n  let didUnsubscribe &#x3D; false\n  let lastThrownError &#x3D; null\n   &#x2F;&#x2F;storeæ›´æ–°è®¢é˜…ä¼ æ’­åˆ°æ­¤ç»„ä»¶æ—¶ï¼Œè¿è¡Œæ­¤å›è°ƒ\n  const checkForUpdates &#x3D; ()&#x3D;&gt;&#123;\n      &#x2F;&#x2F;....\n  &#125;\n  &#x2F;&#x2F;å°†checkForUpdatesä½œä¸ºlistener\n  subscription.onStateChange &#x3D; checkForUpdates\n  &#x2F;&#x2F;å¼€å¯è®¢é˜…è€… ï¼Œå½“å‰æ˜¯è¢«connect åŒ…è½¬çš„æƒ…å†µ ä¼šæŠŠ å½“å‰çš„ checkForceUpdate æ”¾åœ¨å­˜å…¥ çˆ¶å…ƒç´ çš„addNestedSubä¸­ã€‚\n  subscription.trySubscribe()\n  &#x2F;&#x2F;åœ¨ç¬¬ä¸€æ¬¡å‘ˆç°ä¹‹åä»å­˜å‚¨ä¸­æå–æ•°æ®ï¼Œä»¥é˜²å­˜å‚¨ä»æˆ‘ä»¬å¼€å§‹å°±æ”¹å˜äº†ã€‚\n  &#x2F;&#x2F;ç¡®ä¿è·å–åˆ°çš„æœ€æ–°çš„store.getState,ç„¶ååˆ¤æ–­æ˜¯å¦æ›´æ–°ç»„ä»¶\n  checkForUpdates()\n  &#x2F;* å¸è½½è®¢é˜…èµ· *&#x2F;\n  const unsubscribeWrapper &#x3D; () &#x3D;&gt; &#123;\n    didUnsubscribe &#x3D; true\n    subscription.tryUnsubscribe()\n    subscription.onStateChange &#x3D; null\n  &#125;\n\n  return unsubscribeWrapper\n&#125;\n</code></pre>\n</li>\n<li><p>é¦–å…ˆå£°æ˜ store æ›´æ–°è®¢é˜…ä¼ æ’­åˆ°æ­¤ç»„ä»¶æ—¶çš„å›è°ƒå‡½æ•°checkForUpdatesæŠŠå®ƒèµ‹å€¼ç»™onStateChange,å¦‚æœstoreä¸­çš„stateå‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆåœ¨ç»„ä»¶è®¢é˜…äº†stateå†…å®¹ä¹‹åï¼Œç›¸å…³è”çš„stateæ”¹å˜å°±ä¼šè§¦å‘å½“å‰ç»„ä»¶çš„onStateChange,æ¥åˆå¹¶å¾—åˆ°æ–°çš„props</p>\n</li>\n<li><p>subscription.trySubscribe()æŠŠè®¢é˜…å‡½æ•°onStateChangeç»‘å®šç»™çˆ¶çº§subscription,è¿›è¡Œäº†å±‚å±‚è®¢é˜…</p>\n</li>\n<li><p>ä¸ºäº†ç¡®ä¿æ‹¿åˆ°çš„storeå†…å®¹æ˜¯æœ€æ–°çš„ï¼Œæ‰€ä»¥é¦–å…ˆæ‰§è¡Œäº†ä¸€æ¬¡checkForUpdates<br><img src=\"https://img-blog.csdnimg.cn/d03af8b00dcd4deaad5bcb09c5cc2903.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA56We5aWH5aSn5Y-U,size_20,color_FFFFFF,t_70,g_se,x_16\"></p>\n<h2 id=\"checkForUpdates\"><a href=\"#checkForUpdates\" class=\"headerlink\" title=\"checkForUpdates\"></a>checkForUpdates</h2></li>\n<li><p>åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°çš„å‡½æ•°</p>\n<pre class=\"line-numbers language-tsx\" data-language=\"tsx\"><code class=\"language-tsx\">&#x2F;&#x2F;storeæ›´æ–°è®¢é˜…ä¼ æ’­åˆ°æ­¤ç»„ä»¶æ—¶ï¼Œè¿è¡Œæ­¤å›è°ƒ\nconst checkForUpdates &#x3D; () &#x3D;&gt; &#123;\n  if (didUnsubscribe) &#123;\n    &#x2F;&#x2F;å¦‚æœå–æ¶ˆè®¢é˜…äº†\n    return\n  &#125;\n   &#x2F;&#x2F; è·å– store é‡Œstate\n  const latestStoreState &#x3D; store.getState()q\n  let newChildProps, error\n  try &#123;\n    &#x2F;* å¾—åˆ°æœ€æ–°çš„ props *&#x2F;\n    newChildProps &#x3D; childPropsSelector(\n      latestStoreState,\n      lastWrapperProps.current\n    )\n  &#125; \n  &#x2F;&#x2F;å¦‚æœæ–°çš„åˆå¹¶çš„ propsæ²¡æœ‰æ›´æ”¹ï¼Œåˆ™æ­¤å¤„ä¸åšä»»ä½•æ“ä½œ-å±‚å è®¢é˜…æ›´æ–°\n  if (newChildProps &#x3D;&#x3D;&#x3D; lastChildProps.current) &#123; \n    if (!renderIsScheduled.current) &#123;  \n      notifyNestedSubs() &#x2F;* é€šçŸ¥å­ä»£ subscription è§¦å‘ checkForUpdates æ¥æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°ã€‚ *&#x2F;\n    &#125;\n  &#125; else &#123;\n    lastChildProps.current &#x3D; newChildProps\n    childPropsFromStoreUpdate.current &#x3D; newChildProps\n    renderIsScheduled.current &#x3D; true\n    &#x2F;&#x2F; è§¦å‘useReducerçš„dispatchæ¥è¿›è¡Œæ›´æ–°ï¼Œè¯¥dispatchä¼šæ”¹å˜useReducerè¿”å›çš„previousStateUpdateResult\n    &#x2F;&#x2F; è€ŒpreviousStateUpdateResultæ˜¯ä½œä¸ºactualChildPropsçš„ä¾èµ–é¡¹å¼•å‘actualChildPropsçš„æ”¹å˜\n    &#x2F;&#x2F; actualChildPropsåˆæ˜¯å®é™…æ¸²æŸ“ç»„ä»¶çš„ä¾èµ–æ€§ï¼Œä»è€Œå¼•å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“æ›´æ–°\n    forceComponentUpdateDispatch(&#123;\n      type: &#39;STORE_UPDATED&#39;,\n      payload: &#123;\n        error\n      &#125;\n    &#125;)\n  &#125;\n&#125;</code></pre>\n</li>\n<li><p>checkForUpdates é€šè¿‡è°ƒç”¨ childPropsSelectoræ¥å½¢æˆæ–°çš„props,ç„¶ååˆ¤æ–­ä¹‹å‰çš„ prop å’Œå½“å‰æ–°çš„ prop æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æœç›¸ç­‰ï¼Œè¯æ˜æ²¡æœ‰å‘ç”Ÿå˜åŒ–,æ— é¡»æ›´æ–°å½“å‰ç»„ä»¶ï¼Œé‚£ä¹ˆé€šè¿‡è°ƒç”¨notifyNestedSubsæ¥é€šçŸ¥å­ä»£å®¹å™¨ç»„ä»¶ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°ã€‚å¦‚æœä¸ç›¸ç­‰è¯æ˜è®¢é˜…çš„store.stateå‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç«‹å³æ‰§è¡ŒforceComponentUpdateDispatchæ¥è§¦å‘ç»„ä»¶çš„æ›´æ–°</p>\n</li>\n</ul>\n<h2 id=\"æ•´ä¸ªè®¢é˜…æµç¨‹\"><a href=\"#æ•´ä¸ªè®¢é˜…æµç¨‹\" class=\"headerlink\" title=\"æ•´ä¸ªè®¢é˜…æµç¨‹\"></a>æ•´ä¸ªè®¢é˜…æµç¨‹</h2><p>æ•´ä¸ªè®¢é˜…çš„æµç¨‹æ˜¯ï¼Œå¦‚æœè¢«connectåŒ…è£¹ï¼Œå¹¶ä¸”å…·æœ‰ç¬¬ä¸€ä¸ªå‚æ•°ã€‚é¦–å…ˆé€šè¿‡contextè·å–æœ€è¿‘çš„ subscriptionï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„subscription,å¹¶ä¸”å’Œçˆ¶çº§çš„subscriptionå»ºç«‹èµ·å…³è”ã€‚å½“ç¬¬ä¸€æ¬¡hocå®¹å™¨ç»„ä»¶æŒ‚åœ¨å®Œæˆåï¼Œåœ¨useEffecté‡Œï¼Œè¿›è¡Œè®¢é˜…ï¼Œå°†è‡ªå·±çš„è®¢é˜…å‡½æ•°checkForUpdates,ä½œä¸ºå›è°ƒå‡½æ•°ï¼Œé€šè¿‡trySubscribe å’Œthis.parentSub.addNestedSub ,åŠ å…¥åˆ°çˆ¶çº§subscriptionçš„listenersä¸­ã€‚ç”±æ­¤å®Œæˆæ•´ä¸ªè®¢é˜…æµç¨‹</p>\n<h2 id=\"æ•´ä¸ªå‘å¸ƒæµç¨‹\"><a href=\"#æ•´ä¸ªå‘å¸ƒæµç¨‹\" class=\"headerlink\" title=\"æ•´ä¸ªå‘å¸ƒæµç¨‹\"></a>æ•´ä¸ªå‘å¸ƒæµç¨‹</h2><p>æ•´ä¸ªæ›´æ–°æµç¨‹æ˜¯ï¼Œå½“ç»„ä»¶ä¸­è°ƒç”¨dispatchè§¦å‘äº†reduxçš„stateæ”¹å˜å’Œreduxçš„è®¢é˜…å™¨ï¼Œä»è€Œè§¦å‘æ ¹è®¢é˜…å™¨çš„è§¦å‘listeners.notify ,ä¹Ÿå°±æ˜¯checkForUpdateså‡½æ•°ï¼Œç„¶åcheckForUpdateså‡½æ•°é¦–å…ˆæ ¹æ®mapStoretopropsï¼Œmergepropsç­‰æ“ä½œï¼ŒéªŒè¯è¯¥ç»„ä»¶æ˜¯å¦å‘èµ·è®¢é˜…ï¼Œprops æ˜¯å¦æ”¹å˜ï¼Œå¹¶æ›´æ–°ï¼Œå¦‚æœå‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆè§¦å‘useReducerçš„forceComponentUpdateDispatchå‡½æ•°ï¼Œæ¥æ›´æ–°ä¸šåŠ¡ç»„ä»¶ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿæ›´æ–°ï¼Œé‚£ä¹ˆé€šè¿‡è°ƒç”¨notifyNestedSubs,æ¥é€šçŸ¥å½“å‰subscriptionçš„listenersæ£€æŸ¥æ˜¯å¦æ›´æ–°ï¼Œç„¶åå°½å¿ƒå±‚å±‚checkForUpdates,é€çº§å‘ä¸‹ï¼Œå€Ÿæ­¤å®Œæˆæ•´ä¸ªæ›´æ–°æµç¨‹ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><ul>\n<li>connectä½¿ç”¨æŸ¯é‡ŒåŒ–</li>\n<li>useMemoç¼“å­˜æ¸²æŸ“ç»„ä»¶çš„æ“ä½œ</li>\n<li>å‘å¸ƒè®¢é˜…æ¨¡å¼ä»¥åŠé€šè¿‡åŒå‘é“¾è¡¨æ¥ç®¡ç†</li>\n<li>å¦‚ä½•é€šè¿‡Providerè¿›è¡Œå±‚å±‚è®¢é˜…</li>\n<li>react-reduxè§¦å‘æ›´æ–°çš„ä¾æ®æ˜¯actualChildPropsæ˜¯å¦æ”¹å˜</li>\n</ul>\n<h2 id=\"å‚è€ƒ\"><a href=\"#å‚è€ƒ\" class=\"headerlink\" title=\"å‚è€ƒ\"></a>å‚è€ƒ</h2><p><a href=\"https://blog.csdn.net/weixin_43294560/article/details/123284317\">react-reduxæºç è§£æ</a><br><a href=\"https://github.com/841660202/react-redux\">github æºç </a><br><a href=\"https://blog.csdn.net/qq_33715850/article/details/122535984\">React-reduxæºç è§£æâ€“å‡†å¤‡çŸ¥è¯†</a><br><a href=\"https://blog.csdn.net/qq_33715850/article/details/122590433\">React-reduxæºç è§£æ</a></p>\n","text":"æºç ç‰ˆæœ¬&quot;version&quot;: &quot;8.0.2&quot;, Provider ä¸»è¦ä½œç”¨é€šè¿‡subscriptionè°ƒç”¨reduxä¸­storeçš„subscriptionäº§ç”Ÿè®¢é˜…ï¼Œè®¢é˜…å†…å®¹æ˜¯onStateChangeçš„å›è°ƒ é€šè¿‡reactçš„Provider...","link":"","photos":[],"count_time":{"symbolsCount":"30k","symbolsTime":"27 mins."},"categories":[{"name":"react","slug":"react","count":9,"path":"api/categories/react.json"}],"tags":[{"name":"react-redux","slug":"react-redux","count":2,"path":"api/tags/react-redux.json"},{"name":"redux","slug":"redux","count":6,"path":"api/tags/redux.json"},{"name":"æºç ","slug":"æºç ","count":12,"path":"api/tags/æºç .json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Provider\"><span class=\"toc-text\">Provider</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Subscription\"><span class=\"toc-text\">Subscription</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#createListenerCollection\"><span class=\"toc-text\">createListenerCollection</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#connect\"><span class=\"toc-text\">connect</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#selectorFactory\"><span class=\"toc-text\">selectorFactory</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#pureFinalPropsSelectorFactory\"><span class=\"toc-text\">pureFinalPropsSelectorFactory</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#connectHOC\"><span class=\"toc-text\">connectHOC</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#wrapWithConnect\"><span class=\"toc-text\">wrapWithConnect</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%BA%E4%BD%95%E8%A6%81%E4%BC%A0%E9%80%92forwardRef%EF%BC%9F\"><span class=\"toc-text\">ä¸ºä½•è¦ä¼ é€’forwardRefï¼Ÿ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ConnectFunction\"><span class=\"toc-text\">ConnectFunction</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#captureWrapperProps\"><span class=\"toc-text\">captureWrapperProps</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#subscribeUpdates\"><span class=\"toc-text\">subscribeUpdates</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#checkForUpdates\"><span class=\"toc-text\">checkForUpdates</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B4%E4%B8%AA%E8%AE%A2%E9%98%85%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">æ•´ä¸ªè®¢é˜…æµç¨‹</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B4%E4%B8%AA%E5%8F%91%E5%B8%83%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">æ•´ä¸ªå‘å¸ƒæµç¨‹</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">æ€»ç»“</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83\"><span class=\"toc-text\">å‚è€ƒ</span></a></li></ol>","author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"redux æºç  1","uid":"af1b42282a210ca45f834a49b50349c6","slug":"2022-05-25.redux","date":"2022-05-25T05:48:17.000Z","updated":"2022-06-25T09:34:46.425Z","comments":true,"path":"api/articles/2022-05-25.redux.json","keywords":null,"cover":[],"text":"ä»‹ç»A Predictable State Container for JS Apps package.json&#123; &quot;name&quot;: &quot;redux&quot;, &quot;version&quot;: &quot;5.0.0-alpha.0...","link":"","photos":[],"count_time":{"symbolsCount":"3.6k","symbolsTime":"3 mins."},"categories":[{"name":"react","slug":"react","count":9,"path":"api/categories/react.json"}],"tags":[{"name":"redux","slug":"redux","count":6,"path":"api/tags/redux.json"},{"name":"æºç ","slug":"æºç ","count":12,"path":"api/tags/æºç .json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"react-redux æºç 1","uid":"83401137c3fcd92a859b6d9e289c2c88","slug":"2022-05-24react-redux","date":"2022-05-24T05:58:32.000Z","updated":"2022-06-25T09:34:46.424Z","comments":true,"path":"api/articles/2022-05-24react-redux.json","keywords":null,"cover":null,"text":"react-reduxå®˜æ–¹ä»‹ç» å®˜æ–¹UIç»‘å®šå±‚ã€‚ React Redux is the official React UI bindings layer for Redux. ä»reduxçš„storeè¯»æ•°æ®ã€‚ It lets your React components read ...","link":"","photos":[],"count_time":{"symbolsCount":"13k","symbolsTime":"12 mins."},"categories":[{"name":"react","slug":"react","count":9,"path":"api/categories/react.json"}],"tags":[{"name":"react-redux","slug":"react-redux","count":2,"path":"api/tags/react-redux.json"},{"name":"redux","slug":"redux","count":6,"path":"api/tags/redux.json"},{"name":"æºç ","slug":"æºç ","count":12,"path":"api/tags/æºç .json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}