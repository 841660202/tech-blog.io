{"title":"React@16.5.0 syntheticEvent","uid":"8cd3fa1949a115d76dd37b87c1175bed","slug":"2022-07-20react-syntheticEvent","date":"2022-07-20T01:18:53.000Z","updated":"2022-09-16T15:02:19.077Z","comments":true,"path":"api/articles/2022-07-20react-syntheticEvent.json","keywords":null,"cover":[],"content":"<h2 id=\"æœ¬æ–‡è¯´æ˜\"><a href=\"#æœ¬æ–‡è¯´æ˜\" class=\"headerlink\" title=\"æœ¬æ–‡è¯´æ˜\"></a>æœ¬æ–‡è¯´æ˜</h2><p>æœ¬æ–‡ä¸»è¦å†…å®¹æ˜¯ <a href=\"https://github.com/facebook/react/tree/v16.5.0\" target=\"_blank\" >React v16.5.0</a>, éƒ¨åˆ†å†…å®¹ä¼šæ¶‰åŠåˆ° React v17+, React v17+åˆæˆäº‹ä»¶ä¸ React16 æœ‰å¾ˆå¤§å·®å¼‚</p>\n<h2 id=\"React-å’Œäº‹ä»¶ç³»ç»Ÿæ¦‚è¿°\"><a href=\"#React-å’Œäº‹ä»¶ç³»ç»Ÿæ¦‚è¿°\" class=\"headerlink\" title=\"React å’Œäº‹ä»¶ç³»ç»Ÿæ¦‚è¿°\"></a>React å’Œäº‹ä»¶ç³»ç»Ÿæ¦‚è¿°</h2><p><a href=\"https://github.com/facebook/react/blob/71c0e05ba79e2e12556980ffbab264b41fdc19cd/packages/react-dom/src/events/ReactBrowserEventEmitter.js#L52\" target=\"_blank\" >è§</a></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;**\n *\n * +------------+    .\n * |    DOM     |    .\n * +------------+    .\n *       |           .\n *       v           .\n * +------------+    .\n * | ReactEvent |    .\n * |  Listener  |    .\n * +------------+    .                         +-----------+\n *       |           .               +--------+|SimpleEvent|\n *       |           .               |         |Plugin     |\n * +-----|------+    .               v         +-----------+\n * |     |      |    .    +--------------+                    +------------+\n * |     +-----------.---&gt;|EventPluginHub|                    |    Event   |\n * |            |    .    |              |     +-----------+  | Propagators|\n * | ReactEvent |    .    |              |     |TapEvent   |  |------------|\n * |  Emitter   |    .    |              |&lt;---+|Plugin     |  |other plugin|\n * |            |    .    |              |     +-----------+  |  utilities |\n * |     +-----------.---&gt;|              |                    +------------+\n * |     |      |    .    +--------------+\n * +-----|------+    .                ^        +-----------+\n *       |           .                |        |Enter&#x2F;Leave|\n *       +           .                +-------+|Plugin     |\n * +-------------+   .                         +-----------+\n * | application |   .\n * |-------------|   .\n * |             |   .\n * |             |   .\n * +-------------+   .\n *                   .\n *    React Core     .  General Purpose Event Plugin System\n *&#x2F;</code></pre>\n\n<h2 id=\"ä¸ºä»€ä¹ˆ-React-éœ€è¦è‡ªå·±å®ç°ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆ-React-éœ€è¦è‡ªå·±å®ç°ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆ React éœ€è¦è‡ªå·±å®ç°ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Ÿ\"></a>ä¸ºä»€ä¹ˆ React éœ€è¦è‡ªå·±å®ç°ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Ÿ</h2><img src=\"http://t-blog-images.aijs.top/img/20220720095157.webp\" style=\"max-width: 100%; width: 600px\" />\n\n<p>è¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯ä¸ºäº†<code>æ€§èƒ½</code>å’Œ<code>å¤ç”¨</code>ä¸¤ä¸ªæ–¹é¢æ¥è€ƒè™‘ã€‚</p>\n<h3 id=\"é¦–å…ˆå¯¹äºæ€§èƒ½æ¥è¯´\"><a href=\"#é¦–å…ˆå¯¹äºæ€§èƒ½æ¥è¯´\" class=\"headerlink\" title=\"é¦–å…ˆå¯¹äºæ€§èƒ½æ¥è¯´\"></a>é¦–å…ˆå¯¹äº<code>æ€§èƒ½</code>æ¥è¯´</h3><p>React ä½œä¸ºä¸€å¥— View å±‚é¢çš„æ¡†æ¶ï¼Œé€šè¿‡æ¸²æŸ“å¾—åˆ° vDOMï¼Œå†ç”± diff ç®—æ³•å†³å®š DOM æ ‘é‚£äº›ç»“ç‚¹éœ€è¦æ–°å¢ã€æ›¿æ¢æˆ–ä¿®æ”¹ï¼Œå‡å¦‚ç›´æ¥åœ¨ DOM ç»“ç‚¹æ’å…¥åŸç”Ÿäº‹ä»¶ç›‘å¬ï¼Œåˆ™ä¼šå¯¼è‡´é¢‘ç¹çš„è°ƒç”¨ addEventListener å’Œ removeEventListenerï¼Œé€ æˆæ€§èƒ½çš„æµªè´¹ã€‚æ‰€ä»¥ React é‡‡ç”¨äº†äº‹ä»¶ä»£ç†çš„æ–¹æ³•ï¼Œå¯¹äºå¤§éƒ¨åˆ†äº‹ä»¶ 1 è€Œè¨€éƒ½åœ¨ document ä¸Šåšç›‘å¬ï¼Œç„¶å<code>æ ¹æ®Eventä¸­çš„targetæ¥åˆ¤æ–­äº‹ä»¶è§¦å‘çš„ç»“ç‚¹</code>ã€‚</p>\n<p>å…¶æ¬¡ React åˆæˆçš„ SyntheticEvent é‡‡ç”¨äº†<code>æ± çš„æ€æƒ³</code>ï¼Œä»è€Œè¾¾åˆ°èŠ‚çº¦å†…å­˜ï¼Œé¿å…é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯äº‹ä»¶å¯¹è±¡çš„ç›®çš„ã€‚è¿™ä¹Ÿæ˜¯<code>â€œå¦‚æœæˆ‘ä»¬éœ€è¦å¼‚æ­¥ä½¿ç”¨ä¸€ä¸ª syntheticEventï¼Œéœ€è¦æ‰§è¡Œ event.persist()æ‰èƒ½é˜²æ­¢äº‹ä»¶å¯¹è±¡è¢«é‡Šæ”¾â€</code>çš„åŸå› ã€‚</p>\n<p>æœ€ååœ¨ React æºç ä¸­éšå¤„å¯è§ <code>batch åšæ‰¹é‡æ›´æ–°</code>ï¼ŒåŸºæœ¬ä¸Šå‡¡æ˜¯å¯ä»¥æ‰¹é‡å¤„ç†çš„äº‹æƒ…ï¼ˆæœ€æ™®éçš„ setStateï¼‰React éƒ½ä¼šå°†ä¸­é—´è¿‡ç¨‹ä¿å­˜èµ·æ¥ï¼Œç•™åˆ°æœ€åé¢ flushï¼ˆæ¸²æŸ“ï¼Œå¹¶æœ€ç»ˆæäº¤åˆ° DOM æ ‘ä¸Šï¼‰æ‰ã€‚å°±å¦‚<code>æµè§ˆå™¨å¯¹ DOM æ ‘è¿›è¡Œ Styleï¼ŒLayoutï¼ŒPaint ä¸€æ ·ï¼Œéƒ½ä¸ä¼šåœ¨æ“ä½œ ele.style.color=&#39;red&#39;;ä¹‹åé©¬ä¸Šæ‰§è¡Œï¼Œåªä¼šå°†è¿™äº›æ“ä½œæ‰“åŒ…èµ·æ¥å¹¶æœ€ç»ˆåœ¨éœ€è¦æ¸²æŸ“çš„æ—¶å€™å†åšæ¸²æŸ“,</code>ã€‚<a href=\"https://v.aijs.top/post/2022-07-17css\" target=\"_blank\" >é˜Ÿåˆ—æœºåˆ¶æ¥æ‰¹é‡æ›´æ–°å¸ƒå±€ (1000ms&#x2F;60 &#x3D; 16.6ms è¿›è¡Œä¸€æ¬¡æ¸²æŸ“)</a></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">ele.style.color &#x3D; &quot;red&quot;;\nele.style.color &#x3D; &quot;blue&quot;;\nele.style.color &#x3D; &quot;red&quot;;\n&#x2F;&#x2F; æµè§ˆå™¨åªä¼šæ¸²æŸ“ä¸€æ¬¡;</code></pre>\n\n<h3 id=\"è€Œå¯¹äºå¤ç”¨æ¥è¯´\"><a href=\"#è€Œå¯¹äºå¤ç”¨æ¥è¯´\" class=\"headerlink\" title=\"è€Œå¯¹äºå¤ç”¨æ¥è¯´\"></a>è€Œå¯¹äºå¤ç”¨æ¥è¯´</h3><p>React çœ‹åˆ°åœ¨ä¸åŒçš„æµè§ˆå™¨å’Œå¹³å°ä¸Šï¼Œç”¨æˆ·ç•Œé¢ä¸Šçš„äº‹ä»¶å…¶å®éå¸¸ç›¸ä¼¼ï¼Œä¾‹å¦‚æ™®é€šçš„ clickï¼Œchange ç­‰ç­‰ã€‚React å¸Œæœ›é€šè¿‡å°è£…ä¸€å±‚äº‹ä»¶ç³»ç»Ÿï¼Œå°†ä¸åŒå¹³å°çš„åŸç”Ÿäº‹ä»¶éƒ½å°è£…æˆ <code>SyntheticEvent</code>ã€‚</p>\n<ul>\n<li><p>ä½¿å¾—<code>ä¸åŒå¹³å°åªéœ€è¦é€šè¿‡åŠ å…¥EventEmitterä»¥åŠå¯¹åº”çš„Rendererå°±èƒ½ä½¿ç”¨ç›¸åŒçš„ä¸€ä¸ªäº‹ä»¶ç³»ç»Ÿ</code>ï¼ŒWEB å¹³å°ä¸ŠåŠ å…¥ <code>ReactBrowserEventEmitter</code>ï¼ŒNative ä¸ŠåŠ å…¥ <code>ReactNativeEventEmitter</code>ã€‚å¦‚ä¸‹å›¾ï¼Œå¯¹äºä¸åŒå¹³å°ï¼ŒReact åªéœ€è¦æ›¿æ¢æ‰å·¦è¾¹éƒ¨åˆ†ï¼Œè€Œå³è¾¹ EventPluginHub éƒ¨åˆ†å¯ä»¥ä¿æŒå¤ç”¨ã€‚</p>\n</li>\n<li><p>è€Œ<code>å¯¹äºä¸åŒçš„æµè§ˆå™¨è€Œè¨€ï¼ŒReactå¸®æˆ‘ä»¬ç»Ÿä¸€äº†äº‹ä»¶ï¼Œåšäº†æµè§ˆå™¨çš„å…¼å®¹</code>ï¼Œä¾‹å¦‚å¯¹äº transitionEnd,webkitTransitionEnd,MozTransitionEnd å’Œ oTransitionEnd, React éƒ½ä¼šé›†åˆæˆ topAnimationEndï¼Œæ‰€ä»¥æˆ‘ä»¬åªç”¨å¤„ç†è¿™ä¸€ä¸ªæ ‡å‡†çš„äº‹ä»¶å³å¯ã€‚</p>\n</li>\n</ul>\n<img src=\"http://t-blog-images.aijs.top/img/20220720100225.webp\" />\n\n<h2 id=\"React-çš„äº‹ä»¶ç³»ç»Ÿæ˜¯æ€ä¹ˆè¿ä½œèµ·æ¥çš„ï¼Ÿ\"><a href=\"#React-çš„äº‹ä»¶ç³»ç»Ÿæ˜¯æ€ä¹ˆè¿ä½œèµ·æ¥çš„ï¼Ÿ\" class=\"headerlink\" title=\"React çš„äº‹ä»¶ç³»ç»Ÿæ˜¯æ€ä¹ˆè¿ä½œèµ·æ¥çš„ï¼Ÿ\"></a>React çš„äº‹ä»¶ç³»ç»Ÿæ˜¯æ€ä¹ˆè¿ä½œèµ·æ¥çš„ï¼Ÿ</h2><h3 id=\"äº‹ä»¶ç»‘å®š\"><a href=\"#äº‹ä»¶ç»‘å®š\" class=\"headerlink\" title=\"äº‹ä»¶ç»‘å®š\"></a>äº‹ä»¶ç»‘å®š</h3><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬åœ¨ JSX ä¸­å†™çš„ onClickhandler æ˜¯æ€ä¹ˆè¢«è®°å½•åˆ° DOM ç»“ç‚¹ä¸Šï¼Œå¹¶ä¸”åœ¨ document ä¸Šåšç›‘å¬çš„ã€‚</p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720100423.webp\" />\n\n<p>React å¯¹äºå¤§éƒ¨åˆ†äº‹ä»¶çš„ç»‘å®šéƒ½æ˜¯ä½¿ç”¨<code>trapBubbledEvent</code>å’Œ<code>trapCapturedEvent</code>è¿™ä¸¤ä¸ªå‡½æ•°æ¥æ³¨å†Œçš„ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬æ‰§è¡Œäº† render æˆ–è€… setState ä¹‹åï¼ŒReact çš„ <code>Fiber</code> è°ƒåº¦ç³»ç»Ÿï¼Œ<span style=\"text-decoration: underline\">ä¼šåœ¨æœ€å commit åˆ° DOM æ ‘ä¹‹å‰, æ‰§è¡Œ<code>trapBubbledEvent</code>æˆ–<code>trapCapturedEvent</code>ï¼Œåœ¨<code>document</code>èŠ‚ç‚¹ä¸Šç»‘å®šå›è°ƒ</span>ï¼ˆé€šè¿‡æ‰§è¡Œ<code>addEventListener</code>åœ¨ document ç»“ç‚¹ä¸Šç»‘å®šå¯¹åº”çš„<code>dispatch</code>å‡½æ•°,ä½œä¸ºå›è°ƒè´Ÿè´£ç›‘å¬ç±»å‹ä¸º<code>topLevelType</code>çš„äº‹ä»¶ï¼‰ã€‚</p>\n<p>è¿™é‡Œé¢çš„ <code>dispatchInteractiveEvent</code> å’Œ <code>dispatchEvent</code> ä¸¤ä¸ªå›è°ƒå‡½æ•°çš„åŒºåˆ«ä¸ºï¼ŒReact16 å¼€å§‹æ¢æ‰äº†åŸæœ¬ <code>Stack Reconciliation</code> æˆ <code>Fiber</code> å¸Œæœ›å®ç°å¼‚æ­¥æ¸²æŸ“ï¼ˆReact16 ä»æœªé»˜è®¤æ‰“å¼€ï¼Œä»éœ€ä½¿ç”¨ <code>unstable_</code>å¼€å¤´çš„ apiï¼Œæ­¤ç‰¹æ€§ä¸ä¾‹å­ 2 æœ‰å…³ï¼Œå°†åœ¨æ–‡ç« æœ€åé…å›¾è§£é‡Šï¼‰ï¼Œæ‰€ä»¥å¼‚æ­¥æ¸²æŸ“çš„æƒ…å†µä¸‹å‡å¦‚æˆ‘ç‚¹äº†ä¸¤æ¬¡æŒ‰é’®ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡æŒ‰é’®å“åº”çš„æ—¶å€™ï¼Œå¯èƒ½ç¬¬ä¸€æ¬¡æŒ‰é’®çš„ handlerA ä¸­è°ƒç”¨çš„ <code>setState</code> è¿˜æœªæœ€ç»ˆè¢« commit åˆ° DOM æ ‘ä¸Šï¼Œè¿™æ—¶éœ€è¦æŠŠç¬¬ä¸€æ¬¡æŒ‰é’®çš„ç»“æœå…ˆç»™ flush æ‰å¹¶ commit åˆ° DOM æ ‘ï¼Œæ‰èƒ½å¤Ÿä¿æŒä¸€è‡´æ€§ã€‚è¿™ä¸ªæ—¶å€™å°±ä¼šç”¨åˆ° <code>dispatchInteractiveEvent</code>ã€‚å¯ä»¥ç†è§£æˆ <code>dispatchInteractiveEvent</code> åœ¨æ‰§è¡Œå‰éƒ½ä¼šç¡®ä¿ä¹‹å‰æ‰€æœ‰æ“ä½œéƒ½å·²æœ€æ€» commit åˆ° DOM æ ‘ï¼Œå†å¼€å§‹è‡ªå·±çš„æµç¨‹ï¼Œå¹¶æœ€ç»ˆè§¦å‘ dispatchEventã€‚ä½†ç”±äº React16 ä»æ˜¯åŒæ­¥æ¸²æŸ“çš„ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªå‡½æ•°åœ¨ç›®å‰çš„è¡¨ç°æ˜¯ä¸€è‡´çš„ï¼ŒReact17 é»˜è®¤æ‰“å¼€çš„å¼‚æ­¥æ¸²æŸ“åŠŸèƒ½ã€‚</p>\n<p>åˆ°ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨ document ç»“ç‚¹ä¸Šç›‘å¬äº†äº‹ä»¶äº†ï¼Œç°åœ¨éœ€è¦æ¥çœ‹å¦‚ä½•å°†æˆ‘ä»¬åœ¨ jsx ä¸­å†™çš„ handler å­˜èµ·æ¥å¯¹åº”åˆ°ç›¸åº”çš„ç»“ç‚¹ä¸Šã€‚</p>\n<p>åœ¨æˆ‘ä»¬æ¯æ¬¡æ–°å»ºæˆ–è€…æ›´æ–°ç»“ç‚¹æ—¶ï¼ŒReact ä¼šè°ƒç”¨ <code>createInstance</code> æˆ–è€… <code>commitUpdate</code> è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œè€Œè¿™ä¸¤ä¸ªå‡½æ•°éƒ½ä¼šæœ€ç»ˆè°ƒç”¨ <code>updateFiberProps</code> è¿™ä¸ªå‡½æ•°ï¼Œå°† props ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ onClickï¼ŒonChange ç­‰ handler ç»™å­˜åˆ° DOM ç»“ç‚¹ä¸Šã€‚</p>\n<p>è‡³æ­¤ï¼Œæˆ‘ä»¬æˆ‘ä»¬å·²ç»åœ¨ document ä¸Šç›‘å¬äº†äº‹ä»¶ï¼Œå¹¶ä¸”å°† handler å­˜åœ¨å¯¹åº” DOM ç»“ç‚¹ã€‚æ¥ä¸‹æ¥éœ€è¦çœ‹ React æ€ä¹ˆç›‘å¬å¹¶å¤„ç†æµè§ˆå™¨çš„åŸç”Ÿäº‹ä»¶ï¼Œæœ€ç»ˆè§¦å‘å¯¹åº”çš„ handler äº†ã€‚</p>\n<h3 id=\"äº‹ä»¶è§¦å‘\"><a href=\"#äº‹ä»¶è§¦å‘\" class=\"headerlink\" title=\"äº‹ä»¶è§¦å‘\"></a>äº‹ä»¶è§¦å‘</h3><p>åŠ¨ç”»è§åŸæ–‡ <a href=\"https://www.lzane.com/tech/react-event-system-and-source-code/#%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91\" target=\"_blank\" >Hype åŠ¨ç”»</a></p>\n<p>åŠ¨ç”»åº”è¯¥æ˜¯ä½¿ç”¨ <a href=\"https://www.hypeapp.cn/\" target=\"_blank\" >Hype å·¥å…·</a> åˆ¶ä½œçš„</p>\n<p>ä»¥ç®€å•çš„ <code>click</code> äº‹ä»¶ä¸ºä¾‹ï¼Œé€šè¿‡äº‹ä»¶ç»‘å®šæˆ‘ä»¬å·²ç»åœ¨ <code>document</code> ä¸Šç›‘å¬äº† <code>click</code> äº‹ä»¶ï¼Œå½“æˆ‘ä»¬çœŸæ­£ç‚¹å‡»äº†è¿™ä¸ªæŒ‰é’®çš„æ—¶å€™ï¼ŒåŸç”Ÿçš„äº‹ä»¶æ˜¯å¦‚ä½•è¿›å…¥ React çš„ç®¡è¾–èŒƒå›´çš„ï¼Ÿå¦‚ä½•åˆæˆ <code>SyntheticEvent</code> ä»¥åŠå¦‚ä½•æ¨¡æ‹Ÿæ•è·å’Œå†’æ³¡çš„ï¼Ÿä»¥åŠæœ€åæˆ‘ä»¬åœ¨ jsx ä¸­å†™çš„ <code>onClickhandler</code> æ˜¯å¦‚ä½•è¢«æœ€ç»ˆè§¦å‘çš„ï¼Ÿå¸¦ç€è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹äº‹ä»¶è§¦å‘é˜¶æ®µã€‚</p>\n<p>å¤§æ¦‚ç”¨ä¸‹å›¾è¿™ç§æ–¹å¼æ¥è§£æä»£ç ï¼Œå·¦è¾¹æ˜¯æˆ‘ç‚¹å‡»ä¸€ä¸ªç»‘å®šäº† <code>handleClick</code> çš„æŒ‰é’®åçš„ js è°ƒç”¨æ ˆï¼Œå³è¾¹æ˜¯æ¯ä¸€æ­¥çš„ä»£ç ï¼Œå‡å·²åˆ é™¤éƒ¨åˆ†ä¸å½±å“ç†è§£çš„ä»£ç ã€‚å¸Œæœ›é€šè¿‡è¿™ç§æ–¹å¼èƒ½ä½¿å¤§å®¶æ›´æ˜“ç†è§£ React çš„äº‹ä»¶è§¦å‘æœºåˆ¶ã€‚</p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720101536.webp\" />\n\n<p>å½“æˆ‘ä»¬ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®æ˜¯ï¼Œclick äº‹ä»¶å°†ä¼šæœ€ç»ˆå†’æ³¡è‡³ documentï¼Œå¹¶è§¦å‘æˆ‘ä»¬ç›‘å¬åœ¨ document ä¸Šçš„ <code>handler dispatchEvent</code>ï¼Œæ¥ç€è§¦å‘ <code>batchedUpdates</code>ã€‚<code>batchedUpdates</code> è¿™ä¸ªæ ¼å¼çš„ä»£ç åœ¨ React çš„æºç é‡Œé¢ä¼šé¢‘ç¹çš„å‡ºç°ï¼ŒåŸºæœ¬ä¸Š React å°†æ‰€æœ‰èƒ½å¤Ÿæ‰¹é‡å¤„ç†çš„äº‹æƒ…éƒ½ä¼šå…ˆæ”¶é›†èµ·æ¥ï¼Œå†ä¸€æ¬¡æ€§å¤„ç†ã€‚</p>\n<p>å¯ä»¥çœ‹åˆ°é»˜è®¤çš„ <code>isBatching</code> æ˜¯ false çš„ï¼Œå½“è°ƒç”¨äº†ä¸€æ¬¡ <code>batchedUpdates</code>ï¼Œ<code>isBatching</code> çš„å€¼å°†ä¼šå˜æˆ trueï¼Œæ­¤æ—¶å¦‚æœåœ¨æ¥ä¸‹æ¥çš„è°ƒç”¨ä¸­æœ‰æ‰§è¡Œ <code>batchedUpdates</code> çš„è¯ï¼Œå°±ä¼šç›´æ¥æ‰§è¡Œ <code>handleTopLevel</code>,æ­¤æ—¶çš„ <code>setState</code> ç­‰ä¸ä¼šè¢«æ›´æ–°åˆ° DOM ä¸Šã€‚ç›´åˆ°è°ƒç”¨æ ˆé‡æ–°å›åˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>batchedUpdates</code> çš„æ—¶å€™ï¼Œæ‰ä¼šå°†æ‰€æœ‰ç»“æœä¸€èµ· <code>flush</code> æ‰ï¼ˆæ›´æ–°åˆ° DOM ä¸Šï¼‰ã€‚</p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720101657.webp\" />\n\n<p><strong>è°ƒç”¨æ ˆä¸­çš„ BatchedUpdates$1 æ˜¯ä»€ä¹ˆï¼Ÿæˆ–è€…æµè§ˆå™¨çš„ renderer å’Œ Native çš„ renderer æ˜¯å¦‚æœæŒ‚åœ¨åˆ° React çš„äº‹ä»¶ç³»ç»Ÿä¸Šçš„?</strong></p>\n<p>å…¶å® React äº‹ä»¶ç³»ç»Ÿé‡Œé¢æä¾›äº†ä¸€ä¸ªå‡½æ•° <code>setBatchingImplementation</code>ï¼Œç”¨æ¥åŠ¨æ€æŒ‚è½½ä¸åŒå¹³å°çš„ rendererï¼Œè¿™ä¸ªä¹Ÿä½“ç°äº† React äº‹ä»¶ç³»ç»Ÿçš„å¤ç”¨ã€‚ï¼ˆå¦‚å›¾å³è¾¹æ‰€ç¤ºï¼Œåœ¨ <code>DOM Renderer</code> é‡Œé¢å’Œ <code>Native Renderer</code> é‡Œé¢åˆ†åˆ«è°ƒç”¨è¿™ä¸ªå‡½æ•°åŠ¨æ€æ³¨å…¥ç›¸åº”çš„å®ç°ï¼‰</p>\n<p>è¿™é‡Œçš„ <code>interactiveUpdates äº¤äº’å¼æ›´æ–°æ˜¯ç”¨æˆ·äº¤äº’çš„ç»“æœ</code> å’Œ <code>batchedUpdates</code> çš„åŒºåˆ«åœ¨ä¸Šæ–‡å·²ç»è§£é‡Šè¿‡ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚</p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720102322.webp\" />\n\n<p><code>handleTopLevel</code> ä¼šè°ƒç”¨ <code>runExtractedEventsInBatch()</code>ï¼Œè¿™æ˜¯ React äº‹ä»¶å¤„ç†æœ€é‡è¦çš„å‡½æ•°ã€‚å¦‚ä¸Šé¢åŠ¨ç”»æˆ‘ä»¬çœ‹åˆ°çš„ï¼Œåœ¨ EventEmitter é‡Œé¢åšçš„äº‹ï¼Œå…¶å®ä¸»è¦å°±æ˜¯è¿™ä¸ªå‡½æ•°çš„ä¸¤æ­¥ã€‚</p>\n<ul>\n<li>ç¬¬ä¸€æ­¥æ˜¯æ ¹æ®åŸç”Ÿäº‹ä»¶åˆæˆä¸ºåˆæˆäº‹ä»¶ï¼Œå¹¶ä¸”åœ¨ vDOM ä¸Šæ¨¡æ‹Ÿæ•è·å†’æ³¡ï¼Œæ”¶é›†æ‰€æœ‰éœ€è¦æ‰§è¡Œçš„äº‹ä»¶å›è°ƒæ„æˆå›è°ƒæ•°ç»„ã€‚</li>\n<li>ç¬¬äºŒæ­¥æ˜¯éå†å›è°ƒæ•°ç»„ï¼Œè§¦å‘å›è°ƒå‡½æ•°ã€‚</li>\n</ul>\n<img src=\"http://t-blog-images.aijs.top/img/20220720102726.webp\" />\n\n<p>é¦–å…ˆè°ƒç”¨ <code>extractEvents</code>ï¼Œä¼ å…¥åŸç”Ÿäº‹ä»¶ eï¼ŒReact äº‹ä»¶ç³»ç»Ÿæ ¹æ®å¯èƒ½çš„äº‹ä»¶æ’ä»¶åˆæˆåˆæˆäº‹ä»¶ <code>Synthetic e</code>ã€‚ è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è°ƒç”¨äº† <code>EventConstructor.getPooled()</code>ï¼Œä»äº‹ä»¶æ± ä¸­å»å–ä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡ï¼Œå¦‚æœäº‹ä»¶æ± ä¸ºç©ºï¼Œåˆ™æ–°åˆ›å»ºä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡ï¼Œè¿™ä½“ç°äº† React ä¸ºäº†æ€§èƒ½å®ç°äº†æ± çš„æ€æƒ³ã€‚</p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720102846.webp\" />\n\n<p>ç„¶åä¼ å…¥ <code>Propagator</code>ï¼Œåœ¨ vDOM ä¸Šæ¨¡æ‹Ÿæ•è·å’Œå†’æ³¡ï¼Œå¹¶æ”¶é›†æ‰€æœ‰éœ€è¦æ‰§è¡Œçš„äº‹ä»¶å›è°ƒå’Œå¯¹åº”çš„ç»“ç‚¹ã€‚<code>traverseTwoPhase</code> æ¨¡æ‹Ÿäº†æ•è·å’Œå†’æ³¡çš„ä¸¤ä¸ªé˜¶æ®µï¼Œè¿™é‡Œå®ç°å¾ˆå·§å¦™ï¼Œç®€å•è€Œè¨€å°±æ˜¯<code>æ­£å‘å’Œåå‘éå†äº†ä¸€ä¸‹æ•°ç»„</code>ã€‚æ¥ç€å¯¹æ¯ä¸€ä¸ªç»“ç‚¹ï¼Œè°ƒç”¨ listenerAtPhase å–å‡ºäº‹ä»¶ç»‘å®šæ—¶æŒ‚è½½åœ¨ç»“ç‚¹ä¸Šçš„å›è°ƒå‡½æ•°ï¼ŒæŠŠå®ƒåŠ å…¥å›è°ƒæ•°ç»„ä¸­ã€‚</p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720103038.webp\" />\n\n<p>æ¥ç€<code>executeDispatchesAndRelease</code>éå†æ‰€æœ‰åˆæˆäº‹ä»¶ã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°å½“ä¸€ä¸ªäº‹ä»¶å¤„ç†å®Œçš„æ—¶å€™ï¼ŒReact ä¼šè°ƒç”¨ <code>event.isPersistent()</code>æ¥æŸ¥çœ‹è¿™ä¸ªåˆæˆäº‹ä»¶æ˜¯å¦éœ€è¦è¢«æŒä¹…åŒ–ï¼Œå¦‚æœä¸éœ€è¦å°±ä¼šé‡Šæ”¾è¿™ä¸ªåˆæˆäº‹ä»¶ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå½“æˆ‘ä»¬éœ€è¦å¼‚æ­¥è¯»å–æ“ä½œä¸€ä¸ªåˆæˆäº‹ä»¶çš„æ—¶å€™ï¼Œéœ€è¦æ‰§è¡Œ <code>event.persist()</code>ï¼Œä¸ç„¶ React å°±æ˜¯åœ¨è¿™é‡Œé‡Šæ”¾æ‰è¿™ä¸ªäº‹ä»¶ã€‚</p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720103344.webp\" />\n\n<p>æœ€å<code>executeDispatchesInOrder</code>è¿™é‡Œå°±æ˜¯å›è°ƒå‡½æ•°è¢«çœŸæ­£è§¦å‘çš„æ—¶å€™äº†ï¼Œå–å‡ºå›è°ƒæ•°ç»„ <code>event._dispatchListeners</code>ï¼Œéå†è§¦å‘å›è°ƒå‡½æ•°ã€‚å¹¶é€šè¿‡ <code>event.isPropagationStopped()</code>è¿™ä¸€æ­¥æ¥æ¨¡æ‹Ÿåœæ­¢å†’æ³¡ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒReact åœ¨æ”¶é›†å›è°ƒæ•°ç»„çš„æ—¶å€™å¹¶ä¸ä¼šå»ç®¡æˆ‘ä»¬æ˜¯å¦è°ƒç”¨äº† <code>stopPropagation</code>ï¼Œè€Œæ˜¯ä¼šåœ¨è§¦å‘çš„é˜¶æ®µæ‰ä¼šå»æ£€æŸ¥æ˜¯å¦éœ€è¦åœæ­¢å†’æ³¡ã€‚</p>\n<p>è‡³æ­¤ï¼Œä¸€ä¸ªäº‹ä»¶å›è°ƒå‡½æ•°å°±è¢«è§¦å‘äº†ï¼Œé‡Œé¢å¦‚æœæ‰§è¡Œäº† setState ç­‰å°±ä¼šç­‰åˆ°è°ƒç”¨æ ˆå¼¹å›åˆ°æœ€ä½éƒ¨çš„ interactiveUpdate ä¸­çš„è¢«æœ€ç»ˆ flush æ‰ï¼Œæ„é€  vDOMï¼Œå’Œå¥½ï¼Œå¹¶æœ€ç»ˆè¢« commit åˆ° DOM ä¸Šã€‚</p>\n<p>è¿™å°±æ˜¯äº‹ä»¶è§¦å‘çš„æ•´ä¸ªè¿‡ç¨‹äº†ï¼Œå¯ä»¥å›å»å†çœ‹ä¸€ä¸‹ <a href=\"https://www.lzane.com/tech/react-event-system-and-source-code/#%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91\" target=\"_blank\" >åŠ¨ç”»</a>ï¼Œç›¸ä¿¡ä½ ä¼šæ›´åŠ ç†è§£è¿™ä¸ªè¿‡ç¨‹çš„ã€‚</p>\n<h2 id=\"åˆæˆäº‹ä»¶ä¸åŸç”Ÿäº‹ä»¶æœ‰æ€æ ·çš„æ‰§è¡Œé¡ºåºï¼Ÿ\"><a href=\"#åˆæˆäº‹ä»¶ä¸åŸç”Ÿäº‹ä»¶æœ‰æ€æ ·çš„æ‰§è¡Œé¡ºåºï¼Ÿ\" class=\"headerlink\" title=\"åˆæˆäº‹ä»¶ä¸åŸç”Ÿäº‹ä»¶æœ‰æ€æ ·çš„æ‰§è¡Œé¡ºåºï¼Ÿ\"></a>åˆæˆäº‹ä»¶ä¸åŸç”Ÿäº‹ä»¶æœ‰æ€æ ·çš„æ‰§è¡Œé¡ºåºï¼Ÿ</h2><p><strong>åŸç”Ÿäº‹ä»¶</strong></p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720105851.webp\" style=\"max-width: 100%; width: 600px\" />\n\n<p><strong>åŸç”Ÿ+åˆæˆäº‹ä»¶</strong></p>\n<ul>\n<li><p>åœ¨ V17 ç‰ˆæœ¬å‰ï¼Œ<code>åŸç”Ÿäº‹ä»¶çš„æ‰§è¡Œæ—¶æœºæ˜¯æ’æ—©äºåˆæˆäº‹ä»¶çš„æ‰§è¡Œæ—¶æœºçš„</code>ã€‚</p>\n</li>\n<li><p>V17 ç‰ˆæœ¬åï¼Œ<code>åˆæˆäº‹ä»¶å’ŒåŸç”Ÿäº‹ä»¶çš„æ‰§è¡Œé¡ºåºä¸å†’æ³¡/æ•è·æ¨¡å¼ç›¸å…³</code>ï¼Œ</p>\n<ul>\n<li><code>æ•è·æ¨¡å¼ï¼Œåˆæˆäº‹ä»¶æ—©äºåŸç”Ÿäº‹ä»¶</code>ï¼Œ</li>\n<li><code>å†’æ³¡æ¨¡å¼ï¼ŒåŸç”Ÿäº‹ä»¶æ—©äºåˆæˆäº‹ä»¶</code>ã€‚</li>\n</ul>\n</li>\n</ul>\n<img src=\"http://t-blog-images.aijs.top/img/20220720105608.webp\" style=\"max-width: 100%; width: 600px\"/>\n<a href=\"https://www.jianshu.com/p/a68219093f88?u_atoken=96c66af6-4b4a-4701-a859-9a64483aaf89&u_asession=01viVXNjWZraXNpt12w6P6wnowBQUY7pona1ulf4v0L73wrchou90FiDGe5jR2qHfDX0KNBwm7Lovlpxjd_P_q4JsKWYrT3W_NKPr8w6oU7K8qavJ7EhmnVdJXQEmE6OtSPpcarp92QKzyJKyYjREPlmBkFo3NEHBv0PZUm6pbxQU&u_asig=05CjAbRIhQ-YGOcSOjfs7WtQu4QiGw5txoYvhryOA5fFYlLiTzNiJXY_hpLV7WJGud4m5iROx4wQ0h3ZgRAXTxp-H_GUJK2jgttmFqvD-hHIPJWVv2NwOqKBXAP-u08vsfCUr3lwfKUBWx5D2_14AeRY0il1Ll8VBsxPq6mesMKSv9JS7q8ZD7Xtz2Ly-b0kmuyAKRFSVJkkdwVUnyHAIJzbzCM-4012j1JNGnXBVIbaIllXASt-Dgl7eSMGAtA78aWPRPQyB_SKrj-61LB_f61u3h9VXwMyh6PgyDIVSG1W8MY0PcDXuTpF4MGYSjFBSfODK7bhW2M-c7MIitG1svzaDy9TZTqvO1bRJoi-cZx4Wss1heq_Xsfq5Pn8i8a2-MmWspDxyAEEo4kbsryBKb9Q&u_aref=0RPjny1vlRI4nr3ZC63TqSOZUa0%3D#:~:text=%E5%9B%9B%E3%80%81-,React%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E4%B8%8E%E5%8E%9F%E7%94%9F%E4%BA%8B%E4%BB%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F,-%E5%9C%A8%20React%20%E4%B8%AD\" target=\"_blank\" >React åˆæˆäº‹ä»¶ä¸åŸç”Ÿäº‹ä»¶æ‰§è¡Œé¡ºåº</a>\n\n<p><a href=\"https://juejin.cn/post/7005129812981317668#:~:text=%E9%87%8C%E9%9D%A2%E7%9A%84%E6%96%B9%E6%B3%95%E3%80%82-,%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E5%92%8C%E5%8E%9F%E7%94%9F%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F,-%E8%BF%99%E9%87%8C%E6%9C%89%E4%B8%AA\" target=\"_blank\" >åˆæˆäº‹ä»¶å’ŒåŸç”Ÿäº‹ä»¶çš„æ‰§è¡Œé¡ºåº</a></p>\n<h2 id=\"ä¾‹å­-1\"><a href=\"#ä¾‹å­-1\" class=\"headerlink\" title=\"ä¾‹å­ 1\"></a>ä¾‹å­ 1</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">class App extends React.Component &#123;\n  innerClick &#x3D; (e) &#x3D;&gt; &#123;\n    console.log(&quot;A: react inner click.&quot;);\n    &#x2F;&#x2F; e.stopPropagation();\n  &#125;;\n\n  outerClick &#x3D; () &#x3D;&gt; &#123;\n    console.log(&quot;B: react outer click.&quot;);\n  &#125;;\n\n  componentDidMount() &#123;\n    document\n      .getElementById(&quot;outer&quot;)\n      .addEventListener(&quot;click&quot;, () &#x3D;&gt; console.log(&quot;C: native outer click&quot;));\n\n    window.addEventListener(&quot;click&quot;, () &#x3D;&gt;\n      console.log(&quot;D: native window click&quot;)\n    );\n  &#125;\n\n  render() &#123;\n    return (\n      &lt;div id&#x3D;&quot;outer&quot; onClick&#x3D;&#123;this.outerClick&#125;&gt;\n        &lt;button id&#x3D;&quot;inner&quot; onClick&#x3D;&#123;this.innerClick&#125;&gt;\n          BUTTON\n        &lt;&#x2F;button&gt;\n      &lt;&#x2F;div&gt;\n    );\n  &#125;\n&#125;</code></pre>\n\n<p>ç›¸ä¿¡çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œå¦‚æœä½ å·²ç»å¯¹ React äº‹ä»¶ç³»ç»Ÿæœ‰æ‰€ç†è§£ï¼Œè¿™é“é¢˜åº”è¯¥æ˜¯ä¸éš¾äº†ã€‚</p>\n<ul>\n<li><p>å› ä¸º React äº‹ä»¶ç›‘å¬æ˜¯æŒ‚è½½åœ¨ document ä¸Šçš„ï¼Œæ‰€ä»¥åŸç”Ÿç³»ç»Ÿåœ¨#outer ä¸Šç›‘å¬çš„å›è°ƒ C ä¼šæœ€å…ˆè¢«è¾“å‡ºï¼›æ¥ç€åŸç”Ÿäº‹ä»¶å†’æ³¡è‡³ <code>document</code> è¿›å…¥ React äº‹ä»¶ç³»ç»Ÿï¼ŒReact äº‹ä»¶ç³»ç»Ÿæ¨¡æ‹Ÿæ•è·å†’æ³¡è¾“å‡º A å’Œ Bï¼›æœ€å React äº‹ä»¶ç³»ç»Ÿæ‰§è¡Œå®Œæ¯•å›åˆ°æµè§ˆå™¨ç»§ç»­å†’æ³¡åˆ° windowï¼Œè¾“å‡º Dã€‚</p>\n</li>\n<li><p>æµè§ˆå™¨åœ¨#outer ä¸Šç›‘å¬åŸç”Ÿäº‹ä»¶çš„å›è°ƒ C ä¼šæœ€å…ˆè¢«æ‰§è¡Œï¼›æ¥ç€åŸç”Ÿäº‹ä»¶å†’æ³¡è‡³ document è¿›å…¥ React äº‹ä»¶ç³»ç»Ÿï¼Œè¾“å‡º Aï¼Œåœ¨ React äº‹ä»¶å¤„ç†ä¸­#inner è°ƒç”¨äº† stopPropagationï¼Œäº‹ä»¶è¢«åœæ­¢å†’æ³¡ã€‚</p>\n</li>\n</ul>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; 1. ä¸é˜»æ­¢åˆæˆäº‹ä»¶å†’æ³¡\n&#x2F;&#x2F;     C: native outer click\n&#x2F;&#x2F;     A: react inner click.\n&#x2F;&#x2F;     B: react outer click.\n&#x2F;&#x2F;     D: native window click\n&#x2F;&#x2F; 2. é˜»æ­¢åˆæˆäº‹ä»¶å†’æ³¡\n&#x2F;&#x2F;     C: native outer click\n&#x2F;&#x2F;     A: react inner click.</code></pre>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>æ‰€ä»¥ï¼Œæœ€å¥½ä¸è¦æ··ç”¨ React äº‹ä»¶ç³»ç»Ÿå’ŒåŸç”Ÿäº‹ä»¶ç³»ç»Ÿï¼Œå¦‚æœæ··ç”¨äº†ï¼Œè¯·ä¿è¯ä½ æ¸…æ¥šçŸ¥é“ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>\n</div>\n<h2 id=\"ä¾‹å­-2\"><a href=\"#ä¾‹å­-2\" class=\"headerlink\" title=\"ä¾‹å­ 2\"></a>ä¾‹å­ 2</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import React from &quot;react&quot;;\nimport ReactDOM from &quot;react-dom&quot;;\n\nclass App extends React.Component &#123;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123;\n      editable: false,\n    &#125;;\n  &#125;\n  handleClick &#x3D; () &#x3D;&gt; &#123;\n    console.log(&quot;edit button click!!&quot;);\n    this.setState(&#123; editable: true &#125;);\n  &#125;;\n  handleSubmit &#x3D; (e) &#x3D;&gt; &#123;\n    console.log(&quot;submit event!!&quot;);\n    e.preventDefault();\n  &#125;;\n  render() &#123;\n    return (\n      &lt;form onSubmit&#x3D;&#123;this.handleSubmit&#125;&gt;\n        &#123;this.state.editable ? (\n          &lt;button type&#x3D;&quot;submit&quot;&gt;submit&lt;&#x2F;button&gt;\n        ) : (\n          &lt;button type&#x3D;&quot;button&quot; onClick&#x3D;&#123;this.handleClick&#125;&gt;\n            edit\n          &lt;&#x2F;button&gt;\n        )&#125;\n      &lt;&#x2F;form&gt;\n    );\n  &#125;\n&#125;\n\nconst rootElement &#x3D; document.getElementById(&quot;root&quot;);\nReactDOM.render(&lt;App &#x2F;&gt;, rootElement);</code></pre>\n\n<p>é¦–å…ˆæˆ‘ä»¬ç‚¹å‡» edit æŒ‰é’®æµè§ˆå™¨è§¦å‘ä¸€ä¸ª click äº‹ä»¶ï¼Œå†’æ³¡è‡³ document è¿›å…¥ React äº‹ä»¶ç³»ç»Ÿï¼ŒReact æ‰§è¡Œå›è°ƒè°ƒç”¨ setStateï¼Œæ­¤æ—¶ React äº‹ä»¶ç³»ç»Ÿå¯¹äº‹ä»¶çš„å¤„ç†æ‰§è¡Œå®Œæ¯•ã€‚ç”±äºç›®å‰ React æ˜¯åŒæ­¥æ¸²æŸ“çš„ï¼Œæ‰€ä»¥æ¥ç€ React æ‰§è¡Œ <code>performSyncWork</code> å°†è¯¥ <code>button æ”¹æˆ type=&quot;submit&quot;</code>ï¼Œç”±äº<code>åŒä¸ªä½ç½®çš„ç»“ç‚¹å¹¶ä¸” tag éƒ½ä¸º button</code>ï¼Œ<code>æ‰€ä»¥ React å¤ç”¨äº†è¿™ä¸ª button ç»“ç‚¹ 2</code>ï¼Œå¹¶æ›´æ–°åˆ° DOM ä¸Šã€‚æ­¤æ—¶æµè§ˆå™¨å¯¹ click äº‹ä»¶æ‰§è¡Œç»§ç»­ï¼Œå…¶å‘ç°è¯¥ç»“ç‚¹çš„ type&#x3D;â€submitâ€ï¼Œåˆ™è§¦å‘ submit äº‹ä»¶ã€‚</p>\n<p><strong>è§£å†³çš„åŠæ³•å°±æœ‰å¾ˆå¤šç§äº†</strong>ï¼Œç»™ button åŠ ä¸Š keyï¼›ä¸¤ä¸ªæŒ‰é’®åˆ†å¼€å†™ï¼Œä¸è¦ç”¨ä¸‰å…ƒç­‰éƒ½å¯ä»¥è§£å†³é—®é¢˜ã€‚</p>\n<h2 id=\"e-stopPropagation-å¦‚ä½•é˜»æ­¢åˆæˆäº‹ä»¶å†’æ³¡ï¼Ÿ\"><a href=\"#e-stopPropagation-å¦‚ä½•é˜»æ­¢åˆæˆäº‹ä»¶å†’æ³¡ï¼Ÿ\" class=\"headerlink\" title=\"e.stopPropagation() å¦‚ä½•é˜»æ­¢åˆæˆäº‹ä»¶å†’æ³¡ï¼Ÿ\"></a>e.stopPropagation() å¦‚ä½•é˜»æ­¢åˆæˆäº‹ä»¶å†’æ³¡ï¼Ÿ</h2><p><code>executeDispatchesInOrder</code>è¿™é‡Œå°±æ˜¯å›è°ƒå‡½æ•°è¢«çœŸæ­£è§¦å‘çš„æ—¶å€™äº†ï¼Œå–å‡ºå›è°ƒæ•°ç»„ <code>event._dispatchListeners</code>ï¼Œéå†è§¦å‘å›è°ƒå‡½æ•°ã€‚å¹¶é€šè¿‡ <code>event.isPropagationStopped()</code>è¿™ä¸€æ­¥æ¥æ¨¡æ‹Ÿåœæ­¢å†’æ³¡ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒReact åœ¨æ”¶é›†å›è°ƒæ•°ç»„çš„æ—¶å€™å¹¶ä¸ä¼šå»ç®¡æˆ‘ä»¬æ˜¯å¦è°ƒç”¨äº† <code>stopPropagation</code>ï¼Œè€Œæ˜¯ä¼šåœ¨è§¦å‘çš„é˜¶æ®µæ‰ä¼šå»æ£€æŸ¥æ˜¯å¦éœ€è¦åœæ­¢å†’æ³¡ã€‚</p>\n<h2 id=\"åŒçº§åˆ«çš„ä¸¤ä¸ªæŒ‰é’®ï¼Œä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œä¼šå‡ºé—®é¢˜ï¼Ÿ\"><a href=\"#åŒçº§åˆ«çš„ä¸¤ä¸ªæŒ‰é’®ï¼Œä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œä¼šå‡ºé—®é¢˜ï¼Ÿ\" class=\"headerlink\" title=\"åŒçº§åˆ«çš„ä¸¤ä¸ªæŒ‰é’®ï¼Œä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œä¼šå‡ºé—®é¢˜ï¼Ÿ\"></a>åŒçº§åˆ«çš„ä¸¤ä¸ªæŒ‰é’®ï¼Œä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œä¼šå‡ºé—®é¢˜ï¼Ÿ</h2><p>æ¸²æŸ“åæŒ‰é’®çš„äº‹ä»¶æ˜¯å¦ä¼šè§¦å‘</p>\n<p><strong>React16 ä¾‹å­ 2 ä¸€å®šè§¦å‘ <code>submit</code>, åŸå› ï¼šåŒæ­¥æ›´æ–°</strong></p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720104906.webp\" style=\"max-width: 100%; width: 600px\"/>\n\n<p><strong>React17+ ä¾‹å­ 2 ä¸ä¸€å®šè§¦å‘ <code>submit</code> åŸå› ï¼šå¼‚æ­¥æ›´æ–°</strong></p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720104951.webp\" style=\"max-width: 100%; width: 600px\"/>\n\n<h2 id=\"React-æç¤º-event-persist-ï¼Œä¸ºä»€ä¹ˆä¼šæç¤ºï¼Ÿ\"><a href=\"#React-æç¤º-event-persist-ï¼Œä¸ºä»€ä¹ˆä¼šæç¤ºï¼Ÿ\" class=\"headerlink\" title=\"React æç¤º event.persist() ï¼Œä¸ºä»€ä¹ˆä¼šæç¤ºï¼Ÿ\"></a>React æç¤º event.persist() ï¼Œä¸ºä»€ä¹ˆä¼šæç¤ºï¼Ÿ</h2><p>React åœ¨<code>executeDispatchesAndRelease</code>éå†æ‰€æœ‰åˆæˆäº‹ä»¶ï¼Œä¼šè°ƒç”¨ <code>event.isPersistent()</code>æ¥æŸ¥çœ‹è¿™ä¸ªåˆæˆäº‹ä»¶æ˜¯å¦éœ€è¦è¢«æŒä¹…åŒ–ï¼Œå¦‚æœä¸éœ€è¦å°±ä¼šé‡Šæ”¾è¿™ä¸ªåˆæˆäº‹ä»¶ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå½“æˆ‘ä»¬éœ€è¦å¼‚æ­¥è¯»å–æ“ä½œä¸€ä¸ªåˆæˆäº‹ä»¶çš„æ—¶å€™ï¼Œéœ€è¦æ‰§è¡Œ <code>event.persist()</code>ï¼Œä¸ç„¶ React å°±æ˜¯åœ¨è¿™é‡Œé‡Šæ”¾æ‰è¿™ä¸ªäº‹ä»¶ã€‚</p>\n<h2 id=\"setState-æœ‰æ—¶å€™æ˜¯å¼‚æ­¥çš„ï¼ŒsetState-ç›¸å¯¹äºæµè§ˆå™¨è€Œè¨€æ˜¯åŒæ­¥çš„ï¼Œå¦‚ä½•ç†è§£ï¼Ÿ\"><a href=\"#setState-æœ‰æ—¶å€™æ˜¯å¼‚æ­¥çš„ï¼ŒsetState-ç›¸å¯¹äºæµè§ˆå™¨è€Œè¨€æ˜¯åŒæ­¥çš„ï¼Œå¦‚ä½•ç†è§£ï¼Ÿ\" class=\"headerlink\" title=\"setState æœ‰æ—¶å€™æ˜¯å¼‚æ­¥çš„ï¼ŒsetState ç›¸å¯¹äºæµè§ˆå™¨è€Œè¨€æ˜¯åŒæ­¥çš„ï¼Œå¦‚ä½•ç†è§£ï¼Ÿ\"></a>setState æœ‰æ—¶å€™æ˜¯å¼‚æ­¥çš„ï¼ŒsetState ç›¸å¯¹äºæµè§ˆå™¨è€Œè¨€æ˜¯åŒæ­¥çš„ï¼Œå¦‚ä½•ç†è§£ï¼Ÿ</h2><p><code>setState</code> åœ¨ç”Ÿå‘½å‘¨æœŸä»¥åŠäº‹ä»¶å›è°ƒä¸­æ˜¯å¼‚æ­¥çš„ï¼Œä¹Ÿå°±æ˜¯ä¼šæ”¶é›†èµ·æ¥æ‰¹é‡å¤„ç†ã€‚åœ¨å…¶å®ƒæƒ…å†µä¸‹å¦‚ <code>promise</code>ï¼Œ<code>setTimeout</code> ä¸­éƒ½æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ä¸€æ¬¡ setState å°±ä¼š render ä¸€æ¬¡å¹¶æ›´æ–°åˆ° DOM ä¸Šé¢</p>\n<p>ä¸”åœ¨ JS è°ƒç”¨æ ˆè¢«å¼¹ç©ºæ—¶å€™ï¼Œå¿…å®šæ˜¯å·²ç»å°†ç»“æœæ›´æ–°åˆ° DOM ä¸Šé¢äº†ï¼ˆåŒæ­¥æ¸²æŸ“ï¼‰ã€‚è¿™ä¹Ÿå°±æ˜¯ setState ç›¸å¯¹äºæµè§ˆå™¨æ˜¯åŒæ­¥çš„å«ä¹‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º</p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720104906.webp\" style=\"max-width: 100%; width: 600px\"/>\n\n<p>å¼‚æ­¥æ¸²æŸ“çš„æµç¨‹å›¾å¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ€è¿‘ä¸€æ¬¡æ€è€ƒè¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œå‘ç°å¦‚æœç°åœ¨æ˜¯å¼‚æ­¥æ¸²æŸ“çš„è¯ï¼Œé‚£æˆ‘ä»¬çš„ä¾‹å­äºŒå°†å˜æˆå¶ç°çš„å‘ ğŸ˜‚ï¼Œå› ä¸ºå¦‚æœ setState çš„ç»“æœè¿˜æ²¡è¢«æ›´æ–°åˆ° DOM ä¸Šï¼Œæµè§ˆå™¨å°±ä¸ä¼šè§¦å‘ submit äº‹ä»¶ã€‚</p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720104951.webp\" style=\"max-width: 100%; width: 600px\"/>\n\n<h2 id=\"å¼‚æ­¥æ¸²æŸ“ä½¿ç”¨ä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸä¼šæœ‰æ€æ ·çš„ç°è±¡ï¼Ÿ\"><a href=\"#å¼‚æ­¥æ¸²æŸ“ä½¿ç”¨ä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸä¼šæœ‰æ€æ ·çš„ç°è±¡ï¼Ÿ\" class=\"headerlink\" title=\"å¼‚æ­¥æ¸²æŸ“ä½¿ç”¨ä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸä¼šæœ‰æ€æ ·çš„ç°è±¡ï¼Ÿ\"></a>å¼‚æ­¥æ¸²æŸ“ä½¿ç”¨ä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸä¼šæœ‰æ€æ ·çš„ç°è±¡ï¼Ÿ</h2><p>ä¾‹å­ 2 å˜æˆå¶ç°</p>\n<h2 id=\"ä¹‹å‰å°†äº‹ä»¶ç›‘å¬æŒ‚è½½åˆ°-document-ä¸Šï¼Œç°åœ¨ä¸ºä½•æŒ‚è½½åˆ°-root-ä¸Šï¼Ÿ\"><a href=\"#ä¹‹å‰å°†äº‹ä»¶ç›‘å¬æŒ‚è½½åˆ°-document-ä¸Šï¼Œç°åœ¨ä¸ºä½•æŒ‚è½½åˆ°-root-ä¸Šï¼Ÿ\" class=\"headerlink\" title=\"ä¹‹å‰å°†äº‹ä»¶ç›‘å¬æŒ‚è½½åˆ° document ä¸Šï¼Œç°åœ¨ä¸ºä½•æŒ‚è½½åˆ° root ä¸Šï¼Ÿ\"></a>ä¹‹å‰å°†äº‹ä»¶ç›‘å¬æŒ‚è½½åˆ° document ä¸Šï¼Œç°åœ¨ä¸ºä½•æŒ‚è½½åˆ° root ä¸Šï¼Ÿ</h2><p>å½“åŒä¸ªé¡¹ç›®é‡Œï¼Œ<code>æœ‰å¤šä¸ª React æ ¹èŠ‚ç‚¹æ—¶</code>ï¼ˆä¹Ÿå¯èƒ½æ˜¯ React å¤šç‰ˆæœ¬å…±å­˜ï¼‰ï¼Œé¿å…å¯èƒ½çš„ä¸€äº›æ“ä½œï¼ˆå¦‚é˜»æ­¢å†’æ³¡ï¼‰ä¼šå½±å“åˆ°å…¶ä»– React èŠ‚ç‚¹çš„æ­£å¸¸å·¥ä½œã€‚</p>\n<img src=\"http://t-blog-images.aijs.top/img/20220720110733.webp\" style=\"max-width: 700px\"  />\n\n<p><a href=\"https://github.com/facebook/react/releases/tag/v17.0.0\" target=\"_blank\" >Delegate events to roots instead of document</a></p>\n<p><a href=\"https://www.bigbinary.com/blog/react-17-delegates-events-to-root-instead-of-document\" target=\"_blank\" >React 17 delegates events to root instead of document</a></p>\n<p>ä¸ºäº†æ¼”ç¤ºå…¶ä¸­ä¸€ä¸ªé—®é¢˜ï¼Œè®©æˆ‘ä»¬ä»¥ select ä¸‹æ‹‰åˆ—è¡¨ä¸ºä¾‹ã€‚</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">&lt;!--Div&#39;s change event contains stopPropagation()--&gt;\n&lt;div id&#x3D;&quot;main&quot;&gt;\n  &lt;!--Div where react component will be rendered --&gt;\n  &lt;div id&#x3D;&quot;react-root&quot;&gt;&lt;&#x2F;div&gt;\n&lt;&#x2F;div&gt;</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">\nclass CountryDropDown extends React.Component &#123;\n  state &#x3D; &#123;\n    country: &#39;&#39;,\n  &#125;\n  const handleChange &#x3D; e &#x3D;&gt; &#123;\n    this.setState(&#123; country: e.target.value &#125;);\n  &#125;\n  render() &#123;\n    return (\n      &lt;table class&#x3D;&quot;table table-striped table-condensed&quot;&gt;\n        &lt;thead&gt;\n          &lt;tr&gt;\n            &lt;th&gt;Country&lt;&#x2F;th&gt;\n            &lt;th&gt;Selected country&lt;&#x2F;th&gt;\n          &lt;&#x2F;tr&gt;\n        &lt;&#x2F;thead&gt;\n        &lt;tbody&gt;\n          &lt;tr&gt;\n            &lt;td&gt;\n              &lt;select value&#x3D;&#123;this.state.country&#125;\n                onChange&#x3D;&#123;this.handleChange&#125;\n              &gt;\n                &lt;option value&#x3D;&quot;&quot;&gt;--Select--&lt;&#x2F;option&gt;\n                &lt;option value&#x3D;&quot;India&quot;&gt;India&lt;&#x2F;option&gt;\n                &lt;option value&#x3D;&quot;US&quot;&gt;US&lt;&#x2F;option&gt;\n                &lt;option value&#x3D;&quot;Dubai&quot;&gt;Dubai&lt;&#x2F;option&gt;\n              &lt;&#x2F;select&gt;\n            &lt;&#x2F;td&gt;\n            &lt;td&gt;\n              &#123;this.state.country&#125;\n            &lt;&#x2F;td&gt;\n          &lt;&#x2F;tr&gt;\n        &lt;&#x2F;tbody&gt;\n      &lt;&#x2F;table&gt;\n    );\n  &#125;\n&#125;\nReactDOM.render(&lt;CountryDropDown &#x2F;&gt;, document.getElementById(&#39;react-root&#39;));\n\n</code></pre>\n\n<p>ç»™<code>main-div</code>å¢åŠ ä¸€ä¸ªé˜»æ­¢å†’æ³¡çš„äº‹ä»¶</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">document.getElementById(&quot;main&quot;).addEventListener(\n  &quot;change&quot;,\n  function (e) &#123;\n    e.stopPropagation();\n  &#125;,\n  false\n);</code></pre>\n\n<p>é™„åŠ åˆ°æ–‡æ¡£èŠ‚ç‚¹çš„ onChange ä¸‹æ‹‰äº‹ä»¶å‡ºç°æ„å¤–è¡Œä¸ºï¼ŒåŸå› æ˜¯ï¼šåŒ…å« e.stopPropagationï¼ˆï¼‰çš„ä¸» div çš„ change äº‹ä»¶é˜»æ­¢äº†ä¸‹æ‹‰çš„ onChange äº‹ä»¶ã€‚</p>\n<h2 id=\"åˆæˆäº‹ä»¶çš„å†’æ³¡æ•è·æœºåˆ¶å¦‚ä½•å®ç°ï¼Ÿ\"><a href=\"#åˆæˆäº‹ä»¶çš„å†’æ³¡æ•è·æœºåˆ¶å¦‚ä½•å®ç°ï¼Ÿ\" class=\"headerlink\" title=\"åˆæˆäº‹ä»¶çš„å†’æ³¡æ•è·æœºåˆ¶å¦‚ä½•å®ç°ï¼Ÿ\"></a>åˆæˆäº‹ä»¶çš„å†’æ³¡æ•è·æœºåˆ¶å¦‚ä½•å®ç°ï¼Ÿ</h2><p><code>traverseTwoPhase</code> æ¨¡æ‹Ÿäº†æ•è·å’Œå†’æ³¡çš„ä¸¤ä¸ªé˜¶æ®µï¼Œè¿™é‡Œå®ç°å¾ˆå·§å¦™ï¼Œç®€å•è€Œè¨€å°±æ˜¯<code>æ­£å‘å’Œåå‘éå†äº†ä¸€ä¸‹æ•°ç»„</code></p>\n<h2 id=\"åˆæˆäº‹ä»¶æºç å‡½æ•°è°ƒç”¨å…³ç³»å›¾\"><a href=\"#åˆæˆäº‹ä»¶æºç å‡½æ•°è°ƒç”¨å…³ç³»å›¾\" class=\"headerlink\" title=\"åˆæˆäº‹ä»¶æºç å‡½æ•°è°ƒç”¨å…³ç³»å›¾\"></a>åˆæˆäº‹ä»¶æºç å‡½æ•°è°ƒç”¨å…³ç³»å›¾</h2><img src=\"http://t-blog-images.aijs.top/img/SyntheticEvent-ç¬¬ 2 é¡µ.drawio.webp\" />\n\n<h2 id=\"v17-0-1\"><a href=\"#v17-0-1\" class=\"headerlink\" title=\"v17.0.1\"></a>v17.0.1</h2><p>React ä¸­äº‹ä»¶åˆ†ä¸º<code>å§”æ‰˜äº‹ä»¶ï¼ˆDelegatedEventï¼‰</code>å’Œ<code>ä¸éœ€è¦å§”æ‰˜äº‹ä»¶ï¼ˆNonDelegatedEventï¼‰</code>ï¼Œ</p>\n<ul>\n<li>å§”æ‰˜äº‹ä»¶åœ¨ fiberRoot åˆ›å»ºçš„æ—¶å€™ï¼Œ<code>å°±ä¼šåœ¨ root èŠ‚ç‚¹çš„ DOM å…ƒç´ ä¸Šç»‘å®šå‡ ä¹æ‰€æœ‰äº‹ä»¶çš„å¤„ç†å‡½æ•°</code>ï¼Œ</li>\n<li>è€Œä¸éœ€è¦å§”æ‰˜äº‹ä»¶åª<code>ä¼šå°†å¤„ç†å‡½æ•°ç»‘å®šåœ¨ DOM å…ƒç´ æœ¬èº«</code>ã€‚</li>\n</ul>\n<p>åŒæ—¶ï¼ŒReact å°†äº‹ä»¶åˆ†ä¸º 3 ç§ç±»å‹â€”â€”discreteEvent(ç¦»æ•£äº‹ä»¶ï¼Œå¯¹åº”<code>discreteEventPairsForSimpleEventPlugin</code>)ã€userBlockingEvent(ç”¨æˆ·é˜»æ­¢äº‹ä»¶ï¼Œå¯¹åº”<code>userBlockingPairsForSimpleEventPlugin</code>)ã€continuousEvent(è¿ç»­äº‹ä»¶ï¼Œå¯¹åº”<code>continuousPairsForSimpleEventPlugin</code>)ï¼Œå®ƒä»¬æ‹¥æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œåœ¨ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°æ—¶ä¼šä½¿ç”¨ä¸åŒçš„å›è°ƒå‡½æ•°ã€‚</p>\n<p>React äº‹ä»¶å»ºç«‹åœ¨åŸç”ŸåŸºç¡€ä¸Šï¼Œæ¨¡æ‹Ÿäº†ä¸€å¥—å†’æ³¡å’Œæ•è·çš„äº‹ä»¶æœºåˆ¶ï¼Œå½“æŸä¸€ä¸ª DOM å…ƒç´ è§¦å‘äº‹ä»¶åï¼Œä¼šå†’æ³¡åˆ° React ç»‘å®šåœ¨ root èŠ‚ç‚¹çš„å¤„ç†å‡½æ•°ï¼Œé€šè¿‡ target è·å–è§¦å‘äº‹ä»¶çš„ DOM å¯¹è±¡å’Œå¯¹åº”çš„ Fiber èŠ‚ç‚¹ï¼Œç”±è¯¥ Fiber èŠ‚ç‚¹å‘ä¸Šå±‚çˆ¶çº§éå†ï¼Œæ”¶é›†ä¸€æ¡äº‹ä»¶é˜Ÿåˆ—ï¼Œå†éå†è¯¥é˜Ÿåˆ—è§¦å‘é˜Ÿåˆ—ä¸­æ¯ä¸ª Fiber å¯¹è±¡å¯¹åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæ­£å‘éå†æ¨¡æ‹Ÿå†’æ³¡ï¼Œåå‘éå†æ¨¡æ‹Ÿæ•è·ï¼Œæ‰€ä»¥åˆæˆäº‹ä»¶çš„è§¦å‘æ—¶æœºæ˜¯åœ¨åŸç”Ÿäº‹ä»¶ä¹‹åçš„ã€‚</p>\n<p>Fiber å¯¹è±¡å¯¹åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ä¾æ—§æ˜¯å‚¨å­˜åœ¨ props é‡Œçš„ï¼Œæ”¶é›†åªæ˜¯ä» props é‡Œå–å‡ºæ¥ï¼Œå®ƒå¹¶æ²¡æœ‰ç»‘å®šåˆ°ä»»ä½•å…ƒç´ ä¸Šã€‚</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">createRootImpl(å§”æ‰˜äº‹ä»¶ç»‘å®š)-&gt;\nlistenToAllSupportedEvents(ç›‘å¬æ‰€æœ‰æ”¯æŒçš„äº‹ä»¶)-&gt;\nlistenToNativeEvent(å†’æ³¡,æ•è·)-&gt;\ngetEventListenerSet,getListenerSetKey,addTrappedEventListenerï¼ˆå‡½æ•°ä¼šé€šè¿‡äº‹ä»¶åå–å¾—å¯¹åº”ä¼˜å…ˆçº§çš„listenerå‡½æ•°ï¼Œå†äº¤ç”±ä¸‹å±‚å‡½æ•°å¤„ç†äº‹ä»¶ç»‘å®šï¼‰-&gt;\ncreateEventListenerWrapperWithPriority(æ ¹æ®ä¼˜å…ˆçº§å–å¾—å¯¹åº”listener)-&gt;\ndispatchDiscreteEvent,dispatchUserBlockingUpdate,dispatchEvent(è§¦å‘äº‹ä»¶)-&gt;\nattemptToDispatchEvent(è§¦å‘äº‹ä»¶)-&gt;\n.....ç•¥.....-&gt;\ndispatchEventsForPlugins(å‡½æ•°é‡Œä¼šæ”¶é›†è§¦å‘äº‹ä»¶å¼€å§‹å„å±‚çº§çš„èŠ‚ç‚¹å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å®é™…ä¼ å…¥JSXä¸­çš„å‡½æ•°ï¼Œå¹¶ä¸”æ‰§è¡Œå®ƒä»¬)-&gt;\nextractEvents(é’ˆå¯¹ä¸åŒç±»å‹çš„äº‹ä»¶åˆ›å»ºå¯¹åº”çš„åˆæˆäº‹ä»¶ï¼Œå¹¶ä¸”å°†å„å±‚çº§èŠ‚ç‚¹çš„listeneræ”¶é›†èµ·æ¥ï¼Œç”¨æ¥æ¨¡æ‹Ÿå†’æ³¡æˆ–è€…æ•è·)-&gt;\naccumulateSinglePhaseListeners(å‡½æ•°é‡Œå°±æ˜¯åœ¨å‘ä¸Šå±‚éå†æ¥æ”¶é›†ä¸€ä¸ªåˆ—è¡¨åé¢ä¼šç”¨æ¥æ¨¡æ‹Ÿå†’æ³¡)-&gt;\nprocessDispatchQueue(éå†dispatchQueue,åœ¨processDispatchQueueItemsInOrderå‡½æ•°é‡Œéå†æ‰§è¡Œ)-&gt;\nprocessDispatchQueueItemsInOrder(æ ¹æ®åˆ¤æ–­æ¥æ­£å‘ã€åå‘çš„éå†æ¥æ¨¡æ‹Ÿå†’æ³¡å’Œæ•è·)-&gt;\nexecuteDispatch(ä¼šæ‰§è¡Œlistener)-&gt;</code></pre>\n\n<h2 id=\"å‚è€ƒé“¾æ¥\"><a href=\"#å‚è€ƒé“¾æ¥\" class=\"headerlink\" title=\"å‚è€ƒé“¾æ¥\"></a>å‚è€ƒé“¾æ¥</h2><p><a href=\"https://www.lzane.com/tech/react-event-system-and-source-code/\" target=\"_blank\" >åŠ¨ç”»æµ…æ REACT äº‹ä»¶ç³»ç»Ÿå’Œæºç </a></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/56531645\" target=\"_blank\" >å°å‰ç«¯è¯»æºç  - React16.7.0(åˆæˆäº‹ä»¶)</a></p>\n<p><a href=\"https://blog.csdn.net/weixin_34352005/article/details/85995026\" target=\"_blank\" >React16 çš„ interactiveUpdates</a></p>\n<p><a src=\"https://blog.51cto.com/u_15127691/4626192\" >React 17 All In One </a></p>\n<p><a href=\"https://segmentfault.com/a/1190000039108951\" target=\"_blank\" >æ·±å…¥ React åˆæˆäº‹ä»¶æœºåˆ¶åŸç†</a></p>\n<p><a href=\"https://juejin.cn/post/7005129812981317668\" target=\"_blank\" >React åˆæˆäº‹ä»¶è¯¦è§£</a></p>\n<p><a href=\"https://www.bigbinary.com/blog/react-17-delegates-events-to-root-instead-of-document\" target=\"_blank\" >React 17 delegates events to root instead of document</a></p>\n<p><a href=\"http://www.zzvips.com/article/227118.html\" target=\"_blank\" >React äº‹ä»¶æœºåˆ¶æºç è§£æ 17.0.1</a></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/166625150\" target=\"_blank\" >React äº‹ä»¶ | 4. React äº‹ä»¶ç›‘å¬</a></p>\n<p><a href=\"https://juejin.cn/post/6863266370411298823#heading-0\" target=\"_blank\" >Reactæºç è§£æ-äº‹ä»¶ç³»ç»Ÿ</a></p>\n","text":"æœ¬æ–‡è¯´æ˜æœ¬æ–‡ä¸»è¦å†…å®¹æ˜¯ React v16.5.0, éƒ¨åˆ†å†…å®¹ä¼šæ¶‰åŠåˆ° React v17+, React v17+åˆæˆäº‹ä»¶ä¸ React16 æœ‰å¾ˆå¤§å·®å¼‚ React å’Œäº‹ä»¶ç³»ç»Ÿæ¦‚è¿°è§ &#x2F;** * * +------------+ . * | DOM | . * +--...","link":"","photos":[],"count_time":{"symbolsCount":"14k","symbolsTime":"13 mins."},"categories":[{"name":"react_1650","slug":"react-1650","count":5,"path":"api/categories/react-1650.json"}],"tags":[{"name":"react_1650","slug":"react-1650","count":5,"path":"api/tags/react-1650.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9C%AC%E6%96%87%E8%AF%B4%E6%98%8E\"><span class=\"toc-text\">æœ¬æ–‡è¯´æ˜</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#React-%E5%92%8C%E4%BA%8B%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0\"><span class=\"toc-text\">React å’Œäº‹ä»¶ç³»ç»Ÿæ¦‚è¿°</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%BA%E4%BB%80%E4%B9%88-React-%E9%9C%80%E8%A6%81%E8%87%AA%E5%B7%B1%E5%AE%9E%E7%8E%B0%E4%B8%80%E5%A5%97%E4%BA%8B%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%9F\"><span class=\"toc-text\">ä¸ºä»€ä¹ˆ React éœ€è¦è‡ªå·±å®ç°ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Ÿ</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%A6%96%E5%85%88%E5%AF%B9%E4%BA%8E%E6%80%A7%E8%83%BD%E6%9D%A5%E8%AF%B4\"><span class=\"toc-text\">é¦–å…ˆå¯¹äºæ€§èƒ½æ¥è¯´</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%80%8C%E5%AF%B9%E4%BA%8E%E5%A4%8D%E7%94%A8%E6%9D%A5%E8%AF%B4\"><span class=\"toc-text\">è€Œå¯¹äºå¤ç”¨æ¥è¯´</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#React-%E7%9A%84%E4%BA%8B%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E8%BF%90%E4%BD%9C%E8%B5%B7%E6%9D%A5%E7%9A%84%EF%BC%9F\"><span class=\"toc-text\">React çš„äº‹ä»¶ç³»ç»Ÿæ˜¯æ€ä¹ˆè¿ä½œèµ·æ¥çš„ï¼Ÿ</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A\"><span class=\"toc-text\">äº‹ä»¶ç»‘å®š</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91\"><span class=\"toc-text\">äº‹ä»¶è§¦å‘</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E4%B8%8E%E5%8E%9F%E7%94%9F%E4%BA%8B%E4%BB%B6%E6%9C%89%E6%80%8E%E6%A0%B7%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%EF%BC%9F\"><span class=\"toc-text\">åˆæˆäº‹ä»¶ä¸åŸç”Ÿäº‹ä»¶æœ‰æ€æ ·çš„æ‰§è¡Œé¡ºåºï¼Ÿ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BE%8B%E5%AD%90-1\"><span class=\"toc-text\">ä¾‹å­ 1</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BE%8B%E5%AD%90-2\"><span class=\"toc-text\">ä¾‹å­ 2</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#e-stopPropagation-%E5%A6%82%E4%BD%95%E9%98%BB%E6%AD%A2%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1%EF%BC%9F\"><span class=\"toc-text\">e.stopPropagation() å¦‚ä½•é˜»æ­¢åˆæˆäº‹ä»¶å†’æ³¡ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%8C%E7%BA%A7%E5%88%AB%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%8C%89%E9%92%AE%EF%BC%8C%E4%BD%BF%E7%94%A8%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6%EF%BC%8C%E4%BC%9A%E5%87%BA%E9%97%AE%E9%A2%98%EF%BC%9F\"><span class=\"toc-text\">åŒçº§åˆ«çš„ä¸¤ä¸ªæŒ‰é’®ï¼Œä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œä¼šå‡ºé—®é¢˜ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#React-%E6%8F%90%E7%A4%BA-event-persist-%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E6%8F%90%E7%A4%BA%EF%BC%9F\"><span class=\"toc-text\">React æç¤º event.persist() ï¼Œä¸ºä»€ä¹ˆä¼šæç¤ºï¼Ÿ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#setState-%E6%9C%89%E6%97%B6%E5%80%99%E6%98%AF%E5%BC%82%E6%AD%A5%E7%9A%84%EF%BC%8CsetState-%E7%9B%B8%E5%AF%B9%E4%BA%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E8%80%8C%E8%A8%80%E6%98%AF%E5%90%8C%E6%AD%A5%E7%9A%84%EF%BC%8C%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%EF%BC%9F\"><span class=\"toc-text\">setState æœ‰æ—¶å€™æ˜¯å¼‚æ­¥çš„ï¼ŒsetState ç›¸å¯¹äºæµè§ˆå™¨è€Œè¨€æ˜¯åŒæ­¥çš„ï¼Œå¦‚ä½•ç†è§£ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%BC%82%E6%AD%A5%E6%B8%B2%E6%9F%93%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E4%BC%9A%E6%9C%89%E6%80%8E%E6%A0%B7%E7%9A%84%E7%8E%B0%E8%B1%A1%EF%BC%9F\"><span class=\"toc-text\">å¼‚æ­¥æ¸²æŸ“ä½¿ç”¨ä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸä¼šæœ‰æ€æ ·çš„ç°è±¡ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B9%8B%E5%89%8D%E5%B0%86%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E6%8C%82%E8%BD%BD%E5%88%B0-document-%E4%B8%8A%EF%BC%8C%E7%8E%B0%E5%9C%A8%E4%B8%BA%E4%BD%95%E6%8C%82%E8%BD%BD%E5%88%B0-root-%E4%B8%8A%EF%BC%9F\"><span class=\"toc-text\">ä¹‹å‰å°†äº‹ä»¶ç›‘å¬æŒ‚è½½åˆ° document ä¸Šï¼Œç°åœ¨ä¸ºä½•æŒ‚è½½åˆ° root ä¸Šï¼Ÿ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E7%9A%84%E5%86%92%E6%B3%A1%E6%8D%95%E8%8E%B7%E6%9C%BA%E5%88%B6%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%EF%BC%9F\"><span class=\"toc-text\">åˆæˆäº‹ä»¶çš„å†’æ³¡æ•è·æœºåˆ¶å¦‚ä½•å®ç°ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E6%BA%90%E7%A0%81%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%85%B3%E7%B3%BB%E5%9B%BE\"><span class=\"toc-text\">åˆæˆäº‹ä»¶æºç å‡½æ•°è°ƒç”¨å…³ç³»å›¾</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#v17-0-1\"><span class=\"toc-text\">v17.0.1</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\"><span class=\"toc-text\">å‚è€ƒé“¾æ¥</span></a></li></ol>","author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"React@16.5.0 createElement","uid":"5d9b43eaa4875051b6cba337b4fe23d2","slug":"2022-07-21react-createElement","date":"2022-07-21T03:18:50.000Z","updated":"2022-09-16T15:02:24.977Z","comments":true,"path":"api/articles/2022-07-21react-createElement.json","keywords":null,"cover":null,"text":"é¡¹ç›®å¼€å‘æ—¶å€™ä¹¦å†™ä»£ç æŸä¸ªé¡µé¢æˆ–è€…æ˜¯ç»„ä»¶ &#x2F;&#x2F; class ReactComponent extends React.Component &#123; &#x2F;&#x2F; render() &#123; &#x2F;&#x2F; return &lt;p ...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"react_1650","slug":"react-1650","count":5,"path":"api/categories/react-1650.json"}],"tags":[{"name":"react_1650","slug":"react-1650","count":5,"path":"api/tags/react-1650.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"react-native æ¶æ„å˜æ›´","uid":"6f92233bb9cb3976c3ae6f34c3be87e6","slug":"2022-07-19rn-æ¶æ„å˜æ›´","date":"2022-07-19T02:33:57.000Z","updated":"2022-09-16T13:54:56.220Z","comments":true,"path":"api/articles/2022-07-19rn-æ¶æ„å˜æ›´.json","keywords":null,"cover":[],"text":"Fabric æ¸²æŸ“å™¨Fabric æ¸²æŸ“å™¨ ä¸€å¼€å§‹ç›´æ¥çœ‹ react-native å®˜ç½‘ï¼Œå¯¹äº Fabric æ¸²æŸ“å™¨çš„ä»‹ç»çœ‹çš„æˆ‘ä¸€è„¸æ‡µé€¼ï¼Œåœ¨ Google æ‰’æ‹‰ä¸‹ï¼Œå‘ç°äº† 2018 å¹´çš„ä¸€ä¸ªææ¡ˆã€‚ æˆ‘è§‰å¾—ä»è¿‡å»æ¥çœ‹æ›´ç¬¦åˆäº‹ç‰©çš„å‘å±•è§„å¾‹ã€‚ç›´æ¥æ‹¿åˆ°ç»“æœå€’ç€çœ‹ï¼Œä¸æ˜¯å¾ˆå¥½ç†è§£ã€‚ è¿™ä¹ˆæœæœåˆ°...","link":"","photos":[],"count_time":{"symbolsCount":"8.3k","symbolsTime":"8 mins."},"categories":[{"name":"react-native","slug":"react-native","count":2,"path":"api/categories/react-native.json"}],"tags":[{"name":"react-native","slug":"react-native","count":2,"path":"api/tags/react-native.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}