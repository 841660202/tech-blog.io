{"title":"移动端适配 - amfe-flexible","uid":"f348d38b4d9622020eade27f316aa8e6","slug":"2023-02-23amfe-flexible","date":"2023-02-23T08:59:26.000Z","updated":"2023-02-27T12:46:06.493Z","comments":true,"path":"api/articles/2023-02-23amfe-flexible.json","keywords":null,"cover":[],"content":"<h2 id=\"amfe-flexible\"><a href=\"#amfe-flexible\" class=\"headerlink\" title=\"amfe-flexible\"></a>amfe-flexible</h2><p>作用: 是动态设置根节点和 body 的 fontSize, 检测<code>0.5px</code>的支持情况</p>\n<div style=\"display: flex;align-items: center;padding-top:4px;padding-bottom: 4px\"><a target=\"_blank\" href=\"https://github.com/amfe/lib-flexible\">https://github.com/amfe/lib-flexible</a><img src=\"https://img.shields.io/github/stars/amfe/lib-flexible?style=social\" /></div>\n\n<h2 id=\"设置-body-的原因：\"><a href=\"#设置-body-的原因：\" class=\"headerlink\" title=\"设置 body 的原因：\"></a>设置 body 的原因：</h2><ol>\n<li>fontSize 会被继承，</li>\n<li>root fontSize 被改变了，</li>\n<li>要把字体做还原处理</li>\n</ol>\n<h2 id=\"触发计算的时机\"><a href=\"#触发计算的时机\" class=\"headerlink\" title=\"触发计算的时机\"></a>触发计算的时机</h2><ol>\n<li>设置 body 的<code>fontSize</code>的时机<ol>\n<li>脚本执行时</li>\n<li>DOM 内容加载完毕时</li>\n</ol>\n</li>\n<li>设置根节点<code>fontSize</code>的时机<ol>\n<li>脚本执行时</li>\n<li>页面改变时</li>\n<li>页面显示时</li>\n</ol>\n</li>\n</ol>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">(function flexible(window, document) &#123;\n  var docEl &#x3D; document.documentElement;\n  var dpr &#x3D; window.devicePixelRatio || 1;\n\n  &#x2F;&#x2F; adjust body font size\n  function setBodyFontSize() &#123;\n    if (document.body) &#123;\n      document.body.style.fontSize &#x3D; 12 * dpr + &quot;px&quot;;\n    &#125; else &#123;\n      &#x2F;&#x2F; 页面加载的一个阶段，进行触发\n      document.addEventListener(&quot;DOMContentLoaded&quot;, setBodyFontSize);\n    &#125;\n  &#125;\n  setBodyFontSize();\n\n  &#x2F;&#x2F; set 1rem &#x3D; viewWidth &#x2F; 10\n  function setRemUnit() &#123;\n    var rem &#x3D; docEl.clientWidth &#x2F; 10;\n    docEl.style.fontSize &#x3D; rem + &quot;px&quot;;\n  &#125;\n\n  setRemUnit();\n\n  &#x2F;&#x2F; reset rem unit on page resize\n  window.addEventListener(&quot;resize&quot;, setRemUnit);\n  window.addEventListener(&quot;pageshow&quot;, function (e) &#123;\n    if (e.persisted) &#123;\n      setRemUnit();\n    &#125;\n  &#125;);\n\n  &#x2F;&#x2F; detect 0.5px supports\n  &#x2F;&#x2F; 检测是否支持0.5px\n  if (dpr &gt;&#x3D; 2) &#123;\n    var fakeBody &#x3D; document.createElement(&quot;body&quot;);\n    var testElement &#x3D; document.createElement(&quot;div&quot;);\n    testElement.style.border &#x3D; &quot;.5px solid transparent&quot;;\n    fakeBody.appendChild(testElement);\n    docEl.appendChild(fakeBody);\n    if (testElement.offsetHeight &#x3D;&#x3D;&#x3D; 1) &#123;\n      docEl.classList.add(&quot;hairlines&quot;);\n    &#125;\n    docEl.removeChild(fakeBody);\n  &#125;\n&#125;)(window, document);</code></pre>\n\n<h2 id=\"为什么还学它\"><a href=\"#为什么还学它\" class=\"headerlink\" title=\"为什么还学它\"></a>为什么还学它</h2><ol>\n<li>虽然是建议用 viewport 了，但是目前很多公司用的还是 rem 进行适配</li>\n</ol>\n","text":"amfe-flexible作用: 是动态设置根节点和 body 的 fontSize, 检测0.5px的支持情况 https://github.com/amfe/lib-flexible 设置 body 的原因： fontSize 会被继承， root fontSize 被改变了...","link":"","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"移动端适配","slug":"移动端适配","count":4,"path":"api/categories/移动端适配.json"}],"tags":[{"name":"移动端适配","slug":"移动端适配","count":4,"path":"api/tags/移动端适配.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#amfe-flexible\"><span class=\"toc-text\">amfe-flexible</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AE%BE%E7%BD%AE-body-%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%9A\"><span class=\"toc-text\">设置 body 的原因：</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%A7%A6%E5%8F%91%E8%AE%A1%E7%AE%97%E7%9A%84%E6%97%B6%E6%9C%BA\"><span class=\"toc-text\">触发计算的时机</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E5%AD%A6%E5%AE%83\"><span class=\"toc-text\">为什么还学它</span></a></li></ol>","author":{"name":"十三","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>多学一点，多想一点，多做一点</p><p>眼中有光，心中有梦，脚下有路</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"移动端适配 - viewport","uid":"7f7a9ab6a798a1698e4fe0da6545ff5a","slug":"2023-2-23viewport","date":"2023-02-23T09:27:13.000Z","updated":"2023-02-23T13:26:54.134Z","comments":true,"path":"api/articles/2023-2-23viewport.json","keywords":null,"cover":[],"text":"postcss-px-to-viewport5W2H 法则进行复利 为什么amfe-flexible 作者： 由于 viewport 单位得到众多浏览器的兼容，lib-flexible 这个过渡方案已经可以放弃使用，不管是现在的版本还是以前的版本，都存有一定的问题。建议大家开始使...","link":"","photos":[],"count_time":{"symbolsCount":853,"symbolsTime":"1 mins."},"categories":[{"name":"移动端适配","slug":"移动端适配","count":4,"path":"api/categories/移动端适配.json"}],"tags":[{"name":"源码","slug":"源码","count":16,"path":"api/tags/源码.json"},{"name":"移动端适配","slug":"移动端适配","count":4,"path":"api/tags/移动端适配.json"}],"author":{"name":"十三","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>多学一点，多想一点，多做一点</p><p>眼中有光，心中有梦，脚下有路</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"小插曲 prettier","uid":"5f5455c442e0d990b14d6a6cf267983f","slug":"2023-02-23prittier","date":"2023-02-23T03:25:03.000Z","updated":"2023-02-27T12:46:06.493Z","comments":true,"path":"api/articles/2023-02-23prittier.json","keywords":null,"cover":null,"text":"Prettier 是什么代码自动格式化工具 为什么用 Prettier5W2H 解决历史问题：不用浪费时间整理代码 工具本身：简单好用，开销低 帮助新人：学习代码书写，减少错误 社区很热：(必聊社区) 代码书写： “我想写代码。不要在格式化上花费周期。” “它消除了我们日常生活中...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"工具","slug":"工具","count":26,"path":"api/categories/工具.json"}],"tags":[{"name":"工具","slug":"工具","count":20,"path":"api/tags/工具.json"}],"author":{"name":"十三","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>多学一点，多想一点，多做一点</p><p>眼中有光，心中有梦，脚下有路</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}