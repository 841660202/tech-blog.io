{"title":"å‰ç«¯åŸºç¡€-è·¨åŸŸé—®é¢˜","uid":"097419cee069b6e2fdfe8a3b19f9ef54","slug":"2022-05-09cors","date":"2022-05-09T13:30:47.000Z","updated":"2022-09-16T13:54:56.104Z","comments":true,"path":"api/articles/2022-05-09cors.json","keywords":null,"cover":"http://t-blog-images.aijs.top/img/20220509181853.webp","content":"<h2 id=\"èƒŒæ™¯\"><a href=\"#èƒŒæ™¯\" class=\"headerlink\" title=\"èƒŒæ™¯\"></a>èƒŒæ™¯</h2><p>æµè§ˆå™¨å®‰å…¨ç­–ç•¥é™åˆ¶è·¨åŸŸè®¿é—®</p>\n<p>å†…å®¹å®‰å…¨ç­–ç•¥æ˜¯ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å±‚ï¼Œç”¨äºæ£€æµ‹å¹¶å‰Šå¼±æŸäº›ç‰¹å®šç±»å‹çš„æ”»å‡»ï¼ŒåŒ…æ‹¬è·¨ç«™è„šæœ¬ (XSS) å’Œæ•°æ®æ³¨å…¥æ”»å‡»ç­‰ã€‚æ— è®ºæ˜¯æ•°æ®ç›—å–ã€ç½‘ç«™å†…å®¹æ±¡æŸ“è¿˜æ˜¯æ•£å‘æ¶æ„è½¯ä»¶ï¼Œè¿™äº›æ”»å‡»éƒ½æ˜¯ä¸»è¦çš„æ‰‹æ®µã€‚</p>\n<p>ç»´åŸºç™¾ç§‘ï¼š</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆè‹±è¯­ï¼šContent Security Policyï¼Œç®€ç§° CSPï¼‰æ˜¯ä¸€ç§è®¡ç®—æœºå®‰å…¨æ ‡å‡†ï¼Œæ—¨åœ¨é˜²å¾¡è·¨ç«™è„šæœ¬ã€ç‚¹å‡»åŠ«æŒç­‰ä»£ç æ³¨å…¥æ”»å‡»ï¼Œé˜»æ­¢æ¶æ„å†…å®¹åœ¨å—ä¿¡ç½‘é¡µç¯å¢ƒä¸­æ‰§è¡Œã€‚è¿™ä¸€æ ‡å‡†æ˜¯ W3C ç½‘ç»œåº”ç”¨å®‰å…¨å·¥ä½œç»„çš„å€™é€‰æ¨èæ ‡å‡†ï¼Œè¢«ç°ä»£ç½‘é¡µæµè§ˆå™¨å¹¿æ³›æ”¯æŒ</p></blockquote>\n<ol>\n<li>ä½¿ç”¨æ–¹å¼<br>ä¸ºä½¿ CSP å¯ç”¨, ä½ éœ€è¦é…ç½®ä½ çš„ç½‘ç»œæœåŠ¡å™¨è¿”å› Content-Security-Policyï¼Œæˆ–è€…åœ¨ HTML <meta> å…ƒç´ ç§ä¹Ÿå¯é…ç½®è¯¥ç­–ç•¥, ä¾‹å¦‚ï¼š</li>\n</ol>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">&lt;meta\n  http-equiv&#x3D;&quot;Content-Security-Policy&quot;\n  content&#x3D;&quot;default-src &#39;self&#39;; img-src https:&#x2F;&#x2F;*; child-src &#39;none&#39;;&quot;\n&#x2F;&gt;</code></pre>\n\n<ol start=\"2\">\n<li>é…ç½®ç¤ºä¾‹<br>ï¼ˆ1ï¼‰ä¸€ä¸ªç½‘ç«™ç®¡ç†è€…æƒ³è¦æ‰€æœ‰å†…å®¹å‡æ¥è‡ªç«™ç‚¹çš„åŒä¸€ä¸ªæº (ä¸åŒ…æ‹¬å…¶å­åŸŸå)</li>\n</ol>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">Content-Security-Policy: default-src &#39;self&#39;</code></pre>\n\n<p>ï¼ˆ2ï¼‰ä¸€ä¸ªç½‘ç«™ç®¡ç†è€…å…è®¸å†…å®¹æ¥è‡ªä¿¡ä»»çš„åŸŸååŠå…¶å­åŸŸå (åŸŸåä¸å¿…é¡»ä¸ CSP è®¾ç½®æ‰€åœ¨çš„åŸŸåç›¸åŒ)</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Content-Security-Policy: default-src &#39;self&#39; *.trusted.com</code></pre>\n\n<p>ï¼ˆ3ï¼‰ä¸€ä¸ªç½‘ç«™ç®¡ç†è€…å…è®¸ç½‘é¡µåº”ç”¨çš„ç”¨æˆ·åœ¨ä»–ä»¬è‡ªå·±çš„å†…å®¹ä¸­åŒ…å«æ¥è‡ªä»»ä½•æºçš„å›¾ç‰‡, ä½†æ˜¯é™åˆ¶éŸ³é¢‘æˆ–è§†é¢‘éœ€ä»ä¿¡ä»»çš„èµ„æºæä¾›è€…(è·å¾—)ï¼Œæ‰€æœ‰è„šæœ¬å¿…é¡»ä»ç‰¹å®šä¸»æœºæœåŠ¡å™¨è·å–å¯ä¿¡çš„ä»£ç ã€‚</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Content-Security-Policy: default-src &#39;self&#39;;\nimg-src *;\nmedia-src media1.com media2.com; script-src userscripts.example.com</code></pre>\n\n<p>åœ¨è¿™é‡Œï¼Œå„ç§å†…å®¹é»˜è®¤ä»…å…è®¸ä»æ–‡æ¡£æ‰€åœ¨çš„æºè·å–, ä½†å­˜åœ¨å¦‚ä¸‹ä¾‹å¤–:</p>\n<p>å›¾ç‰‡å¯ä»¥ä»ä»»ä½•åœ°æ–¹åŠ è½½(æ³¨æ„ â€œ*â€œ é€šé…ç¬¦)ã€‚<br>å¤šåª’ä½“æ–‡ä»¶ä»…å…è®¸ä» media1.com å’Œ media2.com åŠ è½½(ä¸å…è®¸ä»è¿™äº›ç«™ç‚¹çš„å­åŸŸå)ã€‚<br>å¯è¿è¡Œè„šæœ¬ä»…å…è®¸æ¥è‡ªäº userscripts.example.comã€‚</p>\n<p>ä½œè€…ï¼šèœé¸¡å‰ç«¯<br>é“¾æ¥ï¼š<a href=\"https://www.jianshu.com/p/a45924e99a6d\">https://www.jianshu.com/p/a45924e99a6d</a><br>æ¥æºï¼šç®€ä¹¦<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>\n<h2 id=\"å¤„ç†æ–¹å¼\"><a href=\"#å¤„ç†æ–¹å¼\" class=\"headerlink\" title=\"å¤„ç†æ–¹å¼\"></a>å¤„ç†æ–¹å¼</h2><h3 id=\"nginx\"><a href=\"#nginx\" class=\"headerlink\" title=\"nginx\"></a>nginx</h3><ul>\n<li>è„šæœ¬</li>\n</ul>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">\nlisten 80; # ç›‘å¬çš„ç«¯â¼\n   add_header &#39;Access-Control-Allow-Origin&#39; &#39;$http_origin&#39; ;\n   add_header &#39;Access-Control-Allow-Credentials&#39; &#39;true&#39; ;\n   add_header &#39;Access-Control-Allow-Methods&#39; &#39;PUT,POST,GET,DELETE,OPTIONS&#39; ;\n   add_header &#39;Access-Control-Allow-Headers&#39; &#39;Content-Type,Content-Length,Authorization,Accept,X-Requested-With&#39; ;</code></pre>\n\n<ul>\n<li>å®é™…æ“ä½œ</li>\n</ul>\n<p><img src=\"http://t-blog-images.aijs.top/img/20220509181853.webp\"></p>\n<h3 id=\"jsonp-æ–¹å¼-lt-åŠ¨æ€-script-gt\"><a href=\"#jsonp-æ–¹å¼-lt-åŠ¨æ€-script-gt\" class=\"headerlink\" title=\"jsonp æ–¹å¼ &lt;åŠ¨æ€ script&gt;\"></a>jsonp æ–¹å¼ &lt;åŠ¨æ€ script&gt;</h3><p>æœ€ç»å…¸çš„è·¨åŸŸâ½…æ¡ˆ jsonp jsonp æœ¬è´¨ä¸Šæ˜¯â¼€ä¸ª Hackï¼Œå®ƒåˆ©â½¤ <code>&lt;script&gt;</code> æ ‡ç­¾ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„ç‰¹æ€§è¿›â¾è·¨åŸŸæ“ä½œã€‚</p>\n<p>jsonp ä¼˜ç‚¹ï¼š å®ç°ç®€å• å…¼å®¹æ€§â¾®å¸¸å¥½</p>\n<p>jsonp çš„ç¼ºç‚¹ï¼š</p>\n<p>åªâ½€æŒ get è¯·æ±‚ï¼ˆå› ä¸º<code> &lt;script&gt;</code> æ ‡ç­¾åªèƒ½ getï¼‰<br>æœ‰å®‰å…¨æ€§é—®é¢˜ï¼Œå®¹æ˜“é­å— xss æ”»å‡»<br>éœ€è¦æœåŠ¡ç«¯é…åˆ jsonp è¿›â¾â¼€å®šç¨‹åº¦çš„æ”¹é€ </p>\n<p>jsonp çš„å®ç°ï¼š</p>\n<pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\">function JSONP(&#123; url, params, callbackKey, callback &#125;) &#123;\n  &#x2F;&#x2F; åœ¨å‚æ•°â¾¥åˆ¶å®š callback çš„åå­—\n  params &#x3D; params || &#123;&#125;;\n  params[callbackKey] &#x3D; &quot;callback&quot;;\n  &#x2F;&#x2F; é¢„ç•™ callback\n  window.callback &#x3D; callback;\n  &#x2F;&#x2F; æ‹¼æ¥å‚æ•°å­—ç¬¦ä¸²\n  const paramKeys &#x3D; Object.keys(params);\n  const paramString &#x3D; paramKeys.map((key) &#x3D;&gt; &#96;$&#123;key&#125;&#x3D;$&#123;params[key]&#125;&#96;).join(&quot;&amp;&quot;);\n  &#x2F;&#x2F; æ’â¼Š DOM å…ƒç´ \n  const script &#x3D; document.createElement(&quot;script&quot;);\n  script.setAttribute(&quot;src&quot;, &#96;$&#123;url&#125;?$&#123;paramString&#125;&#96;);\n  document.body.appendChild(script);\n&#125;\n\nJSONP(&#123;\n  url: &quot;http:&#x2F;&#x2F;s.weibo.com&#x2F;ajax&#x2F;jsonp&#x2F;suggestion&quot;,\n  params: &#123;\n    key: &quot;test&quot;,\n  &#125;,\n  callbackKey: &quot;callback&quot;,\n  callback(result) &#123;\n    console.log(result.data);\n  &#125;,\n&#125;);</code></pre>\n\n<p>jsonp æœåŠ¡ç«¯æ”¹é€ </p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">var http &#x3D; require(&quot;http&quot;);\nvar urllib &#x3D; require(&quot;url&quot;);\n\nvar port &#x3D; 10011;\nvar data &#x3D; &#123; name: &quot;jifeng&quot;, company: &quot;tb&quot; &#125;;\n\nhttp\n  .createServer(function (req, res) &#123;\n    var params &#x3D; urllib.parse(req.url, true);\n    console.log(params);\n    if (params.query &amp;&amp; params.query.callback &#x2F;**å¯¹åº”å®¢æˆ·ç«¯ *&#x2F;) &#123;\n      &#x2F;&#x2F;console.log(params.query.callback);\n      var str &#x3D; params.query.callback + &quot;(&quot; + JSON.stringify(data) + &quot;)&quot;; &#x2F;&#x2F;jsonp\n      res.end(str);\n    &#125; else &#123;\n      res.end(JSON.stringify(data)); &#x2F;&#x2F;æ™®é€šçš„json\n    &#125;\n  &#125;)\n  .listen(port, function () &#123;\n    console.log(&quot;server is listening on port &quot; + port);\n  &#125;);</code></pre>\n\n<h3 id=\"æœåŠ¡ç«¯è®¾ç½®ï¼Œç±»ä¼¼-nginx\"><a href=\"#æœåŠ¡ç«¯è®¾ç½®ï¼Œç±»ä¼¼-nginx\" class=\"headerlink\" title=\"æœåŠ¡ç«¯è®¾ç½®ï¼Œç±»ä¼¼ nginx\"></a>æœåŠ¡ç«¯è®¾ç½®ï¼Œç±»ä¼¼ nginx</h3><p>cors æ˜¯â½¬å‰ä¸»æµçš„è·¨åŸŸè§£å†³â½…æ¡ˆï¼Œè·¨åŸŸèµ„æºå…±äº«(CORS) æ˜¯â¼€ç§æœºåˆ¶ï¼Œå®ƒä½¿â½¤é¢å¤–çš„ HTTP å¤´æ¥å‘Šè¯‰æµè§ˆå™¨ è®©è¿â¾åœ¨â¼€ ä¸ª origin (domain) ä¸Šçš„ Web åº”â½¤è¢«å‡†è®¸è®¿é—®æ¥â¾ƒä¸åŒæºæœåŠ¡å™¨ä¸Šçš„æŒ‡å®šçš„èµ„æºã€‚å½“â¼€ä¸ªèµ„æºä»ä¸è¯¥èµ„æºæœ¬èº«æ‰€åœ¨çš„æœ åŠ¡å™¨ä¸åŒçš„åŸŸã€åè®®æˆ–ç«¯â¼è¯·æ±‚â¼€ä¸ªèµ„æºæ—¶ï¼Œèµ„æºä¼šå‘èµ·â¼€ä¸ªè·¨åŸŸ HTTP è¯·æ±‚ã€‚ å¦‚æœä½ â½¤ expressï¼Œå¯ä»¥è¿™æ ·åœ¨åç«¯è®¾ç½®</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F;CORS middleware\nvar allowCrossDomain &#x3D; function (req, res, next) &#123;\n  res.header(&quot;Access-Control-Allow-Origin&quot;, &quot;http:&#x2F;&#x2F;example.com&quot;);\n  res.header(&quot;Access-Control-Allow-Methods&quot;, &quot;GET,PUT,POST,DELETE&quot;);\n  res.header(&quot;Access-Control-Allow-Headers&quot;, &quot;Content-Type&quot;);\n  &#x2F;&#x2F; é¢„æ£€çš„å­˜æ´»æ—¶é—´\n  res.setHeader(&quot;Access-Control-Max-Age&quot;, 60);\n  next();\n&#125;;\n&#x2F;&#x2F;...\napp.configure(function () &#123;\n  app.use(express.bodyParser());\n  app.use(express.cookieParser());\n  app.use(express.session(&#123; secret: &quot;cool beans&quot; &#125;));\n  app.use(express.methodOverride());\n  app.use(allowCrossDomain);\n  app.use(app.router);\n  app.use(express.static(__dirname + &quot;&#x2F;public&quot;));\n&#125;);</code></pre>\n\n<p>åœ¨â½£äº§ç¯å¢ƒä¸­å»ºè®®â½¤æˆç†Ÿçš„å¼€æºä¸­é—´ä»¶è§£å†³é—®é¢˜ã€‚</p>\n<p>ä¸åŒçš„ nodejs æ¡†æ¶è®¾ç½®æ–¹å¼ä¸åŒï¼Œä¸€èˆ¬è·¨åŸŸé—®é¢˜å‡ ä¹æ¡†æ¶å®˜ç½‘å¿…å¤‡ï¼ŒæŸ¥ä¸‹å°±æ™“å¾—å¦‚ä½•é…ç½®äº†ï¼Œä½†æœ¬è´¨éƒ½æ˜¯æ”¹å˜ç›¸åº”å¤´</p>\n<h3 id=\"å…¶ä»–ï¼ˆä¸å¸¸ç”¨ï¼‰\"><a href=\"#å…¶ä»–ï¼ˆä¸å¸¸ç”¨ï¼‰\" class=\"headerlink\" title=\"å…¶ä»–ï¼ˆä¸å¸¸ç”¨ï¼‰\"></a>å…¶ä»–ï¼ˆä¸å¸¸ç”¨ï¼‰</h3><ol>\n<li>HTML5 XMLHttpRequest æœ‰â¼€ä¸ª APIï¼Œ<code>postMessage()</code>â½…æ³•å…è®¸æ¥â¾ƒä¸åŒæºçš„è„šæœ¬é‡‡â½¤å¼‚æ­¥â½…å¼è¿›â¾æœ‰é™çš„é€šä¿¡ï¼Œ å¯ä»¥å®ç°è·¨â½‚æœ¬æ¡£ã€å¤šçª—â¼ã€è·¨åŸŸæ¶ˆæ¯ä¼ é€’ã€‚</li>\n</ol>\n<details class=\"custom-details\">\n<summary>Details</summary>\n<p><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; a.html\n  &lt;iframe src&#x3D;&quot;http:&#x2F;&#x2F;localhost:4000&#x2F;b.html&quot; frameborder&#x3D;&quot;0&quot; id&#x3D;&quot;frame&quot; onload&#x3D;&quot;load()&quot;&gt;&lt;&#x2F;iframe&gt; &#x2F;&#x2F;ç­‰å®ƒåŠ è½½å®Œè§¦å‘ä¸€ä¸ªäº‹ä»¶\n  &#x2F;&#x2F;å†…åµŒåœ¨http:&#x2F;&#x2F;localhost:3000&#x2F;a.html\n    &lt;script&gt;\n      function load() &#123;\n        let frame &#x3D; document.getElementById(&#39;frame&#39;)\n        frame.contentWindow.postMessage(&#39;æˆ‘çˆ±ä½ &#39;, &#39;http:&#x2F;&#x2F;localhost:4000&#39;) &#x2F;&#x2F;å‘é€æ•°æ®\n        window.onmessage &#x3D; function(e) &#123; &#x2F;&#x2F;æ¥å—è¿”å›æ•°æ®\n          console.log(e.data) &#x2F;&#x2F;æˆ‘ä¸çˆ±ä½ \n        &#125;\n      &#125;\n    &lt;&#x2F;script&gt;\n</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; b.html\nwindow.onmessage &#x3D; function (e) &#123;\n  console.log(e.data); &#x2F;&#x2F;æˆ‘çˆ±ä½ \n  e.source.postMessage(&quot;æˆ‘ä¸çˆ±ä½ &quot;, e.origin);\n&#125;;</code></pre>\n\n</p>\n</details>\n<ol start=\"2\">\n<li><code>WebSocket</code> æ˜¯â¼€ç§åŒå‘é€šä¿¡åè®®ï¼Œåœ¨å»ºâ½´è¿æ¥ä¹‹åï¼ŒWebSocket çš„ server ä¸ client éƒ½èƒ½ä¸»åŠ¨å‘å¯¹â½…å‘é€æˆ–æ¥æ”¶æ•° æ®ï¼Œè¿æ¥å»ºâ½´å¥½äº†ä¹‹å client ä¸ server ä¹‹é—´çš„åŒå‘é€šä¿¡å°±ä¸ HTTP â½†å…³äº†ï¼Œå› æ­¤å¯ä»¥è·¨åŸŸã€‚</li>\n<li><code>window.name + iframe</code>ï¼šwindow.name å±æ€§å€¼åœ¨ä¸åŒçš„â»šâ¾¯ï¼ˆç”šâ¾„ä¸åŒåŸŸåï¼‰åŠ è½½åä¾æ—§å­˜åœ¨ï¼Œå¹¶ä¸”å¯ä»¥â½€æŒâ¾®å¸¸ â»“çš„ name å€¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©â½¤è¿™ä¸ªç‰¹ç‚¹è¿›â¾è·¨åŸŸã€‚</li>\n</ol>\n<details class=\"custom-details\">\n<summary>Details</summary>\n<p><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; a.html(http:&#x2F;&#x2F;localhost:3000&#x2F;b.html)\n &lt;iframe src&#x3D;&quot;http:&#x2F;&#x2F;localhost:4000&#x2F;c.html&quot; frameborder&#x3D;&quot;0&quot; onload&#x3D;&quot;load()&quot; id&#x3D;&quot;iframe&quot;&gt;&lt;&#x2F;iframe&gt;\n &lt;script&gt;\n   let first &#x3D; true\n   &#x2F;&#x2F; onloadäº‹ä»¶ä¼šè§¦å‘2æ¬¡ï¼Œç¬¬1æ¬¡åŠ è½½è·¨åŸŸé¡µï¼Œå¹¶ç•™å­˜æ•°æ®äºwindow.name\n   function load() &#123;\n     if(first)&#123;\n     &#x2F;&#x2F; ç¬¬1æ¬¡onload(è·¨åŸŸé¡µ)æˆåŠŸåï¼Œåˆ‡æ¢åˆ°åŒåŸŸä»£ç†é¡µé¢\n       let iframe &#x3D; document.getElementById(&#39;iframe&#39;);\n       iframe.src &#x3D; &#39;http:&#x2F;&#x2F;localhost:3000&#x2F;b.html&#39;;\n       first &#x3D; false;\n     &#125;else&#123;\n     &#x2F;&#x2F; ç¬¬2æ¬¡onload(åŒåŸŸb.htmlé¡µ)æˆåŠŸåï¼Œè¯»å–åŒåŸŸwindow.nameä¸­æ•°æ®\n       console.log(iframe.contentWindow.name);\n     &#125;\n   &#125;\n &lt;&#x2F;script&gt;</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; c.html(http:&#x2F;&#x2F;localhost:4000&#x2F;c.html)\n&lt;script&gt;window.name &#x3D; &#39;æˆ‘ä¸çˆ±ä½ &#39;&lt;&#x2F;script&gt;</code></pre>\n\n<p>é€šè¿‡ iframe çš„ src å±æ€§ç”±å¤–åŸŸè½¬å‘æœ¬åœ°åŸŸï¼Œè·¨åŸŸæ•°æ®å³ç”± iframe çš„ window.name ä»å¤–åŸŸä¼ é€’åˆ°æœ¬åœ°åŸŸã€‚è¿™ä¸ªå°±å·§å¦™åœ°ç»•è¿‡äº†æµè§ˆå™¨çš„è·¨åŸŸè®¿é—®é™åˆ¶ï¼Œä½†åŒæ—¶å®ƒåˆæ˜¯å®‰å…¨æ“ä½œã€‚</p>\n</p>\n</details>\n<ol start=\"4\">\n<li><code>location.hash + iframe</code>ï¼ša.html æ¬²ä¸ c.html è·¨åŸŸç›¸äº’é€šä¿¡ï¼Œé€šè¿‡ä¸­é—´â»š b.html æ¥å®ç°ã€‚ ä¸‰ä¸ªâ»šâ¾¯ï¼Œä¸åŒåŸŸä¹‹é—´åˆ©â½¤ iframe çš„ location.hash ä¼ å€¼ï¼Œç›¸åŒåŸŸä¹‹é—´ç›´æ¥ js è®¿é—®æ¥é€šä¿¡ã€‚</li>\n</ol>\n<details class=\"custom-details\">\n<summary>åŠ¨æ€åˆ›å»º iframe</summary>\n<p>å…·ä½“å®ç°æ­¥éª¤ï¼šä¸€å¼€å§‹ a.html ç»™ c.html ä¼ ä¸€ä¸ª hash å€¼ï¼Œç„¶å c.html æ”¶åˆ° hash å€¼åï¼Œå†æŠŠ hash å€¼ä¼ é€’ç»™ b.htmlï¼Œæœ€å b.html å°†ç»“æœæ”¾åˆ° a.html çš„ hash å€¼ä¸­ã€‚<br>åŒæ ·çš„ï¼Œa.html å’Œ b.html æ˜¯åŒåŸŸçš„ï¼Œéƒ½æ˜¯ <a href=\"http://localhost:3000;è€Œ\">http://localhost:3000;è€Œ</a> c.html æ˜¯ <a href=\"http://localhost:4000/\">http://localhost:4000</a></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; a.html\n &lt;iframe src&#x3D;&quot;http:&#x2F;&#x2F;localhost:4000&#x2F;c.html#iloveyou&quot;&gt;&lt;&#x2F;iframe&gt;\n &lt;script&gt;\n   window.onhashchange &#x3D; function () &#123; &#x2F;&#x2F;æ£€æµ‹hashçš„å˜åŒ–\n     console.log(location.hash);\n   &#125;\n &lt;&#x2F;script&gt;\n</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; b.html\n&lt;script&gt;\n  window.parent.parent.location.hash &#x3D; location.hash\n  &#x2F;&#x2F;b.htmlå°†ç»“æœæ”¾åˆ°a.htmlçš„hashå€¼ä¸­ï¼Œb.htmlå¯é€šè¿‡parent.parentè®¿é—®a.htmlé¡µé¢\n&lt;&#x2F;script&gt;</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; c.html\nconsole.log(location.hash);\nlet iframe &#x3D; document.createElement(&quot;iframe&quot;);\niframe.src &#x3D; &quot;http:&#x2F;&#x2F;localhost:3000&#x2F;b.html#idontloveyou&quot;;\ndocument.body.appendChild(iframe);</code></pre>\n\n</p>\n</details>\n<ol start=\"5\">\n<li><code>document.domain + iframe</code>ï¼š è¯¥â½…å¼åªèƒ½â½¤äºâ¼†çº§åŸŸåç›¸åŒçš„æƒ…å†µä¸‹ï¼Œâ½å¦‚ a.test.com å’Œ b.test.com é€‚â½¤äºè¯¥â½… å¼ï¼Œæˆ‘ä»¬åªéœ€è¦ç»™â»šâ¾¯æ·»åŠ  document.domain &#x3D;â€™test.comâ€™ è¡¨ç¤ºâ¼†çº§åŸŸåéƒ½ç›¸åŒå°±å¯ä»¥å®ç°è·¨åŸŸï¼Œä¸¤ä¸ªâ»šâ¾¯éƒ½é€šè¿‡ js å¼ºåˆ¶è®¾ç½® document.domain ä¸ºåŸºç¡€ä¸»åŸŸï¼Œå°±å®ç°äº†åŒåŸŸã€‚</li>\n</ol>\n<details class=\"custom-details\">\n<summary>Details</summary>\n<p><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; a.html\n&lt;body&gt;\n helloa\n  &lt;iframe src&#x3D;&quot;http:&#x2F;&#x2F;b.zf1.cn:3000&#x2F;b.html&quot; frameborder&#x3D;&quot;0&quot; onload&#x3D;&quot;load()&quot; id&#x3D;&quot;frame&quot;&gt;&lt;&#x2F;iframe&gt;\n  &lt;script&gt;\n    document.domain &#x3D; &#39;zf1.cn&#39;\n    function load() &#123;\n      console.log(frame.contentWindow.a);\n    &#125;\n  &lt;&#x2F;script&gt;\n&lt;&#x2F;body&gt;\n</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; b.html\n&lt;body&gt;\n  hellob\n  &lt;script&gt;document.domain &#x3D; &#39;zf1.cn&#39; var a &#x3D; 100;&lt;&#x2F;script&gt;\n&lt;&#x2F;body&gt;</code></pre>\n\n</p>\n</details>\n<h2 id=\"å‚è€ƒé“¾æ¥\"><a href=\"#å‚è€ƒé“¾æ¥\" class=\"headerlink\" title=\"å‚è€ƒé“¾æ¥\"></a>å‚è€ƒé“¾æ¥</h2><p><a href=\"https://juejin.cn/post/6844903767226351623#heading-19\" target=\"_blank\" >ä¹ç§è·¨åŸŸæ–¹å¼å®ç°åŸç†ï¼ˆå®Œæ•´ç‰ˆï¼‰</a></p>\n<p><a href=\"https://www.ruanyifeng.com/blog/2016/09/csp.html\" target=\"_blank\" >Content Security Policy å…¥é—¨æ•™ç¨‹</a></p>\n","text":"èƒŒæ™¯æµè§ˆå™¨å®‰å…¨ç­–ç•¥é™åˆ¶è·¨åŸŸè®¿é—® å†…å®¹å®‰å…¨ç­–ç•¥æ˜¯ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å±‚ï¼Œç”¨äºæ£€æµ‹å¹¶å‰Šå¼±æŸäº›ç‰¹å®šç±»å‹çš„æ”»å‡»ï¼ŒåŒ…æ‹¬è·¨ç«™è„šæœ¬ (XSS) å’Œæ•°æ®æ³¨å…¥æ”»å‡»ç­‰ã€‚æ— è®ºæ˜¯æ•°æ®ç›—å–ã€ç½‘ç«™å†…å®¹æ±¡æŸ“è¿˜æ˜¯æ•£å‘æ¶æ„è½¯ä»¶ï¼Œè¿™äº›æ”»å‡»éƒ½æ˜¯ä¸»è¦çš„æ‰‹æ®µã€‚ ç»´åŸºç™¾ç§‘ï¼š å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆè‹±è¯­ï¼šContent Security ...","link":"","photos":[],"count_time":{"symbolsCount":"8.8k","symbolsTime":"8 mins."},"categories":[{"name":"å‰ç«¯åŸºç¡€","slug":"å‰ç«¯åŸºç¡€","count":27,"path":"api/categories/å‰ç«¯åŸºç¡€.json"}],"tags":[{"name":"å‰ç«¯åŸºç¡€","slug":"å‰ç«¯åŸºç¡€","count":29,"path":"api/tags/å‰ç«¯åŸºç¡€.json"},{"name":"é¢è¯•","slug":"é¢è¯•","count":17,"path":"api/tags/é¢è¯•.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">èƒŒæ™¯</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">å¤„ç†æ–¹å¼</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#nginx\"><span class=\"toc-text\">nginx</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#jsonp-%E6%96%B9%E5%BC%8F-lt-%E5%8A%A8%E6%80%81-script-gt\"><span class=\"toc-text\">jsonp æ–¹å¼ &lt;åŠ¨æ€ script&gt;</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E7%BD%AE%EF%BC%8C%E7%B1%BB%E4%BC%BC-nginx\"><span class=\"toc-text\">æœåŠ¡ç«¯è®¾ç½®ï¼Œç±»ä¼¼ nginx</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B6%E4%BB%96%EF%BC%88%E4%B8%8D%E5%B8%B8%E7%94%A8%EF%BC%89\"><span class=\"toc-text\">å…¶ä»–ï¼ˆä¸å¸¸ç”¨ï¼‰</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\"><span class=\"toc-text\">å‚è€ƒé“¾æ¥</span></a></li></ol>","author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Slate wiki-uiè¯„è®ºåŠŸèƒ½å…‰æ ‡ä¹±è·³","uid":"f5ccfd5f1ce5f78727a64a19669811c7","slug":"2022-04-29slate","date":"2022-05-10T05:00:00.000Z","updated":"2022-09-16T13:54:56.099Z","comments":true,"path":"api/articles/2022-04-29slate.json","keywords":null,"cover":"http://t-blog-images.aijs.top/img/bug.webp","text":"bugå¤ç°bugå¤ç° (node:29) UnhandledPromiseRejectionWarning: Error: Forbidden at &amp;#x2F;code&amp;#x2F;client&amp;#x2F;.next&amp;#x2F;server&amp...","link":"","photos":[],"count_time":{"symbolsCount":"5.8k","symbolsTime":"5 mins."},"categories":[{"name":"wiki","slug":"wiki","count":3,"path":"api/categories/wiki.json"}],"tags":[{"name":"wiki","slug":"wiki","count":4,"path":"api/tags/wiki.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"é¢è¯•é¢˜æ±‡æ€»","uid":"99460a2013287be2d51642da6dd169f8","slug":"2022-05-08interview","date":"2022-05-08T08:27:00.000Z","updated":"2022-09-16T13:54:56.102Z","comments":true,"path":"api/articles/2022-05-08interview.json","keywords":null,"cover":null,"text":"å€¼å¾—æ”¶è—çš„é“¾æ¥ ç ä¸Šé€šå¤© é¢è¯•å®Œ 50 ä¸ªäººåæˆ‘å†™ä¸‹è¿™ç¯‡æ€»ç»“ if æˆ‘æ˜¯å‰ç«¯å›¢é˜Ÿ Leaderï¼Œæ€ä¹ˆåˆ¶å®šå‰ç«¯åä½œè§„èŒƒ? åšäº†ä¸€ä»½å‰ç«¯é¢è¯•å¤ä¹ è®¡åˆ’ï¼Œä¿ç†Ÿï½ urlè§£æè¿‡ç¨‹ ","link":"","photos":[],"count_time":{"symbolsCount":91,"symbolsTime":"1 mins."},"categories":[{"name":"é¢è¯•","slug":"é¢è¯•","count":2,"path":"api/categories/é¢è¯•.json"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","count":17,"path":"api/tags/é¢è¯•.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}