{"title":"React StrictMode","uid":"072284d75a6848b3baf49e71f53b2857","slug":"2023-03-10babel","date":"2023-03-10T09:14:04.000Z","updated":"2023-03-13T13:39:28.233Z","comments":true,"path":"api/articles/2023-03-10babel.json","keywords":null,"cover":[],"content":"<h2 id=\"动机\"><a href=\"#动机\" class=\"headerlink\" title=\"动机\"></a>动机</h2><ol>\n<li>React StrictMode 的源码长什么样子？</li>\n<li>执行过成是什么？为什么是标签，难道 React 内部实现了这个组件？</li>\n</ol>\n<h2 id=\"查资料\"><a href=\"#查资料\" class=\"headerlink\" title=\"查资料\"></a>查资料</h2><p>搜到的资料都是<a href=\"https://reactjs.org/docs/strict-mode.html\" target=\"_blank\" >官网文档</a> 和 React 官方博客 <a href=\"https://reactjs.org/blog/2022/03/29/react-v18.html\" target=\"_blank\" >18 版本更新内容</a> 的搬运</p>\n<h2 id=\"翻源码\"><a href=\"#翻源码\" class=\"headerlink\" title=\"翻源码\"></a>翻源码</h2><h3 id=\"clone-react-源码，-vscode-搜索\"><a href=\"#clone-react-源码，-vscode-搜索\" class=\"headerlink\" title=\"clone react 源码， vscode 搜索\"></a>clone react 源码， vscode 搜索</h3><p>一搜 😓，尴尬了，发现很多<code>StrictMode</code>, 硬着头皮，从第一行搜索结果，找到最后一行，嗯，没有想要的</p>\n<h3 id=\"找入口文件\"><a href=\"#找入口文件\" class=\"headerlink\" title=\"找入口文件\"></a>找入口文件</h3><pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\">import &#123;\n  ...\n  REACT_FRAGMENT_TYPE, &#x2F;&#x2F; Symbol.for(&#39;react.fragment&#39;)\n  &#x2F;&#x2F; ...\n  REACT_STRICT_MODE_TYPE, &#x2F;&#x2F; Symbol.for(&#39;react.strict_mode&#39;)\n  &#x2F;&#x2F; ...\n&#125; from &quot;shared&#x2F;ReactSymbols&quot;;\n\nexport &#123;\n  &#x2F;&#x2F; ...\n  REACT_FRAGMENT_TYPE as Fragment,\n  &#x2F;&#x2F; ...\n  REACT_STRICT_MODE_TYPE as StrictMode,\n  &#x2F;&#x2F; ...\n&#125;;</code></pre>\n\n<ol>\n<li>这～～，确实没找到<code>StrictMode</code>组件</li>\n<li>我留了<code>Fragment</code>和<code>StrictMode</code>，不至于对<code>StrictMode</code>陌生</li>\n</ol>\n<h2 id=\"Q-amp-A\"><a href=\"#Q-amp-A\" class=\"headerlink\" title=\"Q&amp;A\"></a>Q&amp;A</h2><ol>\n<li>既然是组件，那肯定走了<code>React.createElement</code>方法，</li>\n<li>JSX 语法是看不到<code>React.createElement</code>调用的，中间一定存在转化</li>\n<li>React 官方 和 babel 官方 合作，以去掉 React 引用</li>\n<li>中间执行转化的就是<code>babel</code>（js 语法解析器是 babel）</li>\n</ol>\n<h2 id=\"babel\"><a href=\"#babel\" class=\"headerlink\" title=\"babel\"></a>babel</h2><p><a href=\"https://www.babeljs.cn/repl#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&build=&builtIns=false&corejs=3.21&spec=false&loose=false&code_lz=DwJQpghgxgLgdAZRgJwJawLIHsAmYB8AUAATHA6oBuxRppwADsQM4wCeANmALwDevULByzIAXMQDkyMDgkBfOcSwA7AMId0Aaz4ALCMpxd1WufgCMAJkvAA9A1p1GxVDm4SzE81Yu37JR0yaYGzcAEQ6YBzCoV7Wdg62FJQJDgCQAGLIEADmALZgyjD-tgng0PCZOfmFDqSVeQUwFsU2ZbBw9dUwRLZt8EhomLgEQA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&timeTravel=false&sourceType=module&lineWrap=true&presets=env%2Creact&prettier=true&targets=&version=7.21.2&externalPlugins=&assumptions=%7B%7D\" target=\"_blank\" >见</a></p>\n<h3 id=\"时间穿梭图\"><a href=\"#时间穿梭图\" class=\"headerlink\" title=\"时间穿梭图\"></a>时间穿梭图</h3><img src=\"http://t-blog-images.aijs.top/img/202303101737542.webp\" />\n\n<h3 id=\"完整图\"><a href=\"#完整图\" class=\"headerlink\" title=\"完整图\"></a>完整图</h3><img src=\"http://t-blog-images.aijs.top/img/202303101741060.webp\" />\n\n<p><strong>看上去没有 <a href=\"https://astexplorer.net/\">ast explore</a>（JSON 格式） 那么好看，ast explore 上没有 react 相关的，所以吧，凑合着看</strong></p>\n<ol>\n<li>至此，与入口文件处的 symble 对应上了，在源码中不存在 StrictMode 组件，也说明了在源码中找组件的方式，是找不到的</li>\n<li>序号 1 对应 fiber 的 tag, <a href=\"https://beta.reactjs.org/reference/react/createElement\" target=\"_blank\" >React.createElement</a></li>\n<li>序号 2 属性 <code>properties</code> 相关</li>\n<li>序号 3 子节点</li>\n</ol>\n<p><strong>createElement 源码也可一探究竟，其对参数 1、参数 2、参数 3 的处理</strong></p>\n<p><a href=\"https://github.com/facebook/react/blob/d1ad984db1591b131d16739a24dee4ba44886a09/packages/react/src/ReactElement.js#L362\" target=\"_blank\" >见</a></p>\n<h2 id=\"ast-explore\"><a href=\"#ast-explore\" class=\"headerlink\" title=\"ast explore\"></a>ast explore</h2><img src=\"http://t-blog-images.aijs.top/img/202303101819397.webp\" />\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>在找<code>StrictMode</code>组件的过程中，</p>\n<ol>\n<li>学到了 babel 会将 jsx 转化啥样子</li>\n<li>一个变量怎么就可以当组件用了</li>\n</ol>\n<h2 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h2><ol>\n<li><a href=\"https://github.com/facebook/react/blob/d1ad984db1591b131d16739a24dee4ba44886a09/packages/react/src/ReactElement.js#L362\" target=\"_blank\" >React.createElement 源码</a></li>\n<li><a href=\"https://www.babeljs.cn/repl#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&build=&builtIns=false&corejs=3.21&spec=false&loose=false&code_lz=DwJQpghgxgLgdAZRgJwJawLIHsAmYB8AUAATHA6oBuxRppwADsQM4wCeANmALwDevULByzIAXMQDkyMDgkBfOcSwA7AMId0Aaz4ALCMpxd1WufgCMAJkvAA9A1p1GxVDm4SzE81Yu37JR0yaYGzcAEQ6YBzCoV7Wdg62FJQJDgCQAGLIEADmALZgyjD-tgng0PCZOfmFDqSVeQUwFsU2ZbBw9dUwRLZt8EhomLgEQA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&timeTravel=false&sourceType=module&lineWrap=true&presets=env%2Creact&prettier=true&targets=&version=7.21.2&externalPlugins=&assumptions=%7B%7D\" target=\"_blank\" >babel playground</a></li>\n<li><a href=\"https://beta.reactjs.org/reference/react/createElement\" target=\"_blank\" >createelement</a></li>\n<li><a href=\"https://reactjs.org/blog/2022/03/29/react-v18.html\" target=\"_blank\" >18 版本更新内容</a></li>\n</ol>\n","text":"动机 React StrictMode 的源码长什么样子？ 执行过成是什么？为什么是标签，难道 React 内部实现了这个组件？ 查资料搜到的资料都是官网文档 和 React 官方博客 18 版本更新内容 的搬运 翻源码clone react 源码， vscode 搜索一搜 😓，...","link":"","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"React","slug":"React","count":39,"path":"api/categories/React.json"}],"tags":[{"name":"React","slug":"React","count":33,"path":"api/tags/React.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8A%A8%E6%9C%BA\"><span class=\"toc-text\">动机</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%B5%84%E6%96%99\"><span class=\"toc-text\">查资料</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%BF%BB%E6%BA%90%E7%A0%81\"><span class=\"toc-text\">翻源码</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#clone-react-%E6%BA%90%E7%A0%81%EF%BC%8C-vscode-%E6%90%9C%E7%B4%A2\"><span class=\"toc-text\">clone react 源码， vscode 搜索</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%89%BE%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">找入口文件</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Q-amp-A\"><span class=\"toc-text\">Q&amp;A</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#babel\"><span class=\"toc-text\">babel</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%97%B6%E9%97%B4%E7%A9%BF%E6%A2%AD%E5%9B%BE\"><span class=\"toc-text\">时间穿梭图</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%8C%E6%95%B4%E5%9B%BE\"><span class=\"toc-text\">完整图</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ast-explore\"><span class=\"toc-text\">ast explore</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\"><span class=\"toc-text\">参考链接</span></a></li></ol>","author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>举手向苍穹，并非一定要摘到星月</p><p>眼中有光，心中有梦，脚下有路</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"React jsx -> fiber -> dom 的转化","uid":"1a2c0f92af01c15fc4932e397caca413","slug":"2023-03-31createElement","date":"2023-03-13T05:57:13.000Z","updated":"2023-04-18T15:54:59.596Z","comments":true,"path":"api/articles/2023-03-31createElement.json","keywords":null,"cover":[],"text":"读源码基础 位运算 call、apply、bind 原理 链表相关知识(单链表、双链表、循环链表) 节流、防抖原理 ensureRootIsScheduled: if (existingCallbackNode !== null) &#123; 设计模式相关知识 安全相关知识 栈...","link":"","photos":[],"count_time":{"symbolsCount":"9.4k","symbolsTime":"9 mins."},"categories":[{"name":"React","slug":"React","count":39,"path":"api/categories/React.json"}],"tags":[{"name":"React","slug":"React","count":33,"path":"api/tags/React.json"}],"author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>举手向苍穹，并非一定要摘到星月</p><p>眼中有光，心中有梦，脚下有路</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"Object.defineProperty","uid":"547eb37eabbf2632d492b2d3c42b55d1","slug":"2023-03-09defineProperty","date":"2023-03-09T07:09:55.000Z","updated":"2023-03-09T15:11:24.967Z","comments":true,"path":"api/articles/2023-03-09defineProperty.json","keywords":null,"cover":null,"text":"是什么Object.defineProperty() 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性，并返回此对象 &#x2F;&#x2F; 语法 Object.defineProperty(obj, prop, descriptor); 动机为了精确地添加或修...","link":"","photos":[],"count_time":{"symbolsCount":"5.9k","symbolsTime":"5 mins."},"categories":[{"name":"前端基础","slug":"前端基础","count":54,"path":"api/categories/前端基础.json"}],"tags":[{"name":"前端基础","slug":"前端基础","count":56,"path":"api/tags/前端基础.json"}],"author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>举手向苍穹，并非一定要摘到星月</p><p>眼中有光，心中有梦，脚下有路</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}