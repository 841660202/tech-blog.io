{"title":"AbortController å–æ¶ˆè¯·æ±‚","uid":"c80e8e10d9dca59bf6892c0788404a9e","slug":"2022-09-14cancel","date":"2022-09-14T13:06:23.000Z","updated":"2022-09-15T14:26:11.089Z","comments":true,"path":"api/articles/2022-09-14cancel.json","keywords":null,"cover":[],"content":"<h2 id=\"å–æ¶ˆè¯·æ±‚\"><a href=\"#å–æ¶ˆè¯·æ±‚\" class=\"headerlink\" title=\"å–æ¶ˆè¯·æ±‚\"></a>å–æ¶ˆè¯·æ±‚</h2><p>åœ¨ç½‘ä¸Šèƒ¡ä¹±ç¿»ç¿»ï¼Œæ— æ„ä¸­åˆç¿»åˆ° MDN çœ‹åˆ°äº†</p>\n<h2 id=\"AbortController\"><a href=\"#AbortController\" class=\"headerlink\" title=\"AbortController\"></a>AbortController</h2><p>AbortController æ¥å£è¡¨ç¤ºä¸€ä¸ªæ§åˆ¶å™¨å¯¹è±¡ï¼Œå…è®¸ä½ æ ¹æ®éœ€è¦ä¸­æ­¢ä¸€ä¸ªæˆ–å¤šä¸ª Web è¯·æ±‚ã€‚</p>\n<p><strong>æ„é€ å‡½æ•°</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">AbortController.AbortController();\n&#x2F;&#x2F; åˆ›å»ºä¸€ä¸ªæ–°çš„ AbortController å¯¹è±¡å®ä¾‹ã€‚</code></pre>\n\n<p><strong>å±æ€§</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">AbortController.signal; &#x2F;&#x2F; åªè¯»\n&#x2F;&#x2F; è¿”å›ä¸€ä¸ª AbortSignal å¯¹è±¡å®ä¾‹ï¼Œå®ƒå¯ä»¥ç”¨æ¥ with&#x2F;abort ä¸€ä¸ª Webï¼ˆç½‘ç»œï¼‰è¯·æ±‚ã€‚</code></pre>\n\n<p><strong>æ–¹æ³•</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">AbortController.abort();\n&#x2F;&#x2F; ä¸­æ­¢ä¸€ä¸ªå°šæœªå®Œæˆçš„ Webï¼ˆç½‘ç»œï¼‰è¯·æ±‚ã€‚è¿™èƒ½å¤Ÿä¸­æ­¢ fetch è¯·æ±‚åŠä»»ä½•å“åº”ä½“çš„æ¶ˆè´¹å’Œæµã€‚</code></pre>\n\n<p>å¯¹äºå–æ¶ˆè¯·æ±‚ï¼Œæˆ‘ä¹‹å‰ç†è§£çš„ä¼˜ç‚¹åå·®ï¼Œæˆ‘ä¹‹å‰ç†è§£çš„æ˜¯ï¼špromise æå‰è¿”å›å°±æŠŠè¯·æ±‚å–æ¶ˆæ‰äº†ï¼Œç±»ä¼¼ race,ç„¶è€Œå¹¶éå¦‚æ­¤</p>\n<img src=\"http://t-blog-images.aijs.top/img/202209142113959.png\" />\n\n<p>å½“ä¸€ä¸ª fetch request åˆå§‹åŒ–ï¼Œæˆ‘ä»¬æŠŠ AbortSignal ä½œä¸ºä¸€ä¸ªé€‰é¡¹ä¼ é€’åˆ°åˆ°è¯·æ±‚å¯¹è±¡ï¼ˆå¦‚ä¸‹ { signal }ï¼‰ã€‚è¿™å°† signal å’Œ controller ä¸è¿™ä¸ª fetch request ç›¸å…³è”ï¼Œç„¶åå…è®¸æˆ‘ä»¬é€šè¿‡è°ƒç”¨ AbortController.abort() ä¸­æ­¢è¯·æ±‚ï¼Œå¦‚ä¸‹ç¬¬äºŒä¸ªäº‹ä»¶ç›‘å¬å‡½æ•°ã€‚</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">let controller;\nconst url &#x3D; &quot;video.mp4&quot;;\n\nconst downloadBtn &#x3D; document.querySelector(&quot;.download&quot;);\nconst abortBtn &#x3D; document.querySelector(&quot;.abort&quot;);\n\ndownloadBtn.addEventListener(&quot;click&quot;, fetchVideo);\n\nabortBtn.addEventListener(&quot;click&quot;, () &#x3D;&gt; &#123;\n  if (controller) &#123;\n    controller.abort();\n    console.log(&quot;ä¸­æ­¢ä¸‹è½½&quot;);\n  &#125;\n&#125;);\n\nfunction fetchVideo() &#123;\n  controller &#x3D; new AbortController();\n  const signal &#x3D; controller.signal;\n  fetch(url, &#123; signal &#125;)\n    .then((response) &#x3D;&gt; &#123;\n      console.log(&quot;ä¸‹è½½å®Œæˆ&quot;, response);\n    &#125;)\n    .catch((err) &#x3D;&gt; &#123;\n      console.error(&#96;ä¸‹è½½é”™è¯¯ï¼š$&#123;err.message&#125;&#96;);\n    &#125;);\n&#125;</code></pre>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>å¤‡æ³¨ï¼š å½“ abort() è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ª fetch() promise å°† reject ä¸€ä¸ªåä¸º AbortError çš„ DOMExceptionã€‚</p>\n</div>\n<h2 id=\"axios\"><a href=\"#axios\" class=\"headerlink\" title=\"axios\"></a>axios</h2><img src=\"http://t-blog-images.aijs.top/img/202209142107002.png\" />\n\n<img src=\"http://t-blog-images.aijs.top/img/202209142106275.png\" />\n\n<p><a href=\"https://github.com/axios/axios/blob/649d739288c8e2c55829ac60e2345a0f3439c730/lib/adapters/xhr.js#L217\" target=\"_blank\" >axios adapters xhr</a></p>\n<img src=\"http://t-blog-images.aijs.top/img/202209142118467.png\" />\n\n<h2 id=\"å‚è€ƒé“¾æ¥\"><a href=\"#å‚è€ƒé“¾æ¥\" class=\"headerlink\" title=\"å‚è€ƒé“¾æ¥\"></a>å‚è€ƒé“¾æ¥</h2><p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController\" target=\"_blank\" >AbortController</a></p>\n<p><a href=\"https://axios-http.com/zh/docs/cancellation\" target=\"_blank\" >axios-http.com</a></p>\n<p><a href=\"https://github.com/axios/axios#abortcontroller\" target=\"_blank\" >github axios</a></p>\n","text":"å–æ¶ˆè¯·æ±‚åœ¨ç½‘ä¸Šèƒ¡ä¹±ç¿»ç¿»ï¼Œæ— æ„ä¸­åˆç¿»åˆ° MDN çœ‹åˆ°äº† AbortControllerAbortController æ¥å£è¡¨ç¤ºä¸€ä¸ªæ§åˆ¶å™¨å¯¹è±¡ï¼Œå…è®¸ä½ æ ¹æ®éœ€è¦ä¸­æ­¢ä¸€ä¸ªæˆ–å¤šä¸ª Web è¯·æ±‚ã€‚ æ„é€ å‡½æ•° AbortController.AbortController(); &#x2F;&...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"å‰ç«¯åŸºç¡€","slug":"å‰ç«¯åŸºç¡€","count":27,"path":"api/categories/å‰ç«¯åŸºç¡€.json"}],"tags":[{"name":"å‰ç«¯åŸºç¡€","slug":"å‰ç«¯åŸºç¡€","count":29,"path":"api/tags/å‰ç«¯åŸºç¡€.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82\"><span class=\"toc-text\">å–æ¶ˆè¯·æ±‚</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#AbortController\"><span class=\"toc-text\">AbortController</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#axios\"><span class=\"toc-text\">axios</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\"><span class=\"toc-text\">å‚è€ƒé“¾æ¥</span></a></li></ol>","author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"å¾…åŠäº‹é¡¹","uid":"c370dd6ecfc84fe9fdfa77b1a6f29341","slug":"todo","date":"2022-12-14T03:59:59.000Z","updated":"2022-09-15T14:26:11.103Z","comments":true,"path":"api/articles/todo.json","keywords":null,"cover":[],"text":"ç‰¹æ®Šè®°å¿† &#x2F;&#x2F; 1. headless-recorder &#x2F;&#x2F; 2. lightHouse https:&#x2F;&#x2F;blog.csdn.net&#x2F;tangdou369098655&#x2F;article&#x2F;de...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"Todo","slug":"Todo","count":1,"path":"api/categories/Todo.json"}],"tags":[{"name":"Todo","slug":"Todo","count":1,"path":"api/tags/Todo.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"webviewåº”ç”¨","uid":"ed5cd7890f7f44ca244b6e91a3c180a3","slug":"2022-09-13webview","date":"2022-09-13T14:10:02.000Z","updated":"2022-09-15T14:26:11.083Z","comments":true,"path":"api/articles/2022-09-13webview.json","keywords":null,"cover":[],"text":"h5 webviewåº”ç”¨å¾ˆå¹¿å•Šï¼Œå¹³æ—¶è¿˜çœŸæ²¡æ„Ÿè§‰åˆ°æ˜¯ h5 é¡µé¢æ¸²æŸ“çš„å†…å®¹ï¼ŒæŠ¥é”™äº†æ‰çŸ¥é“ æ”¯ä»˜å®ä¼šå‘˜ B ç«™ ç›´æ’­ æ˜é‡‘æ–‡ç« è¯¦æƒ… ","link":"","photos":[],"count_time":{"symbolsCount":66,"symbolsTime":"1 mins."},"categories":[{"name":"h5","slug":"h5","count":1,"path":"api/categories/h5.json"}],"tags":[{"name":"h5","slug":"h5","count":1,"path":"api/tags/h5.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}