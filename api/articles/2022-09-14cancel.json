{"title":"AbortController 取消请求","uid":"c80e8e10d9dca59bf6892c0788404a9e","slug":"2022-09-14cancel","date":"2022-09-14T13:06:23.000Z","updated":"2022-09-16T13:54:56.329Z","comments":true,"path":"api/articles/2022-09-14cancel.json","keywords":null,"cover":[],"content":"<h2 id=\"取消请求\"><a href=\"#取消请求\" class=\"headerlink\" title=\"取消请求\"></a>取消请求</h2><p>在网上胡乱翻翻，无意中又翻到 MDN 看到了</p>\n<h2 id=\"AbortController\"><a href=\"#AbortController\" class=\"headerlink\" title=\"AbortController\"></a>AbortController</h2><p>AbortController 接口表示一个控制器对象，允许你根据需要中止一个或多个 Web 请求。</p>\n<p><strong>构造函数</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">AbortController.AbortController();\n&#x2F;&#x2F; 创建一个新的 AbortController 对象实例。</code></pre>\n\n<p><strong>属性</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">AbortController.signal; &#x2F;&#x2F; 只读\n&#x2F;&#x2F; 返回一个 AbortSignal 对象实例，它可以用来 with&#x2F;abort 一个 Web（网络）请求。</code></pre>\n\n<p><strong>方法</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">AbortController.abort();\n&#x2F;&#x2F; 中止一个尚未完成的 Web（网络）请求。这能够中止 fetch 请求及任何响应体的消费和流。</code></pre>\n\n<p>对于取消请求，我之前理解的优点偏差，我之前理解的是：promise 提前返回就把请求取消掉了，类似 race,然而并非如此</p>\n<img src=\"http://t-blog-images.aijs.top/img/202209142113959.png\" />\n\n<p>当一个 fetch request 初始化，我们把 AbortSignal 作为一个选项传递到到请求对象（如下 { signal }）。这将 signal 和 controller 与这个 fetch request 相关联，然后允许我们通过调用 AbortController.abort() 中止请求，如下第二个事件监听函数。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">let controller;\nconst url &#x3D; &quot;video.mp4&quot;;\n\nconst downloadBtn &#x3D; document.querySelector(&quot;.download&quot;);\nconst abortBtn &#x3D; document.querySelector(&quot;.abort&quot;);\n\ndownloadBtn.addEventListener(&quot;click&quot;, fetchVideo);\n\nabortBtn.addEventListener(&quot;click&quot;, () &#x3D;&gt; &#123;\n  if (controller) &#123;\n    controller.abort();\n    console.log(&quot;中止下载&quot;);\n  &#125;\n&#125;);\n\nfunction fetchVideo() &#123;\n  controller &#x3D; new AbortController();\n  const signal &#x3D; controller.signal;\n  fetch(url, &#123; signal &#125;)\n    .then((response) &#x3D;&gt; &#123;\n      console.log(&quot;下载完成&quot;, response);\n    &#125;)\n    .catch((err) &#x3D;&gt; &#123;\n      console.error(&#96;下载错误：$&#123;err.message&#125;&#96;);\n    &#125;);\n&#125;</code></pre>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>备注： 当 abort() 被调用时，这个 fetch() promise 将 reject 一个名为 AbortError 的 DOMException。</p>\n</div>\n<h2 id=\"axios\"><a href=\"#axios\" class=\"headerlink\" title=\"axios\"></a>axios</h2><img src=\"http://t-blog-images.aijs.top/img/202209142107002.png\" />\n\n<img src=\"http://t-blog-images.aijs.top/img/202209142106275.png\" />\n\n<p><a href=\"https://github.com/axios/axios/blob/649d739288c8e2c55829ac60e2345a0f3439c730/lib/adapters/xhr.js#L217\" target=\"_blank\" >axios adapters xhr</a></p>\n<img src=\"http://t-blog-images.aijs.top/img/202209142118467.png\" />\n\n<h2 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h2><p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController\" target=\"_blank\" >AbortController</a></p>\n<p><a href=\"https://axios-http.com/zh/docs/cancellation\" target=\"_blank\" >axios-http.com</a></p>\n<p><a href=\"https://github.com/axios/axios#abortcontroller\" target=\"_blank\" >github axios</a></p>\n","text":"取消请求在网上胡乱翻翻，无意中又翻到 MDN 看到了 AbortControllerAbortController 接口表示一个控制器对象，允许你根据需要中止一个或多个 Web 请求。 构造函数 AbortController.AbortController(); &#x2F;&...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"前端基础","slug":"前端基础","count":47,"path":"api/categories/前端基础.json"}],"tags":[{"name":"前端基础","slug":"前端基础","count":49,"path":"api/tags/前端基础.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82\"><span class=\"toc-text\">取消请求</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#AbortController\"><span class=\"toc-text\">AbortController</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#axios\"><span class=\"toc-text\">axios</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\"><span class=\"toc-text\">参考链接</span></a></li></ol>","author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"眼中有光，心中有梦，脚下有路","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Hexo 源码","uid":"f54d504d52d1875fefca7d88d3a6e051","slug":"2022-09-16hexo源码","date":"2022-09-16T01:15:22.000Z","updated":"2022-09-20T12:23:35.409Z","comments":true,"path":"api/articles/2022-09-16hexo源码.json","keywords":null,"cover":[],"text":"项目依赖 # tree -L 2 -I .pnpm . ├── hexo -&gt; .pnpm&#x2F;hexo@6.2.0&#x2F;node_modules&#x2F;hexo ├── hexo-browsersync -&gt; .pnpm&#x2F;hexo-brow...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"hexo","slug":"hexo","count":2,"path":"api/categories/hexo.json"}],"tags":[{"name":"hexo","slug":"hexo","count":4,"path":"api/tags/hexo.json"}],"author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"眼中有光，心中有梦，脚下有路","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"webview应用","uid":"ed5cd7890f7f44ca244b6e91a3c180a3","slug":"2022-09-13webview","date":"2022-09-13T14:10:02.000Z","updated":"2022-09-16T13:54:56.325Z","comments":true,"path":"api/articles/2022-09-13webview.json","keywords":null,"cover":[],"text":"h5 webview应用很广啊，平时还真没感觉到是 h5 页面渲染的内容，报错了才知道 支付宝会员 B 站 直播 掘金文章详情 ","link":"","photos":[],"count_time":{"symbolsCount":66,"symbolsTime":"1 mins."},"categories":[{"name":"h5","slug":"h5","count":1,"path":"api/categories/h5.json"}],"tags":[{"name":"h5","slug":"h5","count":1,"path":"api/tags/h5.json"}],"author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"眼中有光，心中有梦，脚下有路","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}