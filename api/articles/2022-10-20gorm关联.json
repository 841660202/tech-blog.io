{"title":"gorm 关联","uid":"1e93951633e1850ed62331ad3c63ff79","slug":"2022-10-20gorm关联","date":"2022-10-20T08:46:50.000Z","updated":"2022-10-21T12:45:30.510Z","comments":true,"path":"api/articles/2022-10-20gorm关联.json","keywords":null,"cover":null,"content":"<h2 id=\"playground\"><a href=\"#playground\" class=\"headerlink\" title=\"playground\"></a>playground</h2><p><a href=\"https://github.com/go-gorm/playground/blob/master/models.go\" target=\"_blank\" >playground</a></p>\n<pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">package main\n\nimport (\n\t&quot;database&#x2F;sql&quot;\n\t&quot;time&quot;\n\n\t&quot;gorm.io&#x2F;gorm&quot;\n)\n\n&#x2F;&#x2F; User has one &#96;Account&#96; (has one), many &#96;Pets&#96; (has many) and &#96;Toys&#96; (has many - polymorphic)\n&#x2F;&#x2F; He works in a Company (belongs to), he has a Manager (belongs to - single-table), and also managed a Team (has many - single-table)\n&#x2F;&#x2F; He speaks many languages (many to many) and has many friends (many to many - single-table)\n&#x2F;&#x2F; His pet also has one Toy (has one - polymorphic)\n\n&#x2F;&#x2F;用户有一个“帐户”（有一个），多个“宠物”（有很多）和“玩具”（有许多多态性）\n&#x2F;&#x2F;他在一家公司工作（属于），他有一个经理（属于-单表），还管理一个团队（有多-单表）\n&#x2F;&#x2F;他会说多种语言（多对多），有许多朋友（多对多-单表）\n&#x2F;&#x2F;他的宠物也有一个玩具（有一个多态性）\ntype User struct &#123;\n\tgorm.Model\n\tName      string\n\tAge       uint\n\tBirthday  *time.Time\n  &#x2F;&#x2F; has one\n\tAccount   Account &#x2F;&#x2F; 有一个“帐户”（有一个）\n  &#x2F;&#x2F; has many 这两个怎么不一样？\n  &#x2F;&#x2F; 反向引用\n\tPets      []*Pet &#x2F;&#x2F; 有多个宠物\n  &#x2F;&#x2F; has many\n\tToys      []Toy &#96;gorm:&quot;polymorphic:Owner&quot;&#96; &#x2F;&#x2F; 有多个玩具\n  &#x2F;&#x2F; belong to\n\tCompanyID *int &#x2F;&#x2F; 在一家公司工作（属于）\n\tCompany   Company &#x2F;&#x2F; 在一家公司工作（属于）\n  &#x2F;&#x2F; belong to\n\tManagerID *uint &#x2F;&#x2F; 他有一个经理（属于-单表）\n\tManager   *User &#x2F;&#x2F; 他有一个经理（属于-单表）\n  &#x2F;&#x2F; has many\n\tTeam      []User     &#96;gorm:&quot;foreignkey:ManagerID&quot;&#96; &#x2F;&#x2F; 还管理一个团队（有多个单表）\n  &#x2F;&#x2F; many 2 many\n\tLanguages []Language &#96;gorm:&quot;many2many:UserSpeak&quot;&#96; &#x2F;&#x2F; 他会说多种语言（多对多）\n  &#x2F;&#x2F; many 2 many\n\tFriends   []*User    &#96;gorm:&quot;many2many:user_friends&quot;&#96; &#x2F;&#x2F; 有许多朋友（多对多-单表）\n\tActive    bool\n&#125;\n&#x2F;&#x2F; 账号表\ntype Account struct &#123;\n\tgorm.Model\n\tUserID sql.NullInt64\n\tNumber string\n&#125;\n &#x2F;&#x2F; 宠物表\ntype Pet struct &#123;\n\tgorm.Model\n\tUserID *uint\n\tName   string\n\tToy    Toy &#96;gorm:&quot;polymorphic:Owner;&quot;&#96; &#x2F;&#x2F; polymorphic 处理多态，多态\n  &#x2F;&#x2F; 主键放到 OwnerID ，表名放到 OwnerType\n  &#x2F;&#x2F; link: https:&#x2F;&#x2F;learnku.com&#x2F;docs&#x2F;gorm&#x2F;v2&#x2F;has_one&#x2F;9737#85d280\n&#125;\n&#x2F;&#x2F; 玩具表\ntype Toy struct &#123;\n\tgorm.Model\n\tName      string\n\tOwnerID   string\n\tOwnerType string\n&#125;\n&#x2F;&#x2F; 公司表\ntype Company struct &#123; &#x2F;&#x2F; 属于\n\tID   int\n\tName string\n&#125;\n&#x2F;&#x2F; 语言表\ntype Language struct &#123; &#x2F;&#x2F; 多种语言\n\tCode string &#96;gorm:&quot;primarykey&quot;&#96;\n\tName string\n&#125;</code></pre>\n\n<h2 id=\"Belong-to\"><a href=\"#Belong-to\" class=\"headerlink\" title=\"Belong to\"></a>Belong to</h2><h3 id=\"belong-to-属于\"><a href=\"#belong-to-属于\" class=\"headerlink\" title=\"belong to 属于\"></a>belong to 属于</h3><h3 id=\"has-one-拥有\"><a href=\"#has-one-拥有\" class=\"headerlink\" title=\"has one 拥有\"></a>has one 拥有</h3><p><a href=\"https://gorm.io/zh_CN/docs/has_one.html\" target=\"_blank\" >见</a></p>\n<h3 id=\"谁是拥有者\"><a href=\"#谁是拥有者\" class=\"headerlink\" title=\"谁是拥有者\"></a>谁是拥有者</h3><pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">&#x2F;&#x2F; User 有一张 CreditCard，UserID 是外键\ntype User struct &#123; &#x2F;&#x2F; 拥有者\n  gorm.Model\n  CreditCard CreditCard\n&#125;\n\ntype CreditCard struct &#123;\n  gorm.Model\n  Number string\n  UserID uint &#x2F;&#x2F; 拥有者模型的主键\n&#125;</code></pre>\n\n<h3 id=\"什么是外键\"><a href=\"#什么是外键\" class=\"headerlink\" title=\"什么是外键\"></a>什么是外键</h3><p>外键是某个表中的一列，它包含在另一个表的主键中。<br>外键也是索引的一种，是通过一张表中的一列指向另一张表中的主键，来对两张表进行关联。</p>\n<h3 id=\"重写外键\"><a href=\"#重写外键\" class=\"headerlink\" title=\"重写外键\"></a>重写外键</h3><pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">type User struct &#123;\n  gorm.Model\n  CreditCard CreditCard &#96;gorm:&quot;foreignKey:UserName&quot;&#96; &#x2F;&#x2F; 使用 UserName 作为外键\n&#125;\n\ntype CreditCard struct &#123;\n  gorm.Model\n  Number   string\n  UserName string &#x2F;&#x2F; 这里是外键\n&#125;</code></pre>\n\n<h3 id=\"重写引用-注意-官方文档存在问题，已提-issue\"><a href=\"#重写引用-注意-官方文档存在问题，已提-issue\" class=\"headerlink\" title=\"重写引用 注意 官方文档存在问题，已提 issue\"></a>重写引用 注意 官方文档存在问题，已提 issue</h3><pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">type User struct &#123;\n  gorm.Model\n  Name       string     &#96;gorm:&quot;index&quot;&#96; &#x2F;&#x2F; 这个是引用，对应 references\n  CreditCard CreditCard &#96;gorm:&quot;foreignkey:UserName;references:name&quot;&#96;\n&#125;\n\ntype CreditCard struct &#123;\n  gorm.Model\n  Number   string\n  UserName string\n&#125;</code></pre>\n\n<p><a href=\"https://github.com/go-gorm/gorm/issues/5793\" target=\"_blank\" >#5793</a></p>\n<h2 id=\"Has-one\"><a href=\"#Has-one\" class=\"headerlink\" title=\"Has one\"></a>Has one</h2><h2 id=\"Has-many\"><a href=\"#Has-many\" class=\"headerlink\" title=\"Has many\"></a>Has many</h2><h2 id=\"Many-to-many\"><a href=\"#Many-to-many\" class=\"headerlink\" title=\"Many to many\"></a>Many to many</h2>","text":"playgroundplayground package main import ( &quot;database&#x2F;sql&quot; &quot;time&quot; &quot;gorm.io&#x2F;gorm&quot; ) &#x2F;&#x2F; User ...","link":"","photos":[],"count_time":{"symbolsCount":"3.5k","symbolsTime":"3 mins."},"categories":[{"name":"Go","slug":"Go","count":9,"path":"api/categories/Go.json"}],"tags":[{"name":"Go","slug":"Go","count":9,"path":"api/tags/Go.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#playground\"><span class=\"toc-text\">playground</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Belong-to\"><span class=\"toc-text\">Belong to</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#belong-to-%E5%B1%9E%E4%BA%8E\"><span class=\"toc-text\">belong to 属于</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#has-one-%E6%8B%A5%E6%9C%89\"><span class=\"toc-text\">has one 拥有</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%B0%81%E6%98%AF%E6%8B%A5%E6%9C%89%E8%80%85\"><span class=\"toc-text\">谁是拥有者</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AF%E5%A4%96%E9%94%AE\"><span class=\"toc-text\">什么是外键</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%87%8D%E5%86%99%E5%A4%96%E9%94%AE\"><span class=\"toc-text\">重写外键</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%87%8D%E5%86%99%E5%BC%95%E7%94%A8-%E6%B3%A8%E6%84%8F-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98%EF%BC%8C%E5%B7%B2%E6%8F%90-issue\"><span class=\"toc-text\">重写引用 注意 官方文档存在问题，已提 issue</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Has-one\"><span class=\"toc-text\">Has one</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Has-many\"><span class=\"toc-text\">Has many</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Many-to-many\"><span class=\"toc-text\">Many to many</span></a></li></ol>","author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"生活不止眼前的苟且，还有诗和远方","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"gorm migrate 注意点","uid":"1269a76e445b052b3fd7442cae906b92","slug":"2022-10-21gorm-migrate","date":"2022-10-21T02:04:16.000Z","updated":"2022-10-21T12:45:30.510Z","comments":true,"path":"api/articles/2022-10-21gorm-migrate.json","keywords":null,"cover":null,"text":"等效语句添加、删除会报错 &#x2F;&#x2F; ... type User struct &#123; gorm.Model Name string &#96;gorm:&quot;size:255;index:idx_name,unique&quot;&#96; &#125...","link":"","photos":[],"count_time":{"symbolsCount":"8.2k","symbolsTime":"7 mins."},"categories":[{"name":"Go","slug":"Go","count":9,"path":"api/categories/Go.json"}],"tags":[{"name":"Go","slug":"Go","count":9,"path":"api/tags/Go.json"}],"author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"生活不止眼前的苟且，还有诗和远方","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"前端基础-js表达式","uid":"5920bc0e327b10c465c146c4b5f81619","slug":"2022-10-19js表达式","date":"2022-10-19T10:00:07.000Z","updated":"2022-11-26T07:05:03.115Z","comments":true,"path":"api/articles/2022-10-19js表达式.json","keywords":null,"cover":[],"text":"1. 逗号操作符, 没你想象的那么简单对它的每个操作数求值（从左到右），并返回最后一个操作数的值。 let x &#x3D; 1; x &#x3D; (x++, x); console.log(x); &#x2F;&#x2F; expected output: 2 x &#x3D...","link":"","photos":[],"count_time":{"symbolsCount":"7.8k","symbolsTime":"7 mins."},"categories":[{"name":"前端基础","slug":"前端基础","count":39,"path":"api/categories/前端基础.json"}],"tags":[{"name":"前端基础","slug":"前端基础","count":41,"path":"api/tags/前端基础.json"}],"author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"生活不止眼前的苟且，还有诗和远方","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}