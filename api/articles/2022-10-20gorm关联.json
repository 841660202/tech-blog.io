{"title":"gorm 关联","uid":"1e93951633e1850ed62331ad3c63ff79","slug":"2022-10-20gorm关联","date":"2022-10-20T08:46:50.000Z","updated":"2022-12-11T11:55:38.221Z","comments":true,"path":"api/articles/2022-10-20gorm关联.json","keywords":null,"cover":[],"content":"<h2 id=\"打开认知\"><a href=\"#打开认知\" class=\"headerlink\" title=\"打开认知\"></a>打开认知</h2><h3 id=\"belong-to-属于\"><a href=\"#belong-to-属于\" class=\"headerlink\" title=\"belong to 属于\"></a>belong to 属于</h3><img src=\"http://t-blog-images.aijs.top/img/202212062125482.webp\" />\n\n<h3 id=\"has-one-拥有\"><a href=\"#has-one-拥有\" class=\"headerlink\" title=\"has one 拥有\"></a>has one 拥有</h3><img src=\"http://t-blog-images.aijs.top/img/202212062130965.webp\" />\n\n<h3 id=\"belong-to-vs-has-one\"><a href=\"#belong-to-vs-has-one\" class=\"headerlink\" title=\"belong to vs has one\"></a>belong to vs has one</h3><ul>\n<li>B belong to A : B 结构体和 B 的 ID 都 A 在结构体中</li>\n<li>A has one B: A 的 id 在 B 结构体中，B 的结构体在 A 结构体中</li>\n</ul>\n<h3 id=\"Has-many\"><a href=\"#Has-many\" class=\"headerlink\" title=\"Has many\"></a>Has many</h3><img src=\"http://t-blog-images.aijs.top/img/202212062138712.webp\" />\n\n<h3 id=\"belong-to-x2F-has-one-x2F-has-many-总结\"><a href=\"#belong-to-x2F-has-one-x2F-has-many-总结\" class=\"headerlink\" title=\"belong to &#x2F; has one &#x2F; has many 总结\"></a>belong to &#x2F; has one &#x2F; has many 总结</h3><p><code>belong to</code>, <code>has one</code>, <code>has many</code>, id 在哪个结构体中，那么这个结构体对应的数据库表就有外键约束</p>\n<h3 id=\"Many-to-many\"><a href=\"#Many-to-many\" class=\"headerlink\" title=\"Many to many\"></a>Many to many</h3><img src=\"http://t-blog-images.aijs.top/img/202212062146023.webp\" />\n\n<h3 id=\"Many-to-many-总结\"><a href=\"#Many-to-many-总结\" class=\"headerlink\" title=\"Many to many 总结\"></a>Many to many 总结</h3><ul>\n<li>many2many 在哪个结构体中，哪个结构体就能创建全部的表</li>\n<li>外键约束都在关联表中，非关联表，各自为简单表</li>\n</ul>\n<h2 id=\"playground\"><a href=\"#playground\" class=\"headerlink\" title=\"playground\"></a>playground</h2><p><a href=\"https://github.com/go-gorm/playground/blob/master/models.go\" target=\"_blank\" >playground</a></p>\n<pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">package main\n\nimport (\n\t&quot;database&#x2F;sql&quot;\n\t&quot;time&quot;\n\n\t&quot;gorm.io&#x2F;gorm&quot;\n)\n\n&#x2F;&#x2F; User has one &#96;Account&#96; (has one), many &#96;Pets&#96; (has many) and &#96;Toys&#96; (has many - polymorphic)\n&#x2F;&#x2F; He works in a Company (belongs to), he has a Manager (belongs to - single-table), and also managed a Team (has many - single-table)\n&#x2F;&#x2F; He speaks many languages (many to many) and has many friends (many to many - single-table)\n&#x2F;&#x2F; His pet also has one Toy (has one - polymorphic)\n\n&#x2F;&#x2F;用户有一个“帐户”（有一个），多个“宠物”（有很多）和“玩具”（有许多多态性）\n&#x2F;&#x2F;他在一家公司工作（属于），他有一个经理（属于-单表），还管理一个团队（有多-单表）\n&#x2F;&#x2F;他会说多种语言（多对多），有许多朋友（多对多-单表）\n&#x2F;&#x2F;他的宠物也有一个玩具（有一个多态性）\ntype User struct &#123;\n\tgorm.Model\n\tName      string\n\tAge       uint\n\tBirthday  *time.Time\n  &#x2F;&#x2F; has one\n\tAccount   Account &#x2F;&#x2F; 有一个“帐户”（有一个）\n  &#x2F;&#x2F; has many 这两个怎么不一样？\n  &#x2F;&#x2F; 反向引用\n\tPets      []*Pet &#x2F;&#x2F; 有多个宠物\n  &#x2F;&#x2F; has many\n\tToys      []Toy &#96;gorm:&quot;polymorphic:Owner&quot;&#96; &#x2F;&#x2F; 有多个玩具\n  &#x2F;&#x2F; belong to\n\tCompanyID *int &#x2F;&#x2F; 在一家公司工作（属于）\n\tCompany   Company &#x2F;&#x2F; 在一家公司工作（属于）\n  &#x2F;&#x2F; belong to\n\tManagerID *uint &#x2F;&#x2F; 他有一个经理（属于-单表）\n\tManager   *User &#x2F;&#x2F; 他有一个经理（属于-单表）\n  &#x2F;&#x2F; has many\n\tTeam      []User     &#96;gorm:&quot;foreignkey:ManagerID&quot;&#96; &#x2F;&#x2F; 还管理一个团队（有多个单表）\n  &#x2F;&#x2F; many 2 many\n\tLanguages []Language &#96;gorm:&quot;many2many:UserSpeak&quot;&#96; &#x2F;&#x2F; 他会说多种语言（多对多）\n  &#x2F;&#x2F; many 2 many\n\tFriends   []*User    &#96;gorm:&quot;many2many:user_friends&quot;&#96; &#x2F;&#x2F; 有许多朋友（多对多-单表）\n\tActive    bool\n&#125;\n&#x2F;&#x2F; 账号表\ntype Account struct &#123;\n\tgorm.Model\n\tUserID sql.NullInt64\n\tNumber string\n&#125;\n &#x2F;&#x2F; 宠物表\ntype Pet struct &#123;\n\tgorm.Model\n\tUserID *uint\n\tName   string\n\tToy    Toy &#96;gorm:&quot;polymorphic:Owner;&quot;&#96; &#x2F;&#x2F; polymorphic 处理多态，多态\n  &#x2F;&#x2F; 主键放到 OwnerID ，表名放到 OwnerType\n  &#x2F;&#x2F; link: https:&#x2F;&#x2F;learnku.com&#x2F;docs&#x2F;gorm&#x2F;v2&#x2F;has_one&#x2F;9737#85d280\n&#125;\n&#x2F;&#x2F; 玩具表\ntype Toy struct &#123;\n\tgorm.Model\n\tName      string\n\tOwnerID   string\n\tOwnerType string\n&#125;\n&#x2F;&#x2F; 公司表\ntype Company struct &#123; &#x2F;&#x2F; 属于\n\tID   int\n\tName string\n&#125;\n&#x2F;&#x2F; 语言表\ntype Language struct &#123; &#x2F;&#x2F; 多种语言\n\tCode string &#96;gorm:&quot;primarykey&quot;&#96;\n\tName string\n&#125;</code></pre>\n\n<h2 id=\"Belong-to\"><a href=\"#Belong-to\" class=\"headerlink\" title=\"Belong to\"></a>Belong to</h2><h3 id=\"belong-to-属于-1\"><a href=\"#belong-to-属于-1\" class=\"headerlink\" title=\"belong to 属于\"></a>belong to 属于</h3><img src=\"http://t-blog-images.aijs.top/img/202212062125482.webp\" />\n\n<h3 id=\"has-one-拥有-1\"><a href=\"#has-one-拥有-1\" class=\"headerlink\" title=\"has one 拥有\"></a>has one 拥有</h3><p><a href=\"https://gorm.io/zh_CN/docs/has_one.html\" target=\"_blank\" >见</a></p>\n<h3 id=\"谁是拥有者\"><a href=\"#谁是拥有者\" class=\"headerlink\" title=\"谁是拥有者\"></a>谁是拥有者</h3><pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">&#x2F;&#x2F; User 有一张 CreditCard，UserID 是外键\ntype User struct &#123; &#x2F;&#x2F; 拥有者\n  gorm.Model\n  CreditCard CreditCard\n&#125;\n\ntype CreditCard struct &#123;\n  gorm.Model\n  Number string\n  UserID uint &#x2F;&#x2F; 拥有者模型的主键\n&#125;</code></pre>\n\n<!-- TODO: DELETE -->\n<!-- <img src=\"http://t-blog-images.aijs.top/img/202212062101108.webp\" /> -->\n\n<h3 id=\"什么是外键\"><a href=\"#什么是外键\" class=\"headerlink\" title=\"什么是外键\"></a>什么是外键</h3><p>外键是某个表中的一列，它包含在另一个表的主键中。<br>外键也是索引的一种，是通过一张表中的一列指向另一张表中的主键，来对两张表进行关联。</p>\n<h3 id=\"重写外键（给外键改名字，数据库并没有发生变化）\"><a href=\"#重写外键（给外键改名字，数据库并没有发生变化）\" class=\"headerlink\" title=\"重写外键（给外键改名字，数据库并没有发生变化）\"></a>重写外键（给外键改名字，数据库并没有发生变化）</h3><pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">type User struct &#123;\n  gorm.Model\n  CreditCard CreditCard &#96;gorm:&quot;foreignKey:UserName&quot;&#96; &#x2F;&#x2F; 使用 UserName 作为外键\n&#125;\n\ntype CreditCard struct &#123;\n  gorm.Model\n  Number   string\n  UserName string &#x2F;&#x2F; 这里是外键\n&#125;</code></pre>\n\n<!-- <img src=\"http://t-blog-images.aijs.top/img/202212062118372.webp\" /> -->\n\n<h3 id=\"重写引用-注意-官方文档存在问题，已提-issue\"><a href=\"#重写引用-注意-官方文档存在问题，已提-issue\" class=\"headerlink\" title=\"重写引用 注意 官方文档存在问题，已提 issue\"></a>重写引用 注意 官方文档存在问题，已提 issue</h3><p>重写引用，子表发生变化</p>\n<pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">type User struct &#123;\n  gorm.Model\n  Name       string     &#96;gorm:&quot;index&quot;&#96; &#x2F;&#x2F; 这个是引用，对应 references\n  CreditCard CreditCard &#96;gorm:&quot;foreignkey:UserName;references:name&quot;&#96;\n&#125;\n\ntype CreditCard struct &#123;\n  gorm.Model\n  Number   string\n  UserName string\n&#125;</code></pre>\n\n<p><a href=\"https://github.com/go-gorm/gorm/issues/5793\" target=\"_blank\" >#5793</a></p>\n<h2 id=\"Has-one\"><a href=\"#Has-one\" class=\"headerlink\" title=\"Has one\"></a>Has one</h2><h2 id=\"Has-many-1\"><a href=\"#Has-many-1\" class=\"headerlink\" title=\"Has many\"></a>Has many</h2><img src=\"http://t-blog-images.aijs.top/img/202212062138712.webp\" />\n\n<h2 id=\"Many-to-many-1\"><a href=\"#Many-to-many-1\" class=\"headerlink\" title=\"Many to many\"></a>Many to many</h2><img src=\"http://t-blog-images.aijs.top/img/202212062146023.webp\" />\n\n<h3 id=\"外键约束\"><a href=\"#外键约束\" class=\"headerlink\" title=\"外键约束\"></a>外键约束</h3><pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">type User struct &#123;\n  gorm.Model\n  Languages []Language &#96;gorm:&quot;many2many:user_speaks;&quot;&#96;\n&#125;\n\ntype Language struct &#123;\n  Code string &#96;gorm:&quot;primarykey&quot;&#96;\n  Name string\n&#125;\n\n&#x2F;&#x2F; CREATE TABLE &#96;user_speaks&#96; (&#96;user_id&#96; integer,&#96;language_code&#96; text,PRIMARY KEY (&#96;user_id&#96;,&#96;language_code&#96;),CONSTRAINT &#96;fk_user_speaks_user&#96; FOREIGN KEY (&#96;user_id&#96;) REFERENCES &#96;users&#96;(&#96;id&#96;) ON DELETE SET NULL ON UPDATE CASCADE,CONSTRAINT &#96;fk_user_speaks_language&#96; FOREIGN KEY (&#96;language_code&#96;) REFERENCES &#96;languages&#96;(&#96;code&#96;) ON DELETE SET NULL ON UPDATE CASCADE);</code></pre>\n\n<h3 id=\"重写外键，重写引用\"><a href=\"#重写外键，重写引用\" class=\"headerlink\" title=\"重写外键，重写引用\"></a>重写外键，重写引用</h3><p><a href=\"https://blog.csdn.net/sunriseYJP/article/details/126941577\" target=\"_blank\" >Gorm 中的重写外键和重写引用</a></p>\n<pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">\n&#x2F;&#x2F; 重写前\n\ntype User struct &#123;\n  gorm.Model\n  Languages []Language &#96;gorm:&quot;many2many:user_languages;&quot;&#96;\n&#125;\n\ntype Language struct &#123;\n  gorm.Model\n  Name string\n&#125;\n\n&#x2F;&#x2F; 连接表：user_languages\n&#x2F;&#x2F;   foreign key: user_id, reference: users.id\n&#x2F;&#x2F;   foreign key: language_id, reference: languages.id\n\n&#x2F;&#x2F; id       user_id          language_id\n\ntype User struct &#123;\n    gorm.Model\n    Profiles []Profile &#96;gorm:&quot;many2many:user_profiles;foreignKey:Refer;joinForeignKey:UserReferID;References:UserRefer;joinReferences:ProfileRefer&quot;&#96;\n\t\t&#x2F;&#x2F; many2many:user_profiles; user_profile 多对多连接表名，默认gorm加s -&gt; user_profiles\n\n\t\t&#x2F;&#x2F; foreignKey:Refer;            &#x2F;&#x2F; 当前表的描述信息\n\t\t&#x2F;&#x2F; joinForeignKey:UserReferID;  &#x2F;&#x2F; 中间表的描述信息\n\t\t&#x2F;&#x2F; References:UserRefer 重写引用 &#x2F;&#x2F; 另一表的描述信息\n\t\t&#x2F;&#x2F; joinReferences:ProfileRefer &#x2F;&#x2F; 中间表的描述信息\n\t\t&#x2F;&#x2F; 以上分析结果参考自：&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;gorm.io&#x2F;zh_CN&#x2F;docs&#x2F;many_to_many.html#%E5%A4%8D%E5%90%88%E5%A4%96%E9%94%AE&quot; target&#x3D;&quot;_blank&quot; &gt;复合外键&lt;&#x2F;a&gt;\n\n\n    Refer    uint      &#96;gorm:&quot;index:,unique&quot;&#96;\n&#125;\n\ntype Profile struct &#123;\n    gorm.Model\n    Name      string\n    UserRefer uint &#96;gorm:&quot;index:,unique&quot;&#96;\n&#125;\n\n\n\n\n&#x2F;&#x2F; 重写后\n\n&#x2F;&#x2F; 会创建连接表：user_profiles\n&#x2F;&#x2F;   foreign key: user_refer_id, reference: users.refer\n&#x2F;&#x2F;   foreign key: profile_refer, reference: profiles.user_refer\n\n&#x2F;&#x2F; id         user_refer_id          profile_refer</code></pre>\n\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">\nCREATE TABLE &#96;user_speaks&#96; (\n\t&#96;user_id&#96;  integer,\n\t&#96;language_code&#96; text,\n\t-- 没有id，使用联合主键，还能进行主键索引优化\n\tPRIMARY KEY(&#96;user_id&#96;, &#96;language_code&#96;),\n\t-- user表的约束\n\tCONSTRAINT &#96;fk_user_speaks_user&#96; FOREIGN KEY(&#96;user_id&#96;) REFERENCES &#96;users&#96; (&#96;id&#96;) ON DELETE SET NULL ONUPDATE CASCADE,\n\t-- Language表的约束\n  CONSTRAINT &#96;fk_user_speaks_language&#96;  FOREIGN KEY(&#96;language_code&#96;) REFERENCES &#96;languages&#96; (&#96;code&#96;) ON DELETE SET NULL ONUPDATE CASCADE\n);</code></pre>\n\n<h2 id=\"看不懂撸代码\"><a href=\"#看不懂撸代码\" class=\"headerlink\" title=\"看不懂撸代码\"></a>看不懂撸代码</h2><h2 id=\"重写外键（前）\"><a href=\"#重写外键（前）\" class=\"headerlink\" title=\"重写外键（前）\"></a>重写外键（前）</h2><h3 id=\"清理现场\"><a href=\"#清理现场\" class=\"headerlink\" title=\"清理现场\"></a>清理现场</h3><pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">DROP DATABASE IF EXISTS gorm_many2many;\nCREATE DATABASE IF NOT EXISTS gorm_many2many;</code></pre>\n\n<h3 id=\"结构体代码\"><a href=\"#结构体代码\" class=\"headerlink\" title=\"结构体代码\"></a>结构体代码</h3><pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">package main\n\nimport (\n\t&quot;gorm.io&#x2F;driver&#x2F;mysql&quot;\n\t&quot;gorm.io&#x2F;gorm&quot;\n)\n\ntype User struct &#123;\n\tgorm.Model\n\tLanguages []Language &#96;gorm:&quot;many2many:user_languages;&quot;&#96;\n&#125;\n\ntype Language struct &#123;\n\tgorm.Model\n\tName string\n&#125;\n\nfunc main() &#123;\n\t&#x2F;&#x2F; 参考 https:&#x2F;&#x2F;github.com&#x2F;go-sql-driver&#x2F;mysql#dsn-data-source-name 获取详情\n\tdsn :&#x3D; &quot;root:123456@tcp(localhost:3306)&#x2F;gorm_many2many?charset&#x3D;utf8mb4&amp;parseTime&#x3D;True&amp;loc&#x3D;Local&quot;\n\tdb, err :&#x3D; gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)\n\n\tif err !&#x3D; nil &#123;\n\t\tpanic(&quot;failed to connect database&quot;)\n\t&#125;\n\n\t&#x2F;&#x2F; db.AutoMigrate(&amp;User&#123;&#125;, &amp;Language&#123;&#125;)\n\tdb.Debug().AutoMigrate(&amp;User&#123;&#125;)\n\n&#125;</code></pre>\n\n<h2 id=\"重写外键（后）\"><a href=\"#重写外键（后）\" class=\"headerlink\" title=\"重写外键（后）\"></a>重写外键（后）</h2><h3 id=\"清理现场-1\"><a href=\"#清理现场-1\" class=\"headerlink\" title=\"清理现场\"></a>清理现场</h3><pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">DROP DATABASE IF EXISTS gorm_many2many;\nCREATE DATABASE IF NOT EXISTS gorm_many2many;</code></pre>\n\n<h3 id=\"结构体代码-1\"><a href=\"#结构体代码-1\" class=\"headerlink\" title=\"结构体代码\"></a>结构体代码</h3><pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">package main\n\nimport (\n\t&quot;gorm.io&#x2F;driver&#x2F;mysql&quot;\n\t&quot;gorm.io&#x2F;gorm&quot;\n)\n\ntype User struct &#123;\n\tgorm.Model\n\tProfiles []Profile &#96;gorm:&quot;many2many:user_profiles;foreignKey:Refer;joinForeignKey:UserReferID;References:UserRefer;joinReferences:ProfileRefer&quot;&#96;\n\tRefer    uint      &#96;gorm:&quot;index:,unique&quot;&#96;\n&#125;\n\ntype Profile struct &#123;\n\tgorm.Model\n\tName      string\n\tUserRefer uint &#96;gorm:&quot;index:,unique&quot;&#96;\n&#125;\n\nfunc main() &#123;\n\t&#x2F;&#x2F; 参考 https:&#x2F;&#x2F;github.com&#x2F;go-sql-driver&#x2F;mysql#dsn-data-source-name 获取详情\n\tdsn :&#x3D; &quot;root:123456@tcp(localhost:3306)&#x2F;gorm_many2many?charset&#x3D;utf8mb4&amp;parseTime&#x3D;True&amp;loc&#x3D;Local&quot;\n\tdb, err :&#x3D; gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)\n\n\tif err !&#x3D; nil &#123;\n\t\tpanic(&quot;failed to connect database&quot;)\n\t&#125;\n\n\t&#x2F;&#x2F; db.AutoMigrate(&amp;User&#123;&#125;, &amp;Language&#123;&#125;)\n\tdb.Debug().AutoMigrate(&amp;User&#123;&#125;)\n\n&#125;\n</code></pre>\n\n<h2 id=\"代码演示结果\"><a href=\"#代码演示结果\" class=\"headerlink\" title=\"代码演示结果\"></a>代码演示结果</h2><h2 id=\"前后对比图\"><a href=\"#前后对比图\" class=\"headerlink\" title=\"前后对比图\"></a>前后对比图</h2><img src=\"http://t-blog-images.aijs.top/img/202212042159502.webp\" />\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">\n\ntype User struct &#123;\n    gorm.Model\n    Profiles []Profile &#96;gorm:&quot;many2many:user_profiles;foreignKey:Refer;joinForeignKey:UserReferID;References:UserRefer;joinReferences:ProfileRefer&quot;&#96;\n\t\t&#x2F;&#x2F; many2many:user_profiles; user_profile 多对多连接表名，默认gorm加s -&gt; user_profiles\n\n\t\t&#x2F;&#x2F; foreignKey:Refer;            &#x2F;&#x2F; 当前表的描述信息\n\t\t&#x2F;&#x2F; joinForeignKey:UserReferID;  &#x2F;&#x2F; 中间表（连接表）的描述信息\n\t\t&#x2F;&#x2F; References:UserRefer 重写引用 &#x2F;&#x2F; 另一表（引用表）的描述信息\n\t\t&#x2F;&#x2F; joinReferences:ProfileRefer &#x2F;&#x2F; 中间表的描述信息\n\t\t&#x2F;&#x2F; 以上分析结果参考自：&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;gorm.io&#x2F;zh_CN&#x2F;docs&#x2F;many_to_many.html#%E5%A4%8D%E5%90%88%E5%A4%96%E9%94%AE&quot; target&#x3D;&quot;_blank&quot; &gt;复合外键&lt;&#x2F;a&gt;\n\n\n    Refer    uint      &#96;gorm:&quot;index:,unique&quot;&#96;\n&#125;\n\ntype Profile struct &#123;\n    gorm.Model\n    Name      string\n    UserRefer uint &#96;gorm:&quot;index:,unique&quot;&#96;\n&#125;\n\n</code></pre>\n\n<h2 id=\"如何理解-foreignKey-x2F-references-x2F-joinForeignKey-x2F-joinReferences\"><a href=\"#如何理解-foreignKey-x2F-references-x2F-joinForeignKey-x2F-joinReferences\" class=\"headerlink\" title=\"如何理解 foreignKey&#x2F;references&#x2F;joinForeignKey&#x2F;joinReferences\"></a>如何理解 foreignKey&#x2F;references&#x2F;joinForeignKey&#x2F;joinReferences</h2><h3 id=\"容易混的点\"><a href=\"#容易混的点\" class=\"headerlink\" title=\"容易混的点\"></a>容易混的点</h3><p>容易混的点是：</p>\n<ol>\n<li>建表语句中外键约束的部分的 <code>references</code> 与 gorm 关联标签 <code>references</code> <span style=\"color: red\">毫无关系</span></li>\n<li>建表语句中外键约束的部分的 <code>FOREIGN KEY</code> 与 gorm 关联标签 <code>foreignKey</code> <span style=\"color: red\">毫无关系</span></li>\n<li>不是一个维度的东西</li>\n</ol>\n<h3 id=\"理解：当前表-x2F-引用表-x2F-连接表\"><a href=\"#理解：当前表-x2F-引用表-x2F-连接表\" class=\"headerlink\" title=\"理解：当前表&#x2F;引用表&#x2F;连接表\"></a>理解：当前表&#x2F;引用表&#x2F;连接表</h3><ul>\n<li><code>当前表</code>也就是<code>父表</code></li>\n<li><code>引用表</code>也就是<code>子表</code></li>\n<li><code>关联表</code>也就是<code>连接表</code></li>\n</ul>\n<p>简单的讲:当两个表建立一对多关系的时候,”一”的那一端是父表,”多”的那一端是子表.</p>\n<ul>\n<li>父表设置一个主键</li>\n<li>子表设置一个外键</li>\n<li>外键与主键相关联</li>\n</ul>\n<p>B 表引用 A 表的字段作为外键，那么 A 表是主表，B 表是从表。就像 A 是 B 的父亲一样，儿子可以继承父亲的遗产，可以将父亲的东西拿来自己用。用继承的思想想这个问题就会比较明了。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">B</th>\n<th align=\"left\">A</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">B_id</td>\n<td align=\"left\">A_id</td>\n</tr>\n<tr>\n<td align=\"left\">B_name</td>\n<td align=\"left\">A_name</td>\n</tr>\n<tr>\n<td align=\"left\">A_id</td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p><code>简单的理解是，子表中的记录使用了父表中的某些字段，通过这些字段可以找到父表中关于这条记录的所有信息，</code></p>\n<p>例如：有<code>学生表</code>、<code>课程表</code>、<code>选课表</code>，<br>由于选课表中用到了学生表中的学生 ID 字段（用来与学生表进行关联，获得学生的信息），并且用到了课程表中的课程 ID 字段（用来与课程表进行关联，获得课程的信息），</p>\n<p>通过上面的分析我们知道，选课表是子表，学生表与课程表都是它的父表</p>\n<p><a href=\"https://blog.csdn.net/lxr_17/article/details/49249527\" target=\"_blank\" >参考</a></p>\n<h3 id=\"关联标签\"><a href=\"#关联标签\" class=\"headerlink\" title=\"关联标签\"></a>关联标签</h3><table>\n<thead>\n<tr>\n<th align=\"left\">标签</th>\n<th align=\"left\">描述</th>\n<th>理解</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">many2many</td>\n<td align=\"left\">指定连接表表名</td>\n<td>起个名字</td>\n</tr>\n<tr>\n<td align=\"left\">foreignKey</td>\n<td align=\"left\">指定当前模型的列作为连接表的外键</td>\n<td><code>父表提供什么字段</code></td>\n</tr>\n<tr>\n<td align=\"left\">references</td>\n<td align=\"left\">指定引用表的列名，其将被映射为连接表外键</td>\n<td><code>子表提供什么字段</code></td>\n</tr>\n<tr>\n<td align=\"left\">joinForeignKey</td>\n<td align=\"left\">指定连接表的外键列名，其将被映射到当前表</td>\n<td><code>连接表提供什么字段与（父表提供的字段）关联</code></td>\n</tr>\n<tr>\n<td align=\"left\">joinReferences</td>\n<td align=\"left\">指定连接表的外键列名，其将被映射到引用表</td>\n<td><code>连接表提供什么字段与（子表提供的字段）关联</code></td>\n</tr>\n</tbody></table>\n<h3 id=\"再加一个例子：\"><a href=\"#再加一个例子：\" class=\"headerlink\" title=\"再加一个例子：\"></a>再加一个例子：</h3><h4 id=\"golang-代码\"><a href=\"#golang-代码\" class=\"headerlink\" title=\"golang 代码\"></a>golang 代码</h4><pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">&#x2F;&#x2F; 当前表（父表）\ntype CCreditCard struct &#123;\n\tID     uint\n\tNumber string &#96;gorm:&quot;index:unique;size:255&quot;&#96;\n\t&#x2F;&#x2F; 在当前表中引用了（子表）\n\tInfos  []Info &#96;gorm:&quot;many2many:card_infos;foreignKey:Number;joinForeignKey:card_number;references:Name;joinReferences:name&quot;&#96;\n&#125;\n\n&#x2F;&#x2F; 当前表：foreignKey Number 字段 -&gt; 链接表 joinForeignKey card_number 字段\n&#x2F;&#x2F; 引用表：references Name -&gt; 链接表 joinReferences name 字段\n\n&#x2F;&#x2F; 引用表（子表）\ntype Info struct &#123;\n\tID   uint\n\tName string &#96;gorm:&quot;index:unique;size:255&quot;&#96;\n\tAge  int\n&#125;\n\nfunc main() &#123;\n\tdb.AutoMigrate(&amp;CreditCard&#123;&#125;, &amp;Info&#123;&#125;)\n\tdb.Create(&amp;CreditCard&#123;\n\t\tNumber: &quot;123456&quot;,\n\t\tInfos: []Info&#123;\n\t\t\t&#123;\n\t\t\t\tID:   1,\n\t\t\t\tName: &quot;linzy&quot;,\n\t\t\t\tAge:  18,\n\t\t\t&#125;,\n\t\t&#125;,\n\t&#125;)\n\n\tdb.Create(&amp;CreditCard&#123;\n\t\tNumber: &quot;456789&quot;,\n\t\tInfos: []Info&#123;\n\t\t\t&#123;\n\t\t\t\tID:   2,\n\t\t\t\tName: &quot;slyyy&quot;,\n\t\t\t\tAge:  66,\n\t\t\t&#125;,\n\t\t\t&#123;\n\t\t\t\tID:   3,\n\t\t\t\tName: &quot;qhgwueiq&quot;,\n\t\t\t\tAge:  1,\n\t\t\t&#125;,\n\t\t&#125;,\n\t&#125;)\n&#125;\n\n</code></pre>\n\n<h4 id=\"查询到的键表语句\"><a href=\"#查询到的键表语句\" class=\"headerlink\" title=\"查询到的键表语句\"></a>查询到的键表语句</h4><pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">-- 查询语句\nshow create table 表名 \\G</code></pre>\n\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">CREATE TABLE &#96;c_credit_cards&#96; (\n\t  &#96;id&#96; bigint(20) unsigned NOT NULL AUTO_INCREMENT,\n\t  &#96;number&#96; varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,\n\t  PRIMARY KEY (&#96;id&#96;),\n\t  KEY &#96;unique&#96; (&#96;number&#96;)\n\t) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_unicode_ci\n\n\n\nCREATE TABLE &#96;infos&#96; (\n\t  &#96;id&#96; bigint(20) unsigned NOT NULL AUTO_INCREMENT,\n\t  &#96;name&#96; varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,\n\t  &#96;age&#96; bigint(20) DEFAULT NULL,\n\t  PRIMARY KEY (&#96;id&#96;),\n\t  KEY &#96;unique&#96; (&#96;name&#96;)\n\t) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_unicode_ci\n\n\n\n CREATE TABLE &#96;card_infos&#96; (\n\n\t\t&#96;card_number&#96; varchar(255) COLLATE utf8_unicode_ci NOT NULL,\n\t\t&#96;name&#96; varchar(255) COLLATE utf8_unicode_ci NOT NULL,\n\t\tPRIMARY KEY (&#96;card_number&#96;,&#96;name&#96;),\n\t\tKEY &#96;fk_card_infos_info&#96; (&#96;name&#96;),\n\t\t-- fk  card_infos  c_credit_card\n\t\t-- FOREIGN KEY REFERENCES 与 gorm 中的关联标签无关\n\t\tCONSTRAINT &#96;fk_card_infos_c_credit_card&#96; FOREIGN KEY (&#96;card_number&#96;) REFERENCES &#96;c_credit_cards&#96; (&#96;number&#96;),\n\t\t-- fk  card_infos  info\n\t\t-- FOREIGN KEY REFERENCES 与 gorm 中的关联标签无关\n\n    -- 理解：\n\t\t-- 关联表的 FOREIGN KEY 描述的是 关联表 的字段\n\t\t-- gorm 中的关联标签描述的是 父表 的字段\n\n    -- 理解：\n\t\t-- 关联表的 REFERENCES 描述的是 关联表 与哪张表的哪个字段建立关系\n\t\t-- gorm中的 REFERENCES  描述的是 引用表的 字段与连接表的映射字段\n\n\n\t\tCONSTRAINT &#96;fk_card_infos_info&#96; FOREIGN KEY (&#96;name&#96;) REFERENCES &#96;infos&#96; (&#96;name&#96;)\n\n\t) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_unicode_ci\n\n</code></pre>\n\n<h4 id=\"关联标签顺序可随意\"><a href=\"#关联标签顺序可随意\" class=\"headerlink\" title=\"关联标签顺序可随意\"></a>关联标签顺序可随意</h4><p>经测试，随便放都是 OK 的</p>\n<pre class=\"line-numbers language-go\" data-language=\"go\"><code class=\"language-go\">&#x2F;&#x2F; 顺序无关\nInfos []Info &#96;gorm:&quot;many2many:card_infos;joinForeignKey:card_number;joinReferences:namem;foreignKey:Number;references: Name&quot;&#96;</code></pre>\n","text":"打开认知belong to 属于 has one 拥有 belong to vs has one B belong to A : B 结构体和 B 的 ID 都 A 在结构体中 A has one B: A 的 id 在 B 结构体中，B 的结构体在 A 结构体中 Has man...","link":"","photos":[],"count_time":{"symbolsCount":"14k","symbolsTime":"13 mins."},"categories":[{"name":"Go","slug":"Go","count":13,"path":"api/categories/Go.json"}],"tags":[{"name":"Go","slug":"Go","count":13,"path":"api/tags/Go.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%89%93%E5%BC%80%E8%AE%A4%E7%9F%A5\"><span class=\"toc-text\">打开认知</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#belong-to-%E5%B1%9E%E4%BA%8E\"><span class=\"toc-text\">belong to 属于</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#has-one-%E6%8B%A5%E6%9C%89\"><span class=\"toc-text\">has one 拥有</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#belong-to-vs-has-one\"><span class=\"toc-text\">belong to vs has one</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Has-many\"><span class=\"toc-text\">Has many</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#belong-to-x2F-has-one-x2F-has-many-%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">belong to &#x2F; has one &#x2F; has many 总结</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Many-to-many\"><span class=\"toc-text\">Many to many</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Many-to-many-%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">Many to many 总结</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#playground\"><span class=\"toc-text\">playground</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Belong-to\"><span class=\"toc-text\">Belong to</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#belong-to-%E5%B1%9E%E4%BA%8E-1\"><span class=\"toc-text\">belong to 属于</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#has-one-%E6%8B%A5%E6%9C%89-1\"><span class=\"toc-text\">has one 拥有</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%B0%81%E6%98%AF%E6%8B%A5%E6%9C%89%E8%80%85\"><span class=\"toc-text\">谁是拥有者</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AF%E5%A4%96%E9%94%AE\"><span class=\"toc-text\">什么是外键</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%87%8D%E5%86%99%E5%A4%96%E9%94%AE%EF%BC%88%E7%BB%99%E5%A4%96%E9%94%AE%E6%94%B9%E5%90%8D%E5%AD%97%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E6%B2%A1%E6%9C%89%E5%8F%91%E7%94%9F%E5%8F%98%E5%8C%96%EF%BC%89\"><span class=\"toc-text\">重写外键（给外键改名字，数据库并没有发生变化）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%87%8D%E5%86%99%E5%BC%95%E7%94%A8-%E6%B3%A8%E6%84%8F-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98%EF%BC%8C%E5%B7%B2%E6%8F%90-issue\"><span class=\"toc-text\">重写引用 注意 官方文档存在问题，已提 issue</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Has-one\"><span class=\"toc-text\">Has one</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Has-many-1\"><span class=\"toc-text\">Has many</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Many-to-many-1\"><span class=\"toc-text\">Many to many</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F\"><span class=\"toc-text\">外键约束</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%87%8D%E5%86%99%E5%A4%96%E9%94%AE%EF%BC%8C%E9%87%8D%E5%86%99%E5%BC%95%E7%94%A8\"><span class=\"toc-text\">重写外键，重写引用</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%9C%8B%E4%B8%8D%E6%87%82%E6%92%B8%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">看不懂撸代码</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%87%8D%E5%86%99%E5%A4%96%E9%94%AE%EF%BC%88%E5%89%8D%EF%BC%89\"><span class=\"toc-text\">重写外键（前）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B8%85%E7%90%86%E7%8E%B0%E5%9C%BA\"><span class=\"toc-text\">清理现场</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BB%93%E6%9E%84%E4%BD%93%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">结构体代码</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%87%8D%E5%86%99%E5%A4%96%E9%94%AE%EF%BC%88%E5%90%8E%EF%BC%89\"><span class=\"toc-text\">重写外键（后）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B8%85%E7%90%86%E7%8E%B0%E5%9C%BA-1\"><span class=\"toc-text\">清理现场</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BB%93%E6%9E%84%E4%BD%93%E4%BB%A3%E7%A0%81-1\"><span class=\"toc-text\">结构体代码</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA%E7%BB%93%E6%9E%9C\"><span class=\"toc-text\">代码演示结果</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E5%90%8E%E5%AF%B9%E6%AF%94%E5%9B%BE\"><span class=\"toc-text\">前后对比图</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3-foreignKey-x2F-references-x2F-joinForeignKey-x2F-joinReferences\"><span class=\"toc-text\">如何理解 foreignKey&#x2F;references&#x2F;joinForeignKey&#x2F;joinReferences</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%B9%E6%98%93%E6%B7%B7%E7%9A%84%E7%82%B9\"><span class=\"toc-text\">容易混的点</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%90%86%E8%A7%A3%EF%BC%9A%E5%BD%93%E5%89%8D%E8%A1%A8-x2F-%E5%BC%95%E7%94%A8%E8%A1%A8-x2F-%E8%BF%9E%E6%8E%A5%E8%A1%A8\"><span class=\"toc-text\">理解：当前表&#x2F;引用表&#x2F;连接表</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B3%E8%81%94%E6%A0%87%E7%AD%BE\"><span class=\"toc-text\">关联标签</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%86%8D%E5%8A%A0%E4%B8%80%E4%B8%AA%E4%BE%8B%E5%AD%90%EF%BC%9A\"><span class=\"toc-text\">再加一个例子：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#golang-%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">golang 代码</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2%E5%88%B0%E7%9A%84%E9%94%AE%E8%A1%A8%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">查询到的键表语句</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%85%B3%E8%81%94%E6%A0%87%E7%AD%BE%E9%A1%BA%E5%BA%8F%E5%8F%AF%E9%9A%8F%E6%84%8F\"><span class=\"toc-text\">关联标签顺序可随意</span></a></li></ol></li></ol></li></ol>","author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"生活不止眼前的苟且，还有诗和远方","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"gorm migrate 注意点","uid":"1269a76e445b052b3fd7442cae906b92","slug":"2022-10-21gorm-migrate","date":"2022-10-21T02:04:16.000Z","updated":"2022-10-21T12:45:30.510Z","comments":true,"path":"api/articles/2022-10-21gorm-migrate.json","keywords":null,"cover":null,"text":"等效语句添加、删除会报错 &#x2F;&#x2F; ... type User struct &#123; gorm.Model Name string &#96;gorm:&quot;size:255;index:idx_name,unique&quot;&#96; &#125...","link":"","photos":[],"count_time":{"symbolsCount":"8.2k","symbolsTime":"7 mins."},"categories":[{"name":"Go","slug":"Go","count":13,"path":"api/categories/Go.json"}],"tags":[{"name":"Go","slug":"Go","count":13,"path":"api/tags/Go.json"}],"author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"生活不止眼前的苟且，还有诗和远方","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"前端基础-js表达式","uid":"5920bc0e327b10c465c146c4b5f81619","slug":"2022-10-19js表达式","date":"2022-10-19T10:00:07.000Z","updated":"2022-11-26T07:05:03.115Z","comments":true,"path":"api/articles/2022-10-19js表达式.json","keywords":null,"cover":[],"text":"1. 逗号操作符, 没你想象的那么简单对它的每个操作数求值（从左到右），并返回最后一个操作数的值。 let x &#x3D; 1; x &#x3D; (x++, x); console.log(x); &#x2F;&#x2F; expected output: 2 x &#x3D...","link":"","photos":[],"count_time":{"symbolsCount":"7.8k","symbolsTime":"7 mins."},"categories":[{"name":"前端基础","slug":"前端基础","count":39,"path":"api/categories/前端基础.json"}],"tags":[{"name":"前端基础","slug":"前端基础","count":41,"path":"api/tags/前端基础.json"}],"author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"生活不止眼前的苟且，还有诗和远方","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}