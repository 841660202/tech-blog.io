{"title":"组件库UMD产物","uid":"87960c0852e545c2c12901d0c42ef062","slug":"2023-01-29umd","date":"2023-01-29T03:32:23.000Z","updated":"2023-02-20T21:20:56.486Z","comments":true,"path":"api/articles/2023-01-29umd.json","keywords":null,"cover":null,"content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>有些组件库（公司 wiki 库）依赖项，非常多，编译速度巨慢，如果能够像 echarts 一样，使用 script 标签引入，这样无需编译，浏览器还有缓存可以利用，开发体验非常可观</p>\n<p>一直以来在想打 umd 产物的包，以解决上述问题，没时间～，我今天又揽活了，什么时候能改掉这个坏毛病</p>\n<h2 id=\"dumi-gt-father\"><a href=\"#dumi-gt-father\" class=\"headerlink\" title=\"dumi -&gt; father\"></a>dumi -&gt; father</h2><p><a href=\"https://github.com/umijs/father/blob/master/docs/guide/umd.md\" target=\"_blank\" >见</a></p>\n<h3 id=\"构建-UMD-产物\"><a href=\"#构建-UMD-产物\" class=\"headerlink\" title=\"构建 UMD 产物\"></a>构建 UMD 产物</h3><h4 id=\"如何选择\"><a href=\"#如何选择\" class=\"headerlink\" title=\"如何选择\"></a>如何选择</h4><p>只有在满足如下任意条件的情况下，才需要选择输出 UMD 产物：</p>\n<ol>\n<li>项目的用户可能需要将该依赖做 external 处理、<code>并在 HTML 中通过 script 标签直接引入 CDN 上的产物</code>（类似 React 或 antd）</li>\n<li>项目需要产出编译后的样式表给用户使用，例如将 Less 文件以特定的变量编译成 CSS 文件，常见于基于 antd、<code>又需要自定义主题的组件库</code></li>\n</ol>\n<h4 id=\"如何构建\"><a href=\"#如何构建\" class=\"headerlink\" title=\"如何构建\"></a>如何构建</h4><p>只需要使用 <code>umd</code> 配置项，再执行 <code>father build</code> 即可产出 UMD 产物：</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; .fatherrc.js\nexport default &#123;\n  &#x2F;&#x2F; 以下为 umd 配置项启用时的默认值，有自定义需求时才需配置\n  umd: &#123;\n    entry: &quot;src&#x2F;index&quot;, &#x2F;&#x2F; 默认构建入口文件\n  &#125;,\n&#125;;</code></pre>\n\n<p>更多配置项可参考 <a href=\"https://github.com/umijs/father/blob/master/docs/config.md\" target=\"_blank\" >配置项</a></p>\n<p>在 father 项目中，UMD 产物以 Bundle 模式进行构建，关于 Bundle 模式的介绍可参考 <a href=\"https://github.com/umijs/father/blob/master/docs/guide/build-mode.md#bundle\" target=\"_blank\" >构建模式 - Bundle</a></p>\n<h2 id=\"webpack\"><a href=\"#webpack\" class=\"headerlink\" title=\"webpack\"></a>webpack</h2><p><a href=\"https://blog.csdn.net/weixin_42947716/article/details/124104045\" target=\"_blank\" >见</a></p>\n<p><a href=\"https://webpack.docschina.org/configuration/output/\" target=\"_blank\" >见</a></p>\n<h3 id=\"webpack-dev-config-js\"><a href=\"#webpack-dev-config-js\" class=\"headerlink\" title=\"webpack.dev.config.js\"></a>webpack.dev.config.js</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; webpack.dev.config.js\nconst path &#x3D; require(&quot;path&quot;);\nconst config &#x3D; require(&quot;.&#x2F;webpack.config&quot;);\nconst HtmlWebpackPlugin &#x3D; require(&quot;html-webpack-plugin&quot;);\n\nconst &#123; merge &#125; &#x3D; require(&quot;webpack-merge&quot;);\n\nmodule.exports &#x3D; merge(config, &#123;\n  mode: &quot;development&quot;,\n  entry: path.resolve(&quot;.&#x2F;src&#x2F;demo.tsx&quot;),\n  plugins: [\n    new HtmlWebpackPlugin(&#123;\n      filename: &quot;index.html&quot;,\n      template: path.resolve(&quot;.&#x2F;index.html&quot;),\n    &#125;),\n  ],\n&#125;);</code></pre>\n\n<h3 id=\"webpack-prod-config-js\"><a href=\"#webpack-prod-config-js\" class=\"headerlink\" title=\"webpack.prod.config.js\"></a>webpack.prod.config.js</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; webpack.prod.config.js\nconst config &#x3D; require(&quot;.&#x2F;webpack.config&quot;);\nconst path &#x3D; require(&quot;path&quot;);\nconst &#123; merge &#125; &#x3D; require(&quot;webpack-merge&quot;);\n&#x2F;&#x2F; 进度条\nconst ProgressBarPlugin &#x3D; require(&quot;progress-bar-webpack-plugin&quot;);\nmodule.exports &#x3D; merge(config, &#123;\n  mode: &quot;production&quot;,\n  output: &#123;\n    library: &quot;wikiUI&quot;,\n    libraryTarget: &quot;umd&quot;,\n    libraryExport: &quot;default&quot;,\n    path: path.join(process.cwd(), &quot;lib&quot;),\n    filename: &quot;index.js&quot;,\n  &#125;,\n  plugins: [\n    &#x2F;&#x2F; 进度条\n    new ProgressBarPlugin(),\n  ],\n&#125;);</code></pre>\n\n<h3 id=\"webpack-config-js\"><a href=\"#webpack-config-js\" class=\"headerlink\" title=\"webpack.config.js\"></a>webpack.config.js</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; webpack.config.js\nconst webpack &#x3D; require(&quot;webpack&quot;);\nconst path &#x3D; require(&quot;path&quot;);\nconst MiniCssExtractPlugin &#x3D; require(&quot;mini-css-extract-plugin&quot;);\n\nmodule.exports &#x3D; &#123;\n  mode: &quot;development&quot;,\n  entry: path.resolve(&quot;.&#x2F;src&#x2F;index.ts&quot;),\n  plugins: [new MiniCssExtractPlugin()],\n  module: &#123;\n    rules: [\n      &#123;\n        test: &#x2F;\\.(ts|tsx)$&#x2F;,\n        loader: &quot;babel-loader&quot;,\n        include: [path.resolve(__dirname, &quot;..&#x2F;src&quot;)],\n        exclude: [&quot;&#x2F;node_modules&#x2F;&quot;],\n      &#125;,\n      &#123;\n        test: &#x2F;.(sa|sc|c)ss$&#x2F;,\n        use: [\n          &#123;\n            loader: MiniCssExtractPlugin.loader,\n          &#125;,\n          &#123;\n            loader: &quot;css-loader&quot;,\n            options: &#123;\n              sourceMap: true,\n            &#125;,\n          &#125;,\n          &#123;\n            loader: &quot;sass-loader&quot;,\n            options: &#123;\n              sourceMap: true,\n            &#125;,\n          &#125;,\n        ],\n      &#125;,\n      &#123;\n        test: &#x2F;.(le)ss$&#x2F;,\n        use: [\n          &#123;\n            loader: MiniCssExtractPlugin.loader,\n          &#125;,\n          &#123;\n            loader: &quot;css-loader&quot;,\n            options: &#123;\n              sourceMap: true,\n            &#125;,\n          &#125;,\n          &#123;\n            loader: &quot;less-loader&quot;,\n            options: &#123;\n              sourceMap: true,\n              lessOptions: &#123;\n                javascriptEnabled: true,\n              &#125;,\n            &#125;,\n          &#125;,\n        ],\n      &#125;,\n      &#123;\n        test: &#x2F;\\.(woff(2)?|ttf|eot|svg)(\\?v&#x3D;\\d+\\.\\d+\\.\\d+)?$&#x2F;,\n        use: [\n          &#123;\n            loader: &quot;file-loader&quot;,\n            options: &#123;\n              name: &quot;[name].[ext]&quot;,\n              outputPath: &quot;fonts&#x2F;&quot;,\n            &#125;,\n          &#125;,\n        ],\n      &#125;,\n    ],\n  &#125;,\n  resolve: &#123;\n    alias: &#123;\n      &quot;@&quot;: path.resolve(__dirname, &quot;..&#x2F;src&#x2F;&quot;),\n    &#125;,\n    extensions: [&quot;.tsx&quot;, &quot;.ts&quot;, &quot;.js&quot;],\n  &#125;,\n&#125;;</code></pre>\n\n<h2 id=\"vite\"><a href=\"#vite\" class=\"headerlink\" title=\"vite\"></a>vite</h2><p><code>Invalid value &quot;umd&quot; for option &quot;output.format&quot; - UMD and IIFE output formats are not supported for code-splitting builds.</code></p>\n<h2 id=\"中心组件库\"><a href=\"#中心组件库\" class=\"headerlink\" title=\"中心组件库\"></a>中心组件库</h2><p>webpack 模块联邦</p>\n<p><a href=\"/#/post/2023-02-04工程化\" target=\"_blank\" >见：2023-02-04 工程化</a></p>\n","text":"背景有些组件库（公司 wiki 库）依赖项，非常多，编译速度巨慢，如果能够像 echarts 一样，使用 script 标签引入，这样无需编译，浏览器还有缓存可以利用，开发体验非常可观 一直以来在想打 umd 产物的包，以解决上述问题，没时间～，我今天又揽活了，什么时候能改掉这个...","link":"","photos":[],"count_time":{"symbolsCount":"4.5k","symbolsTime":"4 mins."},"categories":[{"name":"React","slug":"React","count":36,"path":"api/categories/React.json"}],"tags":[{"name":"React","slug":"React","count":30,"path":"api/tags/React.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">背景</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#dumi-gt-father\"><span class=\"toc-text\">dumi -&gt; father</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9E%84%E5%BB%BA-UMD-%E4%BA%A7%E7%89%A9\"><span class=\"toc-text\">构建 UMD 产物</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9\"><span class=\"toc-text\">如何选择</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA\"><span class=\"toc-text\">如何构建</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#webpack\"><span class=\"toc-text\">webpack</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#webpack-dev-config-js\"><span class=\"toc-text\">webpack.dev.config.js</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#webpack-prod-config-js\"><span class=\"toc-text\">webpack.prod.config.js</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#webpack-config-js\"><span class=\"toc-text\">webpack.config.js</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#vite\"><span class=\"toc-text\">vite</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%AD%E5%BF%83%E7%BB%84%E4%BB%B6%E5%BA%93\"><span class=\"toc-text\">中心组件库</span></a></li></ol>","author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>眼中有光，心中有梦，脚下有路</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"混乱库处理","uid":"55bae55fcf20ed40c2c35c2a5ff7ce4f","slug":"2023-01-31antd","date":"2023-01-31T02:25:33.000Z","updated":"2023-02-20T21:20:56.486Z","comments":true,"path":"api/articles/2023-01-31antd.json","keywords":null,"cover":null,"text":"ahooksimport &#123; useMemoizedFn &#125; from &quot;ahooks&quot;; &#x2F;&#x2F;社区存在ahooks-v2版本，导致无法，无法使用，新增一个私有仓库v3版本，不去更改历史版本 import &#123; ...","link":"","photos":[],"count_time":{"symbolsCount":846,"symbolsTime":"1 mins."},"categories":[{"name":"前端","slug":"前端","count":5,"path":"api/categories/前端.json"}],"tags":[{"name":"前端","slug":"前端","count":5,"path":"api/tags/前端.json"}],"author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>眼中有光，心中有梦，脚下有路</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"React Refs","uid":"5fabc47ffe883306098d02d0d23becda","slug":"2023-01-28refs","date":"2023-01-28T05:36:24.000Z","updated":"2023-02-20T21:20:56.485Z","comments":true,"path":"api/articles/2023-01-28refs.json","keywords":null,"cover":null,"text":"Refs &amp; DOM 为 DOM 元素添加 ref 为 class 组件添加 Ref Refs 与函数组件 默认情况下，你不能在函数组件上使用 ref 属性，因为它们没有实例 如果要在函数组件中使用 ref，你可以使用 forwardRef（可与 useImperativ...","link":"","photos":[],"count_time":{"symbolsCount":704,"symbolsTime":"1 mins."},"categories":[{"name":"React","slug":"React","count":36,"path":"api/categories/React.json"}],"tags":[{"name":"React","slug":"React","count":30,"path":"api/tags/React.json"}],"author":{"name":"举手摘月亮","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>眼中有光，心中有梦，脚下有路</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}