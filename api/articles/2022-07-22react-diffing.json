{"title":"React@16.5.0 diffing algorithm","uid":"591f2a8f52aa8db4f8ec9853d594cc54","slug":"2022-07-22react-diffing","date":"2022-07-22T01:16:00.000Z","updated":"2022-09-16T15:02:43.733Z","comments":true,"path":"api/articles/2022-07-22react-diffing.json","keywords":null,"cover":[],"content":"<h2 id=\"è¯´æ˜\"><a href=\"#è¯´æ˜\" class=\"headerlink\" title=\"è¯´æ˜\"></a>è¯´æ˜</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>React provides a declarative API so that you donâ€™t have to worry about exactly what changes on every update. This makes writing applications a lot easier, but it might not be obvious how this is implemented within React. This article explains the choices we made in Reactâ€™s â€œdiffingâ€ algorithm so that component updates are predictable while being fast enough for high-performance apps.</p></blockquote>\n<p>å—¯ï¼Œè¿™é‡Œä½¿ç”¨äº†è‹±æ–‡åŸæ–‡ï¼Œæˆ‘è§‰å¾—ä¸­æ–‡ç‰ˆæœ¬ï¼Œç¿»è¯‘çš„ä¸å¤Ÿå‡†ç¡®</p>\n<p>æ’‡å¼€ä¸­æ–‡ç‰ˆå®˜æ–¹ä¸è°ˆï¼Œè¯‘æ–‡å¦‚ä¸‹ï¼š</p>\n<p>React æä¾›äº†å“åº”å¼ API,æ‰€ä»¥ä½ ä¸ç”¨æ‹…å¿ƒæ¯æ¬¡æ›´æ–°éƒ½ä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ã€‚è¿™ä½¿å¾—å¼€å‘åº”ç”¨æ›´ç‚¹å•ï¼Œä½†åœ¨ React ä¸­å¦‚ä½•å®ç°è¿™ä¸€ç‚¹å¯èƒ½å¹¶ä¸æ˜æ˜¾ã€‚è¿™ç¯‡æ–‡ç« è§£é‡Šäº†æˆ‘ä»¬åœ¨ React çš„ diffing ç®—æ³•çš„é€‰æ‹©ï¼Œå› æ­¤ï¼Œç»„ä»¶æ›´æ–°æ˜¯å¯é¢„æµ‹çš„ï¼ŒåŒæ—¶å¯¹é«˜æ€§èƒ½åº”ç”¨ç¨‹åºæ¥è¯´è¶³å¤Ÿå¿«ã€‚</p>\n<h2 id=\"è®¾è®¡åŠ¨æœº\"><a href=\"#è®¾è®¡åŠ¨æœº\" class=\"headerlink\" title=\"è®¾è®¡åŠ¨æœº\"></a>è®¾è®¡åŠ¨æœº</h2><p>åœ¨æŸä¸€æ—¶é—´èŠ‚ç‚¹è°ƒç”¨ React çš„ render() æ–¹æ³•ï¼Œä¼šåˆ›å»ºä¸€æ£µç”± React å…ƒç´ ç»„æˆçš„æ ‘ã€‚</p>\n<p>åœ¨ä¸‹ä¸€æ¬¡ state æˆ– props æ›´æ–°æ—¶ï¼Œç›¸åŒçš„ render() æ–¹æ³•ä¼šè¿”å›ä¸€æ£µä¸åŒçš„æ ‘ã€‚</p>\n<p>React éœ€è¦åŸºäºè¿™ä¸¤æ£µæ ‘ä¹‹é—´çš„å·®åˆ«æ¥åˆ¤æ–­å¦‚ä½•é«˜æ•ˆçš„æ›´æ–° UIï¼Œä»¥ä¿è¯å½“å‰ UI ä¸æœ€æ–°çš„æ ‘ä¿æŒåŒæ­¥ã€‚</p>\n<p>æ­¤ç®—æ³•æœ‰ä¸€äº›é€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œå³ç”Ÿæˆå°†ä¸€æ£µæ ‘è½¬æ¢æˆå¦ä¸€æ£µæ ‘çš„æœ€å°æ“ä½œæ¬¡æ•°ã€‚ç„¶è€Œï¼Œå³ä½¿ä½¿ç”¨æœ€ä¼˜çš„ç®—æ³•ï¼Œè¯¥ç®—æ³•çš„å¤æ‚ç¨‹åº¦ä»ä¸º O(n 3 )ï¼Œå…¶ä¸­ n æ˜¯æ ‘ä¸­å…ƒç´ çš„æ•°é‡ã€‚</p>\n<p>å¦‚æœåœ¨ React ä¸­ä½¿ç”¨è¯¥ç®—æ³•ï¼Œé‚£ä¹ˆå±•ç¤º 1000 ä¸ªå…ƒç´ åˆ™éœ€è¦ 10 äº¿æ¬¡çš„æ¯”è¾ƒã€‚è¿™ä¸ªå¼€é”€å®åœ¨æ˜¯å¤ªè¿‡é«˜æ˜‚ã€‚äºæ˜¯ React åœ¨ä»¥ä¸‹ä¸¤ä¸ªå‡è®¾çš„åŸºç¡€ä¹‹ä¸Šæå‡ºäº†ä¸€å¥— O(n) çš„ <code>å¯å‘å¼ç®—æ³•</code>ï¼š</p>\n<ul>\n<li><code>ä¸¤ä¸ªä¸åŒç±»å‹çš„å…ƒç´ ä¼šäº§ç”Ÿå‡ºä¸åŒçš„æ ‘ï¼›</code></li>\n<li><code>å¼€å‘è€…å¯ä»¥ä½¿ç”¨ key å±æ€§æ ‡è¯†å“ªäº›å­å…ƒç´ åœ¨ä¸åŒçš„æ¸²æŸ“ä¸­å¯èƒ½æ˜¯ä¸å˜çš„ã€‚</code></li>\n</ul>\n<p>åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å‘ç°ä»¥ä¸Šå‡è®¾åœ¨å‡ ä¹æ‰€æœ‰å®ç”¨çš„åœºæ™¯ä¸‹éƒ½æˆç«‹ã€‚</p>\n<details class=\"custom-details\">\n<summary>å¯å‘å¼ç®—æ³•å®šä¹‰</summary>\n<p><a href=\"https://baike.baidu.com/item/%E5%90%AF%E5%8F%91%E5%BC%8F%E7%AE%97%E6%B3%95/938987\" target=\"_blank\" ><code>å¯å‘å¼ç®—æ³•</code></a>ï¼ˆheuristic algorithm)æ˜¯ç›¸å¯¹äºæœ€ä¼˜åŒ–ç®—æ³•æå‡ºçš„ã€‚ä¸€ä¸ªé—®é¢˜çš„æœ€ä¼˜ç®—æ³•æ±‚å¾—è¯¥é—®é¢˜æ¯ä¸ªå®ä¾‹çš„æœ€ä¼˜è§£ã€‚å¯å‘å¼ç®—æ³•å¯ä»¥è¿™æ ·å®šä¹‰ï¼šä¸€ä¸ªåŸºäºç›´è§‚æˆ–ç»éªŒæ„é€ çš„ç®—æ³•ï¼Œåœ¨å¯æ¥å—çš„èŠ±è´¹ï¼ˆæŒ‡è®¡ç®—æ—¶é—´å’Œç©ºé—´ï¼‰ä¸‹ç»™å‡ºå¾…è§£å†³ç»„åˆä¼˜åŒ–é—®é¢˜æ¯ä¸€ä¸ªå®ä¾‹çš„ä¸€ä¸ªå¯è¡Œè§£ï¼Œè¯¥å¯è¡Œè§£ä¸æœ€ä¼˜è§£çš„åç¦»ç¨‹åº¦ä¸€èˆ¬ä¸èƒ½è¢«é¢„è®¡</p>\n</details>\n<h2 id=\"Diffing-ç®—æ³•\"><a href=\"#Diffing-ç®—æ³•\" class=\"headerlink\" title=\"Diffing ç®—æ³•\"></a>Diffing ç®—æ³•</h2><p>å½“å¯¹æ¯”ä¸¤æ£µæ ‘æ—¶ï¼ŒReact é¦–å…ˆæ¯”è¾ƒä¸¤æ£µæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚ä¸åŒç±»å‹çš„æ ¹èŠ‚ç‚¹å…ƒç´ ä¼šæœ‰ä¸åŒçš„å½¢æ€ã€‚</p>\n<h3 id=\"å¯¹æ¯”ä¸åŒç±»å‹çš„å…ƒç´ \"><a href=\"#å¯¹æ¯”ä¸åŒç±»å‹çš„å…ƒç´ \" class=\"headerlink\" title=\"å¯¹æ¯”ä¸åŒç±»å‹çš„å…ƒç´ \"></a>å¯¹æ¯”ä¸åŒç±»å‹çš„å…ƒç´ </h3><p>å½“æ ¹èŠ‚ç‚¹ä¸ºä¸åŒç±»å‹çš„å…ƒç´ æ—¶ï¼ŒReact ä¼šæ‹†å¸åŸæœ‰çš„æ ‘å¹¶ä¸”å»ºç«‹èµ·æ–°çš„æ ‘</p>\n<ul>\n<li><p>å½“å¸è½½ä¸€æ£µæ ‘æ—¶ï¼Œå¯¹åº”çš„ DOM èŠ‚ç‚¹ä¹Ÿä¼šè¢«é”€æ¯ã€‚ç»„ä»¶å®ä¾‹å°†æ‰§è¡Œ <code>componentWillUnmount()</code> æ–¹æ³•ã€‚</p>\n</li>\n<li><p>å½“å»ºç«‹ä¸€æ£µæ–°çš„æ ‘æ—¶ï¼Œå¯¹åº”çš„ DOM èŠ‚ç‚¹ä¼šè¢«åˆ›å»ºä»¥åŠæ’å…¥åˆ° DOM ä¸­ã€‚ç»„ä»¶å®ä¾‹å°†æ‰§è¡Œ <code>UNSAFE_componentWillMount()</code> æ–¹æ³•ï¼Œç´§æ¥ç€ <code>componentDidMount()</code> æ–¹æ³•ã€‚</p>\n</li>\n</ul>\n<p>æ‰€æœ‰ä¸ä¹‹å‰çš„æ ‘ç›¸å…³è”çš„ state ä¹Ÿä¼šè¢«é”€æ¯ã€‚</p>\n<p>åœ¨æ ¹èŠ‚ç‚¹ä»¥ä¸‹çš„ç»„ä»¶ä¹Ÿä¼šè¢«å¸è½½ï¼Œå®ƒä»¬çš„çŠ¶æ€ä¼šè¢«é”€æ¯ã€‚æ¯”å¦‚ï¼Œå½“æ¯”å¯¹ä»¥ä¸‹æ›´å˜æ—¶ï¼š</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&lt;div&gt;\n  &lt;Counter &#x2F;&gt;\n&lt;&#x2F;div&gt;\n\n&lt;span&gt;\n  &lt;Counter &#x2F;&gt;\n&lt;&#x2F;span&gt;\n</code></pre>\n\n<p>React ä¼šé”€æ¯ Counter ç»„ä»¶å¹¶ä¸”é‡æ–°è£…è½½ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚</p>\n<h3 id=\"å¯¹æ¯”åŒä¸€ç±»å‹çš„å…ƒç´ \"><a href=\"#å¯¹æ¯”åŒä¸€ç±»å‹çš„å…ƒç´ \" class=\"headerlink\" title=\"å¯¹æ¯”åŒä¸€ç±»å‹çš„å…ƒç´ \"></a>å¯¹æ¯”åŒä¸€ç±»å‹çš„å…ƒç´ </h3><p>å½“å¯¹æ¯”ä¸¤ä¸ªç›¸åŒç±»å‹çš„ React å…ƒç´ æ—¶ï¼ŒReact ä¼šä¿ç•™ DOM èŠ‚ç‚¹ï¼Œä»…æ¯”å¯¹åŠæ›´æ–°æœ‰æ”¹å˜çš„å±æ€§ã€‚æ¯”å¦‚ï¼š</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&lt;div className&#x3D;&quot;before&quot; title&#x3D;&quot;stuff&quot; &#x2F;&gt;\n\n&lt;div className&#x3D;&quot;after&quot; title&#x3D;&quot;stuff&quot; &#x2F;&gt;</code></pre>\n\n<p>é€šè¿‡å¯¹æ¯”è¿™ä¸¤ä¸ªå…ƒç´ ï¼ŒReact çŸ¥é“åªéœ€è¦ä¿®æ”¹ DOM å…ƒç´ ä¸Šçš„ <code>className</code> å±æ€§ã€‚</p>\n<br/>\n<br/>\n\n<p>å½“æ›´æ–° <code>style</code> å±æ€§æ—¶ï¼ŒReact ä»…æ›´æ–°æœ‰æ‰€æ›´å˜çš„å±æ€§ã€‚æ¯”å¦‚ï¼š</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&lt;div style&#x3D;&#123;&#123;color: &#39;red&#39;, fontWeight: &#39;bold&#39;&#125;&#125; &#x2F;&gt;\n\n&lt;div style&#x3D;&#123;&#123;color: &#39;green&#39;, fontWeight: &#39;bold&#39;&#125;&#125; &#x2F;&gt;</code></pre>\n\n<p>é€šè¿‡å¯¹æ¯”è¿™ä¸¤ä¸ªå…ƒç´ ï¼ŒReact çŸ¥é“åªéœ€è¦ä¿®æ”¹ DOM å…ƒç´ ä¸Šçš„ <code>color</code> æ ·å¼ï¼Œæ— éœ€ä¿®æ”¹ <code>fontWeight</code>ã€‚</p>\n<p>åœ¨å¤„ç†å®Œå½“å‰èŠ‚ç‚¹ä¹‹åï¼ŒReact ç»§ç»­å¯¹å­èŠ‚ç‚¹è¿›è¡Œé€’å½’ã€‚</p>\n<h3 id=\"å¯¹æ¯”åŒç±»å‹çš„ç»„ä»¶å…ƒç´ \"><a href=\"#å¯¹æ¯”åŒç±»å‹çš„ç»„ä»¶å…ƒç´ \" class=\"headerlink\" title=\"å¯¹æ¯”åŒç±»å‹çš„ç»„ä»¶å…ƒç´ \"></a>å¯¹æ¯”åŒç±»å‹çš„ç»„ä»¶å…ƒç´ </h3><p>å½“ä¸€ä¸ªç»„ä»¶æ›´æ–°æ—¶ï¼Œ<code>ç»„ä»¶å®ä¾‹ä¼šä¿æŒä¸å˜</code>ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸åŒçš„æ¸²æŸ“æ—¶ä¿æŒ state ä¸€è‡´ã€‚React å°†æ›´æ–°è¯¥ç»„ä»¶å®ä¾‹çš„ props ä»¥ä¿è¯ä¸æœ€æ–°çš„å…ƒç´ ä¿æŒä¸€è‡´ï¼Œå¹¶ä¸”è°ƒç”¨è¯¥å®ä¾‹çš„ <code>UNSAFE_componentWillReceiveProps()</code>ã€<code>UNSAFE_componentWillUpdate()</code> ä»¥åŠ <code>componentDidUpdate()</code>æ–¹æ³•ã€‚</p>\n<p>ä¸‹ä¸€æ­¥ï¼Œè°ƒç”¨ render() æ–¹æ³•ï¼Œ<strong>diff ç®—æ³•å°†åœ¨ä¹‹å‰çš„ç»“æœä»¥åŠæ–°çš„ç»“æœä¸­è¿›è¡Œé€’å½’</strong>ã€‚</p>\n<h3 id=\"å¯¹å­èŠ‚ç‚¹è¿›è¡Œé€’å½’\"><a href=\"#å¯¹å­èŠ‚ç‚¹è¿›è¡Œé€’å½’\" class=\"headerlink\" title=\"å¯¹å­èŠ‚ç‚¹è¿›è¡Œé€’å½’\"></a>å¯¹å­èŠ‚ç‚¹è¿›è¡Œé€’å½’</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“é€’å½’ DOM èŠ‚ç‚¹çš„å­å…ƒç´ æ—¶ï¼ŒReact ä¼šåŒæ—¶éå†ä¸¤ä¸ªå­å…ƒç´ çš„åˆ—è¡¨ï¼›å½“äº§ç”Ÿå·®å¼‚æ—¶ï¼Œç”Ÿæˆä¸€ä¸ª <code>mutation</code>å˜åŒ–ã€‚</p>\n<p><code>åœ¨å­å…ƒç´ åˆ—è¡¨æœ«å°¾æ–°å¢å…ƒç´ æ—¶ï¼Œæ›´æ–°å¼€é”€æ¯”è¾ƒå°</code>ã€‚æ¯”å¦‚ï¼š</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&lt;ul&gt;\n  &lt;li&gt;first&lt;&#x2F;li&gt;\n  &lt;li&gt;second&lt;&#x2F;li&gt;\n&lt;&#x2F;ul&gt;\n\n&lt;ul&gt;\n  &lt;li&gt;first&lt;&#x2F;li&gt;\n  &lt;li&gt;second&lt;&#x2F;li&gt;\n  &lt;li&gt;third&lt;&#x2F;li&gt;\n&lt;&#x2F;ul&gt;</code></pre>\n\n<p>React ä¼šå…ˆåŒ¹é…ä¸¤ä¸ª <li>first</li> å¯¹åº”çš„æ ‘ï¼Œç„¶ååŒ¹é…ç¬¬äºŒä¸ªå…ƒç´  <li>second</li> å¯¹åº”çš„æ ‘ï¼Œæœ€åæ’å…¥ç¬¬ä¸‰ä¸ªå…ƒç´ çš„ <li>third</li> æ ‘ã€‚</p>\n<p>å¦‚æœåªæ˜¯ç®€å•çš„å°†æ–°å¢å…ƒç´ æ’å…¥åˆ°è¡¨å¤´ï¼Œé‚£ä¹ˆæ›´æ–°å¼€é”€ä¼šæ¯”è¾ƒå¤§ã€‚æ¯”å¦‚ï¼š</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&lt;ul&gt;\n  &lt;li&gt;Duke&lt;&#x2F;li&gt;\n  &lt;li&gt;Villanova&lt;&#x2F;li&gt;\n&lt;&#x2F;ul&gt;\n\n&lt;ul&gt;\n  &lt;li&gt;Connecticut&lt;&#x2F;li&gt;\n  &lt;li&gt;Duke&lt;&#x2F;li&gt;\n  &lt;li&gt;Villanova&lt;&#x2F;li&gt;\n&lt;&#x2F;ul&gt;</code></pre>\n\n<p>React å¹¶ä¸ä¼šæ„è¯†åˆ°åº”è¯¥ä¿ç•™ <code>&lt;li&gt;Duke&lt;/li&gt;</code> å’Œ <code>&lt;li&gt;Villanova&lt;/li&gt;</code>ï¼Œè€Œæ˜¯ä¼šé‡å»ºæ¯ä¸€ä¸ªå­å…ƒç´ ã€‚è¿™ç§æƒ…å†µä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚</p>\n<h3 id=\"Keys\"><a href=\"#Keys\" class=\"headerlink\" title=\"Keys\"></a>Keys</h3><p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼ŒReact å¼•å…¥äº† key å±æ€§ã€‚å½“å­å…ƒç´ æ‹¥æœ‰ key æ—¶ï¼ŒReact ä½¿ç”¨ key æ¥åŒ¹é…åŸæœ‰æ ‘ä¸Šçš„å­å…ƒç´ ä»¥åŠæœ€æ–°æ ‘ä¸Šçš„å­å…ƒç´ ã€‚ä»¥ä¸‹ç¤ºä¾‹åœ¨æ–°å¢ key ä¹‹åï¼Œä½¿å¾—æ ‘çš„è½¬æ¢æ•ˆç‡å¾—ä»¥æé«˜ï¼š</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&lt;ul&gt;\n  &lt;li key&#x3D;&quot;2015&quot;&gt;Duke&lt;&#x2F;li&gt;\n  &lt;li key&#x3D;&quot;2016&quot;&gt;Villanova&lt;&#x2F;li&gt;\n&lt;&#x2F;ul&gt;\n\n&lt;ul&gt;\n  &lt;li key&#x3D;&quot;2014&quot;&gt;Connecticut&lt;&#x2F;li&gt;\n  &lt;li key&#x3D;&quot;2015&quot;&gt;Duke&lt;&#x2F;li&gt;\n  &lt;li key&#x3D;&quot;2016&quot;&gt;Villanova&lt;&#x2F;li&gt;\n&lt;&#x2F;ul&gt;\n</code></pre>\n\n<p>ç°åœ¨ React çŸ¥é“åªæœ‰å¸¦ç€ <code>&#39;2014&#39;</code> key çš„å…ƒç´ æ˜¯æ–°å…ƒç´ ï¼Œå¸¦ç€ <code>&#39;2015&#39;</code> ä»¥åŠ <code>&#39;2016&#39;</code> key çš„å…ƒç´ ä»…ä»…ç§»åŠ¨äº†ã€‚</p>\n<p>å®é™…å¼€å‘ä¸­ï¼Œç¼–å†™ä¸€ä¸ª key å¹¶ä¸å›°éš¾ã€‚ä½ è¦å±•ç°çš„å…ƒç´ å¯èƒ½å·²ç»æœ‰äº†ä¸€ä¸ªå”¯ä¸€ IDï¼Œäºæ˜¯ key å¯ä»¥ç›´æ¥ä»ä½ çš„æ•°æ®ä¸­æå–ï¼š</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&lt;li key&#x3D;&#123;item.id&#125;&gt;&#123;item.name&#125;&lt;&#x2F;li&gt;</code></pre>\n\n<p>å½“ä»¥ä¸Šæƒ…å†µä¸æˆç«‹æ—¶ï¼Œä½ å¯ä»¥æ–°å¢ä¸€ä¸ª ID å­—æ®µåˆ°ä½ çš„æ¨¡å‹ä¸­ï¼Œæˆ–è€…åˆ©ç”¨ä¸€éƒ¨åˆ†å†…å®¹ä½œä¸ºå“ˆå¸Œå€¼æ¥ç”Ÿæˆä¸€ä¸ª keyã€‚<strong>è¿™ä¸ª key ä¸éœ€è¦å…¨å±€å”¯ä¸€ï¼Œä½†åœ¨åˆ—è¡¨ä¸­éœ€è¦ä¿æŒå”¯ä¸€</strong>ã€‚</p>\n<p>æœ€åï¼Œ_ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ä½œä¸º keyã€‚è¿™ä¸ªç­–ç•¥åœ¨å…ƒç´ ä¸è¿›è¡Œé‡æ–°æ’åºæ—¶æ¯”è¾ƒåˆé€‚ï¼Œå¦‚æœæœ‰é¡ºåºä¿®æ”¹ï¼Œdiff å°±ä¼šå˜æ…¢_ã€‚</p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p><strong>å½“åŸºäºä¸‹æ ‡çš„ç»„ä»¶è¿›è¡Œé‡æ–°æ’åºæ—¶ï¼Œç»„ä»¶ state å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜</strong>ã€‚ç”±äºç»„ä»¶å®ä¾‹æ˜¯åŸºäºå®ƒä»¬çš„ key æ¥å†³å®šæ˜¯å¦æ›´æ–°ä»¥åŠå¤ç”¨ï¼Œ<code>å¦‚æœ key æ˜¯ä¸€ä¸ªä¸‹æ ‡ï¼Œé‚£ä¹ˆä¿®æ”¹é¡ºåºæ—¶ä¼šä¿®æ”¹å½“å‰çš„ keyï¼Œå¯¼è‡´</code><small style=\"color: red;\">éå—æ§ç»„ä»¶çš„ stateï¼ˆæ¯”å¦‚è¾“å…¥æ¡†ï¼‰</small><code>å¯èƒ½ç›¸äº’ç¯¡æ”¹ï¼Œä¼šå‡ºç°æ— æ³•é¢„æœŸçš„å˜åŠ¨</code>ã€‚</p>\n</p>\n</div>\n<p>åœ¨ Codepen æœ‰ä¸¤ä¸ªä¾‹å­ï¼Œåˆ†åˆ«ä¸º <a href=\"https://zh-hans.reactjs.org/redirect-to-codepen/reconciliation/index-used-as-key\" target=\"_blank\" >å±•ç¤ºä½¿ç”¨ä¸‹æ ‡ä½œä¸º key æ—¶å¯¼è‡´çš„é—®é¢˜</a>ï¼Œä»¥åŠ <a href=\"https://zh-hans.reactjs.org/redirect-to-codepen/reconciliation/no-index-used-as-key\" target=\"_blank\" >ä¸ä½¿ç”¨ä¸‹æ ‡ä½œä¸º key çš„ä¾‹å­çš„ç‰ˆæœ¬ï¼Œä¿®å¤äº†é‡æ–°æ’åˆ—ï¼Œæ’åºï¼Œä»¥åŠåœ¨åˆ—è¡¨å¤´æ’å…¥çš„é—®é¢˜</a>ã€‚</p>\n<p><strong>ä¿®å¤å‰</strong></p>\n<img src=\"http://t-blog-images.aijs.top/img/Kapture 2022-07-22 at 09.23.57.gif\" style=\"max-width: 100%; width: 400px\" />\n\n<p><strong>ä¿®å¤å</strong></p>\n<img src=\"http://t-blog-images.aijs.top/img/Kapture 2022-07-22 at 09.29.46.gif\" style=\"max-width: 100%; width: 400px\" />\n\n<h2 id=\"æƒè¡¡\"><a href=\"#æƒè¡¡\" class=\"headerlink\" title=\"æƒè¡¡\"></a>æƒè¡¡</h2><p>è¯·è°¨è®°åè°ƒç®—æ³•æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚ã€‚</p>\n<p>React å¯ä»¥åœ¨æ¯ä¸ª action ä¹‹åå¯¹æ•´ä¸ªåº”ç”¨è¿›è¡Œé‡æ–°æ¸²æŸ“ï¼Œå¾—åˆ°çš„æœ€ç»ˆç»“æœä¹Ÿä¼šæ˜¯ä¸€æ ·çš„ã€‚åœ¨æ­¤æƒ…å¢ƒä¸‹ï¼Œé‡æ–°æ¸²æŸ“è¡¨ç¤ºåœ¨æ‰€æœ‰ç»„ä»¶å†…è°ƒç”¨ render æ–¹æ³•ï¼Œè¿™ä¸ä»£è¡¨ React ä¼šå¸è½½æˆ–è£…è½½å®ƒä»¬ã€‚React åªä¼šåŸºäºä»¥ä¸Šæåˆ°çš„è§„åˆ™æ¥å†³å®šå¦‚ä½•è¿›è¡Œå·®å¼‚çš„åˆå¹¶ã€‚</p>\n<p>æˆ‘ä»¬å®šæœŸä¼˜åŒ–å¯å‘å¼ç®—æ³•ï¼Œè®©å¸¸è§ç”¨ä¾‹æ›´é«˜æ•ˆåœ°æ‰§è¡Œã€‚<strong>åœ¨å½“å‰çš„å®ç°ä¸­ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€æ£µå­æ ‘èƒ½åœ¨å…¶å…„å¼Ÿä¹‹é—´ç§»åŠ¨ï¼Œä½†ä¸èƒ½ç§»åŠ¨åˆ°å…¶ä»–ä½ç½®ã€‚</strong>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç®—æ³•ä¼šé‡æ–°æ¸²æŸ“æ•´æ£µå­æ ‘ã€‚</p>\n<p>ç”±äº React ä¾èµ–å¯å‘å¼ç®—æ³•ï¼Œå› æ­¤å½“ä»¥ä¸‹å‡è®¾æ²¡æœ‰å¾—åˆ°æ»¡è¶³ï¼Œæ€§èƒ½ä¼šæœ‰æ‰€æŸè€—ã€‚</p>\n<ul>\n<li>è¯¥ç®—æ³•ä¸ä¼šå°è¯•åŒ¹é…ä¸åŒç»„ä»¶ç±»å‹çš„å­æ ‘ã€‚<strong>å¦‚æœä½ å‘ç°ä½ åœ¨ä¸¤ç§ä¸åŒç±»å‹çš„ç»„ä»¶ä¸­åˆ‡æ¢ï¼Œä½†è¾“å‡ºéå¸¸ç›¸ä¼¼çš„å†…å®¹ï¼Œå»ºè®®æŠŠå®ƒä»¬æ”¹æˆåŒä¸€ç±»å‹</strong>ã€‚åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰é‡åˆ°è¿™ç±»é—®é¢˜ã€‚<br/>\n<br/></li>\n<li>Key åº”è¯¥å…·æœ‰ç¨³å®šï¼Œå¯é¢„æµ‹ï¼Œä»¥åŠåˆ—è¡¨å†…å”¯ä¸€çš„ç‰¹è´¨ã€‚ä¸ç¨³å®šçš„ keyï¼ˆæ¯”å¦‚é€šè¿‡ Math.random() ç”Ÿæˆçš„ï¼‰ä¼šå¯¼è‡´è®¸å¤šç»„ä»¶å®ä¾‹å’Œ DOM èŠ‚ç‚¹è¢«ä¸å¿…è¦åœ°é‡æ–°åˆ›å»ºï¼Œ<strong>è¿™å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™å’Œå­ç»„ä»¶ä¸­çš„çŠ¶æ€ä¸¢å¤±ã€‚</strong></li>\n</ul>\n<h2 id=\"diffing-algorithm\"><a href=\"#diffing-algorithm\" class=\"headerlink\" title=\"diffing algorithm\"></a>diffing algorithm</h2><p><a href=\"https://react.iamkasong.com/diff/prepare.html#diff%E7%9A%84%E7%93%B6%E9%A2%88%E4%BB%A5%E5%8F%8Areact%E5%A6%82%E4%BD%95%E5%BA%94%E5%AF%B9\" target=\"_blank\" >è§</a></p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>æ³¨æ„ï¼šReact æŠ€æœ¯æ­ç§˜è®²çš„å†…å®¹å¹¶ä¸ä¸€å®šæ˜¯å…¨é¢ä¸”æ­£ç¡®çš„ï¼Œå¯èƒ½ä½ åœ¨è¯»çš„æºç ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œä½†å¯å€Ÿé‰´</p>\n</div>\n<h2 id=\"reconcileChildFibers\"><a href=\"#reconcileChildFibers\" class=\"headerlink\" title=\"reconcileChildFibers\"></a>reconcileChildFibers</h2><img src=\"http://t-blog-images.aijs.top/img/begin-diff.png\" />\n\n<p>è¯»æºç ä¸­â€¦</p>\n<h2 id=\"å‚è€ƒé“¾æ¥\"><a href=\"#å‚è€ƒé“¾æ¥\" class=\"headerlink\" title=\"å‚è€ƒé“¾æ¥\"></a>å‚è€ƒé“¾æ¥</h2><p><a href=\"https://zh-hans.reactjs.org/docs/reconciliation.html#the-diffing-algorithm\" target=\"_blank\" >reconciliation</a></p>\n<p><a href=\"https://blog.csdn.net/weixin_47431743/article/details/121589419\" target=\"_blank\" >ä»£ç è°ƒè¯•</a></p>\n<p><a href=\"https://www.jianshu.com/p/c87cc324756f\" target=\"_blank\" >æ¢ç´¢ React æºç ï¼šReconciler</a></p>\n","text":"è¯´æ˜ React provides a declarative API so that you donâ€™t have to worry about exactly what changes on every update. This makes writing applicati...","link":"","photos":[],"count_time":{"symbolsCount":"5k","symbolsTime":"5 mins."},"categories":[{"name":"react_1650","slug":"react-1650","count":5,"path":"api/categories/react-1650.json"}],"tags":[{"name":"react_1650","slug":"react-1650","count":5,"path":"api/tags/react-1650.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AF%B4%E6%98%8E\"><span class=\"toc-text\">è¯´æ˜</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AE%BE%E8%AE%A1%E5%8A%A8%E6%9C%BA\"><span class=\"toc-text\">è®¾è®¡åŠ¨æœº</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Diffing-%E7%AE%97%E6%B3%95\"><span class=\"toc-text\">Diffing ç®—æ³•</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E6%AF%94%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%85%83%E7%B4%A0\"><span class=\"toc-text\">å¯¹æ¯”ä¸åŒç±»å‹çš„å…ƒç´ </span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E6%AF%94%E5%90%8C%E4%B8%80%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%85%83%E7%B4%A0\"><span class=\"toc-text\">å¯¹æ¯”åŒä¸€ç±»å‹çš„å…ƒç´ </span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E6%AF%94%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%BB%84%E4%BB%B6%E5%85%83%E7%B4%A0\"><span class=\"toc-text\">å¯¹æ¯”åŒç±»å‹çš„ç»„ä»¶å…ƒç´ </span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E5%AD%90%E8%8A%82%E7%82%B9%E8%BF%9B%E8%A1%8C%E9%80%92%E5%BD%92\"><span class=\"toc-text\">å¯¹å­èŠ‚ç‚¹è¿›è¡Œé€’å½’</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Keys\"><span class=\"toc-text\">Keys</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9D%83%E8%A1%A1\"><span class=\"toc-text\">æƒè¡¡</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#diffing-algorithm\"><span class=\"toc-text\">diffing algorithm</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#reconcileChildFibers\"><span class=\"toc-text\">reconcileChildFibers</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\"><span class=\"toc-text\">å‚è€ƒé“¾æ¥</span></a></li></ol>","author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"React@16ã€17 æ‚è´§","uid":"7914c7b61758cb63e0d9afa98b764a25","slug":"2022-07-23react-æ‚è´§","date":"2022-07-22T16:25:08.000Z","updated":"2022-09-16T15:02:50.889Z","comments":true,"path":"api/articles/2022-07-23react-æ‚è´§.json","keywords":null,"cover":null,"text":"æ³¨æ„ç‰ˆæœ¬å“ˆä»å‰æœ‰åº§å±±ä¹‹ react æºç è§£è¯»ä¹‹ ReactContext React æºç è§£æâ€”â€”â€”â€”ReactContext.js,ReactLazy.js React çš„ React.createRef()&#x2F;forwardRef()æºç è§£æ(ä¸‰) React çš„ R...","link":"","photos":[],"count_time":{"symbolsCount":"5.3k","symbolsTime":"5 mins."},"categories":[{"name":"React","slug":"React","count":18,"path":"api/categories/React.json"}],"tags":[{"name":"React","slug":"React","count":12,"path":"api/tags/React.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"React@16.5.0 PureComponent","uid":"d6e3ef07929a629e78ad737d602fe838","slug":"2022-07-21react-PureComponent","date":"2022-07-21T08:28:39.000Z","updated":"2022-09-16T15:02:32.005Z","comments":true,"path":"api/articles/2022-07-21react-PureComponent.json","keywords":null,"cover":[],"text":"ä¸²ä¸² PureComponent ç»§æ‰¿ Component,æ·»åŠ  isPureReactComponent æ ‡è®° &#x2F;&#x2F; ComponentDummy æ˜¯å…¸å‹çš„ JavaScript åŸå‹æ¨¡æ‹Ÿç»§æ‰¿çš„åšæ³•ï¼Œ function ComponentDummy() &#...","link":"","photos":[],"count_time":{"symbolsCount":"7.7k","symbolsTime":"7 mins."},"categories":[{"name":"react_1650","slug":"react-1650","count":5,"path":"api/categories/react-1650.json"}],"tags":[{"name":"react_1650","slug":"react-1650","count":5,"path":"api/tags/react-1650.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}