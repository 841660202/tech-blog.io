{"title":"monorepo","uid":"98f521cd056816f8a9831692e48a6839","slug":"2022-05-23monorepo","date":"2022-05-23T06:45:12.000Z","updated":"2022-05-26T14:12:56.679Z","comments":true,"path":"api/articles/2022-05-23monorepo.json","keywords":null,"cover":"https://segmentfault.com/img/remote/1460000038683984","content":"<h2 id=\"èƒŒæ™¯\"><a href=\"#èƒŒæ™¯\" class=\"headerlink\" title=\"èƒŒæ™¯\"></a>èƒŒæ™¯</h2><ul>\n<li>è°ƒè¯•æºç æ—¶å€™ï¼Œæ€»ä¼šé‡åˆ°å¤šåŒ…çš„ä»“åº“ï¼Œé‡åˆ°äº†ä¸æ™“å¾—å¦‚ä½•è°ƒè¯•</li>\n<li>å¼€å‘ä¸ªåº“æˆ–è€…æ˜¯æ’ä»¶ä¹‹ç±»çš„å¼€å‘çš„æ¯”è¾ƒæ··ä¹±</li>\n<li>ç»å†å¤šä¸ªé¡¹ç›®çš„æ¯’æ‰“ï¼Œç»ˆäºæœ‰æ—¶é—´å­¦ä¸‹<code>monorepo</code></li>\n</ul>\n<h2 id=\"lernaã€yarn-workspace\"><a href=\"#lernaã€yarn-workspace\" class=\"headerlink\" title=\"lernaã€yarn workspace\"></a>lernaã€yarn workspace</h2><ul>\n<li>å’Œjavaå¾®æœåŠ¡æ¶æ„ä»£ç å¾ˆåƒ</li>\n<li>å¾ˆå¤šé¡¹ç›®æ˜¯ lerna+yarn workspaceï¼Œå¦‚æœä¸æ‡‚ï¼Œæˆ–è€…äº†è§£äº†ä¸€ç‚¹<code>lerna</code>ã€‚ä¸Šå»ä¸€é¡¿æ“ä½œï¼Œå„ç§æŠ¥é”™ï¼Œåœ¨æ‰€éš¾å…ï¼ˆäº²èº«ç»å†ï¼‰</li>\n</ul>\n<h2 id=\"monorepoç®¡ç†\"><a href=\"#monorepoç®¡ç†\" class=\"headerlink\" title=\"monorepoç®¡ç†\"></a>monorepoç®¡ç†</h2><p>å¯¹äºç»´æŠ¤è¿‡å¤šä¸ªpackage(åŠŸèƒ½ç›¸è¿‘)çš„åŒå­¦æ¥è¯´ï¼Œéƒ½ä¼šé‡åˆ°ä¸€ä¸ªé€‰æ‹©é¢˜ï¼Œè¿™äº›packageæ˜¯æ”¾åœ¨ä¸€ä¸ªä»“åº“é‡Œç»´æŠ¤è¿˜æ˜¯æ”¾åœ¨å¤šä¸ªä»“åº“é‡Œå•ç‹¬ç»´æŠ¤ã€‚Multirepo æ˜¯æ¯”è¾ƒä¼ ç»Ÿçš„åšæ³•ï¼Œå³æ¯ä¸€ä¸ª package éƒ½å•ç‹¬ç”¨ä¸€ä¸ªä»“åº“æ¥è¿›è¡Œç®¡ç†ã€‚Monorepo æ˜¯ç®¡ç†é¡¹ç›®ä»£ç çš„ä¸€ä¸ªæ–¹å¼ï¼ŒæŒ‡åœ¨ä¸€ä¸ªé¡¹ç›®ä»“åº“ (repo) ä¸­ç®¡ç†å¤šä¸ªæ¨¡å—&#x2F;åŒ… (package)ï¼Œä¸åŒäºå¸¸è§çš„æ¯ä¸ªæ¨¡å—å»ºä¸€ä¸ª repoã€‚</p>\n<p>ç›®å‰æœ‰ä¸å°‘å¤§å‹å¼€æºé¡¹ç›®é‡‡ç”¨äº†è¿™ç§æ–¹å¼ï¼Œå¦‚ Babelï¼ŒReact, Meteor, Ember, Angular,Jest, Umijs, Vue, è¿˜æœ‰ create-react-app, react-router ç­‰ã€‚å‡ ä¹æˆ‘ä»¬ç†ŸçŸ¥çš„ä»“åº“ï¼Œéƒ½æ— ä¸€ä¾‹å¤–çš„é‡‡ç”¨äº†monorepo çš„æ–¹å¼ï¼Œå¯ä»¥çœ‹åˆ°è¿™äº›é¡¹ç›®çš„ç¬¬ä¸€çº§ç›®å½•çš„å†…å®¹ä»¥è„šæ‰‹æ¶ä¸ºä¸»ï¼Œä¸»è¦å†…å®¹éƒ½åœ¨ packagesç›®å½•ä¸­ã€åˆ†å¤šä¸ª package è¿›è¡Œç®¡ç†ã€‚</p>\n<p>ç›®å½•ç»“æ„å¦‚ä¸‹:</p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">â”œâ”€â”€ packages\n|   â”œâ”€â”€ pkg1\n|   |   â”œâ”€â”€ package.json\n|   â”œâ”€â”€ pkg2\n|   |   â”œâ”€â”€ package.json\nâ”œâ”€â”€ package.json\n</code></pre>\n<p>monorepo æœ€ä¸»è¦çš„å¥½å¤„æ˜¯ç»Ÿä¸€çš„å·¥ä½œæµå’ŒCode Sharingã€‚æ¯”å¦‚æˆ‘æƒ³çœ‹ä¸€ä¸ª pacakge çš„ä»£ç ã€äº†è§£æŸæ®µé€»è¾‘ï¼Œä¸éœ€è¦æ‰¾å®ƒçš„ repoï¼Œç›´æ¥å°±åœ¨å½“å‰ repoï¼›å½“æŸä¸ªéœ€æ±‚è¦ä¿®æ”¹å¤šä¸ª pacakge æ—¶ï¼Œä¸éœ€è¦åˆ†åˆ«åˆ°å„è‡ªçš„ repo è¿›è¡Œä¿®æ”¹ã€æµ‹è¯•ã€å‘ç‰ˆæˆ–è€… npm linkï¼Œç›´æ¥åœ¨å½“å‰ repo ä¿®æ”¹ï¼Œç»Ÿä¸€æµ‹è¯•ã€ç»Ÿä¸€å‘ç‰ˆã€‚åªè¦æ­å»ºä¸€å¥—è„šæ‰‹æ¶ï¼Œå°±èƒ½ç®¡ç†ï¼ˆæ„å»ºã€æµ‹è¯•ã€å‘å¸ƒï¼‰å¤šä¸ª packageã€‚</p>\n<p>ä¸€å›¾èƒœåƒè¨€:<br><img src=\"https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS84LzE4LzE2Y2EyOThmNTYwZDgxZDg\"></p>\n<p>å‰è€…å…è®¸å¤šå…ƒåŒ–å‘å±•ï¼ˆå„é¡¹ç›®å¯ä»¥æœ‰è‡ªå·±çš„æ„å»ºå·¥å…·ã€ä¾èµ–ç®¡ç†ç­–ç•¥ã€å•å…ƒæµ‹è¯•æ–¹æ³•ï¼‰ï¼Œåè€…å¸Œæœ›é›†ä¸­ç®¡ç†ï¼Œå‡å°‘é¡¹ç›®é—´çš„å·®å¼‚å¸¦æ¥çš„æ²Ÿé€šæˆæœ¬ã€‚</p>\n<p>è™½ç„¶æ‹†åˆ†å­ä»“åº“ã€æ‹†åˆ†å­ npm åŒ…æ˜¯è¿›è¡Œé¡¹ç›®éš”ç¦»çš„å¤©ç„¶æ–¹æ¡ˆï¼Œä½†å½“ä»“åº“å†…å®¹å‡ºç°å…³è”æ—¶ï¼Œæ²¡æœ‰ä»»ä½•ä¸€ç§è°ƒè¯•æ–¹å¼æ¯”æºç æ”¾åœ¨ä¸€èµ·æ›´é«˜æ•ˆã€‚</p>\n<p>ç»“åˆshop-serviceé—¨æˆ·çš„å®é™…åœºæ™¯å’Œä¸šåŠ¡éœ€è¦ï¼Œå¤©ç„¶çš„ MonoRepo ! ä¸€ä¸ªç†æƒ³çš„å¼€å‘ç¯å¢ƒå¯ä»¥æŠ½è±¡æˆè¿™æ ·ï¼š</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>â€œåªå…³å¿ƒä¸šåŠ¡ä»£ç ï¼Œå¯ä»¥ç›´æ¥è·¨ä¸šåŠ¡å¤ç”¨è€Œä¸å…³å¿ƒå¤ç”¨æ–¹å¼ï¼Œè°ƒè¯•æ—¶æ‰€æœ‰ä»£ç éƒ½åœ¨æºç ä¸­ã€‚â€</p></blockquote>\n<p>åœ¨å‰ç«¯å¼€å‘ç¯å¢ƒä¸­ï¼Œå¤š Git Repoï¼Œå¤š npm åˆ™æ˜¯è¿™ä¸ªç†æƒ³çš„é˜»åŠ›ï¼Œå®ƒä»¬å¯¼è‡´å¤ç”¨è¦å…³å¿ƒç‰ˆæœ¬å·ï¼Œè°ƒè¯•éœ€è¦ npm linkã€‚è€Œè¿™äº›æ˜¯ MonoRepo æœ€å¤§çš„ä¼˜åŠ¿ã€‚</p>\n<p>ä¸Šå›¾ä¸­æåˆ°çš„åˆ©ç”¨ç›¸å…³å·¥å…·å°±æ˜¯ä»Šå¤©çš„ä¸»è§’ Lerna ! Lernaæ˜¯ä¸šç•ŒçŸ¥ååº¦æœ€é«˜çš„ Monorepo ç®¡ç†å·¥å…·ï¼ŒåŠŸèƒ½å®Œæ•´ã€‚</p>\n<h2 id=\"Lerna\"><a href=\"#Lerna\" class=\"headerlink\" title=\"Lerna\"></a>Lerna</h2><p>Lerna æ˜¯ä¸€ä¸ªç®¡ç†å¤šä¸ª npm æ¨¡å—çš„å·¥å…·ï¼Œæ˜¯ Babel è‡ªå·±ç”¨æ¥ç»´æŠ¤è‡ªå·±çš„ Monorepo å¹¶å¼€æºå‡ºçš„ä¸€ä¸ªé¡¹ç›®ã€‚ä¼˜åŒ–ç»´æŠ¤å¤šåŒ…çš„å·¥ä½œæµï¼Œè§£å†³å¤šä¸ªåŒ…äº’ç›¸ä¾èµ–ï¼Œä¸”å‘å¸ƒéœ€è¦æ‰‹åŠ¨ç»´æŠ¤å¤šä¸ªåŒ…çš„é—®é¢˜ã€‚</p>\n<p>2.1 å®‰è£…<br>æ¨èå…¨å±€å®‰è£…ï¼Œå› ä¸ºä¼šç»å¸¸ç”¨åˆ° lerna å‘½ä»¤</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">npm i -g lerna</code></pre>\n<p>2.2 åˆå§‹åŒ–é¡¹ç›®</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">lerna init</code></pre>\n<p><img src=\"https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS84LzE4LzE2Y2EyOWE5MDhiMTkyOWQ\"></p>\n<p>å…¶ä¸­ package.json &amp; lerna.json å¦‚ä¸‹:</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#x2F;&#x2F; package.json\n&#123;\n  &quot;name&quot;: &quot;root&quot;,\n  &quot;private&quot;: true, &#x2F;&#x2F; ç§æœ‰çš„ï¼Œä¸ä¼šè¢«å‘å¸ƒï¼Œæ˜¯ç®¡ç†æ•´ä¸ªé¡¹ç›®ï¼Œä¸è¦å‘å¸ƒåˆ°npmçš„è§£è€¦\n  &quot;devDependencies&quot;: &#123;\n    &quot;lerna&quot;: &quot;^3.15.0&quot;\n  &#125;\n&#125;\n \n&#x2F;&#x2F; lerna.json\n&#123;\n  &quot;packages&quot;: [\n    &quot;packages&#x2F;*&quot;\n  ],\n  &quot;version&quot;: &quot;0.0.0&quot;\n&#125;\n</code></pre>\n\n<p>2.3 åˆ›å»ºnpmåŒ…<br>å¢åŠ ä¸¤ä¸ª packages</p>\n<p><img src=\"https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS84LzE4LzE2Y2EyOWIyOTgzNjExZDE\"></p>\n<p>2.4 å¢åŠ æ¨¡å—ä¾èµ–<br>åˆ†åˆ«ç»™ç›¸åº”çš„ package å¢åŠ ä¾èµ–æ¨¡å—</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">lerna add chalk &#x2F;&#x2F; ä¸ºæ‰€æœ‰ package å¢åŠ  chalk æ¨¡å— \nlerna add semver --scope @mo-demo&#x2F;cli-shared-utils &#x2F;&#x2F; ä¸º @mo-demo&#x2F;cli-shared-utils å¢åŠ  semver æ¨¡å— \nlerna add @mo-demo&#x2F;cli-shared-utils --scope @mo-demo&#x2F;cli &#x2F;&#x2F; å¢åŠ å†…éƒ¨æ¨¡å—ä¹‹é—´çš„ä¾èµ–</code></pre>\n<p><img src=\"https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS84LzE4LzE2Y2EyOWI2NTNmMGQ5NjQ\"></p>\n<p>2.5 å‘å¸ƒ</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">lerna publish</code></pre>\n<p><img src=\"https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS84LzE4LzE2Y2EyOWJiMWY4MjhjZjk\"></p>\n<p>2.6 ä¾èµ–åŒ…ç®¡ç†<br>ä¸Šè¿°1-5æ­¥å·²ç»åŒ…å«äº† Lerna æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„è¿‡ç¨‹äº†ï¼Œä½†å½“æˆ‘ä»¬ç»´æŠ¤è¿™ä¸ªé¡¹ç›®æ—¶ï¼Œæ–°æ‹‰ä¸‹æ¥ä»“åº“çš„ä»£ç åï¼Œéœ€è¦ä¸ºå„ä¸ª package å®‰è£…ä¾èµ–åŒ…ã€‚</p>\n<p>æˆ‘ä»¬åœ¨ç¬¬4æ­¥ lerna add æ—¶ä¹Ÿå‘ç°äº†ï¼Œä¸ºæŸä¸ª package å®‰è£…çš„åŒ…è¢«æ”¾åˆ°äº†è¿™ä¸ª package ç›®å½•ä¸‹çš„ node_modules ç›®å½•ä¸‹ã€‚è¿™æ ·å¯¹äºå¤šä¸ª package éƒ½ä¾èµ–çš„åŒ…ï¼Œä¼šè¢«å¤šä¸ª package å®‰è£…å¤šæ¬¡ï¼Œå¹¶ä¸”æ¯ä¸ª package ä¸‹éƒ½ç»´æŠ¤ node_modules ï¼Œä¹Ÿä¸æ¸…çˆ½ã€‚äºæ˜¯æˆ‘ä»¬ä½¿ç”¨ â€“hoist æ¥æŠŠæ¯ä¸ª package ä¸‹çš„ä¾èµ–åŒ…éƒ½æå‡åˆ°å·¥ç¨‹æ ¹ç›®å½•ï¼Œæ¥é™ä½å®‰è£…ä»¥åŠç®¡ç†çš„æˆæœ¬ã€‚</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">lerna bootstrap --hoist</code></pre>\n<p><img src=\"https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS84LzE4LzE2Y2EyOWJmNjUxZDkxMWY\"></p>\n<p>ä¸ºäº†çœå»æ¯æ¬¡éƒ½è¾“å…¥ â€“hoist å‚æ•°çš„éº»çƒ¦ï¼Œå¯ä»¥åœ¨ lerna.json é…ç½®ï¼š</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;packages&quot;: [\n    &quot;packages&#x2F;*&quot;\n  ],\n  &quot;command&quot;: &#123;\n    &quot;bootstrap&quot;: &#123;\n      &quot;hoist&quot;: true\n    &#125;\n  &#125;,\n  &quot;version&quot;: &quot;0.0.1-alpha.0&quot;\n&#125;</code></pre>\n<p>é…ç½®å¥½åï¼Œå¯¹äºä¹‹å‰ä¾èµ–åŒ…å·²ç»è¢«å®‰è£…åˆ°å„ä¸ª package ä¸‹çš„æƒ…å†µï¼Œæˆ‘ä»¬åªéœ€è¦æ¸…ç†ä¸€ä¸‹å®‰è£…çš„ä¾èµ–å³å¯ï¼š</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">lerna clean</code></pre>\n<img src=\"https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS84LzE4LzE2Y2EyOWM2OTdjODVjMWM\" width=350 style=\"object-fit:contain\"/>\nç„¶åæ‰§è¡Œ lerna bootstrap å³å¯çœ‹åˆ° package çš„ä¾èµ–éƒ½è¢«å®‰è£…åˆ°æ ¹ç›®å½•ä¸‹çš„ `node_modules` ä¸­äº†ã€‚\n\n<h2 id=\"Lerna-Monorepo-æœ€ä½³å®è·µ\"><a href=\"#Lerna-Monorepo-æœ€ä½³å®è·µ\" class=\"headerlink\" title=\"Lerna + Monorepo æœ€ä½³å®è·µ\"></a>Lerna + Monorepo æœ€ä½³å®è·µ</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>lernaä¸è´Ÿè´£æ„å»ºï¼Œæµ‹è¯•ç­‰ä»»åŠ¡ï¼Œå®ƒæå‡ºäº†ä¸€ç§é›†ä¸­ç®¡ç†packageçš„ç›®å½•æ¨¡å¼ï¼Œæä¾›äº†ä¸€å¥—è‡ªåŠ¨åŒ–ç®¡ç†ç¨‹åºï¼Œè®©å¼€å‘è€…ä¸å¿…å†æ·±è€•åˆ°å…·ä½“çš„ç»„ä»¶é‡Œç»´æŠ¤å†…å®¹ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•å°±å¯ä»¥å…¨å±€æŒæ§ï¼ŒåŸºäº npm scriptsï¼Œä½¿ç”¨è€…å¯ä»¥å¾ˆå¥½åœ°å®Œæˆç»„ä»¶æ„å»ºï¼Œä»£ç æ ¼å¼åŒ–ç­‰æ“ä½œã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼Œå¦‚æœåŸºäº Lernaï¼Œå¹¶ç»“åˆå…¶å®ƒå·¥å…·æ¥æ­å»º Monorepo é¡¹ç›®çš„æœ€ä½³å®è·µã€‚</p></blockquote>\n<p>ç›®å‰æœ€å¸¸è§çš„ monorepo è§£å†³æ–¹æ¡ˆæ˜¯ Lerna å’Œ yarn çš„ workspaces ç‰¹æ€§ï¼ŒåŸºäºlernaå’Œyarn workspaceçš„monorepoå·¥ä½œæµã€‚ç”±äºyarnå’Œlernaåœ¨åŠŸèƒ½ä¸Šæœ‰è¾ƒå¤šçš„é‡å ,æˆ‘ä»¬é‡‡ç”¨yarnå®˜æ–¹æ¨èçš„åšæ³•,ç”¨yarnæ¥å¤„ç†ä¾èµ–é—®é¢˜ï¼Œç”¨lernaæ¥å¤„ç†å‘å¸ƒé—®é¢˜ã€‚èƒ½ç”¨yarnåšçš„å°±ç”¨yarnåšå§</p>\n<h2 id=\"yarn-workspace\"><a href=\"#yarn-workspace\" class=\"headerlink\" title=\"yarn workspace\"></a>yarn workspace</h2><p>3.1.1 æ­å»ºç¯å¢ƒ<br>æ™®é€šé¡¹ç›®ï¼šcloneä¸‹æ¥åé€šè¿‡yarn install,å³å¯æ­å»ºå®Œé¡¹ç›®ï¼Œæœ‰æ—¶éœ€è¦é…åˆpostinstall hooks,æ¥è¿›è¡Œè‡ªåŠ¨ç¼–è¯‘ï¼Œæˆ–è€…å…¶ä»–è®¾ç½®ã€‚</p>\n<p>monorepo: å„ä¸ªåº“ä¹‹é—´å­˜åœ¨ä¾èµ–ï¼Œå¦‚Aä¾èµ–äºBï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸éœ€è¦å°†B linkåˆ°Açš„node_moduleé‡Œï¼Œä¸€æ—¦ä»“åº“å¾ˆå¤šçš„è¯ï¼Œæ‰‹åŠ¨çš„ç®¡ç†è¿™äº›linkæ“ä½œè´Ÿæ‹…å¾ˆå¤§ï¼Œå› æ­¤éœ€è¦è‡ªåŠ¨åŒ–çš„linkæ“ä½œï¼ŒæŒ‰ç…§æ‹“æ‰‘æ’åºå°†å„ä¸ªä¾èµ–è¿›è¡Œlink</p>\n<p>è§£å†³æ–¹å¼ï¼šé€šè¿‡ä½¿ç”¨workspaceï¼Œyarn installä¼šè‡ªåŠ¨çš„å¸®å¿™è§£å†³å®‰è£…å’Œlinké—®é¢˜</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">yarn install # ç­‰ä»·äº lerna bootstrap --npm-client yarn --use-workspaces\n</code></pre>\n<p>3.1.2 æ¸…ç†ç¯å¢ƒ<br>åœ¨ä¾èµ–ä¹±æ‰æˆ–è€…å·¥ç¨‹æ··ä¹±çš„æƒ…å†µä¸‹ï¼Œæ¸…ç†ä¾èµ–</p>\n<p>æ™®é€šé¡¹ç›®ï¼š ç›´æ¥åˆ é™¤node_modulesä»¥åŠç¼–è¯‘åçš„äº§ç‰©ã€‚</p>\n<p>monorepoï¼š ä¸ä»…éœ€è¦åˆ é™¤rootçš„node_modulesçš„ç¼–è¯‘äº§ç‰©è¿˜éœ€è¦åˆ é™¤å„ä¸ªpackageé‡Œçš„node_modulesä»¥åŠç¼–è¯‘äº§ç‰©</p>\n<p>è§£å†³æ–¹å¼ï¼šä½¿ç”¨lerna cleanæ¥åˆ é™¤æ‰€æœ‰çš„node_modulesï¼Œä½¿ç”¨yarn workspaces run cleanæ¥æ‰§è¡Œæ‰€æœ‰packageçš„æ¸…ç†å·¥ä½œ</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">lerna clean # æ¸…ç†æ‰€æœ‰çš„node_modules\nyarn workspaces run clean # æ‰§è¡Œæ‰€æœ‰packageçš„cleanæ“ä½œ\n</code></pre>\n<p>3.1.3 å®‰è£…|åˆ é™¤ä¾èµ–<br>æ™®é€šé¡¹ç›®ï¼š é€šè¿‡yarn addå’Œyarn removeå³å¯ç®€å•å§è§£å†³ä¾èµ–åº“çš„å®‰è£…å’Œåˆ é™¤é—®é¢˜</p>\n<p>monorepo: ä¸€èˆ¬åˆ†ä¸ºä¸‰ç§åœºæ™¯</p>\n<p>ç»™æŸä¸ªpackageå®‰è£…ä¾èµ–ï¼šyarn workspace packageB add packageA å°†packageAä½œä¸ºpackageBçš„ä¾èµ–è¿›è¡Œå®‰è£…</p>\n<p>ç»™æ‰€æœ‰çš„packageå®‰è£…ä¾èµ–: ä½¿ç”¨yarn workspaces add lodash ç»™æ‰€æœ‰çš„packageå®‰è£…ä¾èµ–</p>\n<p>ç»™root å®‰è£…ä¾èµ–ï¼šä¸€èˆ¬çš„å…¬ç”¨çš„å¼€å‘å·¥å…·éƒ½æ˜¯å®‰è£…åœ¨rooté‡Œï¼Œå¦‚typescript,æˆ‘ä»¬ä½¿ç”¨yarn add -W -D typescriptæ¥ç»™rootå®‰è£…ä¾èµ–</p>\n<p>å¯¹åº”çš„ä¸‰ç§åœºæ™¯åˆ é™¤ä¾èµ–å¦‚ä¸‹</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">yarn workspace packageB remove packageA\nyarn workspaces remove lodash\nyarn remove -W -D typescript\n</code></pre>\n\n<p>3.1.4 é¡¹ç›®æ„å»º<br>æ™®é€šé¡¹ç›®ï¼šå»ºç«‹ä¸€ä¸ªbuildçš„npm scriptï¼Œä½¿ç”¨yarn buildå³å¯å®Œæˆé¡¹ç›®æ„å»º</p>\n<p>monorepo:åŒºåˆ«äºæ™®é€šé¡¹ç›®ä¹‹å¤„åœ¨äºå„ä¸ªpackageä¹‹é—´å­˜åœ¨ç›¸äº’ä¾èµ–ï¼Œå¦‚packageBåªæœ‰åœ¨packageAæ„å»ºå®Œä¹‹åæ‰èƒ½è¿›è¡Œæ„å»ºï¼Œå¦åˆ™å°±ä¼šå‡ºé”™ï¼Œè¿™å®é™…ä¸Šè¦æ±‚æˆ‘ä»¬ä»¥ä¸€ç§æ‹“æ‰‘æ’åºçš„è§„åˆ™è¿›è¡Œæ„å»ºã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„å»ºæ‹“æ‰‘æ’åºè§„åˆ™ï¼Œå¾ˆä¸å¹¸çš„æ˜¯yarnçš„workspaceæš‚æ—¶å¹¶æœªæ”¯æŒæŒ‰ç…§æ‹“æ‰‘æ’åºè§„åˆ™æ‰§è¡Œå‘½ä»¤,è™½ç„¶è¯¥ rfcå·²ç»è¢«acceptedï¼Œä½†æ˜¯å°šæœªå®ç°, å¹¸è¿çš„æ˜¯lernaæ”¯æŒæŒ‰ç…§æ‹“æ‰‘æ’åºè§„åˆ™æ‰§è¡Œå‘½ä»¤, â€“sortå‚æ•°å¯ä»¥æ§åˆ¶ä»¥æ‹“æ‰‘æ’åºè§„åˆ™æ‰§è¡Œå‘½ä»¤</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">lerna run --stream --sort build</code></pre>\n<p>3.1.5 ç‰ˆæœ¬å‡çº§åŠå‘åŒ…<br>é¡¹ç›®æµ‹è¯•å®Œæˆåï¼Œå°±æ¶‰åŠåˆ°ç‰ˆæœ¬å‘å¸ƒï¼Œç‰ˆæœ¬å‘å¸ƒä¸€èˆ¬æ¶‰åŠåˆ°å¦‚ä¸‹ä¸€äº›æ­¥éª¤</p>\n<p>æ¡ä»¶éªŒè¯: å¦‚éªŒè¯æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼Œæ˜¯å¦å­˜åœ¨æœªæäº¤çš„ä»£ç ï¼Œæ˜¯å¦åœ¨ä¸»åˆ†æ”¯ä¸Šè¿›è¡Œç‰ˆæœ¬å‘å¸ƒæ“ä½œ</p>\n<p>version_bump:å‘ç‰ˆçš„æ—¶å€™éœ€è¦æ›´æ–°ç‰ˆæœ¬å·ï¼Œè¿™æ—¶å€™å¦‚ä½•æ›´æ–°ç‰ˆæœ¬å·å°±æ˜¯ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬å¤§å®¶éƒ½ä¼šéµå¾ª semVerè¯­ä¹‰ï¼Œ</p>\n<p>ç”Ÿæˆchangelog: ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ¯ä¸ªpackageæ¯ä¸ªç‰ˆæœ¬è§£å†³äº†å“ªäº›åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ç»™æ¯ä¸ªpackageéƒ½ç”Ÿæˆä¸€ä»½changelogæ–¹ä¾¿ç”¨æˆ·æŸ¥çœ‹å„ä¸ªç‰ˆæœ¬çš„åŠŸèƒ½å˜åŒ–ã€‚</p>\n<p>ç”Ÿæˆgit tagï¼šä¸ºäº†æ–¹ä¾¿åç»­å›æ»šé—®é¢˜åŠé—®é¢˜æ’æŸ¥é€šå¸¸éœ€è¦ç»™æ¯ä¸ªç‰ˆæœ¬åˆ›å»ºä¸€ä¸ªgit tag</p>\n<p>git å‘å¸ƒç‰ˆæœ¬ï¼šæ¯æ¬¡å‘ç‰ˆæˆ‘ä»¬éƒ½éœ€è¦å•ç‹¬ç”Ÿæˆä¸€ä¸ªcommitè®°å½•æ¥æ ‡è®°milestone</p>\n<p>å‘å¸ƒnpmåŒ…ï¼šå‘å¸ƒå®Œgitåæˆ‘ä»¬è¿˜éœ€è¦å°†æ›´æ–°çš„ç‰ˆæœ¬å‘å¸ƒåˆ°npmä¸Šï¼Œä»¥ä¾¿å¤–éƒ¨ç”¨æˆ·ä½¿ç”¨</p>\n<p>æˆ‘ä»¬å‘ç°æ‰‹åŠ¨çš„æ‰§è¡Œè¿™äº›æ“ä½œæ˜¯å¾ˆéº»çƒ¦çš„ä¸”åŠå…¶å®¹æ˜“å‡ºé”™ï¼Œå¹¸è¿çš„æ˜¯lernaå¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™äº›é—®é¢˜</p>\n<p>yarnå®˜æ–¹å¹¶ä¸æ‰“ç®—æ”¯æŒå‘å¸ƒæµç¨‹ï¼Œåªæ˜¯æƒ³åšå¥½åŒ…ç®¡ç†å·¥å…·ï¼Œå› æ­¤è¿™éƒ¨åˆ†è¿˜æ˜¯éœ€è¦é€šè¿‡lernaæ”¯æŒ</p>\n<p>lernaæä¾›äº†publishå’Œversionæ¥æ”¯æŒç‰ˆæœ¬çš„å‡çº§å’Œå‘å¸ƒ, publishçš„åŠŸèƒ½å¯ä»¥å³åŒ…å«versionçš„å·¥ä½œï¼Œä¹Ÿå¯ä»¥å•çº¯çš„åªåšå‘å¸ƒæ“ä½œã€‚</p>\n<p>3.2 ä¼˜é›…çš„æäº¤<br>3.2.1 <code>commitizen</code> &amp;&amp; <code>cz-lerna-changelog</code><br>commitizen æ˜¯ç”¨æ¥æ ¼å¼åŒ– git commit message çš„å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç§é—®è¯¢å¼çš„æ–¹å¼å»è·å–æ‰€éœ€çš„æäº¤ä¿¡æ¯ã€‚</p>\n<p>cz-lerna-changelog æ˜¯ä¸“é—¨ä¸º Lerna é¡¹ç›®é‡èº«å®šåˆ¶çš„æäº¤è§„èŒƒï¼Œåœ¨é—®è¯¢çš„è¿‡ç¨‹ï¼Œä¼šæœ‰ç±»ä¼¼å½±å“å“ªäº› package çš„é€‰æ‹©ã€‚å¦‚ä¸‹ï¼š</p>\n<p><img src=\"https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS84LzE4LzE2Y2EyYTNmZGEyMTA3MGI\"></p>\n<p>æˆ‘ä»¬ä½¿ç”¨ commitizen å’Œ cz-lerna-changelog æ¥è§„èŒƒæäº¤ï¼Œä¸ºåé¢è‡ªåŠ¨ç”Ÿæˆæ—¥å¿—ä½œå¥½å‡†å¤‡ã€‚</p>\n<p>å› ä¸ºè¿™æ˜¯æ•´ä¸ªå·¥ç¨‹çš„å¼€å‘ä¾èµ–ï¼Œæ‰€ä»¥åœ¨æ ¹ç›®å½•å®‰è£…ï¼š</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">yarn add  -D commitizen\nyarn add  -D cz-lerna-changelog</code></pre>\n\n<p>å®‰è£…å®Œæˆåï¼Œåœ¨ <code>package.json</code> ä¸­å¢åŠ  <code>config</code> å­—æ®µï¼ŒæŠŠ <code>cz-lerna-changelog</code> é…ç½®ç»™ <code>commitizen</code>ã€‚åŒæ—¶å› ä¸º<code>commitizen</code>ä¸æ˜¯å…¨å±€å®‰å…¨çš„ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ  <code>scripts</code> è„šæœ¬æ¥æ‰§è¡Œ <code>git-cz</code></p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;name&quot;: &quot;root&quot;,\n  &quot;private&quot;: true,\n  &quot;scripts&quot;: &#123;\n    &quot;commit&quot;: &quot;git-cz&quot;\n  &#125;,\n  &quot;config&quot;: &#123;\n    &quot;commitizen&quot;: &#123;\n      &quot;path&quot;: &quot;.&#x2F;node_modules&#x2F;cz-lerna-changelog&quot;\n    &#125;\n  &#125;,\n  &quot;devDependencies&quot;: &#123;\n    &quot;commitizen&quot;: &quot;^3.1.1&quot;,\n    &quot;cz-lerna-changelog&quot;: &quot;^2.0.2&quot;,\n    &quot;lerna&quot;: &quot;^3.15.0&quot;\n  &#125;\n&#125;\n</code></pre>\n\n<p>ä¹‹ååœ¨å¸¸è§„çš„å¼€å‘ä¸­å°±å¯ä»¥ä½¿ç”¨ yarn run commit æ¥æ ¹æ®æç¤ºä¸€æ­¥ä¸€æ­¥è¾“å…¥ï¼Œæ¥å®Œæˆä»£ç çš„æäº¤ã€‚</p>\n<p>3.2.2 commitlint &amp;&amp; husky<br>ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨äº† commitizen æ¥è§„èŒƒæäº¤ï¼Œä½†è¿™ä¸ªè¦é å¼€å‘è‡ªè§‰ä½¿ç”¨<code>yarn run commit</code> ã€‚ä¸‡ä¸€å¿˜è®°äº†ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ git commit æäº¤æ€ä¹ˆåŠï¼Ÿç­”æ¡ˆå°±æ˜¯åœ¨æäº¤æ—¶å¯¹æäº¤ä¿¡æ¯è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœä¸ç¬¦åˆè¦æ±‚å°±ä¸è®©æäº¤ï¼Œå¹¶æç¤ºã€‚æ ¡éªŒçš„å·¥ä½œç”± commitlint æ¥å®Œæˆï¼Œæ ¡éªŒçš„æ—¶æœºåˆ™ç”± husky æ¥æŒ‡å®šã€‚husky ç»§æ‰¿äº† Git ä¸‹æ‰€æœ‰çš„é’©å­ï¼Œåœ¨è§¦å‘é’©å­çš„æ—¶å€™ï¼Œhusky å¯ä»¥é˜»æ­¢ä¸åˆæ³•çš„ commit,push ç­‰ç­‰ã€‚</p>\n<p>å®‰è£… commitlint ä»¥åŠè¦éµå®ˆçš„è§„èŒƒ</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">yarn add -D @commitlint&#x2F;cli @commitlint&#x2F;config-conventional\n</code></pre>\n<p>åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸º commitlint å¢åŠ é…ç½®æ–‡ä»¶ commitlint.config.js ä¸ºcommitlint æŒ‡å®šç›¸åº”çš„è§„èŒƒ</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">module.exports &#x3D; &#123; \n\textends: [&#39;@commitlint&#x2F;config-conventional&#39;] \n&#125;\n</code></pre>\n<p>å®‰è£… husky</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">yarn add -D husky\n</code></pre>\n\n<p>åœ¨ package.json ä¸­å¢åŠ å¦‚ä¸‹é…ç½®</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&quot;husky&quot;: &#123; \n\t\t&quot;hooks&quot;: &#123; \n   \t\t&quot;commit-msg&quot;: &quot;commitlint -E HUSKY_GIT_PARAMS&quot; \n    &#125;\n&#125;\n</code></pre>\n\n<p>â€œcommit-msgâ€æ˜¯gitæäº¤æ—¶æ ¡éªŒæäº¤ä¿¡æ¯çš„é’©å­ï¼Œå½“è§¦å‘æ—¶ä¾¿ä¼šä½¿ç”¨ commitlit æ¥æ ¡éªŒã€‚å®‰è£…é…ç½®å®Œæˆåï¼Œæƒ³é€šè¿‡ git commit æˆ–è€…å…¶å®ƒç¬¬ä¸‰æ–¹å·¥å…·æäº¤æ—¶ï¼Œåªè¦æäº¤ä¿¡æ¯ä¸ç¬¦åˆè§„èŒƒå°±æ— æ³•æäº¤ã€‚ä»è€Œçº¦æŸå¼€å‘è€…ä½¿ç”¨ yarn run commit æ¥æäº¤ã€‚</p>\n<p>3.2.3 eslint &amp;&amp; lint-staged<br>é™¤äº†è§„èŒƒæäº¤ä¿¡æ¯ï¼Œä»£ç æœ¬èº«è‚¯å®šä¹Ÿå°‘äº†é è§„èŒƒæ¥ç»Ÿä¸€é£æ ¼ã€‚</p>\n<p>å®‰è£…</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">yarn add  -D standard lint-staged\n</code></pre>\n\n<p>eslintå°±æ˜¯å®Œæ•´çš„ä¸€å¥— JavaScriptï¼ˆtypescriptï¼‰ ä»£ç è§„èŒƒï¼Œè‡ªå¸¦ linter &amp; ä»£ç è‡ªåŠ¨ä¿®æ­£ã€‚è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç å¹¶ä¿®æ­£ï¼Œæå‰å‘ç°é£æ ¼ä»¥åŠç¨‹åºé—®é¢˜, åŒæ—¶ä¹Ÿæ”¯æŒtypescriptçš„ä»£ç è§„èŒƒæ ¡éªŒï¼Œ<code>eslintrc.json</code>é…ç½®ï¼š</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n    &quot;extends&quot;: [\n        &quot;yayajing&quot;,\n        &quot;plugin:@typescript-eslint&#x2F;recommended&quot;\n    ],\n    &quot;parser&quot;: &quot;typescript-eslint-parser&quot;,\n    &quot;plugins&quot;: [&quot;@typescript-eslint&quot;],\n    &quot;rules&quot;: &#123;\n        &quot;eqeqeq&quot;:&quot;off&quot;,\n        &quot;@typescript-eslint&#x2F;explicit-function-return-type&quot;: &quot;off&quot;,\n        &quot;no-template-curly-in-string&quot;: &quot;off&quot;\n    &#125;\n  &#125;\n\n</code></pre>\n<p><code>lint-staged staged</code> æ˜¯ Git é‡Œçš„æ¦‚å¿µï¼Œè¡¨ç¤ºæš‚å­˜åŒºï¼Œlint-staged è¡¨ç¤ºåªæ£€æŸ¥å¹¶çŸ«æ­£æš‚å­˜åŒºä¸­çš„æ–‡ä»¶ã€‚ä¸€æ¥æé«˜æ ¡éªŒæ•ˆç‡ï¼ŒäºŒæ¥å¯ä»¥ä¸ºè€çš„é¡¹ç›®å¸¦å»å·¨å¤§çš„æ–¹ä¾¿ã€‚<br>package.jsoné…ç½®</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F; package.json\n&#123;\n  &quot;name&quot;: &quot;root&quot;,\n  &quot;private&quot;: true,\n  &quot;scripts&quot;: &#123;\n    &quot;c&quot;: &quot;git-cz&quot;\n  &#125;,\n  &quot;config&quot;: &#123;\n    &quot;commitizen&quot;: &#123;\n      &quot;path&quot;: &quot;.&#x2F;node_modules&#x2F;cz-lerna-changelog&quot;\n    &#125;\n  &#125;,\n  &quot;husky&quot;: &#123;\n    &quot;hooks&quot;: &#123;\n      &quot;pre-commit&quot;: &quot;lint-staged&quot;,\n      &quot;commit-msg&quot;: &quot;commitlint -E HUSKY_GIT_PARAMS&quot;\n    &#125;\n  &#125;,\n  &quot;lint-staged&quot;: &#123;\n    &quot;*.ts&quot;: [\n      &quot;eslint --fix&quot;,\n      &quot;git add&quot;\n    ]\n  &#125;,\n  &quot;devDependencies&quot;: &#123;\n    &quot;@commitlint&#x2F;cli&quot;: &quot;^8.1.0&quot;,\n    &quot;@commitlint&#x2F;config-conventional&quot;: &quot;^8.1.0&quot;,\n    &quot;commitizen&quot;: &quot;^3.1.1&quot;,\n    &quot;cz-lerna-changelog&quot;: &quot;^2.0.2&quot;,\n    &quot;husky&quot;: &quot;^3.0.0&quot;,\n    &quot;lerna&quot;: &quot;^3.15.0&quot;,\n    &quot;lint-staged&quot;: &quot;^9.2.0&quot;\n  &#125;\n&#125;\n</code></pre>\n\n<p>å®‰è£…å®Œæˆåï¼Œåœ¨ package.json å¢åŠ  lint-staged é…ç½®ï¼Œå¦‚ä¸Šæ‰€ç¤ºè¡¨ç¤ºå¯¹æš‚å­˜åŒºä¸­çš„ js æ–‡ä»¶æ‰§è¡Œ eslint â€“fix æ ¡éªŒå¹¶è‡ªåŠ¨ä¿®å¤ã€‚é‚£ä»€ä¹ˆæ—¶å€™å»æ ¡éªŒå‘¢ï¼Œå°±åˆç”¨åˆ°äº†ä¸Šé¢å®‰è£…çš„ husky ï¼Œhuskyçš„é…ç½®ä¸­å¢åŠ pre-commitçš„é’©å­ç”¨æ¥æ‰§è¡Œ lint-staged çš„æ ¡éªŒæ“ä½œã€‚</p>\n<p>æ­¤æ—¶æäº¤ ts æ–‡ä»¶æ—¶ï¼Œä¾¿ä¼šè‡ªåŠ¨ä¿®æ­£å¹¶æ ¡éªŒé”™è¯¯ã€‚å³ä¿è¯äº†ä»£ç é£æ ¼ç»Ÿä¸€ï¼Œåˆèƒ½æé«˜ä»£ç è´¨é‡ã€‚</p>\n<p>3.3 å‘å¸ƒè‡ªåŠ¨ç”Ÿæˆæ—¥å¿—<br>æœ‰äº†ä¹‹å‰çš„è§„èŒƒæäº¤ï¼Œè‡ªåŠ¨ç”Ÿæˆæ—¥å¿—ä¾¿æ°´åˆ°æ¸ æˆäº†ã€‚å†è¯¦ç»†çœ‹ä¸‹ lerna publish æ—¶åšäº†å“ªäº›äº‹æƒ…ï¼š</p>\n<p>3.3.1 lerna version æ›´æ–°ç‰ˆæœ¬</p>\n<ul>\n<li><p>æ‰¾å‡ºä»ä¸Šä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒä»¥æ¥æœ‰è¿‡å˜æ›´çš„ package</p>\n</li>\n<li><p>æç¤ºå¼€å‘è€…ç¡®å®šè¦å‘å¸ƒçš„ç‰ˆæœ¬å·</p>\n</li>\n<li><p>å°†æ‰€æœ‰æ›´æ–°è¿‡çš„çš„ package ä¸­çš„package.jsonçš„versionå­—æ®µæ›´æ–°</p>\n</li>\n<li><p>å°†ä¾èµ–æ›´æ–°è¿‡çš„ package çš„ åŒ…ä¸­çš„ä¾èµ–ç‰ˆæœ¬å·æ›´æ–°</p>\n</li>\n<li><p>æ›´æ–° lerna.json ä¸­çš„ version å­—æ®µ</p>\n</li>\n<li><p>æäº¤ä¸Šè¿°ä¿®æ”¹ï¼Œå¹¶æ‰“ä¸€ä¸ª tag</p>\n</li>\n<li><p>æ¨é€åˆ° git ä»“åº“<br><img src=\"https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS84LzE4LzE2Y2EyYTMzNTMzMzhkYTA\"></p>\n</li>\n</ul>\n<p>3.3.2 ä½¿ç”¨ npm publish å°†æ–°ç‰ˆæœ¬æ¨é€åˆ° npm<br><code>CHANGELOG</code> å¾ˆæ˜æ˜¾æ˜¯å’Œ version ä¸€ä¸€å¯¹åº”çš„ï¼Œæ‰€ä»¥éœ€è¦åœ¨ lerna version ä¸­æƒ³åŠæ³•ï¼ŒæŸ¥çœ‹ lerna version å‘½ä»¤çš„è¯¦ç»†è¯´æ˜åï¼Œä¼šçœ‹åˆ°ä¸€ä¸ªé…ç½®å‚æ•° <code>--conventional-commits</code>ã€‚æ²¡é”™ï¼Œåªè¦æˆ‘ä»¬æŒ‰è§„èŒƒæäº¤åï¼Œåœ¨ lerna version çš„è¿‡ç¨‹ä¸­ä¼šä¾¿ä¼šè‡ªåŠ¨ç”Ÿæˆå½“å‰è¿™ä¸ªç‰ˆæœ¬çš„ CHANGELOGã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œä¸ç”¨æ¯æ¬¡è¾“å…¥å‚æ•°ï¼Œå¯ä»¥é…ç½®åœ¨ <code>lerna.json</code>ä¸­ï¼Œå¦‚ä¸‹ï¼š</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;packages&quot;: [\n    &quot;packages&#x2F;*&quot;\n  ],\n  &quot;command&quot;: &#123;\n    &quot;bootstrap&quot;: &#123;\n      &quot;hoist&quot;: true\n    &#125;,\n    &quot;version&quot;: &#123;\n      &quot;conventionalCommits&quot;: true\n    &#125;\n  &#125;,\n  &quot;ignoreChanges&quot;: [\n    &quot;**&#x2F;*.md&quot;\n  ],\n  &quot;version&quot;: &quot;0.0.1-alpha.1&quot;\n&#125;\n</code></pre>\n\n<p><code>lerna version</code> ä¼šæ£€æµ‹ä»ä¸Šä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒä»¥æ¥çš„å˜åŠ¨ï¼Œä½†æœ‰ä¸€äº›æ–‡ä»¶çš„æäº¤ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›è§¦å‘ç‰ˆæœ¬çš„å˜åŠ¨ï¼Œè­¬å¦‚ .md æ–‡ä»¶çš„ä¿®æ”¹ï¼Œå¹¶æ²¡æœ‰å®é™…å¼•èµ· package é€»è¾‘çš„å˜åŒ–ï¼Œä¸åº”è¯¥è§¦å‘ç‰ˆæœ¬çš„å˜æ›´ã€‚å¯ä»¥é€šè¿‡ <code>ignoreChanges</code> é…ç½®æ’é™¤ã€‚å¦‚ä¸Šã€‚<br><img src=\"https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS84LzE4LzE2Y2EyYTM3NTQwN2Y0MzY\"></p>\n<p>å®é™… <code>lerna version</code>å¾ˆå°‘ç›´æ¥ä½¿ç”¨ï¼Œå› ä¸ºå®ƒåŒ…å«åœ¨ <code>lerna publish</code> ä¸­äº†ï¼Œç›´æ¥ä½¿ç”¨ <code>lerna publish</code>å°±å¥½äº†ã€‚</p>\n<p>3.4 å®Œå–„çš„æµ‹è¯•ç”¨ä¾‹<br>monorepoé¡¹ç›®ï¼šæµ‹è¯•æœ‰ä¸¤ç§æ–¹å¼</p>\n<ul>\n<li><p>ä½¿ç”¨ç»Ÿä¸€çš„jestæµ‹è¯•é…ç½®è¿™æ ·æ–¹ä¾¿å…¨å±€çš„è·‘jestå³å¯ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ–¹ä¾¿ç»Ÿè®¡æ‰€æœ‰ä»£ç çš„æµ‹è¯•è¦†ç›–ç‡ï¼Œåå¤„æ˜¯å¦‚æœpackageæ¯”è¾ƒå¼‚æ„ï¼ˆå¦‚å°ç¨‹åºï¼Œå‰ç«¯ï¼Œnode æœåŠ¡ç«¯ç­‰ï¼‰ï¼Œç»Ÿä¸€çš„æµ‹è¯•é…ç½®ä¸å¤ªå¥½ç¼–å†™</p>\n</li>\n<li><p>æ¯ä¸ªpackageå•ç‹¬æ”¯æŒtestå‘½ä»¤ï¼Œä½¿ç”¨yarn workspace run testï¼Œåå¤„æ˜¯ä¸å¥½ç»Ÿä¸€æ”¶é›†æ‰€æœ‰ä»£ç çš„æµ‹è¯•è¦†ç›–ç‡</p>\n</li>\n</ul>\n<p>å¦‚æœé‡‡ç”¨jestç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œæ”¯æŒtypescriptçš„è¯ï¼Œéœ€è¦åˆå§‹åŒ–é…ç½®jest.config.jsï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">module.exports &#x3D; &#123;\n  preset: &#39;ts-jest&#39;,\n  moduleFileExtensions: [&#39;ts&#39;],\n  testEnvironment: &#39;node&#39;\n&#125;\n</code></pre>\n<p>4 å®è·µæ€»ç»“<br>åˆ°è¿™é‡Œï¼ŒåŸºæœ¬ä¸Šå·²ç»æ„å»ºäº†åŸºäºlernaå’Œyarn workspaceçš„monorepoé¡¹ç›®çš„æœ€ä½³å®è·µäº†ï¼Œè¯¥æœ‰çš„åŠŸèƒ½éƒ½æœ‰ï¼š</p>\n<ul>\n<li><p>å®Œå–„çš„å·¥ä½œæµ</p>\n</li>\n<li><p>typescriptæ”¯æŒ</p>\n</li>\n<li><p>é£æ ¼ç»Ÿä¸€çš„ç¼–ç </p>\n</li>\n<li><p>å®Œæ•´çš„å•å…ƒæµ‹è¯•</p>\n</li>\n<li><p>ä¸€é”®å¼çš„å‘å¸ƒæœºåˆ¶</p>\n</li>\n<li><p>å®Œç¾çš„æ›´æ–°æ—¥å¿—</p>\n</li>\n</ul>\n<p>â€¦â€¦</p>\n<p>å½“ç„¶ï¼Œæ„å»ºä¸€å¥—å®Œå–„çš„ä»“åº“ç®¡ç†æœºåˆ¶ï¼Œå¯èƒ½å®ƒçš„æ”¶ç›Šä¸æ˜¯ä¸€äº›é‡åŒ–çš„æŒ‡æ ‡å¯ä»¥è¡¡é‡å‡ºæ¥çš„ï¼Œä¹Ÿæ²¡æœ‰ç›´æ¥çš„ä»·å€¼è¾“å‡ºï¼Œä½†å®ƒèƒ½åœ¨æ—¥å¸¸çš„å·¥ä½œä¸­æå¤§çš„æé«˜å·¥ä½œæ•ˆç‡ï¼Œè§£æ”¾ç”Ÿäº§åŠ›ï¼ŒèŠ‚çœå¤§é‡çš„äººåŠ›æˆæœ¬ã€‚</p>\n<h2 id=\"å‚è€ƒ\"><a href=\"#å‚è€ƒ\" class=\"headerlink\" title=\"å‚è€ƒ\"></a>å‚è€ƒ</h2><p><a href=\"https://blog.csdn.net/i10630226/article/details/99702447\">lerna+yarn workspace+monorepoé¡¹ç›®çš„æœ€ä½³å®è·µ</a><br><a href=\"https://www.jianshu.com/p/c10d0b8c5581\">5åˆ†é’Ÿææ‡‚Monorepo</a><br><a href=\"https://www.easemob.com/news/5948\">2021å¹´ç®¡ç†Monorepoä»£ç åº“çš„11ç§å‡ºè‰²å·¥å…·</a></p>\n","text":"èƒŒæ™¯ è°ƒè¯•æºç æ—¶å€™ï¼Œæ€»ä¼šé‡åˆ°å¤šåŒ…çš„ä»“åº“ï¼Œé‡åˆ°äº†ä¸æ™“å¾—å¦‚ä½•è°ƒè¯• å¼€å‘ä¸ªåº“æˆ–è€…æ˜¯æ’ä»¶ä¹‹ç±»çš„å¼€å‘çš„æ¯”è¾ƒæ··ä¹± ç»å†å¤šä¸ªé¡¹ç›®çš„æ¯’æ‰“ï¼Œç»ˆäºæœ‰æ—¶é—´å­¦ä¸‹monorepo lernaã€yarn workspace å’Œjavaå¾®æœåŠ¡æ¶æ„ä»£ç å¾ˆåƒ å¾ˆå¤šé¡¹ç›®æ˜¯ lerna+yarn workspaceï¼Œ...","link":"","photos":[],"count_time":{"symbolsCount":"11k","symbolsTime":"10 mins."},"categories":[{"name":"npm","slug":"npm","count":4,"path":"api/categories/npm.json"}],"tags":[{"name":"npm","slug":"npm","count":4,"path":"api/tags/npm.json"},{"name":"monorepo","slug":"monorepo","count":1,"path":"api/tags/monorepo.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">èƒŒæ™¯</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#lerna%E3%80%81yarn-workspace\"><span class=\"toc-text\">lernaã€yarn workspace</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#monorepo%E7%AE%A1%E7%90%86\"><span class=\"toc-text\">monorepoç®¡ç†</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Lerna\"><span class=\"toc-text\">Lerna</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Lerna-Monorepo-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5\"><span class=\"toc-text\">Lerna + Monorepo æœ€ä½³å®è·µ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#yarn-workspace\"><span class=\"toc-text\">yarn workspace</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83\"><span class=\"toc-text\">å‚è€ƒ</span></a></li></ol>","author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"CSSå¦‚ä½•å·¥ä½œ","uid":"436e39263be04b5730d01a19facc4657","slug":"2022-05-23css","date":"2022-05-23T07:53:28.000Z","updated":"2022-05-26T14:12:56.678Z","comments":true,"path":"api/articles/2022-05-23css.json","keywords":null,"cover":[],"text":"æµè§ˆå™¨å·¥ä½œåŸç† å½“æµè§ˆå™¨å±•ç¤ºä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œå®ƒå¿…é¡»å…¼é¡¾æ–‡ä»¶çš„å†…å®¹å’Œæ–‡ä»¶çš„æ ·å¼ä¿¡æ¯ å¦‚ä½•åŠ è½½CSSå’ŒHTMLä¸‹é¢çš„æ­¥éª¤æ˜¯æµè§ˆåŠ è½½ç½‘é¡µçš„ç®€åŒ–ç‰ˆæœ¬: æµè§ˆå™¨è½½å…¥HTMLæ–‡ä»¶ï¼ˆæ¯”å¦‚ä»ç½‘ç»œä¸Šè·å–ï¼‰ã€‚ å°†HTMLæ–‡ä»¶è½¬åŒ–æˆä¸€ä¸ªDOMï¼ˆDocument Object Modelï¼‰ï¼ŒDOMæ˜¯æ–‡ä»¶...","link":"","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"æµè§ˆå™¨åŸç†","slug":"æµè§ˆå™¨åŸç†","count":1,"path":"api/categories/æµè§ˆå™¨åŸç†.json"}],"tags":[{"name":"æµè§ˆå™¨åŸç†","slug":"æµè§ˆå™¨åŸç†","count":1,"path":"api/tags/æµè§ˆå™¨åŸç†.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"ä¿¡æ ‡ï¼ˆBeacon ï¼‰","uid":"a8dbdf02ab5e598ef229ef514965f17c","slug":"2022-05-23beacon","date":"2022-05-23T03:12:16.000Z","updated":"2022-05-26T14:12:56.678Z","comments":true,"path":"api/articles/2022-05-23beacon.json","keywords":null,"cover":null,"text":"Beacon ç‰¹ç‚¹ æ¥å£ç”¨äºå°†å¼‚æ­¥å’Œéé˜»å¡è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ã€‚ è¯·æ±‚ä½¿ç”¨HTTPåè®®ä¸­çš„POSTæ–¹æ³•ï¼Œè¯·æ±‚é€šå¸¸ä¸éœ€è¦å“åº”ã€‚ è¿™ä¸ªè¯·æ±‚è¢«ä¿è¯åœ¨ï¼Œé¡µé¢çš„unloadçŠ¶æ€ä»å‘èµ·åˆ°å®Œæˆä¹‹å‰ï¼Œè¢«å‘é€ã€‚è€Œå¹¶ä¸éœ€è¦ä¸€ä¸ªé˜»å¡è¯·æ±‚ï¼Œä¾‹å¦‚ XMLHttpRequest ã€‚Beacon åœºæ™¯å‘é€å¼‚æ­¥éé˜»...","link":"","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":"æµè§ˆå™¨","slug":"æµè§ˆå™¨","count":1,"path":"api/categories/æµè§ˆå™¨.json"}],"tags":[{"name":"æµè§ˆå™¨","slug":"æµè§ˆå™¨","count":1,"path":"api/tags/æµè§ˆå™¨.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}