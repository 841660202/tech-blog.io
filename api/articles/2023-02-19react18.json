{"title":"React18 版本主要更新内容","uid":"935f55a55c003dca5fd748af01a100e2","slug":"2023-02-19react18","date":"2023-02-19T11:37:57.000Z","updated":"2023-05-15T13:17:32.984Z","comments":true,"path":"api/articles/2023-02-19react18.json","keywords":null,"cover":null,"content":"<h2 id=\"react-18\"><a href=\"#react-18\" class=\"headerlink\" title=\"react 18\"></a>react 18</h2><ol>\n<li><p>修 bug</p>\n<ol>\n<li>由于<code>并发模式可能带来破坏</code>，所以 react18 的并发模式可选</li>\n<li><code>Suspense fallback=&#123;undefined&#125;</code> 表现与<code>null</code>相同</li>\n</ol>\n</li>\n<li><p>增加开发体验</p>\n<ol>\n<li>自动批处理: 之前需要使用 <code>ReactDOM.unstable_batchedUpdates</code>, 现在： 超时、promise、本机事件处理程序、任何其他事件被批处理</li>\n<li>内置 <code>React.lazy + Suspense</code></li>\n<li><code>useId</code>: 生成唯一 ID</li>\n<li><code>useTransition、useDeferredValue</code>: 将紧急更新与非紧急更新分开</li>\n<li>2 个新的<code>渲染api</code>: <code>createRoot</code> 和 <code>hydrateRoot</code> ：应用的根节点也向我们暴露了出来，渲染整个应用的时候只需要调用 root 的 render 方法</li>\n</ol>\n</li>\n<li><p>为其他框架库提供扩展</p>\n<ol>\n<li><code>useInsertionEffect</code>: 为 CSS-in-JS 库添加</li>\n<li><code>useSyncExternalStore</code>: 帮助外部存储库与 React 集成。</li>\n</ol>\n</li>\n<li><p>为以后做准备</p>\n<ol>\n<li>严格模式模拟卸载和重新挂载</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"New-Feature-Automatic-Batching\"><a href=\"#New-Feature-Automatic-Batching\" class=\"headerlink\" title=\"New Feature: Automatic Batching\"></a>New Feature: Automatic Batching</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">之前：只有React事件被批处理。\nsetTimeout(() &#x3D;&gt; &#123;\n  setCount((c) &#x3D;&gt; c + 1);\n  setFlag((f) &#x3D;&gt; !f);\n  &#x2F;&#x2F; React将渲染两次，每次状态更新一次（无批处理）\n&#125;, 1000);\n\n&#x2F;&#x2F;之后：超时、promise、本机事件处理程序或任何其他事件被批处理\nsetTimeout(() &#x3D;&gt; &#123;\n  setCount((c) &#x3D;&gt; c + 1);\n  setFlag((f) &#x3D;&gt; !f);\n&#x2F;&#x2F; React最后只会重新渲染一次（那是批处理！）\n&#125;, 1000);</code></pre>\n\n<h2 id=\"New-Feature-Transitions\"><a href=\"#New-Feature-Transitions\" class=\"headerlink\" title=\"New Feature: Transitions\"></a>New Feature: Transitions</h2><p>过渡是 React 中的一个新概念，用于区分: 紧急更新和非紧急更新。</p>\n<ol>\n<li>输入、点击或按下等紧急更新需要立即响应，以符合我们对物理对象行为的直觉。否则他们会感到“错误”。</li>\n<li>过渡是不同的，因为用户不期望在屏幕上看到每个中间值。</li>\n</ol>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; startTransition &#125; from &#39;react&#39;;\n\n&#x2F;&#x2F; Urgent: Show what was typed\nsetInputValue(input);\n\n&#x2F;&#x2F; Mark any state updates inside as transitions\nstartTransition(() &#x3D;&gt; &#123;\n  &#x2F;&#x2F; Transition: Show the results\n  setSearchQuery(input);\n&#125;);</code></pre>\n\n<h2 id=\"New-Suspense-Features\"><a href=\"#New-Suspense-Features\" class=\"headerlink\" title=\"New Suspense Features\"></a>New Suspense Features</h2><p>Suspense 允许您以声明方式指定组件树的一部分的加载状态，如果它还没有准备好显示</p>\n<ol>\n<li><code>之前版本</code>：<code>可以使用 Suspense 在客户端进行代码拆分 React.lazy</code>.</li>\n<li><code>现在版本</code>：<code>Suspense</code>支持数据请求</li>\n<li><code>未来版本</code>：<code>Suspense callback</code>可以处理任何异步操作（<code>加载代码、数据、图像</code>等）。</li>\n</ol>\n<h2 id=\"New-Client-and-Server-Rendering-APIs\"><a href=\"#New-Client-and-Server-Rendering-APIs\" class=\"headerlink\" title=\"New Client and Server Rendering APIs\"></a>New Client and Server Rendering APIs</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; createRoot: ReactDOM.render;\n&#x2F;&#x2F; hydrateRoot: ReactDOM.hydrate;</code></pre>\n\n<h2 id=\"新的严格模式行为\"><a href=\"#新的严格模式行为\" class=\"headerlink\" title=\"新的严格模式行为\"></a>新的严格模式行为</h2><p>将来，我们想添加一个功能，允许 React 在保留状态的同时添加和删除 UI 的部分。</p>\n<p>例如，当用户离开屏幕并返回时，React 应该能够立即显示上一个屏幕。为此，React 将使用与以前相同的组件状态卸载和重新挂载树。</p>\n<p>此功能将为 React 应用程序提供开箱即用的更好性能，但需要组件对多次挂载和销毁的效果具有弹性。</p>\n<p>大多数效果无需任何更改即可工作，但有些效果假设它们只挂载或销毁一次。</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>在官网中大概是这样解释的，&lt;React.StrictMode&gt;和 Fragment 作用相似，仅仅是作为一个容器，不会被渲染出任何的真实 UI，它为其后代元素触发额外的检查和报告。我们可以在任何地方利用此标签开启严格模式，比如在组件中和 App.js(入口文件)中。当启用检查后，会对后代元素都进行检查。</p></blockquote>\n<h3 id=\"在此更改之前，React-会挂载组件并创建效果：\"><a href=\"#在此更改之前，React-会挂载组件并创建效果：\" class=\"headerlink\" title=\"在此更改之前，React 会挂载组件并创建效果：\"></a>在此更改之前，React 会挂载组件并创建效果：</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; * React mounts the component.\n&#x2F;&#x2F;    * Layout effects are created.\n&#x2F;&#x2F;    * Effects are created.\n\n&#x2F;&#x2F; 使用React 18中的严格模式，React将在开发模式下模拟卸载和重新挂载组件：\n\n&#x2F;&#x2F; * React mounts the component. [挂在组件]\n&#x2F;&#x2F;   * Layout effects are created.\n&#x2F;&#x2F;   * Effects are created.\n&#x2F;&#x2F; * React simulates unmounting the component.【模拟卸载组件】\n&#x2F;&#x2F;   * Layout effects are destroyed.\n&#x2F;&#x2F;   * Effects are destroyed.\n&#x2F;&#x2F; * React simulates mounting the component with the previous state.【使用先前状态，模拟组件挂载】\n&#x2F;&#x2F;   * Layout effects are created.\n&#x2F;&#x2F;   * Effects are created.</code></pre>\n\n<h2 id=\"新的-hooks-amp-other\"><a href=\"#新的-hooks-amp-other\" class=\"headerlink\" title=\"新的 hooks &amp; other\"></a>新的 hooks &amp; other</h2><ol>\n<li><code>useId</code>: 添加 useId 以生成唯一 ID</li>\n<li><code>useTransition、useDeferredValue</code>: 添加 useTranption 和 useDeferredValue 以将紧急更新与转换分开</li>\n<li><code>useInsertionEffect</code>: 为 CSS-in-JS 库添加 useInsertionEffects</li>\n<li><code>useSyncExternalStore</code>: 添加 useSyncExternalStore 以帮助外部存储库与 React 集成。</li>\n<li><code>StrictMode</code>: 使<code>&lt;StrictMode&gt;</code>重新运行效果以检查可恢复状态。</li>\n<li><code>Suspense fallback=&#123;undefined&#125;</code> 表现与<code>null</code>相同.</li>\n</ol>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://juejin.cn/post/6952522397522067470\" target=\"_blank\" >React 的严格模式(React.StrictMode)</a></p>\n","text":"react 18 修 bug 由于并发模式可能带来破坏，所以 react18 的并发模式可选 Suspense fallback=&#123;undefined&#125; 表现与null相同 增加开发体验 自动批处理: 之前需要使用 ReactDOM.unstable_batc...","link":"","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[{"name":"React","slug":"React","count":39,"path":"api/categories/React.json"}],"tags":[{"name":"React","slug":"React","count":33,"path":"api/tags/React.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#react-18\"><span class=\"toc-text\">react 18</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#New-Feature-Automatic-Batching\"><span class=\"toc-text\">New Feature: Automatic Batching</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#New-Feature-Transitions\"><span class=\"toc-text\">New Feature: Transitions</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#New-Suspense-Features\"><span class=\"toc-text\">New Suspense Features</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#New-Client-and-Server-Rendering-APIs\"><span class=\"toc-text\">New Client and Server Rendering APIs</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%B0%E7%9A%84%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F%E8%A1%8C%E4%B8%BA\"><span class=\"toc-text\">新的严格模式行为</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%9C%A8%E6%AD%A4%E6%9B%B4%E6%94%B9%E4%B9%8B%E5%89%8D%EF%BC%8CReact-%E4%BC%9A%E6%8C%82%E8%BD%BD%E7%BB%84%E4%BB%B6%E5%B9%B6%E5%88%9B%E5%BB%BA%E6%95%88%E6%9E%9C%EF%BC%9A\"><span class=\"toc-text\">在此更改之前，React 会挂载组件并创建效果：</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%B0%E7%9A%84-hooks-amp-other\"><span class=\"toc-text\">新的 hooks &amp; other</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99\"><span class=\"toc-text\">参考资料</span></a></li></ol>","author":{"name":"十三","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>自律，为了更好的自己</p><p>眼中有光，心中有梦，脚下有路</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"react-native性能优化","uid":"3badd62824c1bd78d6cf74cef1c634b2","slug":"2023-02-19rn-performance-o","date":"2023-02-19T15:06:09.000Z","updated":"2023-03-01T15:20:52.608Z","comments":true,"path":"api/articles/2023-02-19rn-performance-o.json","keywords":null,"cover":"https://pic1.zhimg.com/v2-24ef1ffd343e72a2dca843b25c62e224_1440w.jpg?source=172ae18b","text":"性能优化 使用 Image 缓存解决方案，使用适当大小的图片 Animated 库中使用 nativeDriver 避免不必要的渲染 不要在源代码中保留 console 表达式 使用 Flipper 进行调试 使用 Hermes 不要使用 Scrollview 渲染一个大列表数据...","link":"","photos":[],"count_time":{"symbolsCount":531,"symbolsTime":"1 mins."},"categories":[{"name":"react-native","slug":"react-native","count":8,"path":"api/categories/react-native.json"}],"tags":[{"name":"react-native","slug":"react-native","count":8,"path":"api/tags/react-native.json"}],"author":{"name":"十三","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>自律，为了更好的自己</p><p>眼中有光，心中有梦，脚下有路</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"RN performance","uid":"a625702239d2378e2ca779050afa4d60","slug":"2023-02-19rn-performance","date":"2023-02-19T09:11:10.000Z","updated":"2023-05-15T13:17:32.986Z","comments":true,"path":"api/articles/2023-02-19rn-performance.json","keywords":null,"cover":"http://t-blog-images.aijs.top/img/202302171928314.webp","text":"bundle 优化bundle 优化速览 环境预创建 异步检测、下载 公用资源拆包 按需加载 新版本 一、React Native 环境预创建一个载体页一个引擎。 通常，一个 React Native 页面从加载渲染到展示大致分为以下几步： 【React Native 环境初始化...","link":"","photos":[],"count_time":{"symbolsCount":"4k","symbolsTime":"4 mins."},"categories":[{"name":"react-native","slug":"react-native","count":8,"path":"api/categories/react-native.json"}],"tags":[{"name":"react-native","slug":"react-native","count":8,"path":"api/tags/react-native.json"}],"author":{"name":"十三","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>自律，为了更好的自己</p><p>眼中有光，心中有梦，脚下有路</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}