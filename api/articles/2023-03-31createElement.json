{"title":"React jsx -> fiber -> dom çš„è½¬åŒ–","uid":"1a2c0f92af01c15fc4932e397caca413","slug":"2023-03-31createElement","date":"2023-03-13T05:57:13.000Z","updated":"2023-04-18T15:54:59.596Z","comments":true,"path":"api/articles/2023-03-31createElement.json","keywords":null,"cover":[],"content":"<h2 id=\"è¯»æºç åŸºç¡€\"><a href=\"#è¯»æºç åŸºç¡€\" class=\"headerlink\" title=\"è¯»æºç åŸºç¡€\"></a>è¯»æºç åŸºç¡€</h2><ol>\n<li>ä½è¿ç®—</li>\n<li>callã€applyã€bind åŸç†</li>\n<li>é“¾è¡¨ç›¸å…³çŸ¥è¯†(å•é“¾è¡¨ã€åŒé“¾è¡¨ã€å¾ªç¯é“¾è¡¨)</li>\n<li>èŠ‚æµã€é˜²æŠ–åŸç† <code>ensureRootIsScheduled: if (existingCallbackNode !== null) &#123;</code></li>\n<li>è®¾è®¡æ¨¡å¼ç›¸å…³çŸ¥è¯†</li>\n<li>å®‰å…¨ç›¸å…³çŸ¥è¯†</li>\n<li>æ ˆï¼ˆæ•°ç»„ï¼‰ <code>pushProvider</code></li>\n<li>Set <code>åˆæˆäº‹ä»¶</code>å­˜å‚¨æ³¨å†Œ</li>\n</ol>\n<h2 id=\"jsx-gt-React-createElement\"><a href=\"#jsx-gt-React-createElement\" class=\"headerlink\" title=\"jsx -&gt; React.createElement\"></a>jsx -&gt; React.createElement</h2><img src=\"http://t-blog-images.aijs.top/img/202303131356155.webp\" />\n\n<h2 id=\"React-createElement-gt-ReactElment-æ ‘\"><a href=\"#React-createElement-gt-ReactElment-æ ‘\" class=\"headerlink\" title=\"React.createElement -&gt; ReactElment æ ‘\"></a>React.createElement -&gt; ReactElment æ ‘</h2><img src=\"https://7kms.github.io/react-illustration-series/static/reactelement-tree.31feb14c.png\" style=\"width:500px;max-width:100%\" />\n\n<h2 id=\"ReactElment-gt-update-gt-updateQueue-gt-fiber\"><a href=\"#ReactElment-gt-update-gt-updateQueue-gt-fiber\" class=\"headerlink\" title=\"ReactElment -&gt; update -&gt; updateQueue -&gt; fiber\"></a>ReactElment -&gt; update -&gt; updateQueue -&gt; fiber</h2><img src=\"http://t-blog-images.aijs.top/img/202303131435472.webp\" />\n\n<h2 id=\"ReactElment-æ ‘-gt-fiber-æ ‘-gt-dom-æ ‘\"><a href=\"#ReactElment-æ ‘-gt-fiber-æ ‘-gt-dom-æ ‘\" class=\"headerlink\" title=\"ReactElment æ ‘ -&gt; fiber æ ‘ -&gt; dom æ ‘\"></a>ReactElment æ ‘ -&gt; fiber æ ‘ -&gt; dom æ ‘</h2><img src=\"https://7kms.github.io/react-illustration-series/static/code2dom.91f1b68b.png\" />\n\n<p><strong>è§ä¸‹æ–‡ jsx ä»£ç ç» babel åˆ° ReactElment æ ‘</strong></p>\n<h2 id=\"jsx-ä»£ç ç»-babel-åˆ°-ReactElment-æ ‘\"><a href=\"#jsx-ä»£ç ç»-babel-åˆ°-ReactElment-æ ‘\" class=\"headerlink\" title=\"jsx ä»£ç ç» babel åˆ° ReactElment æ ‘\"></a>jsx ä»£ç ç» babel åˆ° ReactElment æ ‘</h2><img src=\"http://t-blog-images.aijs.top/img/202303131503939.webp\" />\n\n<h2 id=\"this-setState-gt-fiber\"><a href=\"#this-setState-gt-fiber\" class=\"headerlink\" title=\"this.setState -&gt; fiber\"></a>this.setState -&gt; fiber</h2><img src=\"http://t-blog-images.aijs.top/img/202303131647078.webp\" />\n\n<h2 id=\"è¡¥-React-å›¾è§£\"><a href=\"#è¡¥-React-å›¾è§£\" class=\"headerlink\" title=\"è¡¥ React å›¾è§£\"></a>è¡¥ React å›¾è§£</h2><h3 id=\"processUpdateQueue-æºç è§£æ\"><a href=\"#processUpdateQueue-æºç è§£æ\" class=\"headerlink\" title=\"processUpdateQueue æºç è§£æ\"></a>processUpdateQueue æºç è§£æ</h3><p><a href=\"https://juejin.cn/post/7088149898389880863\" target=\"_blank\" >processUpdateQueue æºç è§£æ</a></p>\n<p><a href=\"https://github.com/facebook/react/blob/cd20376f03212c91057c003bcb640ca9568e87e6/packages/react-reconciler/src/ReactFiberClassUpdateQueue.js#LL466-L667C2\" target=\"_blank\" >è§ processUpdateQueue æºç </a></p>\n<h3 id=\"å¦‚ä½•è®¡ç®—æ–°çš„-state\"><a href=\"#å¦‚ä½•è®¡ç®—æ–°çš„-state\" class=\"headerlink\" title=\"å¦‚ä½•è®¡ç®—æ–°çš„ state\"></a>å¦‚ä½•è®¡ç®—æ–°çš„ state</h3><p><a href=\"https://github.com/facebook/react/blob/cd20376f03212c91057c003bcb640ca9568e87e6/packages/react-reconciler/src/ReactFiberClassUpdateQueue.js#LL383-L464C2\" target=\"_blank\" >è§ getStateFromUpdate æºç </a></p>\n<img src=\"http://t-blog-images.aijs.top/img/202303131913820.webp\" />\n\n<p><a href=\"https://7kms.github.io/react-illustration-series/main/fibertree-create#%E6%8E%A2%E5%AF%BB%E9%98%B6%E6%AE%B5-beginwork:~:text=%E7%8A%B6%E6%80%81%20workInProgress.memoizedState-,processUpdateQueue,-(workInProgress%2C\" target=\"_blank\" >åˆ°è¿™é‡Œäº†</a></p>\n<h3 id=\"nextProps-æ€ä¹ˆä¼šæœ‰-ReactElement-å¯¹è±¡\"><a href=\"#nextProps-æ€ä¹ˆä¼šæœ‰-ReactElement-å¯¹è±¡\" class=\"headerlink\" title=\"nextProps æ€ä¹ˆä¼šæœ‰ ReactElement å¯¹è±¡\"></a>nextProps æ€ä¹ˆä¼šæœ‰ ReactElement å¯¹è±¡</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; 2. è·å–ä¸‹çº§&#96;ReactElement&#96;å¯¹è±¡\nlet nextChildren &#x3D; nextProps.children; &#x2F;&#x2F; åˆ©ç”¨jsxçš„ç‰¹ç‚¹ï¼Ÿ</code></pre>\n\n<p><a href=\"https://7kms.github.io/react-illustration-series/main/fibertree-create#:~:text=%3A%20null%3B-,//%202.%20%E8%8E%B7%E5%8F%96%E4%B8%8B%E7%BA%A7%60ReactElement%60%E5%AF%B9%E8%B1%A1,let%20nextChildren%20%3D%20nextProps.children%3B,-const%20isDirectTextChild%20%3D\" target=\"_blank\" >è§</a></p>\n<img src=\"http://t-blog-images.aijs.top/img/202303132215856.webp\" />\n\n<h3 id=\"beginwork\"><a href=\"#beginwork\" class=\"headerlink\" title=\"beginwork\"></a>beginwork</h3><h3 id=\"stateNode-ç±»ç»„ä»¶çš„-stateNode-æ˜¯æ€æ ·çš„ï¼ŒhostElement-çš„-stateNode-æ˜¯æ€æ ·çš„ï¼Ÿ\"><a href=\"#stateNode-ç±»ç»„ä»¶çš„-stateNode-æ˜¯æ€æ ·çš„ï¼ŒhostElement-çš„-stateNode-æ˜¯æ€æ ·çš„ï¼Ÿ\" class=\"headerlink\" title=\"stateNode: ç±»ç»„ä»¶çš„ stateNode æ˜¯æ€æ ·çš„ï¼ŒhostElement çš„ stateNode æ˜¯æ€æ ·çš„ï¼Ÿ\"></a>stateNode: ç±»ç»„ä»¶çš„ stateNode æ˜¯æ€æ ·çš„ï¼ŒhostElement çš„ stateNode æ˜¯æ€æ ·çš„ï¼Ÿ</h3><img src=\"http://t-blog-images.aijs.top/img/202303132230243.webp\" />\n\n<h3 id=\"çˆ¶å­ç»„ä»¶çš„å‰¯ä½œç”¨-è¿™ä¸ªä¸æ‰§è¡Œé¡ºåºæœ‰å…³ï¼Œçˆ¶å­ç»„ä»¶çš„é¡ºåºé—®é¢˜\"><a href=\"#çˆ¶å­ç»„ä»¶çš„å‰¯ä½œç”¨-è¿™ä¸ªä¸æ‰§è¡Œé¡ºåºæœ‰å…³ï¼Œçˆ¶å­ç»„ä»¶çš„é¡ºåºé—®é¢˜\" class=\"headerlink\" title=\"çˆ¶å­ç»„ä»¶çš„å‰¯ä½œç”¨, è¿™ä¸ªä¸æ‰§è¡Œé¡ºåºæœ‰å…³ï¼Œçˆ¶å­ç»„ä»¶çš„é¡ºåºé—®é¢˜\"></a>çˆ¶å­ç»„ä»¶çš„å‰¯ä½œç”¨, è¿™ä¸ªä¸æ‰§è¡Œé¡ºåºæœ‰å…³ï¼Œçˆ¶å­ç»„ä»¶çš„é¡ºåºé—®é¢˜</h3><img src=\"http://t-blog-images.aijs.top/img/202303132232294.webp\" />\n\n<h3 id=\"bubbleProperties\"><a href=\"#bubbleProperties\" class=\"headerlink\" title=\"bubbleProperties\"></a>bubbleProperties</h3><img src=\"http://t-blog-images.aijs.top/img/202303141032048.webp\" />\n\n<img src=\"http://t-blog-images.aijs.top/img/202303141038197.webp\" />\n\n<p><a href=\"https://github.com/facebook/react/blob/6bd53a5bdfe24d9a70819c4eba40b488e62900cd/packages/react-reconciler/src/ReactFiberCompleteWork.js#LL607-L728C2\" target=\"_blank\" >bubbleProperties æºç </a></p>\n<ol>\n<li>bubbleProperties æ ¹æ® fiber.child åŠ fiber.child.sibling æ›´æ–° subtreeFlags å’Œ childLanes, ä¸»è¦æ˜¯ä¸ºäº†æ ‡è®°å­æ ‘æœ‰æ²¡æœ‰æ›´æ–°,</li>\n<li>è¿™æ ·å¯ä»¥é€šè¿‡ fiber.subtreeFlags å¿«é€Ÿåˆ¤æ–­å­æ ‘æ˜¯å¦æœ‰å‰¯ä½œç”¨é’©å­ï¼Œä¸éœ€è¦æ·±åº¦éå†.</li>\n<li>åœ¨ React17 ç‰ˆæœ¬åä½¿ç”¨ subtreeFlags æ›¿æ¢äº† finishWork.firstEffect çš„å‰¯ä½œç”¨é“¾è¡¨, æ“ä½œä¸»è¦å‘ç”Ÿåœ¨ bubbleProperties å‡½æ•°ä¸­, æ ¸å¿ƒä»£ç å¦‚ä¸‹</li>\n</ol>\n<p>ä½œè€…ï¼šç‹å…«å‰å‰<br>é“¾æ¥ï¼š<a href=\"https://juejin.cn/post/6977203911799406628\">https://juejin.cn/post/6977203911799406628</a><br>æ¥æºï¼šç¨€åœŸæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>\n<img src=\"http://t-blog-images.aijs.top/img/202303140938435.webp\" style=\"width:600px;max-width:100%\" />\n\n<h3 id=\"classInstance-çš„-render\"><a href=\"#classInstance-çš„-render\" class=\"headerlink\" title=\"classInstance çš„ render()\"></a>classInstance çš„ render()</h3><img src=\"http://t-blog-images.aijs.top/img/202303140944164.webp\" />\n\n<img src=\"http://t-blog-images.aijs.top/img/202303141000464.webp\" />\n\n<h3 id=\"å¦‚ä½•å–åˆ°æ¬¡çº§èŠ‚ç‚¹ç¬¬ä¸€ä¸ª-fiber-çš„ï¼Ÿ\"><a href=\"#å¦‚ä½•å–åˆ°æ¬¡çº§èŠ‚ç‚¹ç¬¬ä¸€ä¸ª-fiber-çš„ï¼Ÿ\" class=\"headerlink\" title=\"å¦‚ä½•å–åˆ°æ¬¡çº§èŠ‚ç‚¹ç¬¬ä¸€ä¸ª fiber çš„ï¼Ÿ\"></a>å¦‚ä½•å–åˆ°æ¬¡çº§èŠ‚ç‚¹ç¬¬ä¸€ä¸ª fiber çš„ï¼Ÿ</h3><p>reconcileChildren ç”¨æ¥å‘ä¸‹æ„å»º fiber èŠ‚ç‚¹</p>\n<img src=\"http://t-blog-images.aijs.top/img/202303141020235.webp\" />\n\n<h3 id=\"markUpdateLaneFromFiberToRoot-çš„-sourceFiber-ä¸ç†è§£è¿™ä¸ª-sourceFiber-æ˜¯å¦‚ä½•å–å“ªä¸ªä½œä¸º-sourceFiber\"><a href=\"#markUpdateLaneFromFiberToRoot-çš„-sourceFiber-ä¸ç†è§£è¿™ä¸ª-sourceFiber-æ˜¯å¦‚ä½•å–å“ªä¸ªä½œä¸º-sourceFiber\" class=\"headerlink\" title=\"markUpdateLaneFromFiberToRoot çš„ sourceFiber ä¸ç†è§£è¿™ä¸ª sourceFiber æ˜¯å¦‚ä½•å–å“ªä¸ªä½œä¸º sourceFiber\"></a>markUpdateLaneFromFiberToRoot çš„ sourceFiber ä¸ç†è§£è¿™ä¸ª sourceFiber æ˜¯å¦‚ä½•å–å“ªä¸ªä½œä¸º sourceFiber</h3><h3 id=\"æ›´æ–°è¿‡ç¨‹ä¸­ï¼ŒDOM-å±æ€§å˜åŒ–ï¼Œä¸åˆ›å»º-DOM-å¯¹è±¡ï¼Œä»…æ ‡è®°ï¼Œcommit-é˜¶æ®µä¼šå¤„ç†\"><a href=\"#æ›´æ–°è¿‡ç¨‹ä¸­ï¼ŒDOM-å±æ€§å˜åŒ–ï¼Œä¸åˆ›å»º-DOM-å¯¹è±¡ï¼Œä»…æ ‡è®°ï¼Œcommit-é˜¶æ®µä¼šå¤„ç†\" class=\"headerlink\" title=\"æ›´æ–°è¿‡ç¨‹ä¸­ï¼ŒDOM å±æ€§å˜åŒ–ï¼Œä¸åˆ›å»º DOM å¯¹è±¡ï¼Œä»…æ ‡è®°ï¼Œcommit é˜¶æ®µä¼šå¤„ç†\"></a>æ›´æ–°è¿‡ç¨‹ä¸­ï¼ŒDOM å±æ€§å˜åŒ–ï¼Œä¸åˆ›å»º DOM å¯¹è±¡ï¼Œä»…æ ‡è®°ï¼Œcommit é˜¶æ®µä¼šå¤„ç†</h3><img src=\"http://t-blog-images.aijs.top/img/202303141053033.webp\" />\n\n<h3 id=\"fiber-lanes\"><a href=\"#fiber-lanes\" class=\"headerlink\" title=\"fiber.lanes\"></a>fiber.lanes</h3><ol>\n<li>å¦‚ä½•åŒºåˆ« fiber.lanes æœ‰æ²¡æœ‰æ¸²æŸ“ä¼˜å…ˆçº§ï¼Ÿ</li>\n<li>æ¸²æŸ“ä¼˜å…ˆçº§ä»€ä¹ˆæ—¶å€™åŠ åˆ° fiber ä¸Šçš„ï¼Ÿ markUpdateLaneFromFiberToRoot</li>\n</ol>\n<p><a href=\"https://7kms.github.io/react-illustration-series/main/fibertree-update#markupdatelanefromfibertoroot\" target=\"_blank\" >markUpdateLaneFromFiberToRoot</a></p>\n<img src=\"http://t-blog-images.aijs.top/img/202303141056621.webp\" />\n\n<h3 id=\"props-ä¸­æœ‰èŠ‚ç‚¹çš„æ ‡ç­¾ä¿¡æ¯ï¼Ÿbuton-å˜æˆ-a-ä¼šæ€æ ·ï¼Ÿ\"><a href=\"#props-ä¸­æœ‰èŠ‚ç‚¹çš„æ ‡ç­¾ä¿¡æ¯ï¼Ÿbuton-å˜æˆ-a-ä¼šæ€æ ·ï¼Ÿ\" class=\"headerlink\" title=\"props ä¸­æœ‰èŠ‚ç‚¹çš„æ ‡ç­¾ä¿¡æ¯ï¼Ÿbuton å˜æˆ a ä¼šæ€æ ·ï¼Ÿ\"></a>props ä¸­æœ‰èŠ‚ç‚¹çš„æ ‡ç­¾ä¿¡æ¯ï¼Ÿbuton å˜æˆ a ä¼šæ€æ ·ï¼Ÿ</h3><img src=\"http://t-blog-images.aijs.top/img/202303141105782.webp\" />\n\n<h3 id=\"fiber-çš„-flags-å±æ€§ï¼Œä»€ä¹ˆæ—¶å€™èµ‹å€¼çš„ï¼Œè¿™é‡Œæœ‰ç”¨-fiber-flags-x3D-0-åˆ¤æ–­æœ‰æ²¡æœ‰å‰¯ä½œç”¨\"><a href=\"#fiber-çš„-flags-å±æ€§ï¼Œä»€ä¹ˆæ—¶å€™èµ‹å€¼çš„ï¼Œè¿™é‡Œæœ‰ç”¨-fiber-flags-x3D-0-åˆ¤æ–­æœ‰æ²¡æœ‰å‰¯ä½œç”¨\" class=\"headerlink\" title=\"fiber çš„ flags å±æ€§ï¼Œä»€ä¹ˆæ—¶å€™èµ‹å€¼çš„ï¼Œè¿™é‡Œæœ‰ç”¨ fiber.flags &#x3D; 0 åˆ¤æ–­æœ‰æ²¡æœ‰å‰¯ä½œç”¨\"></a>fiber çš„ flags å±æ€§ï¼Œä»€ä¹ˆæ—¶å€™èµ‹å€¼çš„ï¼Œè¿™é‡Œæœ‰ç”¨ fiber.flags &#x3D; 0 åˆ¤æ–­æœ‰æ²¡æœ‰å‰¯ä½œç”¨</h3><ol>\n<li><p><code>markUpdate</code></p>\n<img src=\"http://t-blog-images.aijs.top/img/202303141122731.webp\" /></li>\n<li><p><code>markRef</code> <code>if (current.ref !== workInProgress.ref) &#123;  markRef(workInProgress);&#125;</code></p>\n</li>\n<li><p><code>è°ƒå’Œå‡½æ•°</code>ä¼šç»™å¢ã€åˆ ã€ç§»åŠ¨èŠ‚ç‚¹è®¾ç½® fiber.flags</p>\n</li>\n</ol>\n<h3 id=\"ä¸ºä»€ä¹ˆ-lastEffect-æŒ‡é’ˆä¸å˜å‘¢ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆ-lastEffect-æŒ‡é’ˆä¸å˜å‘¢ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆ lastEffect æŒ‡é’ˆä¸å˜å‘¢ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆ lastEffect æŒ‡é’ˆä¸å˜å‘¢ï¼Ÿ</h3><img src=\"http://t-blog-images.aijs.top/img/202303141150467.webp\" />\n\n<h3 id=\"é—­åŒ…å’Œç±»çš„åŸå§‹æ€§èƒ½åªæœ‰åœ¨æç«¯åœºæ™¯ä¸‹æ‰ä¼šæœ‰æ˜æ˜¾çš„å·®åˆ«ï¼Œæç«¯æƒ…å†µæ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ\"><a href=\"#é—­åŒ…å’Œç±»çš„åŸå§‹æ€§èƒ½åªæœ‰åœ¨æç«¯åœºæ™¯ä¸‹æ‰ä¼šæœ‰æ˜æ˜¾çš„å·®åˆ«ï¼Œæç«¯æƒ…å†µæ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ\" class=\"headerlink\" title=\"é—­åŒ…å’Œç±»çš„åŸå§‹æ€§èƒ½åªæœ‰åœ¨æç«¯åœºæ™¯ä¸‹æ‰ä¼šæœ‰æ˜æ˜¾çš„å·®åˆ«ï¼Œæç«¯æƒ…å†µæ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ\"></a>é—­åŒ…å’Œç±»çš„åŸå§‹æ€§èƒ½åªæœ‰åœ¨æç«¯åœºæ™¯ä¸‹æ‰ä¼šæœ‰æ˜æ˜¾çš„å·®åˆ«ï¼Œæç«¯æƒ…å†µæ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ</h3><h3 id=\"Hook-ä»€ä¹ˆæ—¶å€™ä¸-fiber-å…³è”çš„ï¼Ÿ\"><a href=\"#Hook-ä»€ä¹ˆæ—¶å€™ä¸-fiber-å…³è”çš„ï¼Ÿ\" class=\"headerlink\" title=\"Hook ä»€ä¹ˆæ—¶å€™ä¸ fiber å…³è”çš„ï¼Ÿ\"></a>Hook ä»€ä¹ˆæ—¶å€™ä¸ fiber å…³è”çš„ï¼Ÿ</h3><img src=\"http://t-blog-images.aijs.top/img/202303151129459.webp\" />\n\n<img src=\"http://t-blog-images.aijs.top/img/202303141453053.webp\" />\n\n<h3 id=\"å‰¯ä½œç”¨-hook-å¦‚ä½•è½¬åŒ–æˆ-fiber-flags-çš„ï¼Ÿ\"><a href=\"#å‰¯ä½œç”¨-hook-å¦‚ä½•è½¬åŒ–æˆ-fiber-flags-çš„ï¼Ÿ\" class=\"headerlink\" title=\"å‰¯ä½œç”¨ hook å¦‚ä½•è½¬åŒ–æˆ fiber.flags çš„ï¼Ÿ\"></a>å‰¯ä½œç”¨ hook å¦‚ä½•è½¬åŒ–æˆ fiber.flags çš„ï¼Ÿ</h3><img src=\"http://t-blog-images.aijs.top/img/202303141519615.webp\" />\n\n<h3 id=\"hook-çš„-effect-ä»€ä¹ˆæ—¶å€™å½¢æˆé“¾è¡¨çš„ï¼Œå¦‚ä½•å½¢æˆçš„ï¼Ÿ\"><a href=\"#hook-çš„-effect-ä»€ä¹ˆæ—¶å€™å½¢æˆé“¾è¡¨çš„ï¼Œå¦‚ä½•å½¢æˆçš„ï¼Ÿ\" class=\"headerlink\" title=\"hook çš„ effect ä»€ä¹ˆæ—¶å€™å½¢æˆé“¾è¡¨çš„ï¼Œå¦‚ä½•å½¢æˆçš„ï¼Ÿ\"></a>hook çš„ effect ä»€ä¹ˆæ—¶å€™å½¢æˆé“¾è¡¨çš„ï¼Œå¦‚ä½•å½¢æˆçš„ï¼Ÿ</h3><h3 id=\"TODO-è¡¥å……åˆ°è‡ªå®šä¹‰-ahooksï¼ˆæš‚æ—¶ä¸è®°å¾—æ˜¯å“ªç¯‡éœ€è¦çš„ï¼‰\"><a href=\"#TODO-è¡¥å……åˆ°è‡ªå®šä¹‰-ahooksï¼ˆæš‚æ—¶ä¸è®°å¾—æ˜¯å“ªç¯‡éœ€è¦çš„ï¼‰\" class=\"headerlink\" title=\"TODO: è¡¥å……åˆ°è‡ªå®šä¹‰ ahooksï¼ˆæš‚æ—¶ä¸è®°å¾—æ˜¯å“ªç¯‡éœ€è¦çš„ï¼‰\"></a>TODO: è¡¥å……åˆ°è‡ªå®šä¹‰ ahooksï¼ˆæš‚æ—¶ä¸è®°å¾—æ˜¯å“ªç¯‡éœ€è¦çš„ï¼‰</h3><img src=\"http://t-blog-images.aijs.top/img/202303150927644.webp\" />\n\n<h3 id=\"updateWorkInProgressHook-ä¸ºä»€ä¹ˆæ˜¯å•æ­¥å…‹éš†ï¼Œæ€ä¹ˆä¸ç›´æ¥\"><a href=\"#updateWorkInProgressHook-ä¸ºä»€ä¹ˆæ˜¯å•æ­¥å…‹éš†ï¼Œæ€ä¹ˆä¸ç›´æ¥\" class=\"headerlink\" title=\"updateWorkInProgressHook ä¸ºä»€ä¹ˆæ˜¯å•æ­¥å…‹éš†ï¼Œæ€ä¹ˆä¸ç›´æ¥\"></a>updateWorkInProgressHook ä¸ºä»€ä¹ˆæ˜¯å•æ­¥å…‹éš†ï¼Œæ€ä¹ˆä¸ç›´æ¥</h3><p>æ¯æ¬¡å–ä¸€ä¸ª hook ç”¨ï¼Œæ‰€ä»¥ä¸éœ€è¦ä¸€æ¬¡å…‹éš†æ‰€æœ‰</p>\n<img src=\"http://t-blog-images.aijs.top/img/202303151143229.webp\" />\n\n<h3 id=\"mountState-mountReducer-gt-dispatch-gt-dispatchAction-bind-è¿›è¡Œ-scheduleUpdateOnFiber\"><a href=\"#mountState-mountReducer-gt-dispatch-gt-dispatchAction-bind-è¿›è¡Œ-scheduleUpdateOnFiber\" class=\"headerlink\" title=\"mountState,mountReducer -&gt; dispatch -&gt; dispatchAction bind è¿›è¡Œ scheduleUpdateOnFiber\"></a>mountState,mountReducer -&gt; dispatch -&gt; dispatchAction bind è¿›è¡Œ scheduleUpdateOnFiber</h3><h3 id=\"updateState-updateReducer-gt-dispatch-gt-dispatchAction-bind-è¿›è¡Œ-scheduleUpdateOnFiber\"><a href=\"#updateState-updateReducer-gt-dispatch-gt-dispatchAction-bind-è¿›è¡Œ-scheduleUpdateOnFiber\" class=\"headerlink\" title=\"updateState,updateReducer -&gt; dispatch -&gt; dispatchAction bind è¿›è¡Œ scheduleUpdateOnFiber\"></a>updateState,updateReducer -&gt; dispatch -&gt; dispatchAction bind è¿›è¡Œ scheduleUpdateOnFiber</h3><img src=\"http://t-blog-images.aijs.top/img/202303151336472.webp\" />\n\n<h3 id=\"queue-pending-æ˜¯ç¯å½¢é“¾è¡¨ï¼Ÿ-1-ä¸ºä»€ç”¨ç¯å½¢é“¾è¡¨ï¼Ÿ2-å¦‚ä½•æ‰¾ç¯å½¢é“¾è¡¨çš„å…¥å£ï¼Ÿ\"><a href=\"#queue-pending-æ˜¯ç¯å½¢é“¾è¡¨ï¼Ÿ-1-ä¸ºä»€ç”¨ç¯å½¢é“¾è¡¨ï¼Ÿ2-å¦‚ä½•æ‰¾ç¯å½¢é“¾è¡¨çš„å…¥å£ï¼Ÿ\" class=\"headerlink\" title=\"queue.pending æ˜¯ç¯å½¢é“¾è¡¨ï¼Ÿ 1. ä¸ºä»€ç”¨ç¯å½¢é“¾è¡¨ï¼Ÿ2. å¦‚ä½•æ‰¾ç¯å½¢é“¾è¡¨çš„å…¥å£ï¼Ÿ\"></a>queue.pending æ˜¯ç¯å½¢é“¾è¡¨ï¼Ÿ 1. ä¸ºä»€ç”¨ç¯å½¢é“¾è¡¨ï¼Ÿ2. å¦‚ä½•æ‰¾ç¯å½¢é“¾è¡¨çš„å…¥å£ï¼Ÿ</h3><img src=\"http://t-blog-images.aijs.top/img/202303151405480.webp\" />\n\n<img src=\"http://t-blog-images.aijs.top/img/202303151431163.webp\" />\n\n<h3 id=\"pending-gt-æ–°çŠ¶æ€\"><a href=\"#pending-gt-æ–°çŠ¶æ€\" class=\"headerlink\" title=\"pending -&gt; æ–°çŠ¶æ€\"></a>pending -&gt; æ–°çŠ¶æ€</h3><p>updateReducer è°ƒç”¨ basicStateReducer</p>\n<img src=\"http://t-blog-images.aijs.top/img/202303151449905.webp\" />\n\n<h3 id=\"ä¼˜å…ˆçº§å¦‚ä½•äº§ç”Ÿ-requestUpdateLane\"><a href=\"#ä¼˜å…ˆçº§å¦‚ä½•äº§ç”Ÿ-requestUpdateLane\" class=\"headerlink\" title=\"ä¼˜å…ˆçº§å¦‚ä½•äº§ç”Ÿ requestUpdateLane\"></a>ä¼˜å…ˆçº§å¦‚ä½•äº§ç”Ÿ requestUpdateLane</h3><img src=\"http://t-blog-images.aijs.top/img/202303151536389.webp\" />\n\n<p>getEventPriority ä»£ç å› é•¿ï¼Œæ”¾é“¾æ¥<br><a href=\"https://github.com/facebook/react/blob/cfc1274e3be5a93a4c93f8fb87f2109993afe1dd/packages/react-dom-bindings/src/events/ReactDOMEventListener.js#LL411-L517C2\" target=\"_blank\" >getEventPriority æºç </a></p>\n<ol>\n<li><code>DiscreteEventPriority</code> ç›´æ¥è§¦å‘</li>\n<li><code>ContinuousEventPriority</code> å¯èƒ½ä¼šç»§ç»­è§¦å‘</li>\n<li><code>case &#39;message&#39;:</code> æ˜¯ React å†…éƒ¨è°ƒåº¦é€šè¿‡æ¶ˆæ¯ä¼ é€’çš„è°ƒåº¦ä¼˜å…ˆçº§ï¼Œä¼šè½¬åŒ–æˆäº‹ä»¶ä¼˜å…ˆçº§ï¼Ÿ</li>\n</ol>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">case &#39;message&#39;: &#123;\n      &#x2F;&#x2F; We might be in the Scheduler callback.\n      &#x2F;&#x2F; Eventually this mechanism will be replaced by a check\n      &#x2F;&#x2F; of the current priority on the native scheduler.\n      const schedulerPriority &#x3D; getCurrentSchedulerPriorityLevel();\n      switch (schedulerPriority) &#123;\n        case ImmediateSchedulerPriority:\n          return DiscreteEventPriority;\n        case UserBlockingSchedulerPriority:\n          return ContinuousEventPriority;\n        case NormalSchedulerPriority:\n        case LowSchedulerPriority:\n          &#x2F;&#x2F; TODO: Handle LowSchedulerPriority, somehow. Maybe the same lane as hydration.\n          return DefaultEventPriority;\n        case IdleSchedulerPriority:\n          return IdleEventPriority;\n        default:\n          return DefaultEventPriority;\n      &#125;\n&#125;\ndefault:\n      return DefaultEventPriority;</code></pre>\n\n<h3 id=\"è¿™ä¸ªæ˜¯å¼‚æ­¥çš„\"><a href=\"#è¿™ä¸ªæ˜¯å¼‚æ­¥çš„\" class=\"headerlink\" title=\"è¿™ä¸ªæ˜¯å¼‚æ­¥çš„\"></a>è¿™ä¸ªæ˜¯å¼‚æ­¥çš„</h3><img src=\"http://t-blog-images.aijs.top/img/202303160919293.webp\" />\n\n<p><a href=\"https://7kms.github.io/react-illustration-series/main/hook-state#å¼‚æ­¥æ›´æ–°\" target=\"_blank\" >å¼‚æ­¥æ›´æ–°</a></p>\n<ol>\n<li>ä½ä¼˜å…ˆçº§ä¹‹å‰çš„é«˜ä¼˜å…ˆçº§è¢«è®¡ç®—ï¼Œæ”¾ç½®åˆ° baseState</li>\n<li>æ‰€æœ‰é«˜ä¼˜å…ˆçº§è¢«è®¡ç®—ï¼Œæ”¾ç½®åˆ° memoizedState</li>\n<li>ç¬¬ä¸€ä¸ªåœ°ä¼˜å…ˆçº§ä¹‹å‰çš„é«˜ä¼˜å…ˆçº§ï¼Œè¢«å¹²æ‰ï¼Œå…¶ä»–çš„ä¸å˜</li>\n</ol>\n<h3 id=\"Hook-çš„-state-è®¡ç®—æœ‰ç‚¹å¤æ‚-baseQueue-gt-newBaseState-newState-ã€æœªç†è§£ã€‘\"><a href=\"#Hook-çš„-state-è®¡ç®—æœ‰ç‚¹å¤æ‚-baseQueue-gt-newBaseState-newState-ã€æœªç†è§£ã€‘\" class=\"headerlink\" title=\"Hook çš„ state è®¡ç®—æœ‰ç‚¹å¤æ‚: baseQueue -&gt; newBaseState,newState ã€æœªç†è§£ã€‘\"></a>Hook çš„ state è®¡ç®—æœ‰ç‚¹å¤æ‚: baseQueue -&gt; newBaseState,newState ã€æœªç†è§£ã€‘</h3><p>QUES: <span style=\"color: red; font-size: 32px\">æœªç†è§£</span></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">hook.memoizedState &#x3D; newState; &#x2F;&#x2F; æä¸æ¸…æ¥šè¿™ä¸ªnewStateçš„è®¡ç®—\nhook.baseState &#x3D; newBaseState; &#x2F;&#x2F;\nhook.baseQueue &#x3D; newBaseQueueLast;\nqueue.lastRenderedState &#x3D; newState; &#x2F;&#x2F;</code></pre>\n\n<img src=\"http://t-blog-images.aijs.top/img/202303151742009.webp\" />\n\n<h3 id=\"Hook-baseQueue-å˜åŒ–\"><a href=\"#Hook-baseQueue-å˜åŒ–\" class=\"headerlink\" title=\"Hook baseQueue å˜åŒ–\"></a>Hook baseQueue å˜åŒ–</h3><img src=\"https://7kms.github.io/react-illustration-series/static/before-basequeue-combine.aa99bd25.png\" />\n\n<div style=\"height: 4px; width: 100%\"></div>\n\n<img src=\"https://7kms.github.io/react-illustration-series/static/after-basequeue-combine.1f0a9771.png\" />\n\n<h3 id=\"typeof\"><a href=\"#typeof\" class=\"headerlink\" title=\"$$typeof\"></a>$$typeof</h3><img src=\"http://t-blog-images.aijs.top/img/202303161024652.webp\" />\n\n<p><a href=\"https://overreacted.io/zh-hans/why-do-react-elements-have-typeof-property/\" target=\"_blank\" >ä¸ºä»€ä¹ˆ React å…ƒç´ æœ‰ä¸€ä¸ª$$typeof å±æ€§ï¼Ÿ</a></p>\n<p>åŠ¨æœºï¼š éªŒè¯ä¸€äº›ä¸å®‰å…¨çš„å¯èƒ½æ€§</p>\n<ol>\n<li>React å…ƒç´ ï¼ˆelementsï¼‰æ˜¯è®¾è®¡å¥½çš„ plain object</li>\n<li>æœåŠ¡ç«¯æ²¡æœ‰åŠæ³•å­˜å‚¨ Symbol ç±»å‹çš„å€¼ï¼Œä¹Ÿæ— æ³•æ·»åŠ ã€‚æ‰€ä»¥å½“åŸæœ¬çš„æ•°æ®è¢«æ›¿æ¢æˆæ¶æ„çš„å¯¹è±¡æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä¸åŒ…å«$$typeof å±æ€§çš„</li>\n<li>React ä¼šæ£€æµ‹åˆæ³•çš„$$typeof å±æ€§ï¼Œä¸ç¬¦åˆæ¡ä»¶ React å°±ä¸ä¼šå¤„ç†è¿™ä¸ªå…ƒç´ </li>\n<li>ä¸æ”¯æŒ symbol çš„æµè§ˆå™¨ä¼šä½¿ç”¨ <code>0xeac7</code> (è‡³äºä¸ºä»€ä¹ˆé€‰ç”¨<code>0xeac7</code>è¿™ä¸ªæ•°å­—ï¼ŒDan ç»™å‡ºçš„ç­”æ¡ˆæ˜¯ï¼Œå®ƒå¾ˆåƒ React)</li>\n<li>å¤§æ„å°±æ˜¯ Symbol.for()æ˜¯å¯ä»¥åœ¨åƒç±»ä¼¼ iframe æˆ–è€… worker è¿™ç§å…¨å±€ç¯å¢ƒä¸­éƒ½èƒ½ç‹¬ç«‹æ ‡è¯†ä¸€ä¸ªå€¼ã€‚æ‰€ä»¥$$typeofå±æ€§å°±ä¸ä¼šå½±å“åˆ°ä¸€äº›å¯ä»¥åœ¨å…¨å±€ç¯å¢ƒä¸­ä¼ é€’çš„React Elementã€‚æˆ–è€…å½“ç•Œé¢æœ‰å¤šä¸ªå‰¯æœ¬å­˜åœ¨æ—¶ï¼Œä¹Ÿèƒ½agreeåˆ°æ­£ç¡®çš„$$typeofã€‚</li>\n</ol>\n<p><a href=\"https://hanqizheng.github.io/2020/07/26/$$typeof.html\" target=\"_blank\" >React å…ƒç´ çš„$$typeof å±æ€§</a></p>\n<p>éªŒè¯ï¼š$$typeof</p>\n<p><a href=\"https://reactjs.org/docs/react-api.html#isvalidelement\" target=\"_blank\" >isValidElement</a></p>\n<h2 id=\"reconciliation\"><a href=\"#reconciliation\" class=\"headerlink\" title=\"reconciliation\"></a>reconciliation</h2><h3 id=\"å…´è¶£ä¸ç”Ÿæ´»çš„å†²çª\"><a href=\"#å…´è¶£ä¸ç”Ÿæ´»çš„å†²çª\" class=\"headerlink\" title=\"å…´è¶£ä¸ç”Ÿæ´»çš„å†²çª\"></a>å…´è¶£ä¸ç”Ÿæ´»çš„å†²çª</h3><p>ä»Šå¤©åœ¨æ€è€ƒä¸€ä»¶éæŠ€æœ¯çš„äº‹ï¼Œä¹‹å‰åœ¨å­¦ go è¯­è¨€ï¼Œåæ¥ä¸€ç›´åœ¨å¿™äºâ€œç”Ÿæ´»â€ï¼Œç®—æ˜¯å‘ç”Ÿæ´»å¦¥å</p>\n<p>å‰äº›å¤©çœ‹åˆ°æœ‰ä¹‹å‰çš„åŒäº‹ä¹Ÿåœ¨æœ‹å‹åœˆå‘ go è¯­è¨€çš„ä»£ç ï¼Œåˆå‹¾èµ·æˆ‘çš„å…´è¶£</p>\n<img src=\"http://t-blog-images.aijs.top/img/202303161034838.webp\" style=\"width:800px;max-width:100%\" />\n\n<h3 id=\"å›å½’ç†æ€§\"><a href=\"#å›å½’ç†æ€§\" class=\"headerlink\" title=\"å›å½’ç†æ€§\"></a>å›å½’ç†æ€§</h3><ol>\n<li>go è¯­è¨€å¥½æ˜¯å¥½ï¼Œç›¸æ¯”äº java æ¥è®²ï¼Œâ€œä¼˜é›…çŸ¥æ€§â€</li>\n<li>æœ‰å¤šå°‘å®¶å…¬å¸éœ€è¦ç”¨ï¼ˆå½“ç„¶ä¸è°ˆäº‘åŸç”Ÿï¼Œæ²¡æ„ä¹‰ï¼Œå› ä¸ºå¾ˆå¤šå…¬å¸åœ¨ç”¨ k8sï¼Œè´¡çŒ®çš„äººå´ä¸å¤šï¼‰</li>\n<li>é™¤äº†æŸäº›å·¨å¤´å…¬å¸ã€æ–°çš„åˆ›ä¸šå…¬å¸ï¼Œå‰©ä¸‹çš„å æ¯”å¾ˆå¤§çš„æ˜¯ java</li>\n<li>å³ä½¿æŒæ¡äº† go è¯­è¨€ï¼Œå»åˆ›ä¸šå…¬å¸ï¼Ÿå»å·¨å¤´å…¬å¸ï¼Ÿå¯èƒ½æ€§éƒ½ä¸æ˜¯å¾ˆå¤§ï¼Œé‚£å‰©ä¸‹çš„å°±æ˜¯è‡ªå¨±äº†ï¼Œä½†æ—¶é—´å’Œç”Ÿæ´»å¹¶ä¸å…è®¸</li>\n<li>è¿™æ—¶å€™å°±è¦å‘ç”Ÿæ´»å¦¥åäº†ï¼Œåšå‡ºè®©æ­¥ï¼Œé™¤äº†å…´è¶£å¤–ï¼Œæ›´é‡è¦çš„æ˜¯ç”Ÿæ´»</li>\n</ol>\n<h3 id=\"å¦¥å-å’Œè§£\"><a href=\"#å¦¥å-å’Œè§£\" class=\"headerlink\" title=\"å¦¥å å’Œè§£\"></a>å¦¥å å’Œè§£</h3><p><a href=\"https://zhidao.baidu.com/question/2147937715158868028.html\" target=\"_blank\" >å¦¥åè¿‘ä¹‰è¯</a></p>\n<p><code>reconciliation:</code> ç™¾åº¦ç¿»è¯‘ä¸ºï¼š<code>è°ƒè§£;å’Œè§£;åè°ƒ;å’Œè°ä¸€è‡´</code></p>\n<p>å“ï½ï¼Œè¿™ä¸å°±æ‰¯åˆ° react reconciliation äº†å—ï¼Ÿ(çœŸçš„æ²¡æƒ³èŠæŠ€æœ¯)</p>\n<h3 id=\"react-ä¸ºä»€ä¹ˆå¯¹ç®—æ³•è¿›è¡Œå¦¥åï¼ˆor-å’Œè§£-or-åšå‡ºè®©æ­¥ï¼‰ï¼Ÿ\"><a href=\"#react-ä¸ºä»€ä¹ˆå¯¹ç®—æ³•è¿›è¡Œå¦¥åï¼ˆor-å’Œè§£-or-åšå‡ºè®©æ­¥ï¼‰ï¼Ÿ\" class=\"headerlink\" title=\"react ä¸ºä»€ä¹ˆå¯¹ç®—æ³•è¿›è¡Œå¦¥åï¼ˆor å’Œè§£ or åšå‡ºè®©æ­¥ï¼‰ï¼Ÿ\"></a>react ä¸ºä»€ä¹ˆå¯¹ç®—æ³•è¿›è¡Œå¦¥åï¼ˆor å’Œè§£ or åšå‡ºè®©æ­¥ï¼‰ï¼Ÿ</h3><p><strong>åŸå› ï¼šè®¡ç®—é‡å¤§ï¼Œè°å—å¾—äº†</strong></p>\n<ol>\n<li>å³ä½¿ä½¿ç”¨æœ€ä¼˜çš„ç®—æ³•ï¼Œè¯¥ç®—æ³•çš„å¤æ‚ç¨‹åº¦ä»ä¸º O(n 3 )ï¼Œå…¶ä¸­ n æ˜¯æ ‘ä¸­å…ƒç´ çš„æ•°é‡ã€‚</li>\n<li>å¦‚æœåœ¨ React ä¸­ä½¿ç”¨è¯¥ç®—æ³•ï¼Œé‚£ä¹ˆå±•ç¤º 1000 ä¸ªå…ƒç´ åˆ™éœ€è¦ 10 äº¿æ¬¡çš„æ¯”è¾ƒã€‚è¿™ä¸ªå¼€é”€å®åœ¨æ˜¯å¤ªè¿‡é«˜æ˜‚</li>\n</ol>\n<h3 id=\"å¦‚ä½•å¦¥åï¼Ÿå¯å‘å¼ç®—æ³•\"><a href=\"#å¦‚ä½•å¦¥åï¼Ÿå¯å‘å¼ç®—æ³•\" class=\"headerlink\" title=\"å¦‚ä½•å¦¥åï¼Ÿå¯å‘å¼ç®—æ³•\"></a>å¦‚ä½•å¦¥åï¼Ÿå¯å‘å¼ç®—æ³•</h3><ol>\n<li>ä¸¤ä¸ªä¸åŒç±»å‹çš„å…ƒç´ ä¼šäº§ç”Ÿå‡ºä¸åŒçš„æ ‘ï¼›</li>\n<li>å¼€å‘è€…å¯ä»¥ä½¿ç”¨ key å±æ€§æ ‡è¯†å“ªäº›å­å…ƒç´ åœ¨ä¸åŒçš„æ¸²æŸ“ä¸­å¯èƒ½æ˜¯ä¸å˜çš„</li>\n</ol>\n<h3 id=\"å°ç»“\"><a href=\"#å°ç»“\" class=\"headerlink\" title=\"å°ç»“\"></a>å°ç»“</h3><p>ğŸ˜„ æ‹‰ä½ å›ç°å®ï¼šæŠ€æœ¯æºäºç”Ÿæ´», æœåŠ¡ç”Ÿæ´»</p>\n<h2 id=\"vscode-æŠ˜å ç­–ç•¥\"><a href=\"#vscode-æŠ˜å ç­–ç•¥\" class=\"headerlink\" title=\"vscode æŠ˜å ç­–ç•¥\"></a>vscode æŠ˜å ç­–ç•¥</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&quot;editor.foldingStrategy&quot;: &quot;indentation&quot;, &#x2F;&#x2F; æŠ˜å ç­–ç•¥ï¼ŒæŒ‰ç…§ç¼©ç´§</code></pre>\n\n<p><a href=\"https://blog.csdn.net/Maybe_ss/article/details/122577167\" target=\"_blank\" >vsCode ä»£ç å—æ— æ³•æŠ˜å æ”¶èµ·é—®é¢˜&amp;ä»£ç å—æŠ˜å &#x2F;å±•å¼€å¿«æ·é”®</a></p>\n<h3 id=\"ä¸ºä»€ä¹ˆå«åˆæˆäº‹ä»¶ï¼Œå¦‚ä½•åˆæˆï¼Œåˆæˆåˆ°ä»€ä¹ˆæ ·å­ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆå«åˆæˆäº‹ä»¶ï¼Œå¦‚ä½•åˆæˆï¼Œåˆæˆåˆ°ä»€ä¹ˆæ ·å­ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆå«åˆæˆäº‹ä»¶ï¼Œå¦‚ä½•åˆæˆï¼Œåˆæˆåˆ°ä»€ä¹ˆæ ·å­ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆå«åˆæˆäº‹ä»¶ï¼Œå¦‚ä½•åˆæˆï¼Œåˆæˆåˆ°ä»€ä¹ˆæ ·å­ï¼Ÿ</h3><p>æ—¢ç„¶æ˜¯åˆæˆäº‹ä»¶</p>\n<ol>\n<li>è‚¯å®šä¸æ˜¯ä¸€ä¸€æ˜ å°„ï¼Œå¦‚æœä¸€ä¸€æ˜ å°„å«ï¼šâ€œæ˜ å°„äº‹ä»¶â€ä¸æ˜¯æ›´å¥½</li>\n<li>è‚¯å®šä¸æ˜¯ä»…ä½œå…¼å®¹ï¼Œå¦‚æœå…¼å®¹å«ï¼šâ€œadapt äº‹ä»¶â€ä¸æ˜¯æ›´å¥½</li>\n</ol>\n<p><a href=\"https://juejin.cn/post/6991645668934680584\" target=\"_blank\" >æµ…è°ˆ React åˆæˆäº‹ä»¶</a></p>\n<p><a href=\"https://github.com/facebook/react/blob/v17.0.2/packages/react-dom/src/events/DOMPluginEventSystem.js#L89-L93\" target=\"_blank\" >DOMPluginEventSystem.js</a></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">SimpleEventPlugin.registerEvents();\n&#x2F;&#x2F; ä¸‹é¢4ç»„æ˜¯åˆæˆäº‹ä»¶ï¼Œä¸Šé¢ä¸€ç»„æ˜¯äº‹ä»¶ä¸€å¯¹ä¸€çš„æ˜ å°„\nEnterLeaveEventPlugin.registerEvents();\nChangeEventPlugin.registerEvents();\nSelectEventPlugin.registerEvents();\nBeforeInputEventPlugin.registerEvents();</code></pre>\n\n<p><a href=\"https://github.com/facebook/react/blob/12adaffef7105e2714f82651ea51936c563fe15c/packages/react-dom/src/events/plugins/BeforeInputEventPlugin.js#LL57-L88C2\" target=\"_blank\" >BeforeInputEventPlugin.js</a></p>\n<p><a href=\"https://github.com/facebook/react/blob/12adaffef7105e2714f82651ea51936c563fe15c/packages/react-dom/src/events/plugins/ChangeEventPlugin.js#LL33-L44C2\" target=\"_blank\" >ChangeEventPlugin.js</a></p>\n<p><a href=\"https://github.com/facebook/react/blob/12adaffef7105e2714f82651ea51936c563fe15c/packages/react-dom/src/events/plugins/EnterLeaveEventPlugin.js#LL29-L34C2\" target=\"_blank\" >EnterLeaveEventPlugin.js</a></p>\n<p><strong>SimpleEventPlugin</strong><br><a href=\"https://github.com/facebook/react/blob/12adaffef7105e2714f82651ea51936c563fe15c/packages/react-dom/src/events/DOMEventProperties.js#LL216-L230C2\" target=\"_blank\" >DOMEventProperties.js</a></p>\n<h3 id=\"åˆæˆäº‹ä»¶å…·ä½“è¡¨ç°\"><a href=\"#åˆæˆäº‹ä»¶å…·ä½“è¡¨ç°\" class=\"headerlink\" title=\"åˆæˆäº‹ä»¶å…·ä½“è¡¨ç°\"></a>åˆæˆäº‹ä»¶å…·ä½“è¡¨ç°</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; BeforeInputEventPlugin.js\nfunction registerEvents() &#123;\n  registerTwoPhaseEvent(&#39;onBeforeInput&#39;, [&#39;compositionend&#39;, &#39;keypress&#39;, &#39;textInput&#39;, &#39;paste&#39;]);\n  registerTwoPhaseEvent(&#39;onCompositionEnd&#39;, [&#39;compositionend&#39;, &#39;focusout&#39;, &#39;keydown&#39;, &#39;keypress&#39;, &#39;keyup&#39;, &#39;mousedown&#39;]);\n  registerTwoPhaseEvent(&#39;onCompositionStart&#39;, [&#39;compositionstart&#39;, &#39;focusout&#39;, &#39;keydown&#39;, &#39;keypress&#39;, &#39;keyup&#39;, &#39;mousedown&#39;]);\n  registerTwoPhaseEvent(&#39;onCompositionUpdate&#39;, [&#39;compositionupdate&#39;, &#39;focusout&#39;, &#39;keydown&#39;, &#39;keypress&#39;, &#39;keyup&#39;, &#39;mousedown&#39;]);\n&#125;\n&#x2F;&#x2F; ChangeEventPlugin.js\nfunction registerEvents() &#123;\n  registerTwoPhaseEvent(&#39;onChange&#39;, [&#39;change&#39;, &#39;click&#39;, &#39;focusin&#39;, &#39;focusout&#39;, &#39;input&#39;, &#39;keydown&#39;, &#39;keyup&#39;, &#39;selectionchange&#39;]);\n&#125;\n&#x2F;&#x2F; EnterLeaveEventPlugin.js\nfunction registerEvents() &#123;\n  registerDirectEvent(&#39;onMouseEnter&#39;, [&#39;mouseout&#39;, &#39;mouseover&#39;]);\n  registerDirectEvent(&#39;onMouseLeave&#39;, [&#39;mouseout&#39;, &#39;mouseover&#39;]);\n  registerDirectEvent(&#39;onPointerEnter&#39;, [&#39;pointerout&#39;, &#39;pointerover&#39;]);\n  registerDirectEvent(&#39;onPointerLeave&#39;, [&#39;pointerout&#39;, &#39;pointerover&#39;]);\n&#125;\n&#x2F;&#x2F; SelectEventPlugin.js\nfunction registerEvents() &#123;\n  registerTwoPhaseEvent(&#39;onSelect&#39;, [\n    &#39;focusout&#39;,\n    &#39;contextmenu&#39;,\n    &#39;dragend&#39;,\n    &#39;focusin&#39;,\n    &#39;keydown&#39;,\n    &#39;keyup&#39;,\n    &#39;mousedown&#39;,\n    &#39;mouseup&#39;,\n    &#39;selectionchange&#39;,\n  ]);\n&#125;\n\n&#x2F;&#x2F; SimpleEventPlugin.js\n\n&#x2F;&#x2F; registerSimpleEvents -&gt;\nimport &#123; registerSimpleEvents &#125; from &#39;..&#x2F;DOMEventProperties&#39;;\nexport &#123; registerSimpleEvents as registerEvents, extractEvents &#125;;\n&#x2F;&#x2F; DOMEventProperties.js\nexport function registerSimpleEvents() &#123;\n  registerSimplePluginEventsAndSetTheirPriorities(discreteEventPairsForSimpleEventPlugin, DiscreteEvent &#x2F;*äº‹ä»¶ä¼˜å…ˆçº§ *&#x2F;);\n  registerSimplePluginEventsAndSetTheirPriorities(userBlockingPairsForSimpleEventPlugin, UserBlockingEvent &#x2F;*äº‹ä»¶ä¼˜å…ˆçº§ *&#x2F;);\n  registerSimplePluginEventsAndSetTheirPriorities(continuousPairsForSimpleEventPlugin, ContinuousEvent &#x2F;*äº‹ä»¶ä¼˜å…ˆçº§ *&#x2F;);\n  setEventPriorities(otherDiscreteEvents, DiscreteEvent &#x2F;*äº‹ä»¶ä¼˜å…ˆçº§ *&#x2F;);\n&#125;\n\n&#x2F;*äº‹ä»¶ä¼˜å…ˆçº§ï¼š è§ä¸Šæ–‡ï¼š getEventPriority *&#x2F;</code></pre>\n\n<p><a href=\"https://github.com/facebook/react/blob/12adaffef7105e2714f82651ea51936c563fe15c/packages/react-dom/src/events/DOMEventProperties.js#LL147-L178C2\" target=\"_blank\" >registerSimplePluginEventsAndSetTheirPriorities</a></p>\n<p>æ³¨é‡Šè¯´ï¼šç»™è½¬åŒ–æˆäºŒç»´æ•°ç»„æ”¾åˆ° map é‡Œé¢</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;**\n * Turns\n * [&#39;abort&#39;, ...]\n *\n * into\n *\n * topLevelEventsToReactNames &#x3D; new Map([\n *   [&#39;abort&#39;, &#39;onAbort&#39;],\n * ]);\n *\n * and registers them.\n *&#x2F;\n\nfunction registerSimplePluginEventsAndSetTheirPriorities(eventTypes: Array&lt;DOMEventName | string&gt;, priority: EventPriority): void &#123;\n  &#x2F;&#x2F; ä½¿ç”¨äºŒç»´æ•°ç»„çš„å¥½å¤„ï¼Œæ•°æ®æˆå¯¹å‡ºç°ï¼Œä¸éœ€è¦ç”¨3ä¸ªæ•°ç»„æ¥å¤„ç†\n  for (let i &#x3D; 0; i &lt; eventTypes.length; i +&#x3D; 2) &#123;\n    const topEvent &#x3D; ((eventTypes[i]: any): DOMEventName); &#x2F;&#x2F; è§ä¸‹å›¾\n    const event &#x3D; ((eventTypes[i + 1]: any): string); &#x2F;&#x2F; è§ä¸‹å›¾\n    const capitalizedEvent &#x3D; event[0].toUpperCase() + event.slice(1);\n    const reactName &#x3D; &#39;on&#39; + capitalizedEvent; &#x2F;&#x2F; reactçš„äº‹ä»¶å\n    eventPriorities.set(topEvent, priority); &#x2F;&#x2F; è®¾ç½®äº‹ä»¶ä¼˜å…ˆçº§\n    topLevelEventsToReactNames.set(topEvent, reactName);\n    registerTwoPhaseEvent(reactName, [topEvent]);\n  &#125;\n&#125;</code></pre>\n\n<img src=\"http://t-blog-images.aijs.top/img/202303161412805.webp\" />\n\n<h3 id=\"è¿™ä¸ª-nativeEvent-æ€ä¹ˆæè¿›æ¥ï¼Ÿæ²¡å‘ç°å‘¢\"><a href=\"#è¿™ä¸ª-nativeEvent-æ€ä¹ˆæè¿›æ¥ï¼Ÿæ²¡å‘ç°å‘¢\" class=\"headerlink\" title=\"è¿™ä¸ª nativeEvent æ€ä¹ˆæè¿›æ¥ï¼Ÿæ²¡å‘ç°å‘¢\"></a>è¿™ä¸ª nativeEvent æ€ä¹ˆæè¿›æ¥ï¼Ÿæ²¡å‘ç°å‘¢</h3><p>bind è¿”å›çš„ listener è¢«è°ƒç”¨æ—¶å€™ä¼ è¿›æ¥çš„ <code>nativeEvent</code>?</p>\n<img src=\"http://t-blog-images.aijs.top/img/202303161448135.webp\" />\n\n<img src=\"http://t-blog-images.aijs.top/img/202303161539967.webp\" />\n\n<h3 id=\"åˆæˆäº‹ä»¶æ€ä¹ˆæ™“å¾—æˆ‘æ“ä½œå“ªä¸ªå…ƒç´ ï¼Œè¿›è¡Œå›è°ƒï¼Ÿ\"><a href=\"#åˆæˆäº‹ä»¶æ€ä¹ˆæ™“å¾—æˆ‘æ“ä½œå“ªä¸ªå…ƒç´ ï¼Œè¿›è¡Œå›è°ƒï¼Ÿ\" class=\"headerlink\" title=\"åˆæˆäº‹ä»¶æ€ä¹ˆæ™“å¾—æˆ‘æ“ä½œå“ªä¸ªå…ƒç´ ï¼Œè¿›è¡Œå›è°ƒï¼Ÿ\"></a>åˆæˆäº‹ä»¶æ€ä¹ˆæ™“å¾—æˆ‘æ“ä½œå“ªä¸ªå…ƒç´ ï¼Œè¿›è¡Œå›è°ƒï¼Ÿ</h3><p>å¦‚æœæ˜¯ Aã€B ä¸¤ä¸ªæŒ‰é’®ï¼šåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œç‚¹å‡» A æŒ‰é’®ï¼Œäº‹ä»¶åˆ°è¾¾ æ ¹ DOM å®¹å™¨ï¼Œreact å¦‚ä½•è¯†åˆ«ï¼Œä½¿ç”¨è°ƒç”¨äº† A æŒ‰é’®çš„ onClick,è€Œä¸æ˜¯ B çš„ onClick</p>\n<!-- äº‹ä»¶ä»£ç†ï¼šä¸éœ€è¦è€ƒè™‘è°è§¦å‘çš„ï¼Œå›è°ƒå°±åœ¨é‚£ -->\n\n<ol>\n<li>AB å¹³çº§ï¼Œå‡è®¾ä¹Ÿä¼ é€’äº†å…¶ä»–æ•°æ®çš„æƒ…å†µï¼Œæ€ä¹ˆæ™“å¾—æ˜¯ A è¿˜æ˜¯ B çš„å›è°ƒ</li>\n<li>A å†…ï¼ŒB å¤– åµŒå¥—ï¼Œéƒ½ä¼šè§¦å‘</li>\n</ol>\n<img src=\"http://t-blog-images.aijs.top/img/202303161918293.webp\" />\n","text":"è¯»æºç åŸºç¡€ ä½è¿ç®— callã€applyã€bind åŸç† é“¾è¡¨ç›¸å…³çŸ¥è¯†(å•é“¾è¡¨ã€åŒé“¾è¡¨ã€å¾ªç¯é“¾è¡¨) èŠ‚æµã€é˜²æŠ–åŸç† ensureRootIsScheduled: if (existingCallbackNode !== null) &#123; è®¾è®¡æ¨¡å¼ç›¸å…³çŸ¥è¯† å®‰å…¨ç›¸å…³çŸ¥è¯† æ ˆ...","link":"","photos":[],"count_time":{"symbolsCount":"9.4k","symbolsTime":"9 mins."},"categories":[{"name":"React","slug":"React","count":38,"path":"api/categories/React.json"}],"tags":[{"name":"React","slug":"React","count":32,"path":"api/tags/React.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AF%BB%E6%BA%90%E7%A0%81%E5%9F%BA%E7%A1%80\"><span class=\"toc-text\">è¯»æºç åŸºç¡€</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#jsx-gt-React-createElement\"><span class=\"toc-text\">jsx -&gt; React.createElement</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#React-createElement-gt-ReactElment-%E6%A0%91\"><span class=\"toc-text\">React.createElement -&gt; ReactElment æ ‘</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ReactElment-gt-update-gt-updateQueue-gt-fiber\"><span class=\"toc-text\">ReactElment -&gt; update -&gt; updateQueue -&gt; fiber</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ReactElment-%E6%A0%91-gt-fiber-%E6%A0%91-gt-dom-%E6%A0%91\"><span class=\"toc-text\">ReactElment æ ‘ -&gt; fiber æ ‘ -&gt; dom æ ‘</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#jsx-%E4%BB%A3%E7%A0%81%E7%BB%8F-babel-%E5%88%B0-ReactElment-%E6%A0%91\"><span class=\"toc-text\">jsx ä»£ç ç» babel åˆ° ReactElment æ ‘</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#this-setState-gt-fiber\"><span class=\"toc-text\">this.setState -&gt; fiber</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%A1%A5-React-%E5%9B%BE%E8%A7%A3\"><span class=\"toc-text\">è¡¥ React å›¾è§£</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#processUpdateQueue-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90\"><span class=\"toc-text\">processUpdateQueue æºç è§£æ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E8%AE%A1%E7%AE%97%E6%96%B0%E7%9A%84-state\"><span class=\"toc-text\">å¦‚ä½•è®¡ç®—æ–°çš„ state</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#nextProps-%E6%80%8E%E4%B9%88%E4%BC%9A%E6%9C%89-ReactElement-%E5%AF%B9%E8%B1%A1\"><span class=\"toc-text\">nextProps æ€ä¹ˆä¼šæœ‰ ReactElement å¯¹è±¡</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#beginwork\"><span class=\"toc-text\">beginwork</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#stateNode-%E7%B1%BB%E7%BB%84%E4%BB%B6%E7%9A%84-stateNode-%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84%EF%BC%8ChostElement-%E7%9A%84-stateNode-%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84%EF%BC%9F\"><span class=\"toc-text\">stateNode: ç±»ç»„ä»¶çš„ stateNode æ˜¯æ€æ ·çš„ï¼ŒhostElement çš„ stateNode æ˜¯æ€æ ·çš„ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8-%E8%BF%99%E4%B8%AA%E4%B8%8E%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E6%9C%89%E5%85%B3%EF%BC%8C%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E7%9A%84%E9%A1%BA%E5%BA%8F%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">çˆ¶å­ç»„ä»¶çš„å‰¯ä½œç”¨, è¿™ä¸ªä¸æ‰§è¡Œé¡ºåºæœ‰å…³ï¼Œçˆ¶å­ç»„ä»¶çš„é¡ºåºé—®é¢˜</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#bubbleProperties\"><span class=\"toc-text\">bubbleProperties</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#classInstance-%E7%9A%84-render\"><span class=\"toc-text\">classInstance çš„ render()</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E5%8F%96%E5%88%B0%E6%AC%A1%E7%BA%A7%E8%8A%82%E7%82%B9%E7%AC%AC%E4%B8%80%E4%B8%AA-fiber-%E7%9A%84%EF%BC%9F\"><span class=\"toc-text\">å¦‚ä½•å–åˆ°æ¬¡çº§èŠ‚ç‚¹ç¬¬ä¸€ä¸ª fiber çš„ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#markUpdateLaneFromFiberToRoot-%E7%9A%84-sourceFiber-%E4%B8%8D%E7%90%86%E8%A7%A3%E8%BF%99%E4%B8%AA-sourceFiber-%E6%98%AF%E5%A6%82%E4%BD%95%E5%8F%96%E5%93%AA%E4%B8%AA%E4%BD%9C%E4%B8%BA-sourceFiber\"><span class=\"toc-text\">markUpdateLaneFromFiberToRoot çš„ sourceFiber ä¸ç†è§£è¿™ä¸ª sourceFiber æ˜¯å¦‚ä½•å–å“ªä¸ªä½œä¸º sourceFiber</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9B%B4%E6%96%B0%E8%BF%87%E7%A8%8B%E4%B8%AD%EF%BC%8CDOM-%E5%B1%9E%E6%80%A7%E5%8F%98%E5%8C%96%EF%BC%8C%E4%B8%8D%E5%88%9B%E5%BB%BA-DOM-%E5%AF%B9%E8%B1%A1%EF%BC%8C%E4%BB%85%E6%A0%87%E8%AE%B0%EF%BC%8Ccommit-%E9%98%B6%E6%AE%B5%E4%BC%9A%E5%A4%84%E7%90%86\"><span class=\"toc-text\">æ›´æ–°è¿‡ç¨‹ä¸­ï¼ŒDOM å±æ€§å˜åŒ–ï¼Œä¸åˆ›å»º DOM å¯¹è±¡ï¼Œä»…æ ‡è®°ï¼Œcommit é˜¶æ®µä¼šå¤„ç†</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#fiber-lanes\"><span class=\"toc-text\">fiber.lanes</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#props-%E4%B8%AD%E6%9C%89%E8%8A%82%E7%82%B9%E7%9A%84%E6%A0%87%E7%AD%BE%E4%BF%A1%E6%81%AF%EF%BC%9Fbuton-%E5%8F%98%E6%88%90-a-%E4%BC%9A%E6%80%8E%E6%A0%B7%EF%BC%9F\"><span class=\"toc-text\">props ä¸­æœ‰èŠ‚ç‚¹çš„æ ‡ç­¾ä¿¡æ¯ï¼Ÿbuton å˜æˆ a ä¼šæ€æ ·ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#fiber-%E7%9A%84-flags-%E5%B1%9E%E6%80%A7%EF%BC%8C%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%B5%8B%E5%80%BC%E7%9A%84%EF%BC%8C%E8%BF%99%E9%87%8C%E6%9C%89%E7%94%A8-fiber-flags-x3D-0-%E5%88%A4%E6%96%AD%E6%9C%89%E6%B2%A1%E6%9C%89%E5%89%AF%E4%BD%9C%E7%94%A8\"><span class=\"toc-text\">fiber çš„ flags å±æ€§ï¼Œä»€ä¹ˆæ—¶å€™èµ‹å€¼çš„ï¼Œè¿™é‡Œæœ‰ç”¨ fiber.flags &#x3D; 0 åˆ¤æ–­æœ‰æ²¡æœ‰å‰¯ä½œç”¨</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%BA%E4%BB%80%E4%B9%88-lastEffect-%E6%8C%87%E9%92%88%E4%B8%8D%E5%8F%98%E5%91%A2%EF%BC%9F\"><span class=\"toc-text\">ä¸ºä»€ä¹ˆ lastEffect æŒ‡é’ˆä¸å˜å‘¢ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%97%AD%E5%8C%85%E5%92%8C%E7%B1%BB%E7%9A%84%E5%8E%9F%E5%A7%8B%E6%80%A7%E8%83%BD%E5%8F%AA%E6%9C%89%E5%9C%A8%E6%9E%81%E7%AB%AF%E5%9C%BA%E6%99%AF%E4%B8%8B%E6%89%8D%E4%BC%9A%E6%9C%89%E6%98%8E%E6%98%BE%E7%9A%84%E5%B7%AE%E5%88%AB%EF%BC%8C%E6%9E%81%E7%AB%AF%E6%83%85%E5%86%B5%E6%98%AF%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%EF%BC%9F\"><span class=\"toc-text\">é—­åŒ…å’Œç±»çš„åŸå§‹æ€§èƒ½åªæœ‰åœ¨æç«¯åœºæ™¯ä¸‹æ‰ä¼šæœ‰æ˜æ˜¾çš„å·®åˆ«ï¼Œæç«¯æƒ…å†µæ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Hook-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%B8%8E-fiber-%E5%85%B3%E8%81%94%E7%9A%84%EF%BC%9F\"><span class=\"toc-text\">Hook ä»€ä¹ˆæ—¶å€™ä¸ fiber å…³è”çš„ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%89%AF%E4%BD%9C%E7%94%A8-hook-%E5%A6%82%E4%BD%95%E8%BD%AC%E5%8C%96%E6%88%90-fiber-flags-%E7%9A%84%EF%BC%9F\"><span class=\"toc-text\">å‰¯ä½œç”¨ hook å¦‚ä½•è½¬åŒ–æˆ fiber.flags çš„ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#hook-%E7%9A%84-effect-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%BD%A2%E6%88%90%E9%93%BE%E8%A1%A8%E7%9A%84%EF%BC%8C%E5%A6%82%E4%BD%95%E5%BD%A2%E6%88%90%E7%9A%84%EF%BC%9F\"><span class=\"toc-text\">hook çš„ effect ä»€ä¹ˆæ—¶å€™å½¢æˆé“¾è¡¨çš„ï¼Œå¦‚ä½•å½¢æˆçš„ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#TODO-%E8%A1%A5%E5%85%85%E5%88%B0%E8%87%AA%E5%AE%9A%E4%B9%89-ahooks%EF%BC%88%E6%9A%82%E6%97%B6%E4%B8%8D%E8%AE%B0%E5%BE%97%E6%98%AF%E5%93%AA%E7%AF%87%E9%9C%80%E8%A6%81%E7%9A%84%EF%BC%89\"><span class=\"toc-text\">TODO: è¡¥å……åˆ°è‡ªå®šä¹‰ ahooksï¼ˆæš‚æ—¶ä¸è®°å¾—æ˜¯å“ªç¯‡éœ€è¦çš„ï¼‰</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#updateWorkInProgressHook-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E5%8D%95%E6%AD%A5%E5%85%8B%E9%9A%86%EF%BC%8C%E6%80%8E%E4%B9%88%E4%B8%8D%E7%9B%B4%E6%8E%A5\"><span class=\"toc-text\">updateWorkInProgressHook ä¸ºä»€ä¹ˆæ˜¯å•æ­¥å…‹éš†ï¼Œæ€ä¹ˆä¸ç›´æ¥</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#mountState-mountReducer-gt-dispatch-gt-dispatchAction-bind-%E8%BF%9B%E8%A1%8C-scheduleUpdateOnFiber\"><span class=\"toc-text\">mountState,mountReducer -&gt; dispatch -&gt; dispatchAction bind è¿›è¡Œ scheduleUpdateOnFiber</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#updateState-updateReducer-gt-dispatch-gt-dispatchAction-bind-%E8%BF%9B%E8%A1%8C-scheduleUpdateOnFiber\"><span class=\"toc-text\">updateState,updateReducer -&gt; dispatch -&gt; dispatchAction bind è¿›è¡Œ scheduleUpdateOnFiber</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#queue-pending-%E6%98%AF%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8%EF%BC%9F-1-%E4%B8%BA%E4%BB%80%E7%94%A8%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8%EF%BC%9F2-%E5%A6%82%E4%BD%95%E6%89%BE%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8%E7%9A%84%E5%85%A5%E5%8F%A3%EF%BC%9F\"><span class=\"toc-text\">queue.pending æ˜¯ç¯å½¢é“¾è¡¨ï¼Ÿ 1. ä¸ºä»€ç”¨ç¯å½¢é“¾è¡¨ï¼Ÿ2. å¦‚ä½•æ‰¾ç¯å½¢é“¾è¡¨çš„å…¥å£ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#pending-gt-%E6%96%B0%E7%8A%B6%E6%80%81\"><span class=\"toc-text\">pending -&gt; æ–°çŠ¶æ€</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BC%98%E5%85%88%E7%BA%A7%E5%A6%82%E4%BD%95%E4%BA%A7%E7%94%9F-requestUpdateLane\"><span class=\"toc-text\">ä¼˜å…ˆçº§å¦‚ä½•äº§ç”Ÿ requestUpdateLane</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%99%E4%B8%AA%E6%98%AF%E5%BC%82%E6%AD%A5%E7%9A%84\"><span class=\"toc-text\">è¿™ä¸ªæ˜¯å¼‚æ­¥çš„</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Hook-%E7%9A%84-state-%E8%AE%A1%E7%AE%97%E6%9C%89%E7%82%B9%E5%A4%8D%E6%9D%82-baseQueue-gt-newBaseState-newState-%E3%80%90%E6%9C%AA%E7%90%86%E8%A7%A3%E3%80%91\"><span class=\"toc-text\">Hook çš„ state è®¡ç®—æœ‰ç‚¹å¤æ‚: baseQueue -&gt; newBaseState,newState ã€æœªç†è§£ã€‘</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Hook-baseQueue-%E5%8F%98%E5%8C%96\"><span class=\"toc-text\">Hook baseQueue å˜åŒ–</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#typeof\"><span class=\"toc-text\">$$typeof</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#reconciliation\"><span class=\"toc-text\">reconciliation</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B4%E8%B6%A3%E4%B8%8E%E7%94%9F%E6%B4%BB%E7%9A%84%E5%86%B2%E7%AA%81\"><span class=\"toc-text\">å…´è¶£ä¸ç”Ÿæ´»çš„å†²çª</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%9B%9E%E5%BD%92%E7%90%86%E6%80%A7\"><span class=\"toc-text\">å›å½’ç†æ€§</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A6%A5%E5%8D%8F-%E5%92%8C%E8%A7%A3\"><span class=\"toc-text\">å¦¥å å’Œè§£</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#react-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AF%B9%E7%AE%97%E6%B3%95%E8%BF%9B%E8%A1%8C%E5%A6%A5%E5%8D%8F%EF%BC%88or-%E5%92%8C%E8%A7%A3-or-%E5%81%9A%E5%87%BA%E8%AE%A9%E6%AD%A5%EF%BC%89%EF%BC%9F\"><span class=\"toc-text\">react ä¸ºä»€ä¹ˆå¯¹ç®—æ³•è¿›è¡Œå¦¥åï¼ˆor å’Œè§£ or åšå‡ºè®©æ­¥ï¼‰ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E5%A6%A5%E5%8D%8F%EF%BC%9F%E5%90%AF%E5%8F%91%E5%BC%8F%E7%AE%97%E6%B3%95\"><span class=\"toc-text\">å¦‚ä½•å¦¥åï¼Ÿå¯å‘å¼ç®—æ³•</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%8F%E7%BB%93\"><span class=\"toc-text\">å°ç»“</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#vscode-%E6%8A%98%E5%8F%A0%E7%AD%96%E7%95%A5\"><span class=\"toc-text\">vscode æŠ˜å ç­–ç•¥</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AB%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%EF%BC%8C%E5%A6%82%E4%BD%95%E5%90%88%E6%88%90%EF%BC%8C%E5%90%88%E6%88%90%E5%88%B0%E4%BB%80%E4%B9%88%E6%A0%B7%E5%AD%90%EF%BC%9F\"><span class=\"toc-text\">ä¸ºä»€ä¹ˆå«åˆæˆäº‹ä»¶ï¼Œå¦‚ä½•åˆæˆï¼Œåˆæˆåˆ°ä»€ä¹ˆæ ·å­ï¼Ÿ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E5%85%B7%E4%BD%93%E8%A1%A8%E7%8E%B0\"><span class=\"toc-text\">åˆæˆäº‹ä»¶å…·ä½“è¡¨ç°</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%99%E4%B8%AA-nativeEvent-%E6%80%8E%E4%B9%88%E6%90%9E%E8%BF%9B%E6%9D%A5%EF%BC%9F%E6%B2%A1%E5%8F%91%E7%8E%B0%E5%91%A2\"><span class=\"toc-text\">è¿™ä¸ª nativeEvent æ€ä¹ˆæè¿›æ¥ï¼Ÿæ²¡å‘ç°å‘¢</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E6%80%8E%E4%B9%88%E6%99%93%E5%BE%97%E6%88%91%E6%93%8D%E4%BD%9C%E5%93%AA%E4%B8%AA%E5%85%83%E7%B4%A0%EF%BC%8C%E8%BF%9B%E8%A1%8C%E5%9B%9E%E8%B0%83%EF%BC%9F\"><span class=\"toc-text\">åˆæˆäº‹ä»¶æ€ä¹ˆæ™“å¾—æˆ‘æ“ä½œå“ªä¸ªå…ƒç´ ï¼Œè¿›è¡Œå›è°ƒï¼Ÿ</span></a></li></ol></li></ol>","author":{"name":"ä¸¾æ‰‹æ‘˜æœˆäº®","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>çœ¼ä¸­æœ‰å…‰ï¼Œå¿ƒä¸­æœ‰æ¢¦ï¼Œè„šä¸‹æœ‰è·¯</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"ossutil","uid":"a48730f893eb3d8564a6e41f516078f2","slug":"2023-03-17ossutil","date":"2023-03-17T01:12:02.000Z","updated":"2023-05-15T13:17:32.987Z","comments":true,"path":"api/articles/2023-03-17ossutil.json","keywords":null,"cover":[],"text":"åŠ¨æœº ä¹‹å‰å•å¼ å›¾ä½¿ç”¨ PicGo è¿›è¡Œä¸Šä¼ ï¼Œè¿™æ¬¡éœ€è¦æ‰¹é‡å¤šç›®å½•å¤„ç† é˜¿é‡Œäº‘ OSS ç½‘é¡µä¸Šä¼ ï¼Œä¼šä¸¢å¤±ç›®å½•å±‚çº§å…³ç³» æ‰¹é‡å°†ç›®å½•ä¸‹çš„å›¾ç‰‡ï¼ŒåŠæ–‡ä»¶å¯¹åº”å…³ç³»ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ OSS,åšå®¢åœ¨çº¿èµ„æºä½¿ç”¨ æ‰¹é‡å›¾ç‰‡å‹ç¼©ï¼Œä¿ç•™æ–‡ä»¶å…³ç³» æ‰¹é‡å›¾ç‰‡å‹ç¼©ChatGPT ç”Ÿæˆ pngquant å‹ç¼©å·¥å…·pn...","link":"","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"é˜¿é‡Œäº‘","slug":"é˜¿é‡Œäº‘","count":1,"path":"api/categories/é˜¿é‡Œäº‘.json"}],"tags":[{"name":"é˜¿é‡Œäº‘","slug":"é˜¿é‡Œäº‘","count":1,"path":"api/tags/é˜¿é‡Œäº‘.json"}],"author":{"name":"ä¸¾æ‰‹æ‘˜æœˆäº®","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>çœ¼ä¸­æœ‰å…‰ï¼Œå¿ƒä¸­æœ‰æ¢¦ï¼Œè„šä¸‹æœ‰è·¯</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"React StrictMode","uid":"072284d75a6848b3baf49e71f53b2857","slug":"2023-03-10babel","date":"2023-03-10T09:14:04.000Z","updated":"2023-03-13T13:39:28.233Z","comments":true,"path":"api/articles/2023-03-10babel.json","keywords":null,"cover":[],"text":"åŠ¨æœº React StrictMode çš„æºç é•¿ä»€ä¹ˆæ ·å­ï¼Ÿ æ‰§è¡Œè¿‡æˆæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆæ˜¯æ ‡ç­¾ï¼Œéš¾é“ React å†…éƒ¨å®ç°äº†è¿™ä¸ªç»„ä»¶ï¼Ÿ æŸ¥èµ„æ–™æœåˆ°çš„èµ„æ–™éƒ½æ˜¯å®˜ç½‘æ–‡æ¡£ å’Œ React å®˜æ–¹åšå®¢ 18 ç‰ˆæœ¬æ›´æ–°å†…å®¹ çš„æ¬è¿ ç¿»æºç clone react æºç ï¼Œ vscode æœç´¢ä¸€æœ ğŸ˜“ï¼Œ...","link":"","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"React","slug":"React","count":38,"path":"api/categories/React.json"}],"tags":[{"name":"React","slug":"React","count":32,"path":"api/tags/React.json"}],"author":{"name":"ä¸¾æ‰‹æ‘˜æœˆäº®","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/202303171118970.webp","link":"/","description":"<div><p>çœ¼ä¸­æœ‰å…‰ï¼Œå¿ƒä¸­æœ‰æ¢¦ï¼Œè„šä¸‹æœ‰è·¯</p><div>","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}