{"title":"nest 413","uid":"86597b4f3663d14f1511e64b4a45dce2","slug":"2022-09-06nestjs","date":"2022-09-06T12:44:35.000Z","updated":"2022-09-16T13:54:56.317Z","comments":true,"path":"api/articles/2022-09-06nestjs.json","keywords":null,"cover":[],"content":"<h2 id=\"有问题的项目\"><a href=\"#有问题的项目\" class=\"headerlink\" title=\"有问题的项目\"></a>有问题的项目</h2><pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\">import &#123; NestFactory &#125; from &quot;@nestjs&#x2F;core&quot;;\nimport &#123; NestExpressApplication &#125; from &quot;@nestjs&#x2F;platform-express&quot;;\nimport &#123; AppModule &#125; from &quot;.&#x2F;app.module&quot;;\nimport &#123; join &#125; from &quot;path&quot;;\nimport &#123; rootDir &#125; from &quot;.&#x2F;utils&#x2F;path&quot;;\nimport &#123; config &#125; from &quot;.&#x2F;config&quot;;\nimport * as bodyParser from &quot;body-parser&quot;;\n\nasync function bootstrap() &#123;\n  &#x2F;&#x2F; const app &#x3D; await NestFactory.create(AppModule);\n  const app &#x3D; await NestFactory.create&lt;NestExpressApplication&gt;(AppModule, &#123;\n    cors: true,\n  &#125;);\n  app.setGlobalPrefix(&quot;api&quot;);\n  app.useStaticAssets(join(rootDir, &quot;public&quot;), &#123;\n    prefix: config.static, &#x2F;&#x2F;设置虚拟路径\n  &#125;);\n\n  &#x2F;&#x2F; limit\n  app.use(bodyParser.urlencoded(&#123; extended: true, limit: &quot;8mb&quot; &#125;));\n  app.use(bodyParser.json(&#123; limit: &quot;8mb&quot; &#125;));\n\n  app.enableCors();\n  await app.listen(config.port);\n&#125;\nbootstrap();</code></pre>\n\n<h2 id=\"新构建的项目-413\"><a href=\"#新构建的项目-413\" class=\"headerlink\" title=\"新构建的项目 413\"></a>新构建的项目 413</h2><p>在一个项目中试了 n 遍都报同样的错误</p>\n<pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\">import &#123; NestFactory &#125; from &quot;@nestjs&#x2F;core&quot;;\nimport &#123; AppModule &#125; from &quot;.&#x2F;app.module&quot;;\n\nasync function bootstrap() &#123;\n  const app &#x3D; await NestFactory.create(AppModule);\n\n  await app.listen(8000);\n&#125;\nbootstrap();\n\n&#x2F;&#x2F;</code></pre>\n\n<img src=\"http://t-blog-images.aijs.top/img/202209062047875.png\" />\n\n<h2 id=\"新构建的项目-200\"><a href=\"#新构建的项目-200\" class=\"headerlink\" title=\"新构建的项目 200\"></a>新构建的项目 200</h2><pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\">&#x2F;&#x2F; it&#39;s ok\nimport &#123; NestFactory &#125; from &quot;@nestjs&#x2F;core&quot;;\nimport &#123; AppModule &#125; from &quot;.&#x2F;app.module&quot;;\nimport * as bodyParser from &quot;body-parser&quot;;\nasync function bootstrap() &#123;\n  const app &#x3D; await NestFactory.create(AppModule);\n  &#x2F;&#x2F; 配置limit\n  app.use(bodyParser.json(&#123; limit: &quot;50mb&quot; &#125;));\n  app.use(bodyParser.urlencoded(&#123; limit: &quot;50mb&quot;, extended: true &#125;));\n\n  await app.listen(8000);\n&#125;\nbootstrap();</code></pre>\n\n<img src=\"http://t-blog-images.aijs.top/img/202209062043913.png\" />\n\n<h2 id=\"新构建的项目-使用-NestExpressApplication\"><a href=\"#新构建的项目-使用-NestExpressApplication\" class=\"headerlink\" title=\"新构建的项目 使用 NestExpressApplication\"></a>新构建的项目 使用 NestExpressApplication</h2><p>配置如下，src 相关代码完全一致</p>\n<pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\">&#123;\n  &quot;name&quot;: &quot;nest-413&quot;,\n  &quot;version&quot;: &quot;0.0.1&quot;,\n  &quot;description&quot;: &quot;&quot;,\n  &quot;author&quot;: &quot;&quot;,\n  &quot;private&quot;: true,\n  &quot;license&quot;: &quot;UNLICENSED&quot;,\n  &quot;scripts&quot;: &#123;\n    &quot;prebuild&quot;: &quot;rimraf dist&quot;,\n    &quot;build&quot;: &quot;nest build&quot;,\n    &quot;format&quot;: &quot;prettier --write \\&quot;src&#x2F;**&#x2F;*.ts\\&quot; \\&quot;test&#x2F;**&#x2F;*.ts\\&quot;&quot;,\n    &quot;start&quot;: &quot;nest start&quot;,\n    &quot;start:dev&quot;: &quot;nest start --watch&quot;,\n    &quot;start:debug&quot;: &quot;nest start --debug --watch&quot;,\n    &quot;start:prod&quot;: &quot;node dist&#x2F;main&quot;,\n    &quot;lint&quot;: &quot;eslint \\&quot;&#123;src,apps,libs,test&#125;&#x2F;**&#x2F;*.ts\\&quot; --fix&quot;,\n    &quot;test&quot;: &quot;jest&quot;,\n    &quot;test:watch&quot;: &quot;jest --watch&quot;,\n    &quot;test:cov&quot;: &quot;jest --coverage&quot;,\n    &quot;test:debug&quot;: &quot;node --inspect-brk -r tsconfig-paths&#x2F;register -r ts-node&#x2F;register node_modules&#x2F;.bin&#x2F;jest --runInBand&quot;,\n    &quot;test:e2e&quot;: &quot;jest --config .&#x2F;test&#x2F;jest-e2e.json&quot;\n  &#125;,\n  &quot;dependencies&quot;: &#123;\n    &quot;@nestjs&#x2F;common&quot;: &quot;^9.0.0&quot;,\n    &quot;@nestjs&#x2F;core&quot;: &quot;^9.0.0&quot;,\n    &quot;@nestjs&#x2F;platform-express&quot;: &quot;^9.0.11&quot;,\n    &quot;@nestjs&#x2F;typeorm&quot;: &quot;^9.0.1&quot;,\n    &quot;body-parser&quot;: &quot;^1.20.0&quot;,\n    &quot;mysql2&quot;: &quot;^2.3.3&quot;,\n    &quot;reflect-metadata&quot;: &quot;^0.1.13&quot;,\n    &quot;request&quot;: &quot;^2.88.2&quot;,\n    &quot;rimraf&quot;: &quot;^3.0.2&quot;,\n    &quot;rxjs&quot;: &quot;^7.2.0&quot;,\n    &quot;typeorm&quot;: &quot;^0.3.9&quot;\n  &#125;,\n  &quot;devDependencies&quot;: &#123;\n    &quot;@nestjs&#x2F;cli&quot;: &quot;^9.0.0&quot;,\n    &quot;@nestjs&#x2F;schematics&quot;: &quot;^9.0.0&quot;,\n    &quot;@nestjs&#x2F;testing&quot;: &quot;^9.0.0&quot;,\n    &quot;@types&#x2F;express&quot;: &quot;^4.17.13&quot;,\n    &quot;@types&#x2F;jest&quot;: &quot;28.1.8&quot;,\n    &quot;@types&#x2F;node&quot;: &quot;^16.0.0&quot;,\n    &quot;@types&#x2F;supertest&quot;: &quot;^2.0.11&quot;,\n    &quot;@typescript-eslint&#x2F;eslint-plugin&quot;: &quot;^5.0.0&quot;,\n    &quot;@typescript-eslint&#x2F;parser&quot;: &quot;^5.0.0&quot;,\n    &quot;eslint&quot;: &quot;^8.0.1&quot;,\n    &quot;eslint-config-prettier&quot;: &quot;^8.3.0&quot;,\n    &quot;eslint-plugin-prettier&quot;: &quot;^4.0.0&quot;,\n    &quot;jest&quot;: &quot;28.1.3&quot;,\n    &quot;prettier&quot;: &quot;^2.3.2&quot;,\n    &quot;source-map-support&quot;: &quot;^0.5.20&quot;,\n    &quot;supertest&quot;: &quot;^6.1.3&quot;,\n    &quot;ts-jest&quot;: &quot;28.0.8&quot;,\n    &quot;ts-loader&quot;: &quot;^9.2.3&quot;,\n    &quot;ts-node&quot;: &quot;^10.0.0&quot;,\n    &quot;tsconfig-paths&quot;: &quot;4.1.0&quot;,\n    &quot;typescript&quot;: &quot;^4.7.4&quot;\n  &#125;,\n  &quot;jest&quot;: &#123;\n    &quot;moduleFileExtensions&quot;: [\n      &quot;js&quot;,\n      &quot;json&quot;,\n      &quot;ts&quot;\n    ],\n    &quot;rootDir&quot;: &quot;src&quot;,\n    &quot;testRegex&quot;: &quot;.*\\\\.spec\\\\.ts$&quot;,\n    &quot;transform&quot;: &#123;\n      &quot;^.+\\\\.(t|j)s$&quot;: &quot;ts-jest&quot;\n    &#125;,\n    &quot;collectCoverageFrom&quot;: [\n      &quot;**&#x2F;*.(t|j)s&quot;\n    ],\n    &quot;coverageDirectory&quot;: &quot;..&#x2F;coverage&quot;,\n    &quot;testEnvironment&quot;: &quot;node&quot;\n  &#125;\n&#125;\n</code></pre>\n\n<h2 id=\"有问题项目配置\"><a href=\"#有问题项目配置\" class=\"headerlink\" title=\"有问题项目配置\"></a>有问题项目配置</h2><pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\">&#123;\n  &quot;name&quot;: &quot;mitm-cache&quot;,\n  &quot;version&quot;: &quot;0.0.1&quot;,\n  &quot;description&quot;: &quot;&quot;,\n  &quot;author&quot;: &quot;&quot;,\n  &quot;private&quot;: true,\n  &quot;license&quot;: &quot;UNLICENSED&quot;,\n  &quot;scripts&quot;: &#123;\n    &quot;prebuild&quot;: &quot;rimraf dist&quot;,\n    &quot;build&quot;: &quot;nest build&quot;,\n    &quot;format&quot;: &quot;prettier --write \\&quot;src&#x2F;**&#x2F;*.ts\\&quot; \\&quot;test&#x2F;**&#x2F;*.ts\\&quot;&quot;,\n    &quot;start&quot;: &quot;nest start&quot;,\n    &quot;start:dev&quot;: &quot;nest start --watch&quot;,\n    &quot;start:debug&quot;: &quot;nest start --debug --watch&quot;,\n    &quot;start:prod&quot;: &quot;node dist&#x2F;main&quot;,\n    &quot;lint&quot;: &quot;eslint \\&quot;&#123;src,apps,libs,test&#125;&#x2F;**&#x2F;*.ts\\&quot; --fix&quot;,\n    &quot;test&quot;: &quot;jest&quot;,\n    &quot;test:watch&quot;: &quot;jest --watch&quot;,\n    &quot;test:cov&quot;: &quot;jest --coverage&quot;,\n    &quot;test:debug&quot;: &quot;node --inspect-brk -r tsconfig-paths&#x2F;register -r ts-node&#x2F;register node_modules&#x2F;.bin&#x2F;jest --runInBand&quot;,\n    &quot;test:e2e&quot;: &quot;jest --config .&#x2F;test&#x2F;jest-e2e.json&quot;\n  &#125;,\n  &quot;dependencies&quot;: &#123;\n    &quot;@nestjs&#x2F;common&quot;: &quot;^8.0.0&quot;,\n    &quot;@nestjs&#x2F;core&quot;: &quot;^8.0.0&quot;,\n    &quot;@nestjs&#x2F;platform-express&quot;: &quot;^8.4.7&quot;,\n    &quot;@nestjs&#x2F;typeorm&quot;: &quot;^8.1.4&quot;,\n    &quot;mysql2&quot;: &quot;^2.3.3&quot;,\n    &quot;reflect-metadata&quot;: &quot;^0.1.13&quot;,\n    &quot;request&quot;: &quot;^2.88.2&quot;,\n    &quot;rimraf&quot;: &quot;^3.0.2&quot;,\n    &quot;rxjs&quot;: &quot;^7.2.0&quot;,\n    &quot;typeorm&quot;: &quot;^0.3.6&quot;\n  &#125;,\n  &quot;devDependencies&quot;: &#123;\n    &quot;@nestjs&#x2F;cli&quot;: &quot;^8.0.0&quot;,\n    &quot;@nestjs&#x2F;schematics&quot;: &quot;^8.0.0&quot;,\n    &quot;@nestjs&#x2F;testing&quot;: &quot;^8.0.0&quot;,\n    &quot;@types&#x2F;express&quot;: &quot;^4.17.13&quot;,\n    &quot;@types&#x2F;jest&quot;: &quot;27.5.0&quot;,\n    &quot;@types&#x2F;node&quot;: &quot;^16.0.0&quot;,\n    &quot;@types&#x2F;supertest&quot;: &quot;^2.0.11&quot;,\n    &quot;@typescript-eslint&#x2F;eslint-plugin&quot;: &quot;^5.0.0&quot;,\n    &quot;@typescript-eslint&#x2F;parser&quot;: &quot;^5.0.0&quot;,\n    &quot;eslint&quot;: &quot;^8.0.1&quot;,\n    &quot;eslint-config-prettier&quot;: &quot;^8.3.0&quot;,\n    &quot;eslint-plugin-prettier&quot;: &quot;^4.0.0&quot;,\n    &quot;jest&quot;: &quot;28.0.3&quot;,\n    &quot;prettier&quot;: &quot;^2.3.2&quot;,\n    &quot;source-map-support&quot;: &quot;^0.5.20&quot;,\n    &quot;supertest&quot;: &quot;^6.1.3&quot;,\n    &quot;ts-jest&quot;: &quot;28.0.1&quot;,\n    &quot;ts-loader&quot;: &quot;^9.2.3&quot;,\n    &quot;ts-node&quot;: &quot;^10.0.0&quot;,\n    &quot;tsconfig-paths&quot;: &quot;4.0.0&quot;,\n    &quot;typescript&quot;: &quot;^4.3.5&quot;\n  &#125;,\n  &quot;jest&quot;: &#123;\n    &quot;moduleFileExtensions&quot;: [\n      &quot;js&quot;,\n      &quot;json&quot;,\n      &quot;ts&quot;\n    ],\n    &quot;rootDir&quot;: &quot;src&quot;,\n    &quot;testRegex&quot;: &quot;.*\\\\.spec\\\\.ts$&quot;,\n    &quot;transform&quot;: &#123;\n      &quot;^.+\\\\.(t|j)s$&quot;: &quot;ts-jest&quot;\n    &#125;,\n    &quot;collectCoverageFrom&quot;: [\n      &quot;**&#x2F;*.(t|j)s&quot;\n    ],\n    &quot;coverageDirectory&quot;: &quot;..&#x2F;coverage&quot;,\n    &quot;testEnvironment&quot;: &quot;node&quot;\n  &#125;\n&#125;\n</code></pre>\n\n<h2 id=\"猜测\"><a href=\"#猜测\" class=\"headerlink\" title=\"猜测\"></a>猜测</h2><p>在 src 代码一致的情况下，nest 相关版本使用最新的，可以断定 nest v8 有问题</p>\n<h2 id=\"公司电脑验证\"><a href=\"#公司电脑验证\" class=\"headerlink\" title=\"公司电脑验证\"></a>公司电脑验证</h2><p>启动的端口一直是修改前的端口，执行 项目中 <code>yarn prebuild</code> 会清理 dist 目录，清理完成后重启可以了</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;scripts&quot;: &#123;\n    &quot;prebuild&quot;: &quot;rimraf dist&quot;, &#x2F;&#x2F; 这个\n    &quot;build&quot;: &quot;nest build&quot;,\n    &quot;format&quot;: &quot;prettier --write \\&quot;src&#x2F;**&#x2F;*.ts\\&quot; \\&quot;test&#x2F;**&#x2F;*.ts\\&quot;&quot;,\n    &quot;start&quot;: &quot;nest start&quot;,\n    &quot;start:dev&quot;: &quot;nest start --watch&quot;,\n    &quot;start:debug&quot;: &quot;nest start --debug --watch&quot;,\n    &quot;start:prod&quot;: &quot;node dist&#x2F;main&quot;,\n    &quot;lint&quot;: &quot;eslint \\&quot;&#123;src,apps,libs,test&#125;&#x2F;**&#x2F;*.ts\\&quot; --fix&quot;,\n    &quot;test&quot;: &quot;jest&quot;,\n    &quot;test:watch&quot;: &quot;jest --watch&quot;,\n    &quot;test:cov&quot;: &quot;jest --coverage&quot;,\n    &quot;test:debug&quot;: &quot;node --inspect-brk -r tsconfig-paths&#x2F;register -r ts-node&#x2F;register node_modules&#x2F;.bin&#x2F;jest --runInBand&quot;,\n    &quot;test:e2e&quot;: &quot;jest --config .&#x2F;test&#x2F;jest-e2e.json&quot;\n  &#125;\n&#125;</code></pre>\n","text":"有问题的项目import &#123; NestFactory &#125; from &quot;@nestjs&#x2F;core&quot;; import &#123; NestExpressApplication &#125; from &quot;@nestjs&#x...","link":"","photos":[],"count_time":{"symbolsCount":"10k","symbolsTime":"9 mins."},"categories":[{"name":"nest","slug":"nest","count":1,"path":"api/categories/nest.json"}],"tags":[{"name":"nest","slug":"nest","count":1,"path":"api/tags/nest.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9C%89%E9%97%AE%E9%A2%98%E7%9A%84%E9%A1%B9%E7%9B%AE\"><span class=\"toc-text\">有问题的项目</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%B0%E6%9E%84%E5%BB%BA%E7%9A%84%E9%A1%B9%E7%9B%AE-413\"><span class=\"toc-text\">新构建的项目 413</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%B0%E6%9E%84%E5%BB%BA%E7%9A%84%E9%A1%B9%E7%9B%AE-200\"><span class=\"toc-text\">新构建的项目 200</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%B0%E6%9E%84%E5%BB%BA%E7%9A%84%E9%A1%B9%E7%9B%AE-%E4%BD%BF%E7%94%A8-NestExpressApplication\"><span class=\"toc-text\">新构建的项目 使用 NestExpressApplication</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9C%89%E9%97%AE%E9%A2%98%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">有问题项目配置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%8C%9C%E6%B5%8B\"><span class=\"toc-text\">猜测</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%85%AC%E5%8F%B8%E7%94%B5%E8%84%91%E9%AA%8C%E8%AF%81\"><span class=\"toc-text\">公司电脑验证</span></a></li></ol>","author":{"name":"陈哈喽","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"比你优秀的人，比你更努力！","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"vite react antd","uid":"f16e7439b5860073efd517d55c41d5e5","slug":"2022-09-07vite-react","date":"2022-09-07T08:44:51.000Z","updated":"2022-09-23T12:54:48.946Z","comments":true,"path":"api/articles/2022-09-07vite-react.json","keywords":null,"cover":[],"text":"技术选型方案 1: nextjs + sun (antd) 之前部门用的公司（前端基建二次封装）的这套组合，被现在的部门嫌弃 方案 2: @umijs&#x2F;max 试用了 umijs&#x2F;max MFSU, 在开发更新体验上还是觉得慢 方案 3: vite + rea...","link":"","photos":[],"count_time":{"symbolsCount":"15k","symbolsTime":"14 mins."},"categories":[{"name":"前端工程化","slug":"前端工程化","count":1,"path":"api/categories/前端工程化.json"}],"tags":[{"name":"vite","slug":"vite","count":1,"path":"api/tags/vite.json"}],"author":{"name":"陈哈喽","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"比你优秀的人，比你更努力！","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"React useImperativeHandle","uid":"89201434f3db3df07b7bcb0835c2df9a","slug":"2022-09-06useImperativeHandle","date":"2022-09-06T03:21:11.000Z","updated":"2022-09-18T14:01:09.918Z","comments":true,"path":"api/articles/2022-09-06useImperativeHandle.json","keywords":null,"cover":[],"text":"小插曲vscode 把 js 代码做做了 ts 校验 问题处理 useImperativeHandleuse Imperative Handle 使用命令句柄 useImperativeHandle(ref, createHandle, [deps]) useImperative...","link":"","photos":[],"count_time":{"symbolsCount":873,"symbolsTime":"1 mins."},"categories":[{"name":"React","slug":"React","count":19,"path":"api/categories/React.json"}],"tags":[{"name":"React","slug":"React","count":13,"path":"api/tags/React.json"}],"author":{"name":"陈哈喽","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"比你优秀的人，比你更努力！","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}