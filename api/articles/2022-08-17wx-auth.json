{"title":"ä¼ä¸šå¾®ä¿¡- æˆæƒ","uid":"d81dd412709b6fc04e7a6fd5be173494","slug":"2022-08-17wx-auth","date":"2022-08-17T08:02:43.000Z","updated":"2022-08-31T13:00:11.735Z","comments":true,"path":"api/articles/2022-08-17wx-auth.json","keywords":null,"cover":[],"content":"<h2 id=\"èƒŒæ™¯\"><a href=\"#èƒŒæ™¯\" class=\"headerlink\" title=\"èƒŒæ™¯\"></a>èƒŒæ™¯</h2><ul>\n<li>é¡¹ç›®ï¼šå·²ç»æœ‰ä¸€ä¸ªé¡¹ç›®äº†ï¼Œåˆæ•´ä¸€ä¸ªæ–°é¡¹ç›®å…±å­˜</li>\n<li>åŸŸåï¼šä¸€çº§ç›¸åŒï¼ŒäºŒçº§åŸŸåä¸åŒ</li>\n</ul>\n<p><strong>å¾®ä¿¡æˆæƒå›è°ƒé™åˆ¶, å›è°ƒå¯ä¿¡åŸŸååªèƒ½é…ç½®ä¸€ä¸ª</strong></p>\n<img src=\"http://t-blog-images.aijs.top/img/202208171607858.webp\" />\n\n<h2 id=\"å˜æ›´åçš„æˆæƒæµç¨‹\"><a href=\"#å˜æ›´åçš„æˆæƒæµç¨‹\" class=\"headerlink\" title=\"å˜æ›´åçš„æˆæƒæµç¨‹\"></a>å˜æ›´åçš„æˆæƒæµç¨‹</h2><img src=\"http://t-blog-images.aijs.top/img/202208171604440.webp\" />\n\n<p><a href=\"https://app.diagrams.net/?src=about#H841660202%2Fpic%2Fmain%2Ftask-report\" target=\"_blank\" >draw.io</a></p>\n<h2 id=\"å¢åŠ è°ƒè¯•-å¼ºåˆ¶å†…ç½‘\"><a href=\"#å¢åŠ è°ƒè¯•-å¼ºåˆ¶å†…ç½‘\" class=\"headerlink\" title=\"å¢åŠ è°ƒè¯• - å¼ºåˆ¶å†…ç½‘\"></a>å¢åŠ è°ƒè¯• - å¼ºåˆ¶å†…ç½‘</h2><p>å¼ºåˆ¶ æœ¬åœ°&#x2F;æ—¥å¸¸&#x2F;é¢„å‘ç¯å¢ƒ èµ°å†…ç½‘ï¼Œæ–¹ä¾¿åœ¨ä¼ä¸šå¾®ä¿¡è¿›è¡Œé€‚é…</p>\n<pre class=\"line-numbers language-ts\" data-language=\"ts\"><code class=\"language-ts\">&#x2F;&#x2F; Config ä¸ºnextjsï¼Œ è¿è¡Œæ—¶é…ç½®ä¿¡æ¯\n\n&#x2F;&#x2F; æ–¹ä¾¿ æ—¥å¸¸&#x2F;é¢„å‘ç¯å¢ƒ åˆ°ä¼ä¸šå¾®ä¿¡ä¸­è°ƒè¯•\nlet forceInNetwork &#x3D; true;\n\nif (isServer &amp;&amp; Config.env &#x3D;&#x3D;&#x3D; &quot;pro&quot;) &#123;\n  &#x2F;&#x2F; çº¿ä¸Šç¯å¢ƒ + æœåŠ¡ç«¯æ¸²æŸ“ï¼Œä¸å¼ºåˆ¶èµ°å†…ç½‘\n  forceInNetwork &#x3D; false;\n&#125; else if (!isServer &amp;&amp; window.__NEXT_DATA__.runtimeConfig.env &#x3D;&#x3D;&#x3D; &quot;pro&quot;) &#123;\n  &#x2F;&#x2F; çº¿ä¸Šç¯å¢ƒ + å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œä¸å¼ºåˆ¶èµ°å†…ç½‘\n  forceInNetwork &#x3D; false;\n&#125;\n\nif (\n  !forceInNetwork &amp;&amp; &#x2F;&#x2F; éå¼ºåˆ¶å†…ç½‘ + å¾®ä¿¡ç¯å¢ƒï¼Œè¯·æ±‚å¤´è®¾ç½® x-ty-auth-type\n  getWechatUserAgent(\n    isServer ? ctx.req.headers[&quot;user-agent&quot;] : navigator.userAgent\n  )\n) &#123;\n  options.headers[&quot;x-ty-auth-type&quot;] &#x3D; &quot;wx&quot;;\n&#125;\n\n&#x2F;&#x2F; ....\n\nlet apiUrl &#x3D; &quot;&quot;;\n&#x2F;&#x2F; éå¼ºåˆ¶å†…ç½‘ + æœåŠ¡ç«¯ + ä¼ä¸šå¾®ä¿¡ç¯å¢ƒï¼Œ èµ°ä¼ä¸šå¾®ä¿¡æˆæƒ\nif (\n  !forceInNetwork &amp;&amp;\n  isServer &amp;&amp;\n  getWechatUserAgent(options.headers[&quot;user-agent&quot;])\n) &#123;\n  apiUrl &#x3D; Config.wechatAuthProviderOrigin;\n&#125; else &#123;\n  apiUrl &#x3D; Config.api;\n&#125;</code></pre>\n\n<h2 id=\"å¢åŠ è°ƒè¯•-è®¾ç½®-cookie\"><a href=\"#å¢åŠ è°ƒè¯•-è®¾ç½®-cookie\" class=\"headerlink\" title=\"å¢åŠ è°ƒè¯• - è®¾ç½® cookie\"></a>å¢åŠ è°ƒè¯• - è®¾ç½® cookie</h2><pre class=\"line-numbers language-tsx\" data-language=\"tsx\"><code class=\"language-tsx\">import &#123; useRouter &#125; from &quot;@ty-fe&#x2F;next&#x2F;router&quot;;\nimport &#123; usePersistFn &#125; from &quot;ahooks&quot;;\nimport &#123; AutoCenter, Button, Card, Input, Space &#125; from &quot;antd-mobile&quot;;\nimport React, &#123; useState &#125; from &quot;react&quot;;\ninterface IProps &#123;&#125;\nconst SetCookie: React.FC&lt;IProps&gt; &#x3D; (props) &#x3D;&gt; &#123;\n  const router &#x3D; useRouter();\n  const [cookie, setCookie] &#x3D; useState(\n    &quot;ss_pweTnTjCiU_1bVtt6GNbd4UT2B7nK87S8xCXE3t0xuqMqDmlu7mH7PoBQ_HwwCYA616QM_9d_2yUsduiNyRrXrXQWZG1TtD7ZNNI1k3XMBx-wsYq59DKsv3Bh6nnZ9zkG-NCHsSdxbHZZ-2bCQIZ-oZ9eGiXEIo&quot;\n  );\n  const handleSetCookie &#x3D; usePersistFn(() &#x3D;&gt; &#123;\n    document.cookie &#x3D; &quot;SSO_USER_TOKEN&quot; + &quot;&#x3D;&quot; + cookie;\n  &#125;);\n  const handleChange &#x3D; usePersistFn((v) &#x3D;&gt; &#123;\n    setCookie(v);\n  &#125;);\n\n  const handleGoMbHome &#x3D; usePersistFn(() &#x3D;&gt; &#123;\n    router.push(&quot;&#x2F;my&#x2F;mobile?activeTab&#x3D;1&quot;);\n  &#125;);\n  return (\n    &lt;Card&gt;\n      &lt;p&gt;è®¾ç½®cookie&lt;&#x2F;p&gt;\n      &lt;Input\n        style&#x3D;&#123;&#123; border: &quot;1px solid #000&quot; &#125;&#125;\n        value&#x3D;&#123;cookie&#125;\n        placeholder&#x3D;&quot;è¾“å…¥cookie&quot;\n        onChange&#x3D;&#123;handleChange&#125;\n      &#x2F;&gt;\n      &lt;br&gt;&lt;&#x2F;br&gt;\n      &lt;Space&gt;\n        &lt;Button color&#x3D;&quot;primary&quot; fill&#x3D;&quot;solid&quot; onClick&#x3D;&#123;handleSetCookie&#125;&gt;\n          è®¾ç½®cookie\n        &lt;&#x2F;Button&gt;\n        &lt;Button color&#x3D;&quot;primary&quot; fill&#x3D;&quot;solid&quot; onClick&#x3D;&#123;handleGoMbHome&#125;&gt;\n          ç§»åŠ¨ç«¯é¦–é¡µ\n        &lt;&#x2F;Button&gt;\n      &lt;&#x2F;Space&gt;\n    &lt;&#x2F;Card&gt;\n  );\n&#125;;\n\nexport default SetCookie;</code></pre>\n\n<h2 id=\"æ³¨æ„äº‹é¡¹\"><a href=\"#æ³¨æ„äº‹é¡¹\" class=\"headerlink\" title=\"æ³¨æ„äº‹é¡¹\"></a>æ³¨æ„äº‹é¡¹</h2><h3 id=\"No-1\"><a href=\"#No-1\" class=\"headerlink\" title=\"No.1\"></a>No.1</h3><p>å¯¹äºæŸäº›éœ€è¦ä½¿ç”¨åˆ°å½“å‰ç”¨æˆ·æ•°æ®çš„é¡µé¢ï¼Œåœ¨ä½œä¸ºå…¥å£çš„æ—¶å€™éœ€è¦ç‰¹åˆ«æ³¨æ„</p>\n<p><span style=\"color: red\">ä¼šå‡ºç°æ‹¿ä¸åˆ°å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯çš„æƒ…å†µ</span></p>\n<p><strong>è¿‡ç¨‹å¦‚ä¸‹</strong></p>\n<ol>\n<li>å¼€å§‹æ˜¯æ²¡æœ‰æˆæƒçš„</li>\n<li>æˆæƒä¹‹åï¼Œé¡µé¢è¢«é‡å®šå‘å›åˆ°è¯¥é¡µé¢</li>\n<li>ç”±äºå·²åŠ è½½äº†ï¼Œæœ‰ç¼“å­˜ï¼ŒæœåŠ¡ç«¯ä¸ä¼šå†èµ°ä¸€éï¼Œåœ¨æœåŠ¡ç«¯å¾€<code>redux</code>å¡æ•°æ®çš„æ—¶å€™ï¼Œä¸ä¼šå†æ¬¡è§¦å‘</li>\n<li>å¦‚æœæœåŠ¡ç«¯æœ‰äº›æ¥å£è®¾è®¡çš„æ—¶å€™ä¸æ˜¯ä» cookie ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå‰ç«¯åœ¨ä¼ å½“å‰ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™ï¼Œå¾ˆæœ‰å¯èƒ½<code>redux</code>ä¸­æ²¡æœ‰è¯¥ç”¨æˆ·ä¿¡æ¯</li>\n</ol>\n<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š åœ¨ä¸€äº›å…¥å£é¡µé¢ï¼Œ<code>redux</code> å–ä¸åˆ°ç”¨æˆ·ä¿¡æ¯æ—¶å€™ï¼Œå®¢æˆ·ç«¯æ¸²æŸ“æ—¶å€™å†æ¬¡è·å–ç”¨æˆ·ä¿¡æ¯</p>\n<h3 id=\"No-2\"><a href=\"#No-2\" class=\"headerlink\" title=\"No.2\"></a>No.2</h3><p>éƒ¨åˆ†ä¼ä¸šå¾®ä¿¡ pc å®¢æˆ·ç«¯ä¸æ”¯æŒ<code>[].at()</code>æ–¹æ³•, é¿å…ä½¿ç”¨æ­¤ api çš„æ—¶å€™ï¼Œ polyfill æ˜¯è§£å†³ä¸äº†é—®é¢˜çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/at#%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5\" target=\"_blank\" >è§</a></p>\n<p><a href=\"https://github.com/zloirock/core-js/blob/b61f3c334f7a3010f376eae4fc465e68232da102/packages/core-js/modules/es.array.at.js#L11\" target=\"_blank\" >code</a></p>\n<img src=\"http://t-blog-images.aijs.top/img/202208250909849.webp\" />\n\n<p><a href=\"https://v.aijs.top/post/2022-07-14js-arr#:~:text=Copy-,at,-at()%20%E6%96%B9%E6%B3%95%E6%8E%A5%E6%94%B6\" target=\"_blank\" >2022-07-14js-arr</a></p>\n<p>ç»æµ‹è¯•å‘ç° polyfill æ— æ•ˆ, åº”è¯¥æ˜¯è¢«ä¼ä¸šå¾®ä¿¡é™åˆ¶äº†</p>\n<img src=\"http://t-blog-images.aijs.top/img/202208250920994.webp\" />\n\n<p>ä¼ä¸šå¾®ä¿¡é™åˆ¶äº†<code>Array</code>ï¼Œä¸ºä½•æœ‰çš„ä¼ä¸šå¾®ä¿¡å®¢æˆ·ç«¯å¯ä»¥ï¼Œæˆ‘çŒœæ˜¯ä¼ä¸šå¾®ä¿¡çš„ä¸€ä¸ª bug</p>\n<img src=\"http://t-blog-images.aijs.top/img/202208250949357.webp\" />\n\n<h3 id=\"No-3\"><a href=\"#No-3\" class=\"headerlink\" title=\"No.3\"></a>No.3</h3>","text":"èƒŒæ™¯ é¡¹ç›®ï¼šå·²ç»æœ‰ä¸€ä¸ªé¡¹ç›®äº†ï¼Œåˆæ•´ä¸€ä¸ªæ–°é¡¹ç›®å…±å­˜ åŸŸåï¼šä¸€çº§ç›¸åŒï¼ŒäºŒçº§åŸŸåä¸åŒ å¾®ä¿¡æˆæƒå›è°ƒé™åˆ¶, å›è°ƒå¯ä¿¡åŸŸååªèƒ½é…ç½®ä¸€ä¸ª å˜æ›´åçš„æˆæƒæµç¨‹ draw.io å¢åŠ è°ƒè¯• - å¼ºåˆ¶å†…ç½‘å¼ºåˆ¶ æœ¬åœ°&#x2F;æ—¥å¸¸&#x2F;é¢„å‘ç¯å¢ƒ èµ°å†…ç½‘ï¼Œæ–¹ä¾¿åœ¨ä¼ä¸šå¾®ä¿¡è¿›è¡Œé€‚é… &#x2F;&#x...","link":"","photos":[],"count_time":{"symbolsCount":"3.5k","symbolsTime":"3 mins."},"categories":[{"name":"ä¼ä¸šå¾®ä¿¡","slug":"ä¼ä¸šå¾®ä¿¡","count":5,"path":"api/categories/ä¼ä¸šå¾®ä¿¡.json"}],"tags":[{"name":"ä¼ä¸šå¾®ä¿¡","slug":"ä¼ä¸šå¾®ä¿¡","count":5,"path":"api/tags/ä¼ä¸šå¾®ä¿¡.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">èƒŒæ™¯</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%98%E6%9B%B4%E5%90%8E%E7%9A%84%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">å˜æ›´åçš„æˆæƒæµç¨‹</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A2%9E%E5%8A%A0%E8%B0%83%E8%AF%95-%E5%BC%BA%E5%88%B6%E5%86%85%E7%BD%91\"><span class=\"toc-text\">å¢åŠ è°ƒè¯• - å¼ºåˆ¶å†…ç½‘</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A2%9E%E5%8A%A0%E8%B0%83%E8%AF%95-%E8%AE%BE%E7%BD%AE-cookie\"><span class=\"toc-text\">å¢åŠ è°ƒè¯• - è®¾ç½® cookie</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9\"><span class=\"toc-text\">æ³¨æ„äº‹é¡¹</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#No-1\"><span class=\"toc-text\">No.1</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#No-2\"><span class=\"toc-text\">No.2</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#No-3\"><span class=\"toc-text\">No.3</span></a></li></ol></li></ol>","author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"å‰ç«¯åŸºç¡€-es6+","uid":"a1c8da0653d05a3bca517b77d6bf6809","slug":"2022-08-17es","date":"2022-08-17T14:46:14.000Z","updated":"2022-08-17T14:47:07.310Z","comments":true,"path":"api/articles/2022-08-17es.json","keywords":null,"cover":null,"text":"å‚è€ƒé“¾æ¥1.5ä¸‡å­—æ¦‚æ‹¬ES6å…¨éƒ¨ç‰¹æ€§(å·²æ›´æ–°ES2020) ","link":"","photos":[],"count_time":{"symbolsCount":30,"symbolsTime":"1 mins."},"categories":[{"name":"å‰ç«¯åŸºç¡€","slug":"å‰ç«¯åŸºç¡€","count":26,"path":"api/categories/å‰ç«¯åŸºç¡€.json"}],"tags":[{"name":"å‰ç«¯åŸºç¡€","slug":"å‰ç«¯åŸºç¡€","count":28,"path":"api/tags/å‰ç«¯åŸºç¡€.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"å¤‡ä»½æ’ä»¶æ’æŸ¥code helper","uid":"0c749d9dc89621b4e02fc2ff0a775bfc","slug":"2022-08-11vscode-plugins","date":"2022-08-11T01:31:40.000Z","updated":"2022-08-31T13:00:11.734Z","comments":true,"path":"api/articles/2022-08-11vscode-plugins.json","keywords":null,"cover":[],"text":"codegen_anything codegen_mock codegen_sinipets CSS Module Typed CSS Modules Color Highlight ES7+ React&#x2F;Redux&#x2F;React-Native snippets...","link":"","photos":[],"count_time":{"symbolsCount":797,"symbolsTime":"1 mins."},"categories":[{"name":"vscode","slug":"vscode","count":2,"path":"api/categories/vscode.json"}],"tags":[{"name":"vscode","slug":"vscode","count":6,"path":"api/tags/vscode.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}