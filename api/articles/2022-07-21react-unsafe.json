{"title":"React@16.5.0 unsafe_","uid":"f07658ed4d8d481756bfa8b0d656b104","slug":"2022-07-21react-unsafe","date":"2022-07-21T06:23:16.000Z","updated":"2022-07-23T09:24:23.110Z","comments":true,"path":"api/articles/2022-07-21react-unsafe.json","keywords":null,"cover":null,"content":"<h2 id=\"æˆ‘æ•´ç†è¿™ç¯‡æ–‡ç« çš„ç›®çš„\"><a href=\"#æˆ‘æ•´ç†è¿™ç¯‡æ–‡ç« çš„ç›®çš„\" class=\"headerlink\" title=\"æˆ‘æ•´ç†è¿™ç¯‡æ–‡ç« çš„ç›®çš„\"></a>æˆ‘æ•´ç†è¿™ç¯‡æ–‡ç« çš„ç›®çš„</h2><p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘åœ¨å­¦æŠ€æœ¯æ—¶å€™æ›´å¤šå…³æ³¨çš„æ˜¯<code>æ•™ç¨‹</code>å’Œ<code>æ–‡æ¡£</code>,åŸå› æœ‰ä¸‰ï¼šæ—¶é—´ç´§ã€ä»»åŠ¡é‡ã€æ–°æŠ€æœ¯å¾ˆå¤š</p>\n<p>æœ€è¿‘æ‰‹å¤´æ— äº‹ï¼Œåˆšå¥½æœæºç æœåˆ°äº†ï¼Œå¸Œæœ›é—²æš‡ä¹‹ä½™ï¼Œä½ ä¹Ÿèƒ½äº†è§£ React å˜æ›´è¿‡ç¨‹ï¼ŒåŠ æ·± React çš„ç†è§£</p>\n<h2 id=\"è¿‡æ—¶çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå¾€å¾€ä¼šå¸¦æ¥ä¸å®‰å…¨çš„ç¼–ç å®è·µ\"><a href=\"#è¿‡æ—¶çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå¾€å¾€ä¼šå¸¦æ¥ä¸å®‰å…¨çš„ç¼–ç å®è·µ\" class=\"headerlink\" title=\"è¿‡æ—¶çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå¾€å¾€ä¼šå¸¦æ¥ä¸å®‰å…¨çš„ç¼–ç å®è·µ\"></a>è¿‡æ—¶çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå¾€å¾€ä¼šå¸¦æ¥ä¸å®‰å…¨çš„ç¼–ç å®è·µ</h2><ul>\n<li>componentWillMount</li>\n<li>componentWillReceiveProps</li>\n<li>componentWillUpdate</li>\n</ul>\n<p>è¿™äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç»å¸¸è¢«<code>è¯¯è§£å’Œæ»¥ç”¨</code>ï¼›æ­¤å¤–ï¼ŒReact å›¢é˜Ÿé¢„è®¡åˆ°ï¼Œåœ¨å¼‚æ­¥æ¸²æŸ“ä¸­ï¼Œå®ƒä»¬æ½œåœ¨çš„<code>è¯¯ç”¨é—®é¢˜å¯èƒ½æ›´å¤§</code>ã€‚æ‰€ä»¥åœ¨ March 27, 2018 æå‡º</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>æˆ‘ä»¬å°†åœ¨å³å°†å‘å¸ƒçš„ç‰ˆæœ¬ä¸­ä¸ºè¿™äº›ç”Ÿå‘½å‘¨æœŸæ·»åŠ  <code>UNSAFE_</code> å‰ç¼€ã€‚ï¼ˆè¿™é‡Œçš„ â€œunsafeâ€ <code>ä¸æ˜¯æŒ‡å®‰å…¨æ€§</code>ï¼Œ<code>è€Œæ˜¯è¡¨ç¤ºä½¿ç”¨è¿™äº›ç”Ÿå‘½å‘¨æœŸçš„ä»£ç åœ¨ React çš„æœªæ¥ç‰ˆæœ¬ä¸­æ›´æœ‰å¯èƒ½å‡ºç° bug</code>ï¼Œ<code>å°¤å…¶æ˜¯åœ¨å¯ç”¨å¼‚æ­¥æ¸²æŸ“ä¹‹å</code>ã€‚ï¼‰</p></blockquote>\n<h2 id=\"éµå¾ªè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶\"><a href=\"#éµå¾ªè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶\" class=\"headerlink\" title=\"éµå¾ªè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶\"></a>éµå¾ªè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶</h2><p>React <a href=\"https://semver.org/lang/zh-CN/\" target=\"_blank\" >éµå¾ªè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶</a>ï¼Œå› æ­¤è¿™ç§å˜åŒ–å°†æ˜¯é€æ­¥çš„ã€‚æˆ‘ä»¬ç›®å‰çš„è®¡åˆ’æ˜¯ï¼š</p>\n<ul>\n<li>16.3ï¼šä¸ºä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸå¼•å…¥åˆ«åï¼Œ<code>UNSAFE_componentWillMount``ã€UNSAFE_componentWillReceiveProps</code> å’Œ <code>UNSAFE_componentWillUpdate</code>ã€‚ï¼ˆæ—§çš„ç”Ÿå‘½å‘¨æœŸåç§°å’Œæ–°çš„åˆ«åéƒ½å¯ä»¥åœ¨æ­¤ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚ï¼‰<br>æœªæ¥</li>\n<li>16.x ç‰ˆæœ¬ï¼šä¸º <code>componentWillMount``ã€componentWillReceiveProps</code> å’Œ <code>componentWillUpdate</code> å¯ç”¨åºŸå¼ƒå‘Šè­¦ã€‚ï¼ˆæ—§çš„ç”Ÿå‘½å‘¨æœŸåç§°å’Œæ–°çš„åˆ«åéƒ½å°†åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­å·¥ä½œï¼Œä½†æ˜¯æ—§çš„åç§°åœ¨å¼€å‘æ¨¡å¼ä¸‹ä¼šäº§ç”Ÿä¸€ä¸ªè­¦å‘Šã€‚ï¼‰</li>\n<li>17.0ï¼šåˆ é™¤ <code>componentWillMount</code>ã€<code>componentWillReceiveProps</code> å’Œ <code>componentWillUpdate</code>ã€‚ï¼ˆåœ¨æ­¤ç‰ˆæœ¬ä¹‹åï¼Œåªæœ‰æ–°çš„ â€œUNSAFE_â€ ç”Ÿå‘½å‘¨æœŸåç§°å¯ä»¥ä½¿ç”¨ã€‚ï¼‰</li>\n</ul>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>æ³¨æ„ï¼Œå¦‚æœä½ æ˜¯ React åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ï¼Œåˆ™æ— éœ€å¯¹è¿™äº›è¿‡æ—¶çš„æ–¹æ³•æ‰§è¡Œä»»ä½•æ“ä½œã€‚å³å°†å‘å¸ƒçš„ 16.3 ç‰ˆæœ¬çš„ä¸»è¦ç›®çš„æ˜¯ä½¿å¼€æºé¡¹ç›®ç»´æŠ¤äººå‘˜èƒ½å¤Ÿåœ¨ä»»ä½•åºŸå¼ƒè­¦å‘Šä¹‹å‰æ›´æ–°ä»–ä»¬çš„åº“ã€‚åœ¨æœªæ¥çš„ 16.x ç‰ˆæœ¬å‘å¸ƒä¹‹å‰ï¼Œä¸ä¼šå¯ç”¨è¿™äº›è­¦å‘Šã€‚</p>\n</div>\n<h2 id=\"è¿ç§»è¿‡æ—¶çš„ç”Ÿå‘½å‘¨æœŸ\"><a href=\"#è¿ç§»è¿‡æ—¶çš„ç”Ÿå‘½å‘¨æœŸ\" class=\"headerlink\" title=\"è¿ç§»è¿‡æ—¶çš„ç”Ÿå‘½å‘¨æœŸ\"></a>è¿ç§»è¿‡æ—¶çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œä¸‹é¢æ˜¯å…³äº 16.3 ç‰ˆæœ¬è®¡åˆ’çš„ç”Ÿå‘½å‘¨æœŸå˜æ›´çš„å¿«é€Ÿæ¦‚è¿°ï¼š</p>\n<ul>\n<li>æ·»åŠ ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸåˆ«åï¼š<code>UNSAFE_componentWillMount</code>ã€<code>UNSAFE_componentWillReceiveProps</code> å’Œ <code>UNSAFE_componentWillUpdate</code>ã€‚ï¼ˆå°†åŒæ—¶æ”¯æŒæ—§çš„ç”Ÿå‘½å‘¨æœŸåç§°å’Œæ–°åˆ«åã€‚ï¼‰</li>\n<li>å¼•å…¥ä¸¤ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸï¼Œé™æ€çš„ <code>getDerivedStateFromProps</code> å’Œ <code>getSnapshotBeforeUpdate</code>ã€‚</li>\n</ul>\n<h2 id=\"getDerivedStateFromProps\"><a href=\"#getDerivedStateFromProps\" class=\"headerlink\" title=\"getDerivedStateFromProps\"></a>getDerivedStateFromProps</h2><pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">class Example extends React.Component &#123;\n  static getDerivedStateFromProps(props, state) &#123;\n    &#x2F;&#x2F; ...\n  &#125;\n&#125;</code></pre>\n\n<p>æ–°çš„é™æ€ <code>getDerivedStateFromProps</code> ç”Ÿå‘½å‘¨æœŸæ–¹æ³•<code>åœ¨ç»„ä»¶å®ä¾‹åŒ–ä¹‹åä»¥åŠé‡æ–°æ¸²æŸ“ä¹‹å‰è°ƒç”¨</code>ã€‚å®ƒå¯ä»¥è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–° stateï¼Œæˆ–è€…<code>è¿”å› null æ¥è¡¨ç¤ºæ–°çš„ props ä¸éœ€è¦ä»»ä½• state çš„æ›´æ–°</code>ã€‚</p>\n<p>ä¸ <code>componentDidUpdate</code> ä¸€èµ·ï¼Œè¿™ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸæ¶µç›–è¿‡æ—¶çš„ <code>componentWillReceiveProps</code> çš„æ‰€æœ‰ç”¨ä¾‹ã€‚</p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>æ³¨æ„ï¼š</p>\n<p>æ—§çš„ componentWillReceiveProps å’Œæ–°çš„ getDerivedStateFromProps æ–¹æ³•éƒ½ä¼šå¢åŠ ç»„ä»¶çš„å¤æ‚æ€§ã€‚è¿™ç»å¸¸ä¼šå¯¼è‡´ bugã€‚è€ƒè™‘ä½¿ç”¨ <a href=\"https://zh-hans.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html\" target=\"_blank\" >æ´¾ç”Ÿ state çš„ç®€å•æ›¿ä»£æ–¹æ³•</a> è®©ç»„ä»¶å¯é¢„æµ‹ä¸”å¯ç»´æŠ¤ã€‚</p>\n</div>\n<h2 id=\"getSnapshotBeforeUpdate\"><a href=\"#getSnapshotBeforeUpdate\" class=\"headerlink\" title=\"getSnapshotBeforeUpdate\"></a>getSnapshotBeforeUpdate</h2><pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">class Example extends React.Component &#123;\n  getSnapshotBeforeUpdate(prevProps, prevState) &#123;\n    &#x2F;&#x2F; ...\n  &#125;\n&#125;</code></pre>\n\n<p>æ–°çš„ <code>getSnapshotBeforeUpdate</code> ç”Ÿå‘½å‘¨æœŸæ–¹æ³•<code>åœ¨æ›´æ–°ä¹‹å‰ï¼ˆå¦‚ï¼šæ›´æ–° DOM ä¹‹å‰ï¼‰è¢«è°ƒç”¨</code>ã€‚<strong>æ­¤ç”Ÿå‘½å‘¨æœŸçš„è¿”å›å€¼å°†ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™ componentDidUpdate</strong>ã€‚ï¼ˆé€šå¸¸ä¸éœ€è¦ï¼Œä½†åœ¨é‡æ–°æ¸²æŸ“è¿‡ç¨‹ä¸­æ‰‹åŠ¨ä¿ç•™æ»šåŠ¨ä½ç½®ç­‰æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚ï¼‰</p>\n<p>ä¸ <code>componentDidUpdate</code> ä¸€èµ·ï¼Œè¿™ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸæ¶µç›–è¿‡æ—¶çš„ <code>componentWillUpdate</code> çš„æ‰€æœ‰ç”¨ä¾‹ã€‚</p>\n<h2 id=\"ç¤ºä¾‹\"><a href=\"#ç¤ºä¾‹\" class=\"headerlink\" title=\"ç¤ºä¾‹\"></a>ç¤ºä¾‹</h2><h3 id=\"åˆå§‹åŒ–-state\"><a href=\"#åˆå§‹åŒ–-state\" class=\"headerlink\" title=\"åˆå§‹åŒ– state\"></a>åˆå§‹åŒ– state</h3><p>è¿™ä¸ªä¾‹å­æ˜¾ç¤ºäº†ç»„ä»¶åœ¨ componentWillMount ä¸­è°ƒç”¨ setStateï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; Before\nclass ExampleComponent extends React.Component &#123;\n  state &#x3D; &#123;&#125;;\n\n  componentWillMount() &#123;\n    this.setState(&#123;\n      currentColor: this.props.defaultColor,\n      palette: &quot;rgb&quot;,\n    &#125;);\n  &#125;\n&#125;</code></pre>\n\n<p>å¯¹äºè¿™ç§ç±»å‹çš„ç»„ä»¶ï¼Œæœ€ç®€å•çš„é‡æ„æ˜¯å°† state çš„åˆå§‹åŒ–ï¼Œç§»åˆ°æ„é€ å‡½æ•°æˆ–å±æ€§çš„åˆå§‹åŒ–å™¨å†…ï¼Œ</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; After\nclass ExampleComponent extends React.Component &#123;\n  state &#x3D; &#123;\n    currentColor: this.props.defaultColor,\n    palette: &quot;rgb&quot;,\n  &#125;;\n&#125;</code></pre>\n\n<h3 id=\"è·å–å¤–éƒ¨æ•°æ®\"><a href=\"#è·å–å¤–éƒ¨æ•°æ®\" class=\"headerlink\" title=\"è·å–å¤–éƒ¨æ•°æ®\"></a>è·å–å¤–éƒ¨æ•°æ®</h3><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ componentWillMount è·å–å¤–éƒ¨æ•°æ®çš„ç»„ä»¶çš„ç¤ºä¾‹ï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; Before\nclass ExampleComponent extends React.Component &#123;\n  state &#x3D; &#123;\n    externalData: null,\n  &#125;;\n\n  componentWillMount() &#123;\n    this._asyncRequest &#x3D; loadMyAsyncData().then((externalData) &#x3D;&gt; &#123;\n      this._asyncRequest &#x3D; null;\n      this.setState(&#123; externalData &#125;);\n    &#125;);\n  &#125;\n\n  componentWillUnmount() &#123;\n    if (this._asyncRequest) &#123;\n      this._asyncRequest.cancel();\n    &#125;\n  &#125;\n\n  render() &#123;\n    if (this.state.externalData &#x3D;&#x3D;&#x3D; null) &#123;\n      &#x2F;&#x2F; æ¸²æŸ“åŠ è½½çŠ¶æ€ ...\n    &#125; else &#123;\n      &#x2F;&#x2F; æ¸²æŸ“çœŸå® UI ...\n    &#125;\n  &#125;\n&#125;</code></pre>\n\n<p>ä¸Šè¿°ä»£ç å¯¹äºæœåŠ¡å™¨æ¸²æŸ“ï¼ˆä¸ä½¿ç”¨å¤–éƒ¨æ•°æ®ï¼‰å’Œå³å°†æ¨å‡ºçš„å¼‚æ­¥æ¸²æŸ“æ¨¡å¼ï¼ˆå¯èƒ½å¤šæ¬¡å¯åŠ¨è¯·æ±‚ï¼‰éƒ½å­˜åœ¨é—®é¢˜ã€‚</p>\n<p>å¤§å¤šæ•°ç”¨ä¾‹æ¨èçš„å‡çº§æ–¹å¼æ˜¯å°†æ•°æ®è·å–ç§»åˆ° componentDidMountï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; After\nclass ExampleComponent extends React.Component &#123;\n  state &#x3D; &#123;\n    externalData: null,\n  &#125;;\n\n  componentDidMount() &#123;\n    this._asyncRequest &#x3D; loadMyAsyncData().then((externalData) &#x3D;&gt; &#123;\n      this._asyncRequest &#x3D; null;\n      this.setState(&#123; externalData &#125;);\n    &#125;);\n  &#125;\n\n  componentWillUnmount() &#123;\n    if (this._asyncRequest) &#123;\n      this._asyncRequest.cancel();\n    &#125;\n  &#125;\n\n  render() &#123;\n    if (this.state.externalData &#x3D;&#x3D;&#x3D; null) &#123;\n      &#x2F;&#x2F; æ¸²æŸ“åŠ è½½çŠ¶æ€ ...\n    &#125; else &#123;\n      &#x2F;&#x2F; æ¸²æŸ“çœŸå® UI ...\n    &#125;\n  &#125;\n&#125;</code></pre>\n\n<h3 id=\"è¯¯è§£-1\"><a href=\"#è¯¯è§£-1\" class=\"headerlink\" title=\"è¯¯è§£ 1\"></a>è¯¯è§£ 1</h3><p>æœ‰ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯ï¼Œåœ¨ <code>componentWillMount</code> ä¸­è·å–æ•°æ®å¯ä»¥é¿å…ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸ºç©ºçš„çŠ¶æ€ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯ä¸å¯¹çš„ï¼Œå› ä¸º React æ€»æ˜¯åœ¨ <code>componentWillMount</code> ä¹‹åç«‹å³æ‰§è¡Œ <code>render</code>ã€‚å¦‚æœåœ¨ <code>componentWillMount</code> è§¦å‘æ—¶æ•°æ®ä¸å¯ç”¨ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡ <code>render</code> ä»ç„¶ä¼šæ˜¾ç¤ºåŠ è½½çš„çŠ¶æ€ï¼Œè€Œä¸ç®¡ä½ åœ¨å“ªé‡Œåˆå§‹åŒ–è·å–æ•°æ®ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå°†è·å–æ•°æ®ç§»åˆ° <code>componentDidMount</code> æ²¡æœ‰æ˜æ˜¾æ•ˆæœçš„åŸå› ã€‚</p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>æ³¨æ„</p>\n<p>ä¸€äº›é«˜çº§ç”¨ä¾‹ï¼ˆå¦‚ï¼š<code>Relay</code> åº“ï¼‰å¯èƒ½å°è¯•æå‰è·å–å¼‚æ­¥æ•°æ®ã€‚è¿™é‡Œæä¾›äº†ä¸€ä¸ªå¦‚ä½•å®ç°çš„ç¤ºä¾‹ã€‚</p>\n<p>ä»é•¿è¿œæ¥çœ‹ï¼Œåœ¨ React ç»„ä»¶ä¸­è·å–æ•°æ®çš„æ ‡å‡†æ–¹æ³•åº”è¯¥åŸºäº â€œ<code>suspense</code>â€ API åœ¨å†°å²› JSConf æå‡ºã€‚æ— è®ºæ˜¯ç®€å•çš„æ•°æ®è·å–è§£å†³æ–¹æ¡ˆï¼Œè¿˜æ˜¯åƒ <code>Apollo</code> å’Œ <code>Relay</code> è¿™æ ·çš„åº“ï¼Œéƒ½å¯ä»¥åœ¨å†…éƒ¨ä½¿ç”¨å®ƒã€‚å®ƒæ¯”ä¸Šé¢çš„ä»»ä½•ä¸€ä¸ªè§£å†³æ–¹æ¡ˆéƒ½è¦ç®€æ´ï¼Œä½†æ˜¯ä¸ä¼šåœ¨ 16.3 ç‰ˆæœ¬å‘å¸ƒä¹‹å‰å®Œæˆã€‚</p>\n<p>å½“æ”¯æŒæœåŠ¡å™¨æ¸²æŸ“æ—¶ï¼Œéœ€è¦åŒæ­¥è·å–æ•°æ®â€”â€”<code>componentWillMount</code> ç»å¸¸ç”¨äºæ­¤ç›®çš„ï¼Œä¹Ÿå¯ä»¥ç”¨æ„é€ å‡½æ•°æ›¿ä»£ã€‚å³å°†æ¨å‡ºçš„ suspense API å°†ä½¿å¼‚æ­¥æ•°æ®è·å–å¯¹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¸²æŸ“éƒ½æ˜¯å®Œå…¨æœ‰å¯èƒ½çš„ã€‚</p>\n\n</div>\n<h3 id=\"æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼ˆæˆ–è®¢é˜…ï¼‰\"><a href=\"#æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼ˆæˆ–è®¢é˜…ï¼‰\" class=\"headerlink\" title=\"æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼ˆæˆ–è®¢é˜…ï¼‰\"></a>æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼ˆæˆ–è®¢é˜…ï¼‰</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œåœ¨ç»„ä»¶æŒ‚è½½æ—¶è®¢é˜…äº†å¤–éƒ¨äº‹ä»¶ï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; Before\nclass ExampleComponent extends React.Component &#123;\n  componentWillMount() &#123;\n    this.setState(&#123;\n      subscribedValue: this.props.dataSource.value,\n    &#125;);\n    &#x2F;&#x2F; è¿™æ˜¯ä¸å®‰å…¨çš„ï¼Œå®ƒä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼\n    this.props.dataSource.subscribe(this.handleSubscriptionChange);\n  &#125;\n\n  componentWillUnmount() &#123;\n    this.props.dataSource.unsubscribe(this.handleSubscriptionChange);\n  &#125;\n\n  handleSubscriptionChange &#x3D; (dataSource) &#x3D;&gt; &#123;\n    this.setState(&#123;\n      subscribedValue: dataSource.value,\n    &#125;);\n  &#125;;\n&#125;</code></pre>\n\n<p>é—æ†¾çš„æ˜¯ï¼Œè¿™å¯èƒ½å¯¼è‡´æœåŠ¡å™¨æ¸²æŸ“ï¼ˆæ°¸è¿œä¸ä¼šè°ƒç”¨ <code>componentWillUnmount</code>ï¼‰å’Œå¼‚æ­¥æ¸²æŸ“ï¼ˆåœ¨æ¸²æŸ“å®Œæˆä¹‹å‰å¯èƒ½è¢«ä¸­æ–­ï¼Œå¯¼è‡´ä¸è°ƒç”¨ <code>componentWillUnmount</code>ï¼‰çš„<code>å†…å­˜æ³„æ¼</code>ã€‚</p>\n<h3 id=\"è¯¯è§£-2\"><a href=\"#è¯¯è§£-2\" class=\"headerlink\" title=\"è¯¯è§£ 2\"></a>è¯¯è§£ 2</h3><p>äººä»¬é€šå¸¸è®¤ä¸º <code>componentWillMount</code> å’Œ <code>componentWillUnmount</code> æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œä½†è¿™å¹¶ä¸èƒ½ä¿è¯ã€‚åªæœ‰è°ƒç”¨äº† <code>componentDidMount</code> ä¹‹åï¼ŒReact æ‰èƒ½ä¿è¯ç¨åè°ƒç”¨ <code>componentWillUnmount</code> è¿›è¡Œæ¸…ç†ã€‚</p>\n<p>å› æ­¤ï¼Œæ·»åŠ ç›‘å¬å™¨&#x2F;è®¢é˜…çš„æ¨èæ–¹æ³•æ˜¯ä½¿ç”¨ <code>componentDidMount</code> ç”Ÿå‘½å‘¨æœŸï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; After\nclass ExampleComponent extends React.Component &#123;\n  state &#x3D; &#123;\n    subscribedValue: this.props.dataSource.value,\n  &#125;;\n  componentDidMount() &#123;\n    &#x2F;&#x2F; äº‹ä»¶ç›‘å¬å™¨åªæœ‰åœ¨æŒ‚è½½åæ·»åŠ æ‰æ˜¯å®‰å…¨çš„ï¼Œ\n    &#x2F;&#x2F; å› æ­¤ï¼Œå¦‚æœæŒ‚è½½ä¸­æ–­æˆ–é”™è¯¯ï¼Œå®ƒä»¬ä¸ä¼šæ³„æ¼ã€‚\n    this.props.dataSource.subscribe(this.handleSubscriptionChange);\n    &#x2F;&#x2F; å¤–éƒ¨å€¼å¯èƒ½åœ¨æ¸²æŸ“å’ŒæŒ‚è½½æœŸé—´æ”¹å˜ï¼Œ\n    &#x2F;&#x2F; åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¤„ç†è¿™ç§æƒ…å†µå¾ˆé‡è¦ã€‚\n    if (this.state.subscribedValue !&#x3D;&#x3D; this.props.dataSource.value) &#123;\n      this.setState(&#123;\n        subscribedValue: this.props.dataSource.value,\n      &#125;);\n    &#125;\n  &#125;\n\n  componentWillUnmount() &#123;\n    this.props.dataSource.unsubscribe(this.handleSubscriptionChange);\n  &#125;\n\n  handleSubscriptionChange &#x3D; (dataSource) &#x3D;&gt; &#123;\n    this.setState(&#123;\n      subscribedValue: dataSource.value,\n    &#125;);\n  &#125;;\n&#125;</code></pre>\n\n<p>æœ‰æ—¶ï¼Œæ›´æ–°è®¢é˜…æ¥å“åº”å±æ€§å˜æ›´éå¸¸é‡è¦ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨åƒ <code>Redux</code> æˆ– <code>MobX</code> è¿™æ ·çš„åº“ï¼Œ<code>åº“çš„å®¹å™¨ç»„ä»¶åº”è¯¥ä¸ºä½ å¤„ç†äº†è¿™ä¸ªé—®é¢˜</code>ã€‚å¯¹äºåº”ç”¨ç¨‹åºä½œè€…ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå°å‹åº“ï¼Œ<code>create-subscription</code>ï¼Œæ¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å°†å®ƒä¸ React 16.3 ä¸€èµ·å‘å¸ƒã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>create-subscription</code> æ¥ä¼ é€’è®¢é˜…çš„å€¼ï¼Œè€Œä¸æ˜¯åƒä¸Šé¢ç¤ºä¾‹é‚£æ ·ä¼ é€’ä¸€ä¸ªå¯è®¢é˜…çš„ dataSource propï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">import &#123; createSubscription &#125; from &quot;create-subscription&quot;;\n\nconst Subscription &#x3D; createSubscription(&#123;\n  getCurrentValue(sourceProp) &#123;\n    &#x2F;&#x2F; è¿”å›è®¢é˜…çš„å½“å‰å€¼ï¼ˆsourcePropï¼‰ã€‚\n    return sourceProp.value;\n  &#125;,\n\n  subscribe(sourceProp, callback) &#123;\n    function handleSubscriptionChange() &#123;\n      callback(sourceProp.value);\n    &#125;\n\n    &#x2F;&#x2F; è®¢é˜…ï¼ˆä¾‹å¦‚ï¼šå‘è®¢é˜…ï¼ˆsourcePropï¼‰æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ã€‚\n    &#x2F;&#x2F; æ¯å½“è®¢é˜…å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè°ƒç”¨å›è°ƒå‡½æ•°ï¼ˆæ–°å€¼ï¼‰ã€‚\n    sourceProp.subscribe(handleSubscriptionChange);\n\n    &#x2F;&#x2F; è¿”å›å–æ¶ˆè®¢é˜…æ–¹æ³•ã€‚\n    return function unsubscribe() &#123;\n      sourceProp.unsubscribe(handleSubscriptionChange);\n    &#125;;\n  &#125;,\n&#125;);\n\n&#x2F;&#x2F; æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼ é€’è®¢é˜…çš„å€¼ï¼Œ\n&#x2F;&#x2F; è€Œä¸æ˜¯å°†å¯è®¢é˜…çš„æºä¼ é€’ç»™æˆ‘ä»¬çš„ ExampleComponentï¼š\n&lt;Subscription source&#x3D;&#123;dataSource&#125;&gt;\n  &#123;(value) &#x3D;&gt; &lt;ExampleComponent subscribedValue&#x3D;&#123;value&#125; &#x2F;&gt;&#125;\n&lt;&#x2F;Subscription&gt;;</code></pre>\n\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>æ³¨æ„ï¼š</p>\n<p>åƒ <code>Relay/Apollo</code> è¿™æ ·çš„åº“ï¼Œå†…éƒ¨åº”è¯¥ä½¿ç”¨äº†ä¸ <code>create-subscription</code> ç›¸åŒçš„æŠ€æœ¯ï¼Œç”¨æœ€é€‚åˆä»–ä»¬åº“ä½¿ç”¨çš„æ–¹å¼æ‰‹åŠ¨ç®¡ç†è®¢é˜…ï¼ˆå‚è€ƒè¿™é‡Œï¼‰ã€‚</p>\n</div>\n<h3 id=\"åŸºäº-props-æ›´æ–°-state\"><a href=\"#åŸºäº-props-æ›´æ–°-state\" class=\"headerlink\" title=\"åŸºäº props æ›´æ–° state\"></a>åŸºäº props æ›´æ–° state</h3><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>æ³¨æ„ï¼š</p>\n<p>æ—§çš„ <code>componentWillReceiveProps</code> å’Œæ–°çš„ <code>getDerivedStateFromProps</code> æ–¹æ³•éƒ½ä¼šç»™ç»„ä»¶å¢åŠ æ˜æ˜¾çš„å¤æ‚æ€§ã€‚è¿™é€šå¸¸ä¼šå¯¼è‡´ <code>bug</code>ã€‚è€ƒè™‘ æ´¾ç”Ÿ state çš„ç®€å•æ›¿ä»£æ–¹æ³• ä½¿ç»„ä»¶å¯é¢„æµ‹ä¸”å¯ç»´æŠ¤ã€‚\n</div>\n<p>è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œç»„ä»¶ä½¿ç”¨è¿‡æ—¶çš„ <code>componentWillReceiveProps</code> ç”Ÿå‘½å‘¨æœŸåŸºäºæ–°çš„ <code>props</code> æ›´æ–° <code>state</code>ï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; Before\nclass ExampleComponent extends React.Component &#123;\n  state &#x3D; &#123;\n    isScrollingDown: false,\n  &#125;;\n\n  componentWillReceiveProps(nextProps) &#123;\n    if (this.props.currentRow !&#x3D;&#x3D; nextProps.currentRow) &#123;\n      this.setState(&#123;\n        isScrollingDown: nextProps.currentRow &gt; this.props.currentRow,\n      &#125;);\n    &#125;\n  &#125;\n&#125;</code></pre>\n\n<p>å°½ç®¡ä¸Šé¢çš„ä»£ç æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ <code>componentWillReceiveProps</code> ç”Ÿå‘½å‘¨æœŸç»å¸¸è¢«è¯¯ç”¨ï¼Œä¼šäº§ç”Ÿé—®é¢˜ã€‚å› æ­¤ï¼Œè¯¥æ–¹æ³•å°†è¢«åºŸå¼ƒã€‚</p>\n<p>ä» 16.3 ç‰ˆæœ¬å¼€å§‹ï¼Œå½“ <code>props</code> å˜åŒ–æ—¶ï¼Œå»ºè®®ä½¿ç”¨æ–°çš„ <code>static getDerivedStateFromProps</code> ç”Ÿå‘½å‘¨æœŸæ›´æ–° <code>state</code>ã€‚åˆ›å»ºç»„ä»¶ä»¥åŠæ¯æ¬¡ç»„ä»¶ç”±äº <code>props</code> æˆ– <code>state</code> çš„æ”¹å˜è€Œé‡æ–°æ¸²æŸ“æ—¶éƒ½ä¼šè°ƒç”¨è¯¥ç”Ÿå‘½å‘¨æœŸï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; After\nclass ExampleComponent extends React.Component &#123;\n  &#x2F;&#x2F; åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ– stateï¼Œ\n  &#x2F;&#x2F; æˆ–è€…ä½¿ç”¨å±æ€§åˆå§‹åŒ–å™¨ã€‚\n  state &#x3D; &#123;\n    isScrollingDown: false,\n    lastRow: null,\n  &#125;;\n\n  static getDerivedStateFromProps(props, state) &#123;\n    if (props.currentRow !&#x3D;&#x3D; state.lastRow) &#123;\n      return &#123;\n        isScrollingDown: props.currentRow &gt; state.lastRow,\n        lastRow: props.currentRow,\n      &#125;;\n    &#125;\n\n    &#x2F;&#x2F; è¿”å› null è¡¨ç¤ºæ— éœ€æ›´æ–° stateã€‚\n    return null;\n  &#125;\n&#125;</code></pre>\n\n<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ° <code>props.currentRow</code> åœ¨ state ä¸­çš„é•œåƒï¼ˆ<code>state.lastRow</code>ï¼‰ã€‚è¿™ä½¿å¾— <code>getDerivedStateFromProps</code> èƒ½å¤Ÿåƒåœ¨ <code>componentWillReceiveProps</code> ä¸­ç›¸åŒçš„æ–¹å¼è®¿é—®ä¸Šä¸€ä¸ª <code>props</code> çš„å€¼ã€‚</p>\n<p>ä½ å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸å°†ä¸Šä¸€ä¸ª <code>props</code> ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>getDerivedStateFromProps</code>ã€‚æˆ‘ä»¬åœ¨è®¾è®¡ API æ—¶è€ƒè™‘è¿‡è¿™ä¸ªæ–¹æ¡ˆï¼Œä½†æœ€ç»ˆå†³å®šä¸é‡‡ç”¨å®ƒï¼ŒåŸå› æœ‰ä¸¤ä¸ªï¼š</p>\n<ul>\n<li><p><code>prevProps</code> å‚æ•°åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>getDerivedStateFromProps</code>ï¼ˆå®ä¾‹åŒ–ä¹‹åï¼‰æ—¶ä¸º <code>null</code>ï¼Œéœ€è¦åœ¨æ¯æ¬¡è®¿é—® <code>prevProps</code> æ—¶æ·»åŠ  <code>if-not-null</code> æ£€æŸ¥ã€‚</p>\n</li>\n<li><p>åœ¨ <code>React</code> çš„æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œä¸ä¼ é€’ä¸Šä¸€ä¸ª <code>props</code> ç»™è¿™ä¸ªæ–¹æ³•æ˜¯ä¸ºäº†é‡Šæ”¾å†…å­˜ã€‚ï¼ˆå¦‚æœ <code>React</code> æ— éœ€ä¼ é€’ä¸Šä¸€ä¸ª <code>props</code> ç»™ç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¹ˆå®ƒå°±æ— éœ€ä¿å­˜ä¸Šä¸€ä¸ª <code>props</code> å¯¹è±¡åœ¨å†…å­˜ä¸­ã€‚ï¼‰</p>\n</li>\n</ul>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p><p>æ³¨æ„</p>\n<p>å¦‚æœä½ æ­£åœ¨ç¼–å†™å…±äº«ç»„ä»¶ï¼Œ<code>react-lifecycles-compat</code> polyfill å¯ä»¥åœ¨æ—§ç‰ˆæœ¬çš„ React é‡Œé¢ä½¿ç”¨æ–°çš„ <code>getDerivedStateFromProps</code> ç”Ÿå‘½å‘¨æœŸã€‚åœ¨ä¸‹é¢äº†è§£æ›´å¤šå¦‚ä½•ä½¿ç”¨ã€‚</p>\n</p>\n</div>\n<h3 id=\"è°ƒç”¨å¤–éƒ¨å›è°ƒ\"><a href=\"#è°ƒç”¨å¤–éƒ¨å›è°ƒ\" class=\"headerlink\" title=\"è°ƒç”¨å¤–éƒ¨å›è°ƒ\"></a>è°ƒç”¨å¤–éƒ¨å›è°ƒ</h3><p>è°ƒç”¨å¤–éƒ¨å›è°ƒ<br>ä¸‹é¢æ˜¯ä¸€ä¸ªç»„ä»¶çš„ç¤ºä¾‹ï¼Œå®ƒåœ¨å†…éƒ¨ state å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨äº†å¤–éƒ¨å‡½æ•°ï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; Before\nclass ExampleComponent extends React.Component &#123;\n  componentWillUpdate(nextProps, nextState) &#123;\n    if (this.state.someStatefulValue !&#x3D;&#x3D; nextState.someStatefulValue) &#123;\n      nextProps.onChange(nextState.someStatefulValue);\n    &#125;\n  &#125;\n&#125;</code></pre>\n\n<h3 id=\"è¯¯è§£-3\"><a href=\"#è¯¯è§£-3\" class=\"headerlink\" title=\"è¯¯è§£ 3\"></a>è¯¯è§£ 3</h3><p>æœ‰æ—¶äººä»¬ä½¿ç”¨ <code>componentWillUpdate</code> æ˜¯å‡ºäºä¸€ç§é”™è¯¯çš„æ‹…å¿ƒï¼Œå³å½“ <code>componentDidUpdate</code> è§¦å‘æ—¶ï¼Œæ›´æ–°å…¶ä»–ç»„ä»¶çš„ <code>state</code> å·²ç»â€å¤ªæ™šâ€äº†ã€‚äº‹å®å¹¶éå¦‚æ­¤ã€‚React å¯ç¡®ä¿åœ¨ç”¨æˆ·çœ‹åˆ°æ›´æ–°çš„ UI ä¹‹å‰ï¼Œåˆ·æ–°åœ¨ <code>componentDidMount</code> å’Œ <code>componentDidUpdate</code> æœŸé—´å‘ç”Ÿçš„ä»»ä½• <code>setState</code> è°ƒç”¨ã€‚é€šå¸¸ï¼Œæœ€å¥½é¿å…è¿™æ ·çš„çº§è”æ›´æ–°ï¼Œ<em>ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™äº›æ›´æ–°æ˜¯å¿…éœ€çš„ï¼ˆä¾‹å¦‚ï¼šå¦‚æœä½ éœ€è¦åœ¨æµ‹é‡æ¸²æŸ“çš„ DOM å…ƒç´ åï¼Œå®šä½å·¥å…·çš„æç¤ºï¼‰ã€‚</em></p>\n<p>ä¸ç®¡æ€æ ·ï¼Œåœ¨å¼‚æ­¥æ¨¡å¼ä¸‹ä½¿ç”¨ <code>componentWillUpdate</code> éƒ½æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸º<code>å¤–éƒ¨å›è°ƒå¯èƒ½ä¼šåœ¨ä¸€æ¬¡æ›´æ–°ä¸­è¢«å¤šæ¬¡è°ƒç”¨</code>ã€‚ç›¸åï¼Œåº”è¯¥ä½¿ç”¨ <code>componentDidUpdate</code> ç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºå®ƒä¿è¯æ¯æ¬¡æ›´æ–°åªè°ƒç”¨ä¸€æ¬¡ï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; After\nclass ExampleComponent extends React.Component &#123;\n  componentDidUpdate(prevProps, prevState) &#123;\n    if (this.state.someStatefulValue !&#x3D;&#x3D; prevState.someStatefulValue) &#123;\n      this.props.onChange(this.state.someStatefulValue);\n    &#125;\n  &#125;\n&#125;</code></pre>\n\n<h3 id=\"props-æ›´æ–°çš„å‰¯ä½œç”¨\"><a href=\"#props-æ›´æ–°çš„å‰¯ä½œç”¨\" class=\"headerlink\" title=\"props æ›´æ–°çš„å‰¯ä½œç”¨\"></a>props æ›´æ–°çš„å‰¯ä½œç”¨</h3><p>ç±»ä¼¼äºä¸Šé¢çš„ä¾‹å­ï¼Œæœ‰æ—¶å€™ç»„ä»¶åœ¨ <code>props</code> å‘ç”Ÿå˜åŒ–æ—¶ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; Before\nclass ExampleComponent extends React.Component &#123;\n  componentWillReceiveProps(nextProps) &#123;\n    if (this.props.isVisible !&#x3D;&#x3D; nextProps.isVisible) &#123;\n      logVisibleChange(nextProps.isVisible);\n    &#125;\n  &#125;\n&#125;</code></pre>\n\n<p>ä¸ <code>componentWillUpdate</code> ç±»ä¼¼ï¼Œ<code>componentWillReceiveProps</code> å¯èƒ½åœ¨ä¸€æ¬¡æ›´æ–°ä¸­è¢«å¤šæ¬¡è°ƒç”¨ã€‚<strong>å› æ­¤ï¼Œé¿å…åœ¨æ­¤æ–¹æ³•ä¸­äº§ç”Ÿå‰¯ä½œç”¨éå¸¸é‡è¦</strong>ã€‚ç›¸åï¼Œåº”è¯¥ä½¿ç”¨ <code>componentDidUpdate</code>ï¼Œå› ä¸ºå®ƒä¿è¯æ¯æ¬¡æ›´æ–°åªè°ƒç”¨ä¸€æ¬¡ï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; After\nclass ExampleComponent extends React.Component &#123;\n  componentDidUpdate(prevProps, prevState) &#123;\n    if (this.props.isVisible !&#x3D;&#x3D; prevProps.isVisible) &#123;\n      logVisibleChange(this.props.isVisible);\n    &#125;\n  &#125;\n&#125;</code></pre>\n\n<h3 id=\"props-æ›´æ–°æ—¶è·å–å¤–éƒ¨æ•°æ®\"><a href=\"#props-æ›´æ–°æ—¶è·å–å¤–éƒ¨æ•°æ®\" class=\"headerlink\" title=\"props æ›´æ–°æ—¶è·å–å¤–éƒ¨æ•°æ®\"></a>props æ›´æ–°æ—¶è·å–å¤–éƒ¨æ•°æ®</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç»„ä»¶çš„ç¤ºä¾‹ï¼Œå®ƒæ ¹æ® props çš„å€¼è·å–å¤–éƒ¨æ•°æ®ï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; Before\nclass ExampleComponent extends React.Component &#123;\n  state &#x3D; &#123;\n    externalData: null,\n  &#125;;\n\n  componentDidMount() &#123;\n    this._loadAsyncData(this.props.id);\n  &#125;\n\n  componentWillReceiveProps(nextProps) &#123;\n    if (nextProps.id !&#x3D;&#x3D; this.props.id) &#123;\n      this.setState(&#123; externalData: null &#125;);\n      this._loadAsyncData(nextProps.id);\n    &#125;\n  &#125;\n\n  componentWillUnmount() &#123;\n    if (this._asyncRequest) &#123;\n      this._asyncRequest.cancel();\n    &#125;\n  &#125;\n\n  render() &#123;\n    if (this.state.externalData &#x3D;&#x3D;&#x3D; null) &#123;\n      &#x2F;&#x2F; æ¸²æŸ“åŠ è½½çŠ¶æ€ ...\n    &#125; else &#123;\n      &#x2F;&#x2F; æ¸²æŸ“çœŸå® UI ...\n    &#125;\n  &#125;\n\n  _loadAsyncData(id) &#123;\n    this._asyncRequest &#x3D; loadMyAsyncData(id).then((externalData) &#x3D;&gt; &#123;\n      this._asyncRequest &#x3D; null;\n      this.setState(&#123; externalData &#125;);\n    &#125;);\n  &#125;\n&#125;</code></pre>\n\n<p>æ­¤ç»„ä»¶çš„æ¨èå‡çº§è·¯å¾„æ˜¯å°†æ•°æ®æ›´æ–°ç§»åŠ¨åˆ° <code>componentDidUpdate</code>ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨æ–°çš„ <code>getDerivedStateFromProps</code> ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨æ¸²æŸ“æ–°çš„ props ä¹‹å‰æ¸…é™¤æ—§æ•°æ®ï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; After\nclass ExampleComponent extends React.Component &#123;\n  state &#x3D; &#123;\n    externalData: null,\n  &#125;;\n\n  static getDerivedStateFromProps(props, state) &#123;\n    &#x2F;&#x2F; ä¿å­˜ prevId åœ¨ state ä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬åœ¨ props å˜åŒ–æ—¶è¿›è¡Œå¯¹æ¯”ã€‚\n    &#x2F;&#x2F; æ¸…é™¤ä¹‹å‰åŠ è½½çš„æ•°æ®ï¼ˆè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šæ¸²æŸ“æ—§çš„å†…å®¹ï¼‰ã€‚\n    if (props.id !&#x3D;&#x3D; state.prevId) &#123;\n      return &#123;\n        externalData: null,\n        prevId: props.id,\n      &#125;;\n    &#125;\n    &#x2F;&#x2F; æ— éœ€æ›´æ–° state\n    return null;\n  &#125;\n\n  componentDidMount() &#123;\n    this._loadAsyncData(this.props.id);\n  &#125;\n\n  componentDidUpdate(prevProps, prevState) &#123;\n    if (this.state.externalData &#x3D;&#x3D;&#x3D; null) &#123;\n      this._loadAsyncData(this.props.id);\n    &#125;\n  &#125;\n\n  componentWillUnmount() &#123;\n    if (this._asyncRequest) &#123;\n      this._asyncRequest.cancel();\n    &#125;\n  &#125;\n\n  render() &#123;\n    if (this.state.externalData &#x3D;&#x3D;&#x3D; null) &#123;\n      &#x2F;&#x2F; æ¸²æŸ“åŠ è½½çŠ¶æ€ ...\n    &#125; else &#123;\n      &#x2F;&#x2F; æ¸²æŸ“çœŸå® UI ...\n    &#125;\n  &#125;\n\n  _loadAsyncData(id) &#123;\n    this._asyncRequest &#x3D; loadMyAsyncData(id).then((externalData) &#x3D;&gt; &#123;\n      this._asyncRequest &#x3D; null;\n      this.setState(&#123; externalData &#125;);\n    &#125;);\n  &#125;\n&#125;</code></pre>\n\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>æ³¨æ„</p>\n<p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨æ”¯æŒå–æ¶ˆçš„ HTTP åº“ï¼Œä¾‹å¦‚ axios é‚£ä¹ˆåœ¨å¸è½½æ—¶å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚éå¸¸ç®€å•ã€‚å¯¹äºåŸç”Ÿçš„ Promiseï¼Œ<a href=\"https://gist.github.com/bvaughn/982ab689a41097237f6e9860db7ca8d6\" target=\"_blank\" >ä½ å¯ä»¥ä½¿ç”¨ç±»ä¼¼æ­¤å¤„æ‰€ç¤ºçš„æ–¹æ³•</a>ã€‚</p>\n</div>\n<h3 id=\"æ›´æ–°å‰è¯»å–-DOM-å±æ€§\"><a href=\"#æ›´æ–°å‰è¯»å–-DOM-å±æ€§\" class=\"headerlink\" title=\"æ›´æ–°å‰è¯»å– DOM å±æ€§\"></a>æ›´æ–°å‰è¯»å– DOM å±æ€§</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç»„ä»¶çš„ç¤ºä¾‹ï¼Œè¯¥ç»„ä»¶åœ¨æ›´æ–°ä¹‹å‰ä» DOM ä¸­è¯»å–å±æ€§ï¼Œä»¥ä¾¿åœ¨åˆ—è¡¨ä¸­ä¿æŒæ»šåŠ¨çš„ä½ç½®</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">class ScrollingList extends React.Component &#123;\n  listRef &#x3D; null;\n  previousScrollOffset &#x3D; null;\n\n  componentWillUpdate(nextProps, nextState) &#123;\n    &#x2F;&#x2F; æˆ‘ä»¬æ­£åœ¨å‘åˆ—è¡¨ä¸­æ·»åŠ æ–°é¡¹å—ï¼Ÿ\n    &#x2F;&#x2F; æ•è·æ»šåŠ¨ä½ç½®ï¼Œä»¥ä¾¿æˆ‘ä»¬ç¨åå¯ä»¥è°ƒæ•´æ»šåŠ¨ä½ç½®ã€‚\n    if (this.props.list.length &lt; nextProps.list.length) &#123;\n      this.previousScrollOffset &#x3D;\n        this.listRef.scrollHeight - this.listRef.scrollTop;\n    &#125;\n  &#125;\n\n  componentDidUpdate(prevProps, prevState) &#123;\n    &#x2F;&#x2F; å¦‚æœæˆ‘ä»¬åˆšåˆšæ·»åŠ äº†æ–°é¡¹ï¼Œå¹¶ä¸”è®¾ç½®äº† previousScrollOffsetã€‚\n    &#x2F;&#x2F; è°ƒæ•´æ»šåŠ¨ä½ç½®ï¼Œä»¥ä¾¿è¿™äº›æ–°é¡¹ä¸ä¼šæŠŠæ—§é¡¹æŒ¤å‡ºè§†å›¾ã€‚\n    if (this.previousScrollOffset !&#x3D;&#x3D; null) &#123;\n      this.listRef.scrollTop &#x3D;\n        this.listRef.scrollHeight - this.previousScrollOffset;\n      this.previousScrollOffset &#x3D; null;\n    &#125;\n  &#125;\n\n  render() &#123;\n    return &lt;div ref&#x3D;&#123;this.setListRef&#125;&gt;&#123;&#x2F;* ...å†…å®¹... *&#x2F;&#125;&lt;&#x2F;div&gt;;\n  &#125;\n\n  setListRef &#x3D; (ref) &#x3D;&gt; &#123;\n    this.listRef &#x3D; ref;\n  &#125;;\n&#125;</code></pre>\n\n<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>componentWillUpdate</code> ç”¨äºè¯»å– DOM å±æ€§ã€‚ä½†æ˜¯ï¼Œå¯¹äºå¼‚æ­¥æ¸²æŸ“ï¼Œâ€œæ¸²æŸ“â€é˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ <code>componentWillUpdate</code> å’Œ <code>render</code>ï¼‰å’Œâ€æäº¤â€é˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ <code>componentDidUpdate</code>ï¼‰ä¹‹é—´å¯èƒ½å­˜åœ¨å»¶è¿Ÿã€‚å¦‚æœç”¨æˆ·åœ¨è¿™æ®µæ—¶é—´å†…è°ƒæ•´çª—å£å¤§å°ï¼Œé‚£ä¹ˆä» <code>componentWillUpdate</code> è¯»å–çš„ <code>scrollHeight</code> å€¼å°†è¿‡æ—¶ã€‚</p>\n<p>è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ–°çš„â€œæäº¤â€é˜¶æ®µç”Ÿå‘½å‘¨æœŸ <code>getSnapshotBeforeUpdate</code>ã€‚è¿™ä¸ªæ–¹æ³•åœ¨å‘ç”Ÿå˜åŒ– <em>å‰ç«‹å³</em> è¢«è°ƒç”¨ï¼ˆä¾‹å¦‚åœ¨æ›´æ–° DOM ä¹‹å‰ï¼‰ã€‚å®ƒå¯ä»¥è¿”å›ä¸€ä¸ª React çš„å€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>componentDidUpdate</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨å‘ç”Ÿå˜åŒ– <em>åç«‹å³</em> è¢«è°ƒç”¨ã€‚</p>\n<p>è¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå¯ä»¥åƒè¿™æ ·ä¸€èµ·ä½¿ç”¨ï¼š</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\">class ScrollingList extends React.Component &#123;\n  listRef &#x3D; null;\n\n  getSnapshotBeforeUpdate(prevProps, prevState) &#123;\n    &#x2F;&#x2F; æˆ‘ä»¬æ­£åœ¨å‘åˆ—è¡¨ä¸­æ·»åŠ æ–°é¡¹å—ï¼Ÿ\n    &#x2F;&#x2F; æ•è·æ»šåŠ¨ä½ç½®ï¼Œä»¥ä¾¿æˆ‘ä»¬ç¨åå¯ä»¥è°ƒæ•´æ»šåŠ¨ä½ç½®ã€‚\n    if (prevProps.list.length &lt; this.props.list.length) &#123;\n      return this.listRef.scrollHeight - this.listRef.scrollTop;\n    &#125;\n    return null;\n  &#125;\n\n  componentDidUpdate(prevProps, prevState, snapshot) &#123;\n    &#x2F;&#x2F; å¦‚æœæˆ‘ä»¬åˆšåˆšæ·»åŠ äº†æ–°é¡¹ï¼Œå¹¶ä¸”æœ‰äº†å¿«ç…§å€¼ã€‚\n    &#x2F;&#x2F; è°ƒæ•´æ»šåŠ¨ä½ç½®ï¼Œä»¥ä¾¿è¿™äº›æ–°é¡¹ä¸ä¼šæŠŠæ—§é¡¹æŒ¤å‡ºè§†å›¾ã€‚\n    &#x2F;&#x2F; ï¼ˆæ­¤å¤„çš„å¿«ç…§æ˜¯ä» getSnapshotBeforeUpdate è¿”å›çš„å€¼ï¼‰\n    if (snapshot !&#x3D;&#x3D; null) &#123;\n      this.listRef.scrollTop &#x3D; this.listRef.scrollHeight - snapshot;\n    &#125;\n  &#125;\n\n  render() &#123;\n    return &lt;div ref&#x3D;&#123;this.setListRef&#125;&gt;&#123;&#x2F;* ...å†…å®¹... *&#x2F;&#125;&lt;&#x2F;div&gt;;\n  &#125;\n\n  setListRef &#x3D; (ref) &#x3D;&gt; &#123;\n    this.listRef &#x3D; ref;\n  &#125;;\n&#125;</code></pre>\n\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>æ³¨æ„</p>\n<p>å¦‚æœä½ æ­£åœ¨ç¼–å†™å…±äº«ç»„ä»¶ï¼Œé‚£ä¹ˆ react-lifecycles-compat polyfill å¯ä»¥ä½¿æ–°çš„ getSnapshotBeforeUpdate ç”Ÿå‘½å‘¨æœŸä¸æ—§ç‰ˆæœ¬çš„ React ä¸€èµ·ä½¿ç”¨ã€‚åœ¨ä¸‹é¢äº†è§£æ›´å¤šå¦‚ä½•ä½¿ç”¨ã€‚</p>\n\n</div>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>è¯¯è§£ã€æ»¥ç”¨ã€å¼‚æ­¥ä¸­è€ API å¤šæ¬¡è°ƒç”¨</p>\n<ul>\n<li><p>è¯¯è§£ <code>componentWillMount</code> ä¸­åˆå§‹åŒ– state</p>\n<br/>\n<br/>\n</li>\n<li><p>è¯¯è§£ <code>componentWillMount</code> ä¸­è·å–æ•°æ®ï¼Œåœ¨ <code>componentWillMount</code> ä¹‹åç«‹å³æ‰§è¡Œ <code>render</code>ã€‚å¦‚æœåœ¨ <code>componentWillMount</code> è§¦å‘æ—¶æ•°æ®ä¸å¯ç”¨ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡ <code>render</code> ä»ç„¶ä¼šæ˜¾ç¤ºåŠ è½½çš„çŠ¶æ€ï¼Œè€Œä¸ç®¡ä½ åœ¨å“ªé‡Œåˆå§‹åŒ–è·å–æ•°æ®</p>\n<br/>\n<br/>\n</li>\n<li><p>è¯¯è§£ <code>componentWillMount</code> ä¸­è®¢é˜…ï¼Œåœ¨æœåŠ¡ç«¯ä¸ä¼šè°ƒç”¨<code>componentWillUnMount</code>,å¯¼è‡´å†…å­˜æ³„æ¼,</p>\n<br/>\n<br/>\n</li>\n<li><p>ä½¿ç”¨ <code>componentWillUpdate</code> æ˜¯å‡ºäºä¸€ç§é”™è¯¯çš„æ‹…å¿ƒï¼Œå³å½“ <code>componentDidUpdate</code> è§¦å‘æ—¶ï¼Œæ›´æ–°å…¶ä»–ç»„ä»¶çš„ <code>state</code> å·²ç»â€å¤ªæ™šâ€äº†ã€‚äº‹å®å¹¶éå¦‚æ­¤ã€‚React å¯ç¡®ä¿åœ¨ç”¨æˆ·çœ‹åˆ°æ›´æ–°çš„ UI ä¹‹å‰ï¼Œåˆ·æ–°åœ¨ <code>componentDidMount</code> å’Œ <code>componentDidUpdate</code> æœŸé—´å‘ç”Ÿçš„ä»»ä½• <code>setState</code> è°ƒç”¨ã€‚é€šå¸¸ï¼Œæœ€å¥½é¿å…è¿™æ ·çš„çº§è”æ›´æ–°ï¼Œ<em>ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™äº›æ›´æ–°æ˜¯å¿…éœ€çš„ï¼ˆä¾‹å¦‚ï¼šå¦‚æœä½ éœ€è¦åœ¨æµ‹é‡æ¸²æŸ“çš„ DOM å…ƒç´ åï¼Œå®šä½å·¥å…·çš„æç¤ºï¼‰ã€‚</em> <strong>å¼‚æ­¥ä¸­ï¼Œå¤šæ¬¡è°ƒç”¨</strong></p>\n<br/>\n<br/>\n</li>\n<li><p><code>componentWillReceiveProps</code> å¯èƒ½åœ¨ä¸€æ¬¡æ›´æ–°ä¸­è¢«å¤šæ¬¡è°ƒç”¨ã€‚<strong>å› æ­¤ï¼Œé¿å…åœ¨æ­¤æ–¹æ³•ä¸­äº§ç”Ÿå‰¯ä½œç”¨éå¸¸é‡è¦</strong></p>\n</li>\n</ul>\n<h2 id=\"å‚è€ƒé“¾æ¥\"><a href=\"#å‚è€ƒé“¾æ¥\" class=\"headerlink\" title=\"å‚è€ƒé“¾æ¥\"></a>å‚è€ƒé“¾æ¥</h2><p><a href=\"https://zh-hans.reactjs.org/blog/2018/03/27/update-on-async-rendering.html\" target=\"_blank\" >å¼‚æ­¥æ¸²æŸ“ä¹‹æ›´æ–°</a></p>\n","text":"æˆ‘æ•´ç†è¿™ç¯‡æ–‡ç« çš„ç›®çš„å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘åœ¨å­¦æŠ€æœ¯æ—¶å€™æ›´å¤šå…³æ³¨çš„æ˜¯æ•™ç¨‹å’Œæ–‡æ¡£,åŸå› æœ‰ä¸‰ï¼šæ—¶é—´ç´§ã€ä»»åŠ¡é‡ã€æ–°æŠ€æœ¯å¾ˆå¤š æœ€è¿‘æ‰‹å¤´æ— äº‹ï¼Œåˆšå¥½æœæºç æœåˆ°äº†ï¼Œå¸Œæœ›é—²æš‡ä¹‹ä½™ï¼Œä½ ä¹Ÿèƒ½äº†è§£ React å˜æ›´è¿‡ç¨‹ï¼ŒåŠ æ·± React çš„ç†è§£ è¿‡æ—¶çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå¾€å¾€ä¼šå¸¦æ¥ä¸å®‰å…¨çš„ç¼–ç å®è·µ componentWi...","link":"","photos":[],"count_time":{"symbolsCount":"17k","symbolsTime":"15 mins."},"categories":[{"name":"React@16.5.0","slug":"React-16-5-0","count":5,"path":"api/categories/React-16-5-0.json"}],"tags":[{"name":"React@16.5.0","slug":"React-16-5-0","count":5,"path":"api/tags/React-16-5-0.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%88%91%E6%95%B4%E7%90%86%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E7%9A%84%E7%9B%AE%E7%9A%84\"><span class=\"toc-text\">æˆ‘æ•´ç†è¿™ç¯‡æ–‡ç« çš„ç›®çš„</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%BF%87%E6%97%B6%E7%9A%84%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%BE%80%E5%BE%80%E4%BC%9A%E5%B8%A6%E6%9D%A5%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E7%BC%96%E7%A0%81%E5%AE%9E%E8%B7%B5\"><span class=\"toc-text\">è¿‡æ—¶çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå¾€å¾€ä¼šå¸¦æ¥ä¸å®‰å…¨çš„ç¼–ç å®è·µ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%81%B5%E5%BE%AA%E8%AF%AD%E4%B9%89%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6\"><span class=\"toc-text\">éµå¾ªè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%BF%81%E7%A7%BB%E8%BF%87%E6%97%B6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F\"><span class=\"toc-text\">è¿ç§»è¿‡æ—¶çš„ç”Ÿå‘½å‘¨æœŸ</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#getDerivedStateFromProps\"><span class=\"toc-text\">getDerivedStateFromProps</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#getSnapshotBeforeUpdate\"><span class=\"toc-text\">getSnapshotBeforeUpdate</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%A4%BA%E4%BE%8B\"><span class=\"toc-text\">ç¤ºä¾‹</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96-state\"><span class=\"toc-text\">åˆå§‹åŒ– state</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%8E%B7%E5%8F%96%E5%A4%96%E9%83%A8%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">è·å–å¤–éƒ¨æ•°æ®</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AF%AF%E8%A7%A3-1\"><span class=\"toc-text\">è¯¯è§£ 1</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8%EF%BC%88%E6%88%96%E8%AE%A2%E9%98%85%EF%BC%89\"><span class=\"toc-text\">æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼ˆæˆ–è®¢é˜…ï¼‰</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AF%AF%E8%A7%A3-2\"><span class=\"toc-text\">è¯¯è§£ 2</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E4%BA%8E-props-%E6%9B%B4%E6%96%B0-state\"><span class=\"toc-text\">åŸºäº props æ›´æ–° state</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%B0%83%E7%94%A8%E5%A4%96%E9%83%A8%E5%9B%9E%E8%B0%83\"><span class=\"toc-text\">è°ƒç”¨å¤–éƒ¨å›è°ƒ</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AF%AF%E8%A7%A3-3\"><span class=\"toc-text\">è¯¯è§£ 3</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#props-%E6%9B%B4%E6%96%B0%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8\"><span class=\"toc-text\">props æ›´æ–°çš„å‰¯ä½œç”¨</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#props-%E6%9B%B4%E6%96%B0%E6%97%B6%E8%8E%B7%E5%8F%96%E5%A4%96%E9%83%A8%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">props æ›´æ–°æ—¶è·å–å¤–éƒ¨æ•°æ®</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9B%B4%E6%96%B0%E5%89%8D%E8%AF%BB%E5%8F%96-DOM-%E5%B1%9E%E6%80%A7\"><span class=\"toc-text\">æ›´æ–°å‰è¯»å– DOM å±æ€§</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">æ€»ç»“</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\"><span class=\"toc-text\">å‚è€ƒé“¾æ¥</span></a></li></ol>","author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"React@16.5.0 PureComponent","uid":"d6e3ef07929a629e78ad737d602fe838","slug":"2022-07-21react-PureComponent","date":"2022-07-21T08:28:39.000Z","updated":"2022-07-23T09:24:12.073Z","comments":true,"path":"api/articles/2022-07-21react-PureComponent.json","keywords":null,"cover":[],"text":"ä¸²ä¸² PureComponent ç»§æ‰¿ Component,æ·»åŠ  isPureReactComponent æ ‡è®° &#x2F;&#x2F; ComponentDummy æ˜¯å…¸å‹çš„ JavaScript åŸå‹æ¨¡æ‹Ÿç»§æ‰¿çš„åšæ³•ï¼Œ function ComponentDummy() &#...","link":"","photos":[],"count_time":{"symbolsCount":"7.7k","symbolsTime":"7 mins."},"categories":[{"name":"React@16.5.0","slug":"React-16-5-0","count":5,"path":"api/categories/React-16-5-0.json"}],"tags":[{"name":"React@16.5.0","slug":"React-16-5-0","count":5,"path":"api/tags/React-16-5-0.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}},"next_post":{"title":"React@16.5.0 createElement","uid":"5d9b43eaa4875051b6cba337b4fe23d2","slug":"2022-07-21react-createElement","date":"2022-07-21T03:18:50.000Z","updated":"2022-07-23T09:24:47.961Z","comments":true,"path":"api/articles/2022-07-21react-createElement.json","keywords":null,"cover":null,"text":"é¡¹ç›®å¼€å‘æ—¶å€™ä¹¦å†™ä»£ç æŸä¸ªé¡µé¢æˆ–è€…æ˜¯ç»„ä»¶ &#x2F;&#x2F; class ReactComponent extends React.Component &#123; &#x2F;&#x2F; render() &#123; &#x2F;&#x2F; return &lt;p ...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"React@16.5.0","slug":"React-16-5-0","count":5,"path":"api/categories/React-16-5-0.json"}],"tags":[{"name":"React@16.5.0","slug":"React-16-5-0","count":5,"path":"api/tags/React-16-5-0.json"}],"author":{"name":"é™ˆæµ·é¾™","slug":"blog-author","avatar":"http://t-blog-images.aijs.top/img/avatar.jpeg","link":"/","description":"éœ€è¦å°±å­¦å‘—ï¼Œå¤šå¤§ç‚¹äº‹ğŸ˜‚","socials":{"github":"https://github.com/841660202","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/web_longboss","juejin":"","customs":{}}}}}